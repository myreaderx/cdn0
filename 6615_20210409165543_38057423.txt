{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2021-04-10 00:55:25","updatedTime":"2021-04-10 00:55:25","title":"âš¡ï¸ React Native å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–â€”â€”Native ç¯‡ï¼ˆå†…å«æºç åˆ†æï¼‰","link":"https://segmentfault.com/a/1190000039797508","description":"<p>Web å¼€å‘æœ‰ä¸€ä¸ªç»å…¸é—®é¢˜ï¼šã€Œ<strong>æµè§ˆå™¨ä¸­ä»è¾“å…¥ URL åˆ°é¡µé¢æ¸²æŸ“çš„è¿™ä¸ªè¿‡ç¨‹ä¸­éƒ½å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</strong>ã€</p>\n<p>æ®æˆ‘è€ƒæ®è¿™ä¸ªé—®é¢˜èµ·ç æœ‰<strong>åå¹´</strong>å†å²äº†ã€‚åœ¨æ—¥æ–°æœˆå¼‚å­¦ä¸åŠ¨çš„å‰ç«¯åœˆå­é‡Œï¼Œè¿™ä¸ªé—®é¢˜èƒ½ä¸€ç›´è¢«é—®ï¼Œå°±æ˜¯å› ä¸ºå› ä¸ºå®ƒæ˜¯ä¸ªéå¸¸å¥½çš„é—®é¢˜ï¼Œæ¶‰åŠéå¸¸å¤šçš„çŸ¥è¯†ç‚¹ï¼Œå¹³æ—¶åšä¸€äº›æ€§èƒ½ä¼˜åŒ–ï¼Œéƒ½å¯ä»¥ä»è¿™ä¸ªé—®é¢˜å‡ºå‘ï¼Œåˆ†ææ€§èƒ½ç“¶é¢ˆï¼Œç„¶åå¯¹ç—‡ä¸‹è¯è¿›è¡Œä¼˜åŒ–ã€‚</p>\n<p>ä¸è¿‡ä»Šå¤©æˆ‘ä»¬ä¸è°ˆ Web çš„æ€§èƒ½ä¼˜åŒ–ï¼Œåªæ˜¯å€ŸåŠ©åˆšåˆšçš„é‚£ä¸ªé‚£ä¸ªç»å…¸é—®é¢˜çš„åˆ†ææ€è·¯ï¼Œ<strong>ä» React Native çš„å¯åŠ¨åˆ°é¡µé¢çš„ç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæˆï¼Œç»“åˆ React Native çš„æºç å’Œ 1.0 çš„æ–°æ¶æ„ï¼Œä¸€ä¸€åˆ†æ React Native çš„å¯åŠ¨æ€§èƒ½ä¼˜åŒ–ä¹‹è·¯</strong>ã€‚</p>\n<blockquote>\n å¦‚æœä½ å–œæ¬¢æˆ‘çš„æ–‡ç« ï¼Œå¸Œæœ›ç‚¹èµğŸ‘ æ”¶è— ğŸ“ è¯„è®º ğŸ’¬ ä¸‰è¿æ”¯æŒä¸€ä¸‹ï¼Œè°¢è°¢ä½ ï¼Œè¿™å¯¹æˆ‘çœŸçš„å¾ˆé‡è¦ï¼\n</blockquote>\n<blockquote>\n <strong>é˜…è¯»æé†’</strong>ï¼š\n <br>1.æ–‡ç« ä¸­çš„æºç å†…å®¹ä¸º RN 0.64 ç‰ˆæœ¬<br>2.æºç åˆ†æå†…å®¹æ¶‰åŠ <code>Objective-C</code>ã€<code>Java</code>ã€<code>C++</code>ã€<code>JavaScript</code> å››é—¨è¯­è¨€ï¼Œæˆ‘å°½é‡è®²å¾—é€šä¿—æ˜“æ‡‚ä¸€äº›ï¼Œè‹¥å®åœ¨ä¸ç†è§£å¯ä»¥ç›´æ¥çœ‹ç»“è®º</br></br>\n</blockquote>\n<h2>0.React Native å¯åŠ¨æµç¨‹</h2>\n<p>React Native ä½œä¸ºä¸€ä¸ª Web å‰ç«¯å‹å¥½çš„æ··åˆå¼€å‘æ¡†æ¶ï¼Œå¯åŠ¨æ—¶å¯ä»¥å¤§è‡´åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>\n<ul>\n <li>Native å®¹å™¨çš„è¿è¡Œ</li>\n <li>JavaScript ä»£ç çš„è¿è¡Œ</li>\n</ul>\n<p>å…¶ä¸­ Native å®¹å™¨å¯åŠ¨åœ¨ç°æœ‰æ¶æ„ï¼ˆç‰ˆæœ¬å·å°äº 1.0.0ï¼‰é‡Œï¼šå¤§è‡´å¯ä»¥åˆ†ä¸º 3 ä¸ªéƒ¨åˆ†ï¼š</p>\n<ul>\n <li>Native å®¹å™¨åˆå§‹åŒ–</li>\n <li>Native Modules çš„<strong>å…¨é‡</strong>ç»‘å®š</li>\n <li>JSEngine çš„åˆå§‹åŒ–</li>\n</ul>\n<p>å®¹å™¨åˆå§‹åŒ–åï¼Œèˆå°å°±äº¤ç»™äº† JavaScriptï¼Œæµç¨‹å¯ä»¥ç»†åˆ†ä¸º 2 ä¸ªéƒ¨åˆ†ï¼š</p>\n<ul>\n <li>JavaScript ä»£ç çš„åŠ è½½ã€è§£æå’Œæ‰§è¡Œ</li>\n <li>JS Component çš„æ„å»º</li>\n</ul>\n<p>æœ€å JS Thread æŠŠè®¡ç®—å¥½çš„å¸ƒå±€ä¿¡æ¯å‘é€åˆ° Native ç«¯ï¼Œè®¡ç®— Shadow Treeï¼Œæœ€åç”± UI Thread è¿›è¡Œå¸ƒå±€å’Œæ¸²æŸ“ã€‚</p>\n<blockquote>\n å…³äºæ¸²æŸ“éƒ¨åˆ†çš„æ€§èƒ½ä¼˜åŒ–å¯ä»¥è§æˆ‘ä¹‹å‰å†™çš„\n <a href=\"https://supercodepower.com/react_native_performance_optimization_guides\" rel=\"nofollow noreferrer\">ã€ŠReact Native æ€§èƒ½ä¼˜åŒ–æŒ‡å—ã€‹</a>ï¼Œæˆ‘ä»\n <strong>æ¸²æŸ“</strong>ã€\n <strong>å›¾ç‰‡</strong>ã€\n <strong>åŠ¨ç”»</strong>ã€\n <strong>é•¿åˆ—è¡¨</strong>ç­‰æ–¹å‘ä»‹ç»äº† RN æ¸²æŸ“ä¼˜åŒ–çš„å¸¸è§å¥—è·¯ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥å‰å¾€æŸ¥çœ‹ï¼Œæˆ‘è¿™é‡Œå°±ä¸å¤šä»‹ç»äº†ã€‚\n</blockquote>\n<p>ä¸Šé¢çš„å‡ ä¸ªæ­¥éª¤ï¼Œæˆ‘ç”»äº†ä¸€å¼ å›¾ï¼Œä¸‹é¢æˆ‘ä»¥è¿™å¼ å›¾ä¸ºç›®å½•ï¼Œä»å·¦å‘å³ä»‹ç»å„ä¸ªæ­¥éª¤çš„ä¼˜åŒ–æ–¹å‘ï¼š</p>\n<p><img src=\"https://segmentfault.com/img/remote/1460000039797510\" alt=\"\" title=\"\" /></p>\n<blockquote>\n <strong>æç¤º</strong>ï¼šReact Native åˆå§‹åŒ–æ—¶ï¼Œæœ‰å¯èƒ½å¤šä¸ªä»»åŠ¡\n <strong>å¹¶è¡Œæ‰§è¡Œ</strong>ï¼Œæ‰€ä»¥ä¸Šå›¾åªèƒ½è¡¨ç¤º React Native åˆå§‹åŒ–çš„å¤§è‡´æµç¨‹ï¼Œå¹¶ä¸å’Œå®é™…ä»£ç çš„æ‰§è¡Œæ—¶åºä¸€ä¸€å¯¹åº”ã€‚\n</blockquote>\n<h2>1.å‡çº§ React Native</h2>\n<p>æƒ³æå‡ React Native åº”ç”¨çš„æ€§èƒ½ï¼Œæœ€ä¸€åŠ³æ°¸é€¸çš„æ–¹æ³•å°±æ˜¯<strong>å‡çº§ RN çš„å¤§ç‰ˆæœ¬</strong>äº†ã€‚æˆ‘ä»¬çš„åº”ç”¨ä» 0.59 å‡çº§åˆ° 0.62 ä¹‹åï¼Œæˆ‘ä»¬çš„ APP æ²¡æœ‰åšä»»ä½•çš„æ€§èƒ½ä¼˜åŒ–å·¥ä½œï¼Œå¯åŠ¨æ—¶é—´ç›´æ¥ç¼©çŸ­äº† 1/2ã€‚å½“ React Native çš„æ–°æ¶æ„å‘å¸ƒåï¼Œå¯åŠ¨é€Ÿåº¦å’Œæ¸²æŸ“é€Ÿåº¦éƒ½ä¼šå¤§å¤§åŠ å¼ºã€‚</p>\n<p>å½“ç„¶ï¼ŒRN çš„ç‰ˆæœ¬å‡çº§å¹¶ä¸å®¹æ˜“ï¼ˆæ¨ªè·¨ iOS Android JS ä¸‰ç«¯ï¼Œå…¼å®¹ç ´åæ€§æ›´æ–°ï¼‰ï¼Œæˆ‘ä¹‹å‰å†™è¿‡ä¸€ç¯‡<a href=\"https://supercodepower.com/docs/react-native-upgrade/index\" rel=\"nofollow noreferrer\">ã€ŠReact Native å‡çº§æŒ‡å—ï¼ˆ0.59 -&gt; 0.62ï¼‰ã€‹</a>çš„æ–‡ç« ï¼Œå¦‚æœæœ‰å‡çº§æƒ³æ³•çš„è€é“å¯ä»¥é˜…è¯»å‚è€ƒä¸€ä¸‹ã€‚</p>\n<h2>2.Native å®¹å™¨åˆå§‹åŒ–</h2>\n<p><img src=\"https://segmentfault.com/img/remote/1460000039797511\" alt=\"\" title=\"\" /></p>\n<p>å®¹å™¨çš„åˆå§‹åŒ–è‚¯å®šæ˜¯ä» APP çš„å…¥å£æ–‡ä»¶å¼€å§‹åˆ†æï¼Œä¸‹é¢æˆ‘ä¼š<strong>æŒ‘é€‰ä¸€äº›å…³é”®ä»£ç </strong>ï¼Œæ¢³ç†ä¸€ä¸‹åˆå§‹åŒ–çš„æµç¨‹ã€‚</p>\n<h3>iOS æºç åˆ†æ</h3>\n<h4>1.AppDelegate.m</h4>\n<p><code>AppDelegate.m</code> æ˜¯ iOS çš„å…¥å£æ–‡ä»¶ï¼Œä»£ç éå¸¸ç²¾ç®€ï¼Œä¸»è¦å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<pre><code class=\"objectivec\">// AppDelegate.m\n\n- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {\n  // 1.åˆå§‹åŒ–ä¸€ä¸ª RCTBridge å®ç°åŠ è½½ jsbundle çš„æ–¹æ³•\n  RCTBridge *bridge = [[RCTBridge alloc] initWithDelegate:self launchOptions:launchOptions];\n\n  // 2.åˆ©ç”¨ RCTBridge åˆå§‹åŒ–ä¸€ä¸ª RCTRootView\n  RCTRootView *rootView = [[RCTRootView alloc] initWithBridge:bridge\n                                                   moduleName:@\"RN64\"\n                                            initialProperties:nil];\n\n  // 3.åˆå§‹åŒ– UIViewController\n  self.window = [[UIWindow alloc] initWithFrame:[UIScreen mainScreen].bounds];\n  UIViewController *rootViewController = [UIViewController new];\n  \n  // 4.å°† RCTRootView èµ‹å€¼ç»™ UIViewController çš„ view\n  rootViewController.view = rootView;\n  self.window.rootViewController = rootViewController;\n  [self.window makeKeyAndVisible];\n  return YES;\n}</code></pre>\n<p>æ€»çš„æ¥çœ‹å…¥å£æ–‡ä»¶å°±åšäº†ä¸‰ä»¶äº‹ï¼š</p>\n<ul>\n <li>åˆå§‹åŒ–ä¸€ä¸ª <code>RCTBridge</code> å®ç°åŠ è½½ jsbundle çš„æ–¹æ³•</li>\n <li>åˆ©ç”¨ <code>RCTBridge</code> åˆå§‹åŒ–ä¸€ä¸ª <code>RCTRootView</code></li>\n <li>å°† <code>RCTRootView</code> èµ‹å€¼ç»™ <code>UIViewController</code> çš„ view å®ç° UI çš„æŒ‚è½½</li>\n</ul>\n<p>ä»å…¥å£æºç æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ‰€æœ‰çš„åˆå§‹åŒ–å·¥ä½œéƒ½<strong>æŒ‡å‘</strong> <code>RCTRootView</code>ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ <code>RCTRootView</code> å¹²äº†äº›å•¥ã€‚</p>\n<h4>2.RCTRootView</h4>\n<p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ <code>RCTRootView</code> çš„å¤´æ–‡ä»¶ï¼Œåˆ ç¹å°±ç®€ï¼Œæˆ‘ä»¬åªçœ‹æˆ‘ä»¬å…³æ³¨çš„ä¸€äº›æ–¹æ³•ï¼š</p>\n<pre><code class=\"objectivec\">// RCTRootView.h\n\n@interface RCTRootView : UIView\n\n// AppDelegate.m ä¸­ç”¨åˆ°çš„åˆå§‹åŒ–æ–¹æ³•\n- (instancetype)initWithBridge:(RCTBridge *)bridge\n                    moduleName:(NSString *)moduleName\n             initialProperties:(nullable NSDictionary *)initialProperties NS_DESIGNATED_INITIALIZER;</code></pre>\n<p>ä»å¤´æ–‡ä»¶çœ‹å‡ºï¼š</p>\n<ul>\n <li><code>RCTRootView</code> ç»§æ‰¿è‡ª <code>UIView</code>ï¼Œæ‰€ä»¥å®ƒæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª UI ç»„ä»¶ï¼›</li>\n <li><code>RCTRootView</code> è°ƒç”¨ <code>initWithBridge</code> åˆå§‹åŒ–æ—¶è¦ä¼ å…¥ä¸€ä¸ªå·²ç»åˆå§‹åŒ–çš„ <code>RCTBridge</code></li>\n</ul>\n<p>åœ¨ <code>RCTRootView.m</code> æ–‡ä»¶é‡Œï¼Œ<code>initWithBridge</code> åˆå§‹åŒ–æ—¶ä¼šç›‘å¬ä¸€ç³»åˆ—çš„ JS åŠ è½½ç›‘å¬å‡½æ•°ï¼Œç›‘å¬åˆ° JS Bundle æ–‡ä»¶åŠ è½½ç»“æŸåï¼Œå°±ä¼šè°ƒç”¨ JS é‡Œçš„ <code>AppRegistry.runApplication()</code>ï¼Œå¯åŠ¨ RN åº”ç”¨ã€‚</p>\n<p>åˆ†æåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å‘ç° <code>RCTRootView.m</code> åªæ˜¯å®ç°äº†å¯¹ <code>RCTBridge</code> çš„çš„å„ç§äº‹ä»¶ç›‘å¬ï¼Œ<strong>å¹¶ä¸æ˜¯åˆå§‹åŒ–çš„æ ¸å¿ƒ</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±åˆè¦è½¬åˆ° <code>RCTBridge</code> è¿™ä¸ªæ–‡ä»¶ä¸Šå»ã€‚</p>\n<h4>3.RCTBridge.m</h4>\n<p><code>RCTBridge.m</code> é‡Œï¼Œåˆå§‹åŒ–çš„è°ƒç”¨è·¯å¾„æœ‰äº›é•¿ï¼Œå…¨è´´æºç æœ‰äº›é•¿ï¼Œæ€»ä¹‹æœ€åè°ƒç”¨çš„æ˜¯ <code>(void)setUp</code>ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"objectivec\">- (Class)bridgeClass\n{\n  return [RCTCxxBridge class];\n}\n\n- (void)setUp {\n  // è·å–bridgeClass é»˜è®¤æ˜¯ RCTCxxBridge\n  Class bridgeClass = self.bridgeClass;\n  // åˆå§‹åŒ– RTCxxBridge\n  self.batchedBridge = [[bridgeClass alloc] initWithParentBridge:self];\n  // å¯åŠ¨ RTCxxBridge\n  [self.batchedBridge start];\n}</code></pre>\n<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>RCTBridge</code> çš„åˆå§‹åŒ–åˆæŒ‡å‘äº† <code>RTCxxBridge</code>ã€‚</p>\n<h4>4.RTCxxBridge.mm</h4>\n<p><code>RTCxxBridge</code> å¯ä»¥è¯´æ˜¯ React Native åˆå§‹åŒ–çš„<strong>æ ¸å¿ƒ</strong>ï¼Œæˆ‘æŸ¥é˜…äº†ä¸€äº›èµ„æ–™ï¼Œè²Œä¼¼ <code>RTCxxBridge</code> æ›¾ç”¨åä¸º <code>RCTBatchedBridge</code>ï¼Œæ‰€ä»¥å¯ä»¥ç²—æš´çš„æŠŠè¿™ä¸¤ä¸ªç±»å½“æˆä¸€å›äº‹å„¿ã€‚</p>\n<p>å› ä¸ºåœ¨ <code>RCTBridge</code> é‡Œè°ƒç”¨äº† <code>RTCxxBridge</code> çš„ <code>start</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å°±ä» <code>start</code> æ–¹æ³•æ¥çœ‹çœ‹åšäº†äº›ä»€ä¹ˆã€‚</p>\n<pre><code class=\"objectivec\">// RTCxxBridge.mm\n\n- (void)start {\n  // 1.åˆå§‹åŒ– JSThreadï¼Œåç»­æ‰€æœ‰çš„ js ä»£ç éƒ½åœ¨è¿™ä¸ªçº¿ç¨‹é‡Œé¢æ‰§è¡Œ\n  _jsThread = [[NSThread alloc] initWithTarget:[self class] selector:@selector(runRunLoop) object:nil];\n  [_jsThread start];\n  \n  // åˆ›å»ºå¹¶è¡Œé˜Ÿåˆ—\n  dispatch_group_t prepareBridge = dispatch_group_create();\n  \n  // 2.æ³¨å†Œæ‰€æœ‰çš„ native modules\n  [self registerExtraModules];\n  (void)[self _initializeModules:RCTGetModuleClasses() withDispatchGroup:prepareBridge lazilyDiscovered:NO];\n  \n  // 3.åˆå§‹åŒ– JSExecutorFactory å®ä¾‹\n  std::shared_ptr&lt;JSExecutorFactory&gt; executorFactory;\n  \n  // 4.åˆå§‹åŒ–åº•å±‚ Instance å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯ _reactInstance\n  dispatch_group_enter(prepareBridge);\n  [self ensureOnJavaScriptThread:^{\n    [weakSelf _initializeBridge:executorFactory];\n    dispatch_group_leave(prepareBridge);\n  }];\n  \n  // 5.åŠ è½½ js ä»£ç \n  dispatch_group_enter(prepareBridge);\n  __block NSData *sourceCode;\n  [self\n      loadSource:^(NSError *error, RCTSource *source) {\n        if (error) {\n          [weakSelf handleError:error];\n        }\n\n        sourceCode = source.data;\n        dispatch_group_leave(prepareBridge);\n      }\n      onProgress:^(RCTLoadingProgress *progressData) {\n      }\n  ];\n  \n  // 6.ç­‰å¾… native moudle å’Œ JS ä»£ç åŠ è½½å®Œæ¯•åå°±æ‰§è¡Œ JS\n  dispatch_group_notify(prepareBridge, dispatch_get_global_queue(QOS_CLASS_USER_INTERACTIVE, 0), ^{\n    RCTCxxBridge *strongSelf = weakSelf;\n    if (sourceCode &amp;&amp; strongSelf.loading) {\n      [strongSelf executeSourceCode:sourceCode sync:NO];\n    }\n  });\n}</code></pre>\n<p>ä¸Šé¢ä»£ç æ¯”è¾ƒé•¿ï¼Œé‡Œé¢ç”¨åˆ°äº† <strong>GCD å¤šçº¿ç¨‹</strong>çš„ä¸€äº›çŸ¥è¯†ç‚¹ï¼Œç”¨æ–‡å­—æè¿°å¤§è‡´æ˜¯å¦‚ä¸‹çš„æµç¨‹ï¼š</p>\n<ol>\n <li>åˆå§‹åŒ– js çº¿ç¨‹ <code>_jsThread</code></li>\n <li>åœ¨ä¸»çº¿ç¨‹ä¸Šæ³¨å†Œæ‰€æœ‰ <code>native modules</code></li>\n <li>å‡†å¤‡ <code>js</code> å’Œ <code>Native</code> ä¹‹é—´çš„æ¡¥å’Œ js è¿è¡Œç¯å¢ƒ</li>\n <li>åœ¨ JS çº¿ç¨‹ä¸Šåˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ— <code>RCTMessageThread</code>ï¼Œåˆå§‹åŒ– <code>_reactInstance</code></li>\n <li>åœ¨ JS çº¿ç¨‹ä¸ŠåŠ è½½ JS Bundle</li>\n <li>ç­‰ä¸Šé¢çš„äº‹æƒ…å…¨éƒ¨åšå®Œåï¼Œæ‰§è¡Œ JS ä»£ç </li>\n</ol>\n<p>å…¶å®ä¸Šé¢çš„å…­ä¸ªç‚¹éƒ½å¯ä»¥æ·±æŒ–ä¸‹å»ï¼Œä½†æ˜¯æœ¬èŠ‚æ¶‰åŠåˆ°çš„æºç å†…å®¹åˆ°è¿™é‡Œå°±å¯ä»¥äº†ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥ç»“åˆæˆ‘æœ€åç»™å‡ºçš„å‚è€ƒèµ„æ–™å’Œ React Native æºç æ·±æŒ–æ¢ç´¢ä¸€ä¸‹ã€‚</p>\n<h3>Android æºç åˆ†æ</h3>\n<h4>1.MainActivity.java &amp; MainApplication.java</h4>\n<p>å’Œ iOS ä¸€æ ·ï¼Œå¯åŠ¨æµç¨‹æˆ‘ä»¬å…ˆä»å…¥å£æ–‡ä»¶å¼€å§‹åˆ†æï¼Œæˆ‘ä»¬å…ˆçœ‹ <code>MainActivity.java</code>ï¼š</p>\n<p><code>MainActivity</code> ç»§æ‰¿è‡ª <code>ReactActivity</code>ï¼Œ<code>ReactActivity</code> åˆç»§æ‰¿è‡ª <code>AppCompatActivity</code>ï¼š</p>\n<pre><code class=\"java\">// MainActivity.java\n\npublic class MainActivity extends ReactActivity {\n  // è¿”å›ç»„ä»¶åï¼Œå’Œ js å…¥å£æ³¨å†Œåå­—ä¸€è‡´\n  @Override\n  protected String getMainComponentName() {\n    return \"rn_performance_demo\";\n  }\n}</code></pre>\n<p>æˆ‘ä»¬å†ä» Android çš„å…¥å£æ–‡ä»¶ <code>MainApplication.java</code> å¼€å§‹åˆ†æï¼š</p>\n<pre><code class=\"java\">// MainApplication.java\n\npublic class MainApplication extends Application implements ReactApplication {\n\n  private final ReactNativeHost mReactNativeHost =\n      new ReactNativeHost(this) {\n        // è¿”å› app éœ€è¦çš„ ReactPackageï¼Œæ·»åŠ éœ€è¦åŠ è½½çš„æ¨¡å—ï¼Œ\n        // è¿™ä¸ªåœ°æ–¹å°±æ˜¯æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­æ·»åŠ ä¾èµ–åŒ…æ—¶éœ€è¦æ·»åŠ ç¬¬ä¸‰æ–¹ package çš„åœ°æ–¹\n        @Override\n        protected List&lt;ReactPackage&gt; getPackages() {\n          @SuppressWarnings(\"UnnecessaryLocalVariable\")\n          List&lt;ReactPackage&gt; packages = new PackageList(this).getPackages();\n          return packages;\n        }\n\n        // js bundle å…¥å£æ–‡ä»¶ï¼Œè®¾ç½®ä¸º index.js\n        @Override\n        protected String getJSMainModuleName() {\n          return \"index\";\n        }\n      };\n\n  @Override\n  public ReactNativeHost getReactNativeHost() {\n    return mReactNativeHost;\n  }\n\n  @Override\n  public void onCreate() {\n    super.onCreate();\n    // SoLoaderï¼šåŠ è½½C++åº•å±‚åº“\n    SoLoader.init(this, /* native exopackage */ false);\n  }\n}</code></pre>\n<p><code>ReactApplication</code> æ¥å£å¾ˆç®€å•ï¼Œè¦æ±‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>ReactNativeHost</code> å¯¹è±¡ï¼š</p>\n<pre><code class=\"java\">public interface ReactApplication {\n  ReactNativeHost getReactNativeHost();\n}</code></pre>\n<p>ä»ä¸Šé¢çš„åˆ†ææˆ‘ä»¬å¯ä»¥çœ‹å‡ºä¸€åˆ‡æŒ‡å‘äº† <code>ReactNativeHost</code> è¿™ä¸ªç±»ï¼Œä¸‹é¢æˆ‘ä»¬å°±çœ‹ä¸€ä¸‹å®ƒã€‚</p>\n<h4>2.ReactNativeHost.java</h4>\n<p><code>ReactNativeHost</code> ä¸»è¦çš„å·¥ä½œå°±æ˜¯åˆ›å»ºäº† <code>ReactInstanceManager</code>:</p>\n<pre><code class=\"java\">public abstract class ReactNativeHost {\n  protected ReactInstanceManager createReactInstanceManager() {\n    ReactMarker.logMarker(ReactMarkerConstants.BUILD_REACT_INSTANCE_MANAGER_START);\n    ReactInstanceManagerBuilder builder =\n        ReactInstanceManager.builder()\n            // åº”ç”¨ä¸Šä¸‹æ–‡\n            .setApplication(mApplication)\n            // JSMainModulePath ç›¸å½“äºåº”ç”¨é¦–é¡µçš„ js Bundleï¼Œå¯ä»¥ä¼ é€’ url ä»æœåŠ¡å™¨æ‹‰å– js Bundle\n            // å½“ç„¶è¿™ä¸ªåªåœ¨ dev æ¨¡å¼ä¸‹å¯ä»¥ä½¿ç”¨\n            .setJSMainModulePath(getJSMainModuleName())\n            // æ˜¯å¦å¼€å¯ dev æ¨¡å¼\n            .setUseDeveloperSupport(getUseDeveloperSupport())\n            // çº¢ç›’çš„å›è°ƒ\n            .setRedBoxHandler(getRedBoxHandler())\n            .setJavaScriptExecutorFactory(getJavaScriptExecutorFactory())\n            .setUIImplementationProvider(getUIImplementationProvider())\n            .setJSIModulesPackage(getJSIModulePackage())\n            .setInitialLifecycleState(LifecycleState.BEFORE_CREATE);\n\n    // æ·»åŠ  ReactPackage\n    for (ReactPackage reactPackage : getPackages()) {\n      builder.addPackage(reactPackage);\n    }\n    \n    // è·å– js Bundle çš„åŠ è½½è·¯å¾„\n    String jsBundleFile = getJSBundleFile();\n    if (jsBundleFile != null) {\n      builder.setJSBundleFile(jsBundleFile);\n    } else {\n      builder.setBundleAssetName(Assertions.assertNotNull(getBundleAssetName()));\n    }\n    ReactInstanceManager reactInstanceManager = builder.build();\n    return reactInstanceManager;\n  }\n}</code></pre>\n<h4>3.ReactActivityDelegate.java</h4>\n<p>æˆ‘ä»¬å†å›åˆ° <code>ReactActivity</code>ï¼Œå®ƒè‡ªå·±å¹¶æ²¡æœ‰åšä»€ä¹ˆäº‹æƒ…ï¼Œæ‰€æœ‰çš„åŠŸèƒ½éƒ½ç”±å®ƒçš„å§”æ‰˜ç±» <code>ReactActivityDelegate</code> æ¥å®Œæˆï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥çœ‹<code>ReactActivityDelegate</code>æ˜¯æ€ä¹ˆå®ç°çš„ï¼š</p>\n<pre><code class=\"java\">public class ReactActivityDelegate {\n  protected void onCreate(Bundle savedInstanceState) {\n    String mainComponentName = getMainComponentName();\n    mReactDelegate =\n        new ReactDelegate(\n            getPlainActivity(), getReactNativeHost(), mainComponentName, getLaunchOptions()) {\n          @Override\n          protected ReactRootView createRootView() {\n            return ReactActivityDelegate.this.createRootView();\n          }\n        };\n    if (mMainComponentName != null) {\n      // è½½å…¥ app é¡µé¢\n      loadApp(mainComponentName);\n    }\n  }\n  \n  protected void loadApp(String appKey) {\n    mReactDelegate.loadApp(appKey);\n    // Activity çš„ setContentView() æ–¹æ³•\n    getPlainActivity().setContentView(mReactDelegate.getReactRootView());\n  }\n}</code></pre>\n<p><code>onCreate()</code> çš„æ—¶å€™åˆå®ä¾‹åŒ–äº†ä¸€ä¸ª <code>ReactDelegate</code>ï¼Œæˆ‘ä»¬å†çœ‹çœ‹å®ƒçš„å®ç°ã€‚</p>\n<h4>4.ReactDelegate.java</h4>\n<p>åœ¨ <code>ReactDelegate.java</code> é‡Œï¼Œæˆ‘æ²¡çœ‹è§å®ƒåšäº†ä¸¤ä»¶äº‹ï¼š</p>\n<ul>\n <li>åˆ›å»º <code>ReactRootView</code> ä½œä¸ºæ ¹è§†å›¾</li>\n <li>è°ƒç”¨ <code>getReactNativeHost().getReactInstanceManager()</code> å¯åŠ¨ RN åº”ç”¨</li>\n</ul>\n<pre><code class=\"java\">public class ReactDelegate {\n  public void loadApp(String appKey) {\n    if (mReactRootView != null) {\n      throw new IllegalStateException(\"Cannot loadApp while app is already running.\");\n    }\n    // åˆ›å»º ReactRootView ä½œä¸ºæ ¹è§†å›¾\n    mReactRootView = createRootView();\n    // å¯åŠ¨ RN åº”ç”¨\n    mReactRootView.startReactApplication(\n        getReactNativeHost().getReactInstanceManager(), appKey, mLaunchOptions);\n  }\n}</code></pre>\n<p>åŸºç¡€çš„å¯åŠ¨æµç¨‹æœ¬èŠ‚æ¶‰åŠåˆ°çš„æºç å†…å®¹åˆ°è¿™é‡Œå°±å¯ä»¥äº†ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥ç»“åˆæˆ‘æœ€åç»™å‡ºçš„å‚è€ƒèµ„æ–™å’Œ React Native æºç æ·±æŒ–æ¢ç´¢ä¸€ä¸‹ã€‚</p>\n<h3>ä¼˜åŒ–å»ºè®®</h3>\n<p>å¯¹äº React Native ä¸ºä¸»ä½“çš„åº”ç”¨ï¼ŒAPP å¯åŠ¨åå°±è¦ç«‹é©¬åˆå§‹åŒ– RN å®¹å™¨ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰ä»€ä¹ˆä¼˜åŒ–æ€è·¯ï¼›ä½†æ˜¯ Native ä¸ºä¸»çš„æ··åˆå¼€å‘ APP å´æœ‰æ‹›ï¼š</p>\n<p><strong>æ—¢ç„¶åˆå§‹åŒ–è€—æ—¶æœ€é•¿ï¼Œæˆ‘ä»¬åœ¨æ­£å¼è¿›å…¥ React Native å®¹å™¨å‰æå‰åˆå§‹åŒ–ä¸å°±å¥½äº†ï¼Ÿ</strong></p>\n<p>è¿™ä¸ªæ–¹æ³•éå¸¸çš„å¸¸è§ï¼Œå› ä¸ºå¾ˆå¤š H5 å®¹å™¨ä¹Ÿæ˜¯è¿™æ ·åšçš„ã€‚æ­£å¼è¿›å…¥ WebView ç½‘é¡µå‰ï¼Œå…ˆåšä¸€ä¸ª WebView å®¹å™¨æ± ï¼Œæå‰åˆå§‹åŒ– WebViewï¼Œè¿›å…¥ H5 å®¹å™¨åï¼Œç›´æ¥åŠ è½½æ•°æ®æ¸²æŸ“ï¼Œä»¥è¾¾åˆ°ç½‘é¡µç§’å¼€çš„æ•ˆæœã€‚</p>\n<p><strong>RN å®¹å™¨æ± </strong>è¿™ä¸ªæ¦‚å¿µçœ‹ç€å¾ˆç„ä¹ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ª <code>Map</code>ï¼Œ<code>key</code> ä¸º RN é¡µé¢çš„ <code>componentName</code>ï¼ˆå³ <code>AppRegistry.registerComponent(appName, Component)</code> ä¸­ä¼ å…¥çš„ <code>appName</code>ï¼‰ï¼Œ<code>value</code> å°±æ˜¯ä¸€ä¸ªå·²ç»å®ä¾‹åŒ–çš„ <code>RCTRootView/ReactRootView</code>ã€‚</p>\n<p>APP å¯åŠ¨åæ‰¾ä¸ªè§¦å‘æ—¶æœºæå‰åˆå§‹åŒ–ï¼Œè¿›å…¥ RN å®¹å™¨å‰å…ˆè¯»å®¹å™¨æ± ï¼Œå¦‚æœæœ‰åŒ¹é…çš„å®¹å™¨ï¼Œç›´æ¥æ‹¿æ¥ç”¨å³å¯ï¼Œæ²¡æœ‰åŒ¹é…çš„å†é‡æ–°åˆå§‹åŒ–ã€‚</p>\n<p>å†™ä¸¤ä¸ªå¾ˆç®€å•çš„æ¡ˆä¾‹ï¼ŒiOS å¯ä»¥å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ„å»º RN å®¹å™¨æ± ï¼š</p>\n<pre><code class=\"objectivec\">@property (nonatomic, strong) NSMutableDictionary&lt;NSString *, RCTRootView *&gt; *rootViewRool;\n\n// å®¹å™¨æ± \n-(NSMutableDictionary&lt;NSString *, RCTRootView *&gt; *)rootViewRool {\n  if (!_rootViewRool) {\n    _rootViewRool = @{}.mutableCopy;\n  }\n  \n  return _rootViewRool;\n}\n\n\n// ç¼“å­˜ RCTRootView\n-(void)cacheRootView:(NSString *)componentName path:(NSString *)path props:(NSDictionary *)props bridge:(RCTBridge *)bridge {\n  // åˆå§‹åŒ–\n  RCTRootView *rootView = [[RCTRootView alloc] initWithBridge:bridge\n                                                   moduleName:componentName\n                                            initialProperties:props];\n  // å®ä¾‹åŒ–åè¦åŠ è½½åˆ°å±å¹•çš„æœ€ä¸‹é¢ï¼Œå¦åˆ™ä¸èƒ½è§¦å‘è§†å›¾æ¸²æŸ“\n  [[UIApplication sharedApplication].keyWindow.rootViewController.view insertSubview:rootView atIndex:0];\n  rootView.frame = [UIScreen mainScreen].bounds;\n  \n  // æŠŠç¼“å­˜å¥½çš„ RCTRootView æ”¾åˆ°å®¹å™¨æ± ä¸­\n  NSString *key = [NSString stringWithFormat:@\"%@_%@\", componentName, path];\n  self.rootViewRool[key] = rootView;\n}\n\n\n// è¯»å–å®¹å™¨\n-(RCTRootView *)getRootView:(NSString *)componentName path:(NSString *)path props:(NSDictionary *)props bridge:(RCTBridge *)bridge {\n  NSString *key = [NSString stringWithFormat:@\"%@_%@\", componentName, path];\n  RCTRootView *rootView = self.rootViewRool[key];\n  if (rootView) {\n    return rootView;\n  }\n  \n  // å…œåº•é€»è¾‘\n  return [[RCTRootView alloc] initWithBridge:bridge moduleName:componentName initialProperties:props];\n}</code></pre>\n<p>Android å¦‚ä¸‹æ„å»º RN å®¹å™¨æ± ï¼š</p>\n<pre><code class=\"java\">private HashMap&lt;String, ReactRootView&gt; rootViewPool = new HashMap&lt;&gt;();\n\n// åˆ›å»ºå®¹å™¨\nprivate ReactRootView createRootView(String componentName, String path, Bundle props, Context context) {\n    ReactInstanceManager bridgeInstance = ((ReactApplication) application).getReactNativeHost().getReactInstanceManager();\n    ReactRootView rootView = new ReactRootView(context);\n\n    if(props == null) {\n        props = new Bundle();\n    }\n    props.putString(\"path\", path);\n\n    rootView.startReactApplication(bridgeInstance, componentName, props);\n\n    return rootView;\n}\n\n// ç¼“å­˜å®¹å™¨\npublic void cahceRootView(String componentName, String path, Bundle props, Context context) {\n    ReactRootView rootView = createRootView(componentName, path, props, context);\n    String key = componentName + \"_\" + path;\n\n    // æŠŠç¼“å­˜å¥½çš„ RCTRootView æ”¾åˆ°å®¹å™¨æ± ä¸­\n    rootViewPool.put(key, rootView);\n}\n\n// è¯»å–å®¹å™¨\npublic ReactRootView getRootView(String componentName, String path, Bundle props, Context context) {\n    String key = componentName + \"_\" + path;\n    ReactRootView rootView = rootViewPool.get(key);\n\n    if (rootView != null) {\n        rootView.setAppProperties(newProps);\n        rootViewPool.remove(key);\n        return rootView;\n    }\n\n    // å…œåº•é€»è¾‘\n    return createRootView(componentName, path, props, context);\n}</code></pre>\n<p>å½“ç„¶ï¼Œç”±äºæ¯æ¬¡ <code>RCTRootView/ReactRootView</code> éƒ½è¦å ç”¨ä¸€å®šçš„å†…å­˜ï¼Œæ‰€ä»¥ä»€ä¹ˆæ—¶å€™å®ä¾‹åŒ–ï¼Œå®ä¾‹åŒ–å‡ ä¸ªå®¹å™¨ï¼Œæ± çš„å¤§å°é™åˆ¶ï¼Œä»€ä¹ˆæ—¶å€™æ¸…é™¤å®¹å™¨ï¼Œéƒ½éœ€è¦ç»“åˆä¸šåŠ¡è¿›è¡Œå®è·µå’Œæ‘¸ç´¢ã€‚</p>\n<h2>3.Native Modules ç»‘å®š</h2>\n<p><img src=\"https://segmentfault.com/img/remote/1460000039797515\" alt=\"\" title=\"\" /></p>\n<h3>iOS æºç åˆ†æ</h3>\n<p>iOS çš„ Native Modules æœ‰ 3 å—å„¿å†…å®¹ï¼Œå¤§å¤´æ˜¯ä¸­é—´çš„ <code>_initializeModules</code> å‡½æ•°ï¼š</p>\n<pre><code class=\"objectivec\">// RCTCxxBridge.mm\n\n- (void)start {\n  // åˆå§‹åŒ– RCTBridge æ—¶è°ƒç”¨ initWithBundleURL_moduleProvider_launchOptions ä¸­çš„ moduleProvider è¿”å›çš„ native modules\n  [self registerExtraModules];\n  \n  // æ³¨å†Œæ‰€æœ‰çš„è‡ªå®šä¹‰ Native Module\n  (void)[self _initializeModules:RCTGetModuleClasses() withDispatchGroup:prepareBridge lazilyDiscovered:NO];\n  \n  // åˆå§‹åŒ–æ‰€æœ‰æ‡’åŠ è½½çš„ native moduleï¼Œåªæœ‰ç”¨ Chrome debug æ—¶æ‰ä¼šè°ƒç”¨\n  [self registerExtraLazyModules];\n}</code></pre>\n<p>æˆ‘ä»¬çœ‹çœ‹ <code>_initializeModules</code> å‡½æ•°åšäº†ä»€ä¹ˆï¼š</p>\n<pre><code class=\"objectivec\">// RCTCxxBridge.mm\n\n- (NSArray&lt;RCTModuleData *&gt; *)_initializeModules:(NSArray&lt;Class&gt; *)modules\n                               withDispatchGroup:(dispatch_group_t)dispatchGroup\n                                lazilyDiscovered:(BOOL)lazilyDiscovered\n{\n    for (RCTModuleData *moduleData in _moduleDataByID) {\n      if (moduleData.hasInstance &amp;&amp; (!moduleData.requiresMainQueueSetup || RCTIsMainQueue())) {\n        // Modules that were pre-initialized should ideally be set up before\n        // bridge init has finished, otherwise the caller may try to access the\n        // module directly rather than via `[bridge moduleForClass:]`, which won't\n        // trigger the lazy initialization process. If the module cannot safely be\n        // set up on the current thread, it will instead be async dispatched\n        // to the main thread to be set up in _prepareModulesWithDispatchGroup:.\n        (void)[moduleData instance];\n      }\n    }\n    _moduleSetupComplete = YES;\n    [self _prepareModulesWithDispatchGroup:dispatchGroup];\n}</code></pre>\n<p>æ ¹æ® <code>_initializeModules</code> å’Œ <code>_prepareModulesWithDispatchGroup</code> çš„æ³¨é‡Šï¼Œå¯ä»¥çœ‹å‡º iOS åœ¨ JS Bundle åŠ è½½çš„è¿‡ç¨‹ä¸­ï¼ˆåœ¨ <strong>JSThead çº¿ç¨‹</strong>è¿›è¡Œï¼‰ï¼ŒåŒæ—¶åœ¨<strong>ä¸»çº¿ç¨‹</strong>åˆå§‹åŒ–æ‰€æœ‰çš„ Native Modulesã€‚</p>\n<p>ç»“åˆå‰é¢çš„æºç åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡º React Native iOS å®¹å™¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼š<strong>åˆå§‹åŒ–æ‰€æœ‰çš„ Native Modules</strong>ï¼Œè‹¥ <code>Native Modules</code> æ¯”è¾ƒå¤šï¼Œå°±ä¼šå½±å“ Android RN å®¹å™¨çš„å¯åŠ¨æ—¶é—´ã€‚</p>\n<h3>Android æºç åˆ†æ</h3>\n<p>å…³äº Native Modules çš„æ³¨å†Œï¼Œå…¶å®åœ¨ <code>MainApplication.java</code> è¿™ä¸ªå…¥å£æ–‡ä»¶é‡Œå·²ç»ç»™å‡ºäº†çº¿ç´¢ï¼š</p>\n<pre><code class=\"java\">// MainApplication.java\n\nprotected List&lt;ReactPackage&gt; getPackages() {\n  @SuppressWarnings(\"UnnecessaryLocalVariable\")\n  List&lt;ReactPackage&gt; packages = new PackageList(this).getPackages();\n  // Packages that cannot be autolinked yet can be added manually here, for example:\n  // packages.add(new MyReactNativePackage());\n  return packages;\n}</code></pre>\n<p>ç”±äº 0.60 ä¹‹å React Native å¯ç”¨äº† <code>auto link</code>ï¼Œå®‰è£…çš„ç¬¬ä¸‰æ–¹ Native Modules éƒ½åœ¨ <code>PackageList</code> é‡Œï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦ <code>getPackages()</code> ä¸€ä¸‹å°±èƒ½è·å– <code>auto link</code> çš„ Modulesã€‚</p>\n<p>æºç é‡Œï¼Œåœ¨ <code>ReactInstanceManager.java</code> è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œä¼šè¿è¡Œ <code>createReactContext()</code> åˆ›å»º <code>ReactContext</code>ï¼Œè¿™é‡Œé¢æœ‰ä¸€æ­¥å°±æ˜¯æ³¨å†Œ <code>nativeModules</code> çš„æ³¨å†Œè¡¨ï¼š</p>\n<pre><code class=\"java\">// ReactInstanceManager.java\n\nprivate ReactApplicationContext createReactContext(\n  JavaScriptExecutor jsExecutor, \n  JSBundleLoader jsBundleLoader) {\n  \n  // æ³¨å†Œ nativeModules æ³¨å†Œè¡¨\n  NativeModuleRegistry nativeModuleRegistry = processPackages(reactContext, mPackages, false);\n}</code></pre>\n<p>æ ¹æ®å‡½æ•°è°ƒç”¨ï¼Œæˆ‘ä»¬è¿½è¸ªåˆ° <code>processPackages()</code> è¿™ä¸ªå‡½æ•°é‡Œï¼Œåˆ©ç”¨ä¸€ä¸ª for å¾ªç¯æŠŠ mPackages é‡Œçš„ Native Modules å…¨éƒ¨åŠ å…¥æ³¨å†Œè¡¨ï¼š</p>\n<pre><code class=\"java\">// ReactInstanceManager.java\n\nprivate NativeModuleRegistry processPackages(\n    ReactApplicationContext reactContext,\n    List&lt;ReactPackage&gt; packages,\n    boolean checkAndUpdatePackageMembership) {\n  // åˆ›å»º JavaModule æ³¨å†Œè¡¨ Builderï¼Œç”¨æ¥åˆ›å»º JavaModule æ³¨å†Œè¡¨ï¼Œ\n  // JavaModule æ³¨å†Œè¡¨å°†æ‰€æœ‰çš„ JavaModule æ³¨å†Œåˆ° CatalystInstance ä¸­\n  NativeModuleRegistryBuilder nativeModuleRegistryBuilder =\n      new NativeModuleRegistryBuilder(reactContext, this);\n\n  // ç»™ mPackages åŠ é”\n  // mPackages ç±»å‹ä¸º List&lt;ReactPackage&gt;ï¼Œä¸ MainApplication.java é‡Œçš„ packages å¯¹åº”\n  synchronized (mPackages) {\n    for (ReactPackage reactPackage : packages) {\n      try {\n        // å¾ªç¯å¤„ç†æˆ‘ä»¬åœ¨ Application é‡Œæ³¨å…¥çš„ ReactPackageï¼Œå¤„ç†çš„è¿‡ç¨‹å°±æ˜¯æŠŠå„è‡ªçš„ Module æ·»åŠ åˆ°å¯¹åº”çš„æ³¨å†Œè¡¨ä¸­\n        processPackage(reactPackage, nativeModuleRegistryBuilder);\n      } finally {\n        Systrace.endSection(TRACE_TAG_REACT_JAVA_BRIDGE);\n      }\n    }\n  }\n\n  NativeModuleRegistry nativeModuleRegistry;\n  try {\n    // ç”Ÿæˆ Java Module æ³¨å†Œè¡¨\n    nativeModuleRegistry = nativeModuleRegistryBuilder.build();\n  } finally {\n    Systrace.endSection(TRACE_TAG_REACT_JAVA_BRIDGE);\n    ReactMarker.logMarker(BUILD_NATIVE_MODULE_REGISTRY_END);\n  }\n\n  return nativeModuleRegistry;\n}</code></pre>\n<p>æœ€åè°ƒç”¨ <code>processPackage()</code> è¿›è¡ŒçœŸæ­£çš„æ³¨å†Œï¼š</p>\n<pre><code class=\"java\">// ReactInstanceManager.java\n\nprivate void processPackage(\n    ReactPackage reactPackage,\n    NativeModuleRegistryBuilder nativeModuleRegistryBuilder\n) {\n  nativeModuleRegistryBuilder.processPackage(reactPackage);\n}</code></pre>\n<p>ä»ä¸Šé¢çš„æµç¨‹å¯ä»¥çœ‹å‡ºï¼ŒAndroid æ³¨å†Œ <code>Native Modules</code> çš„æ—¶å€™æ˜¯<strong>åŒæ­¥å…¨é‡æ³¨å†Œ</strong>çš„ï¼Œè‹¥ <code>Native Modules</code> æ¯”è¾ƒå¤šï¼Œå°±ä¼šå½±å“ Android RN å®¹å™¨çš„å¯åŠ¨æ—¶é—´ã€‚</p>\n<h3>ä¼˜åŒ–å»ºè®®</h3>\n<p>è¯´å®è¯ï¼Œ<strong>Native Modules å…¨é‡ç»‘å®šåœ¨ç°æœ‰çš„æ¶æ„é‡Œæ˜¯æ— è§£çš„</strong>ï¼šä¸ç®¡è¿™ä¸ª Native Methods ä½ æœ‰æ²¡æœ‰ç”¨åˆ°ï¼Œå®¹å™¨å¯åŠ¨æ—¶å…ˆå…¨éƒ¨åˆå§‹åŒ–ä¸€éã€‚åœ¨æ–°çš„ RN æ¶æ„é‡Œï¼ŒTurboModules ä¼šè§£å†³è¿™ä¸ªé—®é¢˜ï¼ˆæœ¬æ–‡ä¸‹ä¸€å°èŠ‚ä¼šä»‹ç»ï¼‰ã€‚</p>\n<p>å¦‚æœéè¦è¯´ä¼˜åŒ–ï¼Œå…¶å®è¿˜æœ‰ä¸ªæ€è·¯ï¼Œä½ ä¸æ˜¯å…¨é‡åˆå§‹åŒ–å—ï¼Œé‚£æˆ‘è®© Native Modules çš„æ•°é‡å‡å°‘ä¸å°±è¡Œäº†ï¼Ÿæ–°æ¶æ„é‡Œæœ‰ä¸€æ­¥å«åš <strong>Lean Core</strong>ï¼Œå°±æ˜¯ç²¾ç®€ React Native æ ¸å¿ƒï¼ŒæŠŠä¸€äº›åŠŸèƒ½/ç»„ä»¶ä» RN çš„ä¸»å·¥ç¨‹é¡¹ç›®é‡Œç§»å‡ºå»ï¼ˆä¾‹å¦‚ <code>WebView</code> ç»„ä»¶ï¼‰ï¼Œäº¤ç»™ç¤¾åŒºç»´æŠ¤ï¼Œä½ æƒ³ç”¨çš„æ—¶å€™å†å•ç‹¬ä¸‹è½½é›†æˆã€‚</p>\n<p>è¿™æ ·åšçš„å¥½å¤„ä¸»è¦æœ‰å‡ ç‚¹ï¼š</p>\n<ul>\n <li>æ ¸å¿ƒæ›´åŠ ç²¾ç®€ï¼ŒRN ç»´æŠ¤è€…æœ‰æ›´å¤šçš„ç²¾åŠ›ç»´æŠ¤ä¸»è¦åŠŸèƒ½</li>\n <li>å‡å° Native Modules çš„ç»‘å®šè€—æ—¶å’Œå¤šä½™çš„ JS åŠ è½½æ—¶é—´ï¼ŒåŒ…ä½“ç§¯çš„å‡å°ï¼Œå¯¹åˆå§‹åŒ–æ€§èƒ½æ›´å‹å¥½ï¼ˆæˆ‘ä»¬å‡çº§ RN ç‰ˆæœ¬åˆ° 0.62 ååˆå§‹åŒ–é€Ÿåº¦æå‡ä¸€å€ï¼ŒåŸºæœ¬éƒ½æ˜¯ Lean Core çš„åŠŸåŠ³ï¼‰</li>\n <li>åŠ å¿«è¿­ä»£é€Ÿåº¦ï¼Œä¼˜åŒ–å¼€å‘ä½“éªŒç­‰</li>\n</ul>\n<p>ç°åœ¨ <strong>Lean Core</strong> çš„å·¥ä½œåŸºæœ¬å·²ç»å®Œæˆï¼Œæ›´å¤šè®¨è®ºå¯è§<a href=\"https://github.com/react-native-community/discussions-and-proposals/issues/6\" rel=\"nofollow noreferrer\">å®˜æ–¹ issues è®¨è®ºåŒº</a>ï¼Œæˆ‘ä»¬åªè¦åŒæ­¥å‡çº§ React Native ç‰ˆæœ¬å°±å¯ä»¥äº«ç”¨ <strong>Lean Core</strong> çš„æˆæœã€‚</p>\n<h2>4.RN æ–°æ¶æ„å¦‚ä½•ä¼˜åŒ–å¯åŠ¨æ€§èƒ½</h2>\n<p>React Native æ–°æ¶æ„å·²ç»è·³ç¥¨å¿«ä¸¤å¹´äº†ï¼Œæ¯æ¬¡é—®è¿›åº¦ï¼Œå®˜æ–¹å›å¤éƒ½æ˜¯â€œåˆ«å‚¬äº†åˆ«å‚¬äº†åœ¨åšäº†åœ¨åšäº†â€ã€‚</p>\n<p><img src=\"https://segmentfault.com/img/remote/1460000039797513\" alt=\"\" title=\"\" /></p>\n<p>æˆ‘ä¸ªäººå»å¹´æœŸå¾…äº†ä¸€æ•´å¹´ï¼Œä½†æ˜¯å•¥éƒ½æ²¡ç­‰åˆ°ï¼Œæ‰€ä»¥ RN å•¥æ—¶å€™æ›´æ–°åˆ° 1.0.0 ç‰ˆæœ¬ï¼Œæˆ‘å·²ç»ä¸åœ¨ä¹äº†ã€‚è™½ç„¶ RN å®˜æ–¹ä¸€ç›´åœ¨é¸½ï¼Œä½†æ˜¯ä¸å¾—ä¸è¯´ä»–ä»¬çš„æ–°æ¶æ„è¿˜æ˜¯æœ‰äº›ä¸œè¥¿çš„ï¼Œå¸‚é¢ä¸Šå­˜åœ¨å…³äº RN æ–°æ¶æ„çš„æ–‡ç« å’Œè§†é¢‘æˆ‘åŸºæœ¬éƒ½çœ‹äº†ä¸€éï¼Œæ‰€ä»¥ä¸ªäººå¯¹æ–°æ¶æ„è¿˜æ˜¯æœ‰ä¸ªæ•´ä½“çš„è®¤çŸ¥ã€‚</p>\n<p><img src=\"https://segmentfault.com/img/remote/1460000039797512\" alt=\"\" title=\"\" /></p>\n<p>å› ä¸ºæ–°æ¶æ„è¿˜æ²¡æœ‰æ­£å¼æ”¾å‡ºï¼Œæ‰€ä»¥å…·ä½“ç»†èŠ‚ä¸Šè‚¯å®šè¿˜å­˜åœ¨ä¸€äº›å·®å¼‚ï¼Œå…·ä½“æ‰§è¡Œç»†èŠ‚è¿˜æ˜¯è¦ç­‰ React Native å®˜æ–¹ä¸ºå‡†ã€‚</p>\n<h3>JSI</h3>\n<p>JSI çš„å…¨åæ˜¯ <strong>JavaScript Interface</strong>ï¼Œä¸€ä¸ªç”¨ C++ å†™çš„æ¡†æ¶ï¼Œä½œç”¨æ˜¯<strong>æ”¯æŒ JS ç›´æ¥è°ƒç”¨ Native æ–¹æ³•</strong>ï¼Œè€Œä¸æ˜¯ç°åœ¨é€šè¿‡ Bridge å¼‚æ­¥é€šè®¯ã€‚</p>\n<p>JS ç›´æ¥è°ƒç”¨ Native å¦‚ä½•ç†è§£å‘¢ï¼Ÿæˆ‘ä»¬ä¸¾ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ã€‚åœ¨æµè§ˆå™¨ä¸Šè°ƒç”¨ <code>setTimeout</code> <code>document.getElementById</code> è¿™ç±» API çš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯åœ¨ JS ä¾§ç›´æ¥è°ƒç”¨ Native Codeï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨æ§åˆ¶å°é‡ŒéªŒè¯ä¸€ä¸‹ï¼š</p>\n<p><img src=\"https://segmentfault.com/img/remote/1460000039797514\" alt=\"\" title=\"\" /></p>\n<p>æ¯”å¦‚è¯´æˆ‘æ‰§è¡Œäº†ä¸€æ¡å‘½ä»¤ï¼š</p>\n<pre><code class=\"javascript\">let el = document.createElement('div')</code></pre>\n<p>å˜é‡ <code>el</code> æŒæœ‰çš„ä¸æ˜¯ä¸€ä¸ª JS å¯¹è±¡ï¼Œè€Œæ˜¯ä¸€ä¸ªåœ¨ C++ ä¸­è¢«å®ä¾‹åŒ–çš„å¯¹è±¡ã€‚å¯¹äº el æŒæœ‰çš„è¿™ä¸ªå¯¹è±¡æˆ‘ä»¬å†è®¾ç½®ä¸€ä¸‹ç›¸å…³å±æ€§ï¼š</p>\n<pre><code class=\"javascript\">el.setAttribute('width', 100)</code></pre>\n<p>è¿™æ—¶å€™å…¶å®æ˜¯ JS <strong>åŒæ­¥è°ƒç”¨</strong> C++ ä¸­çš„ <code>setWidth</code> æ–¹æ³•ï¼Œæ”¹å˜è¿™ä¸ªå…ƒç´ çš„å®½åº¦ã€‚</p>\n<p>React Native æ–°æ¶æ„ä¸­çš„ JSIï¼Œä¸»è¦å°±æ˜¯èµ·è¿™ä¸ªä½œç”¨çš„ï¼Œå€ŸåŠ© JSIï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ JS ç›´æ¥è·å¾— C++ å¯¹è±¡çš„å¼•ç”¨ï¼ˆ<strong>Host Objects</strong>ï¼‰ï¼Œè¿›è€Œç›´æ¥æ§åˆ¶ UIï¼Œç›´æ¥è°ƒç”¨ Native Modules çš„æ–¹æ³•ï¼Œçœå» bridge å¼‚æ­¥é€šè®¯çš„å¼€é”€ã€‚</p>\n<p>ä¸‹é¢æˆ‘ä»¬ä¸¾ä¸ªå°ä¾‹å­ï¼Œæ¥çœ‹ä¸€ä¸‹ Java/OC å¦‚ä½•å€ŸåŠ© JSI å‘ JS æš´éœ²åŒæ­¥è°ƒç”¨çš„æ–¹æ³•ã€‚</p>\n<pre><code class=\"cpp\">#pragma once\n\n#include &lt;string&gt;\n#include &lt;unordered_map&gt;\n\n#include &lt;jsi/jsi.h&gt;\n\n// SampleJSIObject ç»§æ‰¿è‡ª HostObjectï¼Œè¡¨ç¤ºè¿™ä¸ªä¸€ä¸ªæš´éœ²ç»™ JS çš„å¯¹è±¡\n// å¯¹äº JS æ¥è¯´ï¼ŒJS å¯ä»¥ç›´æ¥åŒæ­¥è°ƒç”¨è¿™ä¸ªå¯¹è±¡ä¸Šçš„å±æ€§å’Œæ–¹æ³•\nclass JSI_EXPORT SampleJSIObject : public facebook::jsi::HostObject {\n\npublic: \n\n// ç¬¬ä¸€æ­¥\n// å°† window.__SampleJSIObject æš´éœ²ç»™JavaScript\n// è¿™æ˜¯ä¸€ä¸ªé™æ€å‡½æ•°ï¼Œä¸€èˆ¬åœ¨åº”ç”¨åˆå§‹åŒ–æ—¶ä» ObjC/Java ä¸­è°ƒç”¨\nstatic void SampleJSIObject::install(jsi::Runtime &amp;runtime) {\n  runtime.global().setProperty(\n      runtime,\n      \"__sampleJSIObject\",\n      jsi::Function::createFromHostFunction(\n          runtime,\n          jsi::PropNameID::forAscii(runtime, \"__SampleJSIObject\"),\n          1,\n          [binding](jsi::Runtime&amp; rt, const jsi::Value&amp; thisVal, const jsi::Value* args, size_t count) {\n            // è¿”å›è°ƒç”¨ window.__SampleJSIObject æ—¶å¾—åˆ°çš„å†…å®¹\n            return std::make_shared&lt;SampleJSIObject&gt;();\n          }));\n}\n\n// ç±»ä¼¼äº getterï¼Œæ¯æ¬¡ JS è®¿é—®è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œéƒ½è¦ç»è¿‡è¿™ä¸ªæ–¹æ³•ï¼Œä½œç”¨ç±»ä¼¼äºä¸€ä¸ªåŒ…è£…å™¨\n// æ¯”å¦‚è¯´æˆ‘ä»¬è°ƒç”¨ window.__sampleJSIObject.method1()ï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¼šè¢«è°ƒç”¨\njsi::Value TurboModule::get(jsi::Runtime&amp; runtime, const jsi::PropNameID&amp; propName) {\n  // è°ƒç”¨æ–¹æ³•å\n  // æ¯”å¦‚è¯´è°ƒç”¨ window.__sampleJSIObject.method1() æ—¶ï¼ŒpropNameUtf8 å°±æ˜¯ method1\n  std::string propNameUtf8 = propName.utf8(runtime);\n\n  return jsi::Function::createFromHostFunction(\n    runtime,\n    propName,\n    argCount,\n    [](facebook::jsi::Runtime &amp;rt, const facebook::jsi::Value &amp;thisVal, const facebook::jsi::Value *args, size_t count) {\n      if (propNameUtf8 == 'method1') {\n        // è°ƒç”¨ method1 æ—¶ï¼Œç›¸å…³çš„å‡½æ•°å¤„ç†é€»è¾‘\n      }\n    });\n}\n  \nstd::vector&lt;PropNameID&gt; getPropertyNames(Runtime&amp; rt){\n}\n  \n}</code></pre>\n<p>ä¸Šé¢çš„ä¾‹å­æ¯”è¾ƒç®€çŸ­ï¼Œæƒ³è¦æ·±å…¥äº†è§£ JSIï¼Œå¯ä»¥çœ‹<a href=\"https://medium.com/@christian.falch/https-medium-com-christian-falch-react-native-jsi-challenge-1201a69c8fbf\" rel=\"nofollow noreferrer\">ã€ŠReact Native JSI Challengeã€‹</a>è¿™ç¯‡æ–‡ç« æˆ–ç›´æ¥é˜…è¯»æºç ã€‚</p>\n<h3>TurboModules</h3>\n<p>ç»è¿‡å‰é¢çš„æºç åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œç°æœ‰æ¶æ„é‡Œï¼ŒNative åˆå§‹åŒ–æ—¶ä¼š<strong>å…¨é‡åŠ è½½ native modules</strong>ï¼Œéšç€ä¸šåŠ¡çš„è¿­ä»£ï¼Œnative modules åªä¼šè¶Šæ¥è¶Šå¤šï¼Œè¿™é‡Œçš„è€—æ—¶ä¼šè¶Šæ¥è¶Šé•¿ã€‚</p>\n<p>TurboModules å°±å¯ä»¥ä¸€æ¬¡æ€§è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨æ–°æ¶æ„é‡Œï¼Œnative modules æ˜¯<strong>æ‡’åŠ è½½</strong>çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰ä½ è°ƒç”¨ç›¸åº”çš„ native modules æ—¶æ‰ä¼šåˆå§‹åŒ–åŠ è½½ï¼Œè¿™æ ·å°±è§£å†³äº†åˆå§‹åŒ–å…¨é‡åŠ è½½è€—æ—¶è¾ƒé•¿çš„é—®é¢˜ã€‚</p>\n<p>TurboModules çš„è°ƒç”¨è·¯å¾„å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p>\n<ol>\n <li>å…ˆç”¨ JSI åˆ›å»ºä¸€ä¸ªé¡¶å±‚çš„ã€ŒNative Modules Proxyã€ï¼Œç§°ä¹‹ä¸º <code>global.__turboModuleProxy</code></li>\n <li>è®¿é—®ä¸€ä¸ª Native Modulesï¼Œæ¯”å¦‚è¯´è¦è®¿é—® <code>SampleTurboModule</code>ï¼Œæˆ‘ä»¬å…ˆåœ¨ JavaScript ä¾§æ‰§è¡Œ <code>require('NativeSampleTurboModule')</code></li>\n <li>åœ¨ NativeSampleTurboModule.js è¿™ä¸ªæ–‡ä»¶é‡Œï¼Œæˆ‘ä»¬å…ˆè°ƒç”¨ <code>TurboModuleRegistry.getEnforcing()</code>ï¼Œç„¶åå°±ä¼šè°ƒç”¨ <code>global.__turboModuleProxy(\"SampleTurboModule\")</code></li>\n <li>è°ƒç”¨ <code>global.__turboModuleProxy</code> çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨ç¬¬ä¸€æ­¥ JSI æš´éœ²çš„ Native æ–¹æ³•ï¼Œè¿™æ—¶å€™ C++ å±‚é€šè¿‡ä¼ å…¥çš„å­—ç¬¦ä¸² \"SampleTurboModule\"ï¼Œæ‰¾åˆ° ObjC/Java çš„å®ç°ï¼Œæœ€åè¿”å›ä¸€ä¸ªå¯¹åº”çš„ JSI å¯¹è±¡</li>\n <li>ç°åœ¨æˆ‘ä»¬å¾—åˆ°äº† <code>SampleTurboModule</code> çš„ JSI å¯¹è±¡ï¼Œå°±å¯ä»¥ç”¨ JavaScript åŒæ­¥è°ƒç”¨ JSI å¯¹è±¡ä¸Šçš„å±æ€§å’Œæ–¹æ³•</li>\n</ol>\n<p>é€šè¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å€ŸåŠ© TurboModulesï¼Œ Native Modules åªæœ‰<strong>åˆæ¬¡è°ƒç”¨</strong>çš„æ—¶å€™æ‰ä¼šåŠ è½½ï¼Œè¿™æ ·å°±å½»åº•å¹²æ‰ React Native å®¹å™¨åˆå§‹åŒ–æ—¶<strong>å…¨é‡åŠ è½½</strong> Native Modules æ—¶çš„æ—¶é—´ï¼›åŒæ—¶æˆ‘ä»¬å¯ä»¥å€ŸåŠ© JSI å®ç° JS å’Œ Native çš„åŒæ­¥è°ƒç”¨ï¼Œè€—æ—¶æ›´å°‘ï¼Œæ•ˆç‡æ›´é«˜ã€‚</p>\n<h2>æ€»ç»“</h2>\n<p>æœ¬æ–‡ä¸»è¦ä» <strong>Native</strong> çš„è§’åº¦å‡ºå‘ï¼Œä»æºç åˆ†æ React Native <strong>ç°æœ‰æ¶æ„</strong>çš„å¯åŠ¨æµç¨‹ï¼Œæ€»ç»“äº†å‡ ä¸ª Native å±‚çš„æ€§èƒ½ä¼˜åŒ–ç‚¹ï¼›æœ€ååˆç®€å•ä»‹ç»äº†ä¸€ä¸‹React Native çš„<strong>æ–°æ¶æ„</strong>ã€‚ä¸‹ä¸€ç¯‡æ–‡ç« æˆ‘ä¼šè®²è§£å¦‚ä½•ä» <strong>JavaScript</strong> å…¥æ‰‹ï¼Œä¼˜åŒ– React Native çš„å¯åŠ¨é€Ÿåº¦ã€‚</p>\n<hr>\n <blockquote>\n  å¦‚æœä½ å–œæ¬¢æˆ‘çš„æ–‡ç« ï¼Œå¸Œæœ›ç‚¹èµğŸ‘ æ”¶è— ğŸ“ è¯„è®º ğŸ’¬ ä¸‰è¿æ”¯æŒä¸€ä¸‹ï¼Œè°¢è°¢ä½ ï¼Œè¿™å¯¹æˆ‘çœŸçš„å¾ˆé‡è¦ï¼\n </blockquote>\n <p>æ¬¢è¿å¤§å®¶å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ï¼šå¤è›‹å®éªŒå®¤ï¼Œç›®å‰ä¸“æ³¨å‰ç«¯æŠ€æœ¯ï¼Œå¯¹å›¾å½¢å­¦ä¹Ÿæœ‰ä¸€äº›å¾®å°ç ”ç©¶ã€‚</p>\n <p>åŸæ–‡é“¾æ¥ ğŸ‘‰ <a href=\"https://supercodepower.com/react-native-performance-native\" rel=\"nofollow noreferrer\">âš¡ï¸ React Native å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–â€”â€”Native ç¯‡ï¼ˆå†…å«æºç åˆ†æï¼‰</a>ï¼šæ›´æ–°æ›´åŠæ—¶ï¼Œé˜…è¯»ä½“éªŒæ›´ä½³</p>\n <h2>å‚è€ƒ</h2>\n <p><a href=\"https://supercodepower.com/react_native_performance_optimization_guides\" rel=\"nofollow noreferrer\">React Native æ€§èƒ½ä¼˜åŒ–æŒ‡å—</a></p>\n <p><a href=\"https://supercodepower.com/docs/react-native-upgrade/index\" rel=\"nofollow noreferrer\">React Native å‡çº§æŒ‡å—ï¼ˆ0.59 -&gt; 0.62ï¼‰</a></p>\n <p><a href=\"https://www.youtube.com/watch?v=nphKGWjhg2M\" rel=\"nofollow noreferrer\">Chain React 2019 - Ram Narasimhan - Performance in React Native</a></p>\n <p><a href=\"http://blog.nparashuram.com/2019/01/react-natives-new-architecture-glossary.html#turbomodules\" rel=\"nofollow noreferrer\">React Native's new architecture - Glossary of terms</a></p>\n <p><a href=\"https://medium.com/@christian.falch/https-medium-com-christian-falch-react-native-jsi-challenge-1201a69c8fbf\" rel=\"nofollow noreferrer\">React Native JSI Challenge</a></p>\n <p><a href=\"https://github.com/react-native-community/discussions-and-proposals/blob/master/proposals/0002-Turbo-Modules.md\" rel=\"nofollow noreferrer\">RFC0002: Turbo Modules â„¢</a></p>\n <p><a href=\"https://mrgaogang.github.io/react/ReactNative%E4%B8%8EiOS%E5%8E%9F%E7%94%9F%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90-%E5%88%9D%E5%A7%8B%E5%8C%96.html#%E7%BC%98%E8%B5%B7\" rel=\"nofollow noreferrer\">ReactNativeä¸iOSåŸç”Ÿé€šä¿¡åŸç†è§£æ-åˆå§‹åŒ–</a></p>\n <p><a href=\"http://slides.com/qianmeng/react-native-ios-sourceread\" rel=\"nofollow noreferrer\">React Native iOS æºç è§£æ</a></p>\n <p><a href=\"https://github.com/sucese/react-native/blob/master/doc/ReactNative%E6%BA%90%E7%A0%81%E7%AF%87/1ReactNative%E6%BA%90%E7%A0%81%E7%AF%87%EF%BC%9A%E6%BA%90%E7%A0%81%E5%88%9D%E8%AF%86.md\" rel=\"nofollow noreferrer\">ReactNativeæºç ç¯‡ï¼šæºç åˆè¯†</a></p>\n <p><a href=\"https://time.geekbang.org/dailylesson/detail/100056865\" rel=\"nofollow noreferrer\">å¦‚ä½•ç”¨React Nativeé¢„åŠ è½½æ–¹æ¡ˆè§£å†³ç™½å±é—®é¢˜</a></p>\n <hr />\n</hr>","descriptionType":"html","publishedDate":"Fri, 09 Apr 2021 02:39:20 +0000","feedId":6615,"bgimg":"https://segmentfault.com/img/remote/1460000039797510","linkMd5":"852ec7d4f8235e20bd252fb4a7b4e21e","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx30/cdn26@2020_4/2021/04/09/16-55-35-700_2768b2a846aa0ade.webp","destWidth":732,"destHeight":275,"sourceBytes":46630,"destBytes":46630,"author":"å¤ä»£çƒƒ","articleImgCdnMap":{"https://segmentfault.com/img/remote/1460000039797510":"https://cdn.jsdelivr.net/gh/myreaderx30/cdn26@2020_4/2021/04/09/16-55-35-700_2768b2a846aa0ade.webp","https://segmentfault.com/img/remote/1460000039797511":null,"https://segmentfault.com/img/remote/1460000039797515":"https://cdn.jsdelivr.net/gh/myreaderx21/cdn38@2020_1/2021/04/09/16-55-40-079_baf6e23a018c5a8e.webp","https://segmentfault.com/img/remote/1460000039797513":"https://cdn.jsdelivr.net/gh/myreaderx25/cdn45@2020_6/2021/04/09/16-55-42-425_959a438de45f571b.webp","https://segmentfault.com/img/remote/1460000039797512":"https://cdn.jsdelivr.net/gh/myreaderx12/cdn30@2020_3/2021/04/09/16-55-40-706_80ceb665d1e5953c.webp","https://segmentfault.com/img/remote/1460000039797514":"https://cdn.jsdelivr.net/gh/myreaderx15/cdn39@2020_1/2021/04/09/16-55-40-399_7715f18bb48659c6.webp"},"publishedOrCreatedDate":1617987325018}],"record":{"createdTime":"2021-04-10 00:55:25","updatedTime":"2021-04-10 00:55:25","feedId":6615,"fetchDate":"Fri, 09 Apr 2021 16:55:25 +0000","fetchMs":5432,"handleMs":66,"totalMs":26308,"newArticles":0,"totalArticles":50,"status":1,"type":0,"ip":"5c919425566c2ed25e5b6c5f0652f0b0","hostName":"europe68*","requestId":"0482706d97ff453897b07747c9a4d3bb_6615","contentType":"application/atom+xml; charset=UTF-8","totalBytes":276270,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":6,"articlesImgsGithubTotal":5,"successGithubMap":{"myreaderx25":1,"myreaderx15":1,"myreaderx21":1,"myreaderx12":1,"myreaderx30":1},"failGithubMap":{"myreaderx14":1}},"feed":{"createdTime":"2020-08-25 04:33:08","updatedTime":"2021-04-03 14:32:14","id":6615,"name":"SegmentFault æœ€æ–°çš„æ–‡ç« ","url":"http://segmentfault.com/feeds/blogs","subscriber":null,"website":null,"icon":"https://segmentfault.com/favicon.ico","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx63/cdn75@2020_2/2021/04/03/06-32-08-760_eb238dca7c8e9f0e.jpg","description":"","weekly":null,"link":null},"noPictureArticleList":[{"createdTime":"2021-04-10 00:55:42","updatedTime":"2021-04-10 00:55:42","id":null,"feedId":6615,"linkMd5":"852ec7d4f8235e20bd252fb4a7b4e21e"}],"tmpCommonImgCdnBytes":46630,"tmpBodyImgCdnBytes":229640,"tmpBgImgCdnBytes":0,"extra4":{"start":1617987316640,"total":0,"statList":[{"spend":8313,"msg":"è·å–xmlå†…å®¹"},{"spend":66,"msg":"è§£é‡Šæ–‡ç« "},{"spend":0,"msg":"ä¸Šä¼ å°é¢å›¾åˆ°cdn"},{"spend":0,"msg":"ä¿®æ­£å°é¢å›¾ä¸Šä¼ å¤±è´¥é‡æ–°ä¸Šä¼ "},{"spend":6373,"msg":"æ­£æ–‡é“¾æ¥ä¸Šä¼ åˆ°cdn"}]},"extra5":6,"extra6":6,"extra7ImgCdnFailResultVector":[{"code":1,"isDone":false,"source":"https://segmentfault.com/img/remote/1460000039797511","sourceStatusCode":200,"destWidth":732,"destHeight":275,"sourceBytes":46872,"destBytes":46872,"feedId":6615,"totalSpendMs":3892,"convertSpendMs":0,"createdTime":"2021-04-10 00:55:36","host":"us-029*","referer":"https://segmentfault.com/a/1190000039797508","linkMd5ListStr":"852ec7d4f8235e20bd252fb4a7b4e21e","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx14/cdn34/contents/2021/04/09/16-55-40-558_dee786269ebc75d0.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 68584859.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Fri, 09 Apr 2021 16:55:40 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["CF4E:1395:1054B4B:1AF0B25:6070870C"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1617990096"],"x-ratelimit-used":["61"],"x-xss-protection":["0"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx14/cdn34/contents/2021/04/09/16-55-40-558_dee786269ebc75d0.webp","historyStatusCode":[],"spendMs":91},"base64UserPassword":null,"token":"6b67d******************************91b08"},"githubUser":"myreaderx14","githubHttpCode":403,"extra22GetBytesInfo":"1ã€æ²¡æœ‰Refererå­—æ®µ","extra23historyStatusCode":[200],"sourceSize":"45.8 KB","destSize":"45.8 KB","compressRate":"100%"},{"code":1,"isDone":false,"source":"https://segmentfault.com/img/remote/1460000039797511","sourceStatusCode":200,"destWidth":732,"destHeight":275,"sourceBytes":46872,"destBytes":46872,"feedId":6615,"totalSpendMs":1943,"convertSpendMs":0,"createdTime":"2021-04-10 00:55:40","host":"us-004*","referer":"https://segmentfault.com/a/1190000039797508","linkMd5ListStr":"852ec7d4f8235e20bd252fb4a7b4e21e","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx14/cdn34/contents/2021/04/09/16-55-42-640_dee786269ebc75d0.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 68584859.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Fri, 09 Apr 2021 16:55:42 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["8D5A:6E89:126927:50401F:6070870E"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1617990096"],"x-ratelimit-used":["61"],"x-xss-protection":["0"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx14/cdn34/contents/2021/04/09/16-55-42-640_dee786269ebc75d0.webp","historyStatusCode":[],"spendMs":38},"base64UserPassword":null,"token":"6b67d******************************91b08"},"githubUser":"myreaderx14","githubHttpCode":403,"extra22GetBytesInfo":"1ã€æ²¡æœ‰Refererå­—æ®µ","extra23historyStatusCode":[200],"sourceSize":"45.8 KB","destSize":"45.8 KB","compressRate":"100%"}],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-004.herokuapp.com/":{"failCount":0,"successCount":2,"resultList":[200,200]},"http://us-005.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-51.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://europe67.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-029.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://segmentfault.com/img/remote/1460000039797510","sourceStatusCode":200,"destWidth":732,"destHeight":275,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx30/cdn26@2020_4/2021/04/09/16-55-35-700_2768b2a846aa0ade.webp","sourceBytes":46630,"destBytes":46630,"feedId":6615,"totalSpendMs":4988,"convertSpendMs":0,"createdTime":"2021-04-10 00:55:31","host":"europe63*","referer":"https://segmentfault.com/a/1190000039797508","linkMd5ListStr":"852ec7d4f8235e20bd252fb4a7b4e21e,852ec7d4f8235e20bd252fb4a7b4e21e","githubUser":"myreaderx30","githubHttpCode":201,"extra22GetBytesInfo":"1ã€æ²¡æœ‰Refererå­—æ®µ","extra23historyStatusCode":[200],"sourceSize":"45.5 KB","destSize":"45.5 KB","compressRate":"100%"},{"code":1,"isDone":false,"source":"https://segmentfault.com/img/remote/1460000039797515","sourceStatusCode":200,"destWidth":732,"destHeight":275,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx21/cdn38@2020_1/2021/04/09/16-55-40-079_baf6e23a018c5a8e.webp","sourceBytes":46868,"destBytes":46868,"feedId":6615,"totalSpendMs":3635,"convertSpendMs":0,"createdTime":"2021-04-10 00:55:36","host":"us-004*","referer":"https://segmentfault.com/a/1190000039797508","linkMd5ListStr":"852ec7d4f8235e20bd252fb4a7b4e21e","githubUser":"myreaderx21","githubHttpCode":201,"extra22GetBytesInfo":"1ã€æ²¡æœ‰Refererå­—æ®µ","extra23historyStatusCode":[200],"sourceSize":"45.8 KB","destSize":"45.8 KB","compressRate":"100%"},{"code":1,"isDone":false,"source":"https://segmentfault.com/img/remote/1460000039797514","sourceStatusCode":200,"destWidth":732,"destHeight":203,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx15/cdn39@2020_1/2021/04/09/16-55-40-399_7715f18bb48659c6.webp","sourceBytes":69028,"destBytes":69028,"feedId":6615,"totalSpendMs":3968,"convertSpendMs":0,"createdTime":"2021-04-10 00:55:36","host":"us-005*","referer":"https://segmentfault.com/a/1190000039797508","linkMd5ListStr":"852ec7d4f8235e20bd252fb4a7b4e21e","githubUser":"myreaderx15","githubHttpCode":201,"extra22GetBytesInfo":"1ã€æ²¡æœ‰Refererå­—æ®µ","extra23historyStatusCode":[200],"sourceSize":"67.4 KB","destSize":"67.4 KB","compressRate":"100%"},{"code":1,"isDone":false,"source":"https://segmentfault.com/img/remote/1460000039797512","sourceStatusCode":200,"destWidth":732,"destHeight":523,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx12/cdn30@2020_3/2021/04/09/16-55-40-706_80ceb665d1e5953c.webp","sourceBytes":88326,"destBytes":88326,"feedId":6615,"totalSpendMs":4265,"convertSpendMs":0,"createdTime":"2021-04-10 00:55:36","host":"us-51*","referer":"https://segmentfault.com/a/1190000039797508","linkMd5ListStr":"852ec7d4f8235e20bd252fb4a7b4e21e","githubUser":"myreaderx12","githubHttpCode":201,"extra22GetBytesInfo":"1ã€æ²¡æœ‰Refererå­—æ®µ","extra23historyStatusCode":[200],"sourceSize":"86.3 KB","destSize":"86.3 KB","compressRate":"100%"},{"code":1,"isDone":false,"source":"https://segmentfault.com/img/remote/1460000039797513","sourceStatusCode":200,"destWidth":100,"destHeight":99,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx25/cdn45@2020_6/2021/04/09/16-55-42-425_959a438de45f571b.webp","sourceBytes":25418,"destBytes":25418,"feedId":6615,"totalSpendMs":6340,"convertSpendMs":0,"createdTime":"2021-04-10 00:55:36","host":"europe67*","referer":"https://segmentfault.com/a/1190000039797508","linkMd5ListStr":"852ec7d4f8235e20bd252fb4a7b4e21e","githubUser":"myreaderx25","githubHttpCode":201,"extra22GetBytesInfo":"1ã€æ²¡æœ‰Refererå­—æ®µ","extra23historyStatusCode":[200],"sourceSize":"24.8 KB","destSize":"24.8 KB","compressRate":"100%"}],"successGithubMap":{"myreaderx25":1,"myreaderx15":1,"myreaderx21":1,"myreaderx12":1,"myreaderx30":1},"failGithubMap":{"myreaderx14":1}}