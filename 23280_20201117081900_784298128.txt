{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-11-17 16:18:41","updatedTime":"2020-11-17 16:18:41","title":"我的服务器接连被黑客攻击，我好难","link":"https://segmentfault.com/a/1190000038196844","description":"<p>最近在几台测试服务器上跑一些业务数据，但是过了几天服务器突然变的奇慢无比，敲个命令就像卡壳一样，有时候甚至都连接不上，最开始我以为是网络问题，就强行kill掉进程，重新跑一下进程，最后实在受不了，就上阿里云后台说重启下服务器吧，结果看到CPU的占用率已经到达了100%。</p>\n<p><img src=\"https://segmentfault.com/img/remote/1460000038196850\" alt=\"这是CPU是恢复正常之后截图\" title=\"这是CPU是恢复正常之后截图\" /></p>\n<p>看到这样我以为是因为我跑了大量的数据导致CPU飙升的，然后我就kill到了进程，并且重启了服务器，启动之后CPU正常，我以为就是我跑数据导致的，此后我就没用这台服务器跑数据了，我就单纯的以为这就算处理好了，没想到等我过几天部署测试包的时候发现，又是奇慢无比，看了下CPU占用率又是99.9%，事实证明我还是太年轻了。</p>\n<p>终于忍无可忍，就深究下吧，先用linux命令（top）查看下，到底是什么占用了这么多CPU资源，结果如下图：</p>\n<p><img src=\"https://segmentfault.com/img/remote/1460000038196849\" alt=\"\" title=\"\" /></p>\n<p>看到的瞬间第一感觉就是，这是啥玩意，这是谁部署的。问了下平时身旁的背锅侠，好像也不是他弄的，看来这次这锅是甩不了了，那就只能...</p>\n<p><img src=\"https://segmentfault.com/img/remote/1460000038196847\" alt=\"\" title=\"\" /></p>\n<p><strong>What？中病毒了？</strong></p>\n<p>根据过往的经验，这玩意不应该是点了网页上的小姐姐才会发生的事情吗？我这为什么也就中毒了。</p>\n<h2>这东西是啥</h2>\n<p>既然已经中毒了，那就来看看这是什么东西吧。</p>\n<p>挖矿病毒，大家身在同一个工地都应该或多或少都听过挖矿吧，要是挖到个币，就不用苦逼写文章了，话说回来，要想挖币需要很强的计算资源，那么也就需要众多的服务器来支撑，这里面有些逼呢又不想投入太多，只能通过一些恶毒的手段，将脚本植入的我们的服务器，比如我们需要安装一个Redis，那么像我英文不太好的人，可能第一时间不是去官网，而是找度娘，如果你正好找的资源里面被人植入了这种东西，那么很不凑巧，你的服务器可能要帮别人搞点东西了。</p>\n<h2>如何处理这种病毒</h2>\n<p>既然中了这种病毒，导致我们的服务器很卡，那么肯定要将它杀死，可能没怎么接触过Linux的同学，已经考虑重装镜像了。</p>\n<p>其实大可不必。</p>\n<p>首先呢我们找到此进程将其kill掉。</p>\n<p><img src=\"https://segmentfault.com/img/remote/1460000038196848\" alt=\"\" title=\"\" /></p>\n<p>接下来删除kdevtmpfsi文件，一般在tmp目录下</p>\n<p><img src=\"https://segmentfault.com/img/remote/1460000038196851\" alt=\"\" title=\"\" /></p>\n<p>还有一个文件（kinsing）我们也要将其杀死删掉</p>\n<p><img src=\"https://segmentfault.com/img/remote/1460000038196853\" alt=\"\" title=\"\" /></p>\n<p>这里需要注意，我试了几台服务器kinsing文件可能存在不同的位置，但是我们可以通过上面的方式看到文件路径，将其找到删除就好。</p>\n<p>这个时候我们通过top查看CPU的使用率，可以发现已经正常了</p>\n<p><img src=\"https://segmentfault.com/img/remote/1460000038196852\" alt=\"\" title=\"\" /></p>\n<hr>\n <p>就在我以为万事大吉的时候，现实又给了我沉痛的一击，没过几分钟CPU使用率又到了99.96%，我要崩溃了。</p>\n <p>跟度娘经过深入交流之后，终于知道了问题所在。</p>\n <p>查看服务器的定时任务，crontab -l，大概会看到如下的任务，没有就不用管了，你可以将此ip查一下，一般都是国外的ip。</p>\n <p><img src=\"https://segmentfault.com/img/remote/1460000038196854\" alt=\"\" title=\"\" /></p>\n <p>我们将这些定时任务删除即可，这个链接就是在我们kill到进程、删除文件之后进行下载，然后通过脚本再跑起来。</p>\n <p>这也就是为什么我明明杀死了病毒，没过多久又出现了的原因。</p>\n <p>到这里我们已经完全处理到此病毒了，如果你用的是阿里云ECS，当遇到这种东西的时候，其实会短信通知你，只不过当时太年轻没怎么在意，另外服务器端口默认是22，自己最好改个端口，不然很容易被恶人攻击。</p>\n <p>现在服务器敲起来贼爽，再也不卡顿了。</p>\n <hr>\n  <p>更多精彩内容请关注微信公众号：<strong>一个程序员的成长</strong></p>\n </hr>\n</hr>","descriptionType":"html","publishedDate":"Tue, 17 Nov 2020 06:22:59 +0000","feedId":23280,"bgimg":"https://segmentfault.com/img/remote/1460000038196850","linkMd5":"a1a6d5b9ae77ff8124c63830321502c4","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx16/cdn78@2020_5/2020/11/17/08-18-51-887_0284a38460a6dc5f.webp","destWidth":800,"destHeight":245,"sourceBytes":7038,"destBytes":7038,"author":"bingfeng","articleImgCdnMap":{"https://segmentfault.com/img/remote/1460000038196850":"https://cdn.jsdelivr.net/gh/myreaderx16/cdn78@2020_5/2020/11/17/08-18-51-887_0284a38460a6dc5f.webp","https://segmentfault.com/img/remote/1460000038196849":"https://cdn.jsdelivr.net/gh/myreaderx33/cdn87@2020_5/2020/11/17/08-18-56-951_154664f80dc8e37b.webp","https://segmentfault.com/img/remote/1460000038196847":"https://cdn.jsdelivr.net/gh/myreaderx31/cdn86@2020_3/2020/11/17/08-18-56-308_7be242a1a80c7b7d.webp","https://segmentfault.com/img/remote/1460000038196848":"https://cdn.jsdelivr.net/gh/myreaderx30/cdn81@2020_1/2020/11/17/08-18-59-106_a61ed94afe6a1267.webp","https://segmentfault.com/img/remote/1460000038196851":"https://cdn.jsdelivr.net/gh/myreaderx5oss/cdn93@2020_4/2020/11/17/08-18-55-717_b9dd4b8774be344c.webp","https://segmentfault.com/img/remote/1460000038196853":"https://cdn.jsdelivr.net/gh/myreaderx27/cdn1@2020_4/2020/11/17/08-18-56-799_b43339477d7d3e40.webp","https://segmentfault.com/img/remote/1460000038196852":"https://cdn.jsdelivr.net/gh/myreaderx3/cdn5@2020_4/2020/11/17/08-18-57-735_b4dbc18a56dc89f9.webp","https://segmentfault.com/img/remote/1460000038196854":"https://cdn.jsdelivr.net/gh/myreaderx8/cdn98@2020_6/2020/11/17/08-18-56-914_729eb89be704ef72.webp"},"publishedOrCreatedDate":1605601121173}],"record":{"createdTime":"2020-11-17 16:18:41","updatedTime":"2020-11-17 16:18:41","feedId":23280,"fetchDate":"Tue, 17 Nov 2020 08:18:41 +0000","fetchMs":4746,"handleMs":12747,"totalMs":44986,"newArticles":0,"totalArticles":50,"status":1,"type":0,"ip":"2fbc598270685d2ad3e3de972b0b4ef6","hostName":"us-010*","requestId":"1d91cd9857f94b07948df7d6244219b7_23280","contentType":"application/atom+xml; charset=UTF-8","totalBytes":227514,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":8,"articlesImgsGithubTotal":8,"successGithubMap":{"myreaderx8":1,"myreaderx16":1,"myreaderx27":1,"myreaderx33":1,"myreaderx3":1,"myreaderx30":1,"myreaderx5oss":1,"myreaderx31":1},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 02:29:58","updatedTime":"2020-11-12 13:51:25","id":23280,"name":"SegmentFault 最新的文章","url":"https://segmentfault.com/feeds/blogs","subscriber":142,"website":null,"icon":"https://segmentfault.com/favicon.ico","icon_jsdelivr":null,"description":"","weekly":null,"link":"https://segmentfault.com"},"noPictureArticleList":[],"tmpCommonImgCdnBytes":7038,"tmpBodyImgCdnBytes":220476,"tmpBgImgCdnBytes":0,"extra4":{"start":1605601094985,"total":0,"statList":[{"spend":13442,"msg":"获取xml内容"},{"spend":12747,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":7296,"msg":"正文链接上传到cdn"}]},"extra5":8,"extra6":8,"extra7ImgCdnFailResultVector":[],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-018.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://europe-25.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-001.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://europe64.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-030.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-52.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-026.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://segmentfault.com/img/remote/1460000038196850","sourceStatusCode":200,"destWidth":800,"destHeight":245,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx16/cdn78@2020_5/2020/11/17/08-18-51-887_0284a38460a6dc5f.webp","sourceBytes":7038,"destBytes":7038,"feedId":23280,"totalSpendMs":4222,"convertSpendMs":0,"createdTime":"2020-11-17 16:18:48","host":"us-038*","referer":"https://segmentfault.com/a/1190000038196844","linkMd5ListStr":"a1a6d5b9ae77ff8124c63830321502c4,a1a6d5b9ae77ff8124c63830321502c4","githubUser":"myreaderx16","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"6.9 KB","destSize":"6.9 KB","compressRate":"100%"},{"code":1,"isDone":false,"source":"https://segmentfault.com/img/remote/1460000038196851","sourceStatusCode":200,"destWidth":573,"destHeight":52,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx5oss/cdn93@2020_4/2020/11/17/08-18-55-717_b9dd4b8774be344c.webp","sourceBytes":8960,"destBytes":8960,"feedId":23280,"totalSpendMs":3829,"convertSpendMs":0,"createdTime":"2020-11-17 16:18:52","host":"europe64*","referer":"https://segmentfault.com/a/1190000038196844","linkMd5ListStr":"a1a6d5b9ae77ff8124c63830321502c4","githubUser":"myreaderx5oss","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"8.8 KB","destSize":"8.8 KB","compressRate":"100%"},{"code":1,"isDone":false,"source":"https://segmentfault.com/img/remote/1460000038196847","sourceStatusCode":200,"destWidth":800,"destHeight":218,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx31/cdn86@2020_3/2020/11/17/08-18-56-308_7be242a1a80c7b7d.webp","sourceBytes":25412,"destBytes":25412,"feedId":23280,"totalSpendMs":4571,"convertSpendMs":0,"createdTime":"2020-11-17 16:18:52","host":"europe-25*","referer":"https://segmentfault.com/a/1190000038196844","linkMd5ListStr":"a1a6d5b9ae77ff8124c63830321502c4","githubUser":"myreaderx31","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"24.8 KB","destSize":"24.8 KB","compressRate":"100%"},{"code":1,"isDone":false,"source":"https://segmentfault.com/img/remote/1460000038196854","sourceStatusCode":200,"destWidth":672,"destHeight":157,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx8/cdn98@2020_6/2020/11/17/08-18-56-914_729eb89be704ef72.webp","sourceBytes":10738,"destBytes":10738,"feedId":23280,"totalSpendMs":4970,"convertSpendMs":0,"createdTime":"2020-11-17 16:18:52","host":"us-52*","referer":"https://segmentfault.com/a/1190000038196844","linkMd5ListStr":"a1a6d5b9ae77ff8124c63830321502c4","githubUser":"myreaderx8","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"10.5 KB","destSize":"10.5 KB","compressRate":"100%"},{"code":1,"isDone":false,"source":"https://segmentfault.com/img/remote/1460000038196853","sourceStatusCode":200,"destWidth":800,"destHeight":124,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx27/cdn1@2020_4/2020/11/17/08-18-56-799_b43339477d7d3e40.webp","sourceBytes":23624,"destBytes":23624,"feedId":23280,"totalSpendMs":4977,"convertSpendMs":0,"createdTime":"2020-11-17 16:18:52","host":"us-030*","referer":"https://segmentfault.com/a/1190000038196844","linkMd5ListStr":"a1a6d5b9ae77ff8124c63830321502c4","githubUser":"myreaderx27","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"23.1 KB","destSize":"23.1 KB","compressRate":"100%"},{"code":1,"isDone":false,"source":"https://segmentfault.com/img/remote/1460000038196849","sourceStatusCode":200,"destWidth":800,"destHeight":419,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx33/cdn87@2020_5/2020/11/17/08-18-56-951_154664f80dc8e37b.webp","sourceBytes":75224,"destBytes":75224,"feedId":23280,"totalSpendMs":5241,"convertSpendMs":0,"createdTime":"2020-11-17 16:18:52","host":"us-001*","referer":"https://segmentfault.com/a/1190000038196844","linkMd5ListStr":"a1a6d5b9ae77ff8124c63830321502c4","githubUser":"myreaderx33","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"73.5 KB","destSize":"73.5 KB","compressRate":"100%"},{"code":1,"isDone":false,"source":"https://segmentfault.com/img/remote/1460000038196852","sourceStatusCode":200,"destWidth":800,"destHeight":311,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx3/cdn5@2020_4/2020/11/17/08-18-57-735_b4dbc18a56dc89f9.webp","sourceBytes":54628,"destBytes":54628,"feedId":23280,"totalSpendMs":5995,"convertSpendMs":0,"createdTime":"2020-11-17 16:18:52","host":"us-018*","referer":"https://segmentfault.com/a/1190000038196844","linkMd5ListStr":"a1a6d5b9ae77ff8124c63830321502c4","githubUser":"myreaderx3","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"53.3 KB","destSize":"53.3 KB","compressRate":"100%"},{"code":1,"isDone":false,"source":"https://segmentfault.com/img/remote/1460000038196848","sourceStatusCode":200,"destWidth":800,"destHeight":108,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx30/cdn81@2020_1/2020/11/17/08-18-59-106_a61ed94afe6a1267.webp","sourceBytes":21890,"destBytes":21890,"feedId":23280,"totalSpendMs":7274,"convertSpendMs":0,"createdTime":"2020-11-17 16:18:52","host":"us-026*","referer":"https://segmentfault.com/a/1190000038196844","linkMd5ListStr":"a1a6d5b9ae77ff8124c63830321502c4","githubUser":"myreaderx30","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"21.4 KB","destSize":"21.4 KB","compressRate":"100%"}],"successGithubMap":{"myreaderx8":1,"myreaderx16":1,"myreaderx27":1,"myreaderx33":1,"myreaderx3":1,"myreaderx30":1,"myreaderx5oss":1,"myreaderx31":1},"failGithubMap":{}}