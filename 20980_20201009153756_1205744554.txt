{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-10-09 23:37:56","updatedTime":"2020-10-09 23:37:56","title":"利用浏览器缓存来加速图片广告显示","link":"http://www.aoao.org.cn/?p=177","description":"<p>显示一个广告通常顺序为</p>\n<ol>\n<li>向服务端请求数据，看看该显示啥图片</li>\n<li>请求图片</li>\n<li>下载图片 或者 使用本地缓存</li>\n</ol>\n<p>在这种情况下除了下载图片花时间外，请求数据有时也挺花时间，像请求阻塞这种还可以调整优化，但网络问题基本是没救的。</p>\n<p>通常说广告显示得慢就慢了，无所谓，但是对于把广告当内容用的主，开天窗（就是页面主要位置空白）时， 体验还是比较差滴。</p>\n<p>为了避免开天窗，我分析了下方案</p>\n<ol>\n<li>加 loading 图片，好像现在多数这样干。<br />\n顺便推荐大家看下这两个 css3 实现的 loading 效果 <a title=\"CSS3 Loading Animation Loop\" href=\"http://www.alessioatzeni.com/wp-content/tutorials/html-css/CSS3-loading-animation-loop/index.html\">[1]</a>  <a title=\"CSS3 Animated Loading Bar\" href=\"http://www.leemunroe.com/demos/css3-loading-bar/\">[2]</a><br />\n我也做了个<a href=\"http://labs.aoao.org.cn/demo/css3-loading/\" title=\"css3 loading 例子\">练习</a>，方式不大一样 ^_^ 大家娱乐吧</li>\n<li>设置接口数据的过期时间，让其直接使用 local cache<br />\n缺点：导致新广告不能实时的投放</li>\n<li>利用浏览器缓存显示上次广告当过渡，<br />\n缺点：现在的浏览器缓存比较容易被 T 掉，<br />\n　　　也可能导致新广告不能实时的投放，比如新广告还没出来就被点走了<br />\n　　　也可能导致用户疑惑，刚看到的好广告想点却不见了，因为广告变了</li>\n</ol>\n<p>在广告不是每次刷新都变的情况下，我觉得组合 1 跟 3 来使用，效果应该挺好的。不过就算每次都刷新都不一样的话，其实也是挺有用的，因为下载图片要时间，</p>\n<p>又不过广告是跟RMB打交道 ，某些方面就要重新设计。</p>\n<p>第三种方案的实现比较麻烦的是判断图片是否在浏览器的缓存里</p>\n<pre class=\"code\"><code>img = new Image();\nimg.src = 'ad.url' ;\nif( img.complete ) {\n    // ad.show(); \n} else{\n    img.src = null; img = null; //img.src ='loading.gif' ;\n}\n</code></pre>\n<p>这代码好像看起来可行，但除了IE 外 其他浏览器是并不能 abort 掉图片请求，而是抛弃请求，也就是说图片的请求还是会被发出去，又不过针对中国的特色，只处理IE的好像已经满足大部分用户。 不知道大家有什么比较好的方案查缓存。</p>\n<p>无 Demo 无真相，大家自己玩。理论上是可以用在很多地方。</p>\n","descriptionType":"html","publishedDate":"Sun, 10 Jun 2012 14:55:02 +0000","feedId":20980,"bgimg":"","linkMd5":"df328b13f6148ba4911297eea5415523","bgimgJsdelivr":"","metaImg":"","author":"aoao","publishedOrCreatedDate":1602257876519}],"record":{"createdTime":"2020-10-09 23:37:56","updatedTime":"2020-10-09 23:37:56","feedId":20980,"fetchDate":"Fri, 09 Oct 2020 15:37:56 +0000","fetchMs":119,"handleMs":182415,"totalMs":182564,"newArticles":0,"totalArticles":20,"status":1,"type":0,"ip":"3a5f717433072a454da1dd47c8371714","hostName":"us-51*","requestId":"593640b724e346c1b14ff21f067771d2_20980","contentType":"application/rss+xml; charset=UTF-8","totalBytes":0,"bgimgsTotal":0,"bgimgsGithubTotal":0,"articlesImgsTotal":0,"articlesImgsGithubTotal":0,"successGithubMap":{},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 02:23:51","updatedTime":"2020-09-07 04:15:08","id":20980,"name":"样式之美","url":"http://feeds.feedburner.com/aoao","subscriber":158,"website":null,"icon":"http://www.aoao.org.cn/favicon.ico","icon_jsdelivr":null,"description":"没落的角落","weekly":null,"link":"http://www.aoao.org.cn"},"noPictureArticleList":[],"tmpCommonImgCdnBytes":0,"tmpBodyImgCdnBytes":0,"tmpBgImgCdnBytes":0,"extra4":{"start":1602257693982,"total":0,"statList":[{"spend":122,"msg":"获取xml内容"},{"spend":182415,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":11,"msg":"正文链接上传到cdn"}]},"extra5":0,"extra6":0,"extra7ImgCdnFailResultVector":[],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{},"extra12ImgCdnSuccessResultVector":[],"successGithubMap":{},"failGithubMap":{}}