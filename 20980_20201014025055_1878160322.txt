{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-10-14 10:50:55","updatedTime":"2020-10-14 10:50:55","title":"JavaScript组件打包模式","link":"http://www.aoao.org.cn/?p=149","description":"<p>js组件通常带着css image ，但这样使用起来可能会有些小麻烦，为了让组件足够的solo，有了把css image也打包在js的想法，然后顺便把请求数变少，这个顺便好像更重要，呵呵。</p>\n<p>那怎样打包呢，虽然有<a href=\"http://limi.net/articles/resource-packages\">resource-packages</a>这样的方案，可是我们的核心用户还在玩ie6这种时尚的浏览器呢！</p>\n<h4>我的方案：</h4>\n<ul>\n<li><strong>CSS</strong>：CSS可以当成字符串存在js里，并由js动态加到页面上，页面用的可能不适合，但组件通常不会影响。</li>\n<li><strong>image</strong>：CSS里用的图片用dataURI（<a href=\"http://tools.ietf.org/html/rfc2397\">RFC 2397</a>）跟MHTML（<a href=\"http://tools.ietf.org/html/rfc2557\">RFC 2557</a>）的方式编到js里面。（秦歌写的<a href=\"http://dancewithnet.com/2009/08/15/data-uri-mhtml/\">dataURI和MHTML</a>依然推荐给不知道是什么东东的同学看）。CSS里如果要绝对路径同样可以存js，js如果有直接用到的理论上也是可以，但js通常只改className会比较好。</li>\n<li><strong>flash</strong>：一些比较小的flash，比如存储，复制等也可以选择打包，不过现在米解决非IE的问题，非IE使用外链吧</li>\n</ul>\n<p>这个有个<a href=\"http://labs.aoao.org.cn/yep/test.html\">打包测试的例子</a>。</p>\n<h4>一些细节和纠结的地方</h4>\n<ol>\n<li>所有图片都打包到js里不一定合理，打包进去的应该是必用的图片。<br />那排除的图片是再打一个包好呢还是直接用图片？</li>\n<li>图片可以先压后编，我选用的图片压缩工具是<a href=\"http://advsys.net/ken/utils.htm\">pngout</a>，而且一般是用<code>-s5</code>。<br />有人做了些测试<a href=\"http://www.phpied.com/uncompressed-data-in-base64-probably-not/\">Uncompressed data in base64? Probably not</a>，大家自行判断。</li>\n<li>重复的图片引用直接用dataURI会搞得很大很大，gzip又笨得跟猪一样不会压掉。<br />我是选用存成js变量，淘宝的同学是用提class的方式</li>\n<li>MHTML在ie7+/vista缺少结束分割符无法显示，win03sp2缺少<code>Content-Type</code>会有安全提示，原因都MIME不标准，不是所有的东西都可以省。</li>\n<li>是选择把所有的东西都打包在一个文件还是按MHTML跟dataURI分类型打包成两份在server按ua派文件或由类库智能去读取，好像后者比较和谐。</li>\n<li>swf用dataURI编入有问题，据说fp8没问题，现在都fp10了。<br />另一种solo的方案就是把js打包到swf，不过感觉不和谐</li>\n</ol>\n<h4>multipart/related例子</h4>\n<p>不算标准但能跑，换行也是很重要的</p>\n<pre class=\"code\"><code>Content-Type:multipart/related;boundary=\"_BAIDU_YOUA_BB_YEP\"\n\n--_BAIDU_YOUA_BB_YEP\nContent-Type:image/png\nContent-Location:logo.png\nContent-Transfer-Encoding:base64\n\n...base64...\n\n--_BAIDU_YOUA_BB_YEP\nContent-Type:image/png\nContent-Location:nono.png\nContent-Transfer-Encoding:base64\n\n...base64...\n\n--_BAIDU_YOUA_BB_YEP--</code></pre>\n<p>btw:上篇文章的评论里发现了<a href=\"http://duris.ru/\">这个打包的站</a>，输出界面很帅 </p>\n","descriptionType":"html","publishedDate":"Mon, 05 Apr 2010 08:37:34 +0000","feedId":20980,"bgimg":"","linkMd5":"ba9e0534df33e4c4850aac94f2318b47","bgimgJsdelivr":"","metaImg":"","author":"aoao","publishedOrCreatedDate":1602643855255}],"record":{"createdTime":"2020-10-14 10:50:55","updatedTime":"2020-10-14 10:50:55","feedId":20980,"fetchDate":"Wed, 14 Oct 2020 02:50:55 +0000","fetchMs":2542,"handleMs":181510,"totalMs":184055,"newArticles":0,"totalArticles":20,"status":1,"type":0,"ip":"3a5f717433072a454da1dd47c8371714","hostName":"us-011*","requestId":"609a71def2744bc692e65d1514607ed5_20980","contentType":"application/rss+xml; charset=UTF-8","totalBytes":0,"bgimgsTotal":0,"bgimgsGithubTotal":0,"articlesImgsTotal":0,"articlesImgsGithubTotal":0,"successGithubMap":{},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 02:23:51","updatedTime":"2020-09-07 04:15:08","id":20980,"name":"样式之美","url":"http://feeds.feedburner.com/aoao","subscriber":158,"website":null,"icon":"http://www.aoao.org.cn/favicon.ico","icon_jsdelivr":null,"description":"没落的角落","weekly":null,"link":"http://www.aoao.org.cn"},"noPictureArticleList":[],"tmpCommonImgCdnBytes":0,"tmpBodyImgCdnBytes":0,"tmpBgImgCdnBytes":0,"extra4":{"start":1602643671202,"total":0,"statList":[{"spend":2543,"msg":"获取xml内容"},{"spend":181510,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":0,"msg":"正文链接上传到cdn"}]},"extra5":0,"extra6":0,"extra7ImgCdnFailResultVector":[],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{},"extra12ImgCdnSuccessResultVector":[],"successGithubMap":{},"failGithubMap":{}}