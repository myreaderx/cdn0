{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-10-20 13:38:48","updatedTime":"2020-10-20 13:38:48","title":"Unityのエディタ拡張時に非同期タスクの進捗状況を表示する Progress【Unity】【エディタ拡張】","link":"https://kan-kikuchi.hatenablog.com/entry/UnityEditor_Progress?utm_source=feed","description":"\n<ul>\n<li><a href=\"https://kan-kikuchi.hatenablog.com/entry/2013/11/25/000144\">&#x30A8;&#x30C7;&#x30A3;&#x30BF;&#x62E1;&#x5F35;&#x3068;&#x306F;</a></li>\n</ul><p> </p><br />\n<p>この記事でのバージョン<br />\n<span style=\"color: #0000cc\">Unity 2018.4.6f1</span></p><br />\n<p></p>\n\n<div class=\"section\">\n    <h3>はじめに</h3>\n    <p>Unityにはエディタ拡張時に進捗を表示するための</p><p><span style=\"color: #0000cc\">EditorUtility.Display(Cancelable)ProgressBar</span>という物が用意されています。<br />\n<br />\n</p>\n\n<table>\n    <tr>\n    <td><span itemscope itemtype=\"http://schema.org/Photograph\"><img src=\"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200330/20200330091721.gif\" alt=\"f:id:kan_kikuchi:20200330091721g:plain\" title=\"f:id:kan_kikuchi:20200330091721g:plain\" class=\"hatena-fotolife\" itemprop=\"image\"></span></td>\n    </tr>\n</table><p><iframe src=\"https://hatenablog-parts.com/embed?url=https%3A%2F%2Fkan-kikuchi.hatenablog.com%2Fentry%2FDisplayProgressBar\" title=\"エディタ拡張で進捗状況を表示する【Unity】【エディタ拡張】 - (:3[kanのメモ帳]\" class=\"embed-card embed-blogcard\" scrolling=\"no\" frameborder=\"0\" style=\"display: block; width: 100%; height: 190px; max-width: 500px; margin: 10px 0px;\"></iframe><br />\n<iframe src=\"https://hatenablog-parts.com/embed?url=https%3A%2F%2Fkan-kikuchi.hatenablog.com%2Fentry%2FDisplayCancelableProgressBar\" title=\"EditorUtility.DisplayCancelableProgressBarで途中でキャンセルも出来る進捗状況(プログレスバー)の表示【Unity】【エディタ拡張】 - (:3[kanのメモ帳]\" class=\"embed-card embed-blogcard\" scrolling=\"no\" frameborder=\"0\" style=\"display: block; width: 100%; height: 190px; max-width: 500px; margin: 10px 0px;\"></iframe></p><br />\n<p>そしてUnity 2020.1から、これに似た機能である</p><p>エディタ拡張時に<span style=\"color: #0000cc\">非同期処理</span>の進捗を表示するためのProgressが追加されました。</p><br />\n<p><iframe src=\"https://hatenablog-parts.com/embed?url=https%3A%2F%2Fdocs.unity3d.com%2F2020.1%2FDocumentation%2FScriptReference%2FProgress.html\" title=\"Unity - Scripting API: Progress\" class=\"embed-card embed-webcard\" scrolling=\"no\" frameborder=\"0\" style=\"display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;\"></iframe></p><br />\n<p>今回はこれを試してみようという感じの記事です。</p><p>なお、イメージとしては以下のような感じ。<br />\n<br />\n</p>\n\n<table>\n    <tr>\n    <td><span itemscope itemtype=\"http://schema.org/Photograph\"><img src=\"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200902/20200902073739.gif\" alt=\"f:id:kan_kikuchi:20200902073739g:plain\" title=\"f:id:kan_kikuchi:20200902073739g:plain\" class=\"hatena-fotolife\" itemprop=\"image\"></span></td>\n    </tr>\n</table><p> <br />\n <br />\n </p>\n\n</div>\n<div class=\"section\">\n    <h3>Progress</h3>\n    <p>さっそくProgressの使い方ですが、<span style=\"color: #0000cc\">Start</span>で開始し、<span style=\"color: #0000cc\">Report</span>で更新、<span style=\"color: #0000cc\">Finish</span>で終了する感じです。<br />\n<br />\n</p>\n<pre class=\"code lang-cs\" data-lang=\"cs\" data-unlink><span class=\"synComment\">//タスク開始、返り値でタスクIDの取得</span>\n<span class=\"synType\">int</span> id = Progress.Start(<span class=\"synConstant\">&quot;タスク名&quot;</span>, <span class=\"synConstant\">&quot;タスクの説明&quot;</span>);\n</pre><pre class=\"code lang-cs\" data-lang=\"cs\" data-unlink><span class=\"synComment\">//Startで受け取ったIDを使ってタスクの進捗状況を更新</span>\nProgress.Report(id, progress, <span class=\"synConstant\">&quot;タスクの説明&quot;</span>);\n</pre><pre class=\"code lang-cs\" data-lang=\"cs\" data-unlink><span class=\"synComment\">//タスクの終了(Progress.StatusにはCanceledやFailedもある)</span>\nProgress.Finish(id, Progress.Status.Succeeded);\n</pre><p><br />\n他にも<span style=\"color: #0000cc\">タスクの状況を取得</span>したり、<span style=\"color: #0000cc\">タスクをキャンセル</span>したりなんて事も出来ます。<br />\n<br />\n</p>\n<pre class=\"code lang-cs\" data-lang=\"cs\" data-unlink><span class=\"synComment\">//タスクの状況を取得(Running, Succeeded, Failed, Canceledがある)</span>\nProgress.Status taskStatus = Progress.GetStatus(id);\n</pre><pre class=\"code lang-cs\" data-lang=\"cs\" data-unlink><span class=\"synComment\">//タスクキャンセル</span>\nProgress.Cancel(id);\n</pre><p><br />\nなお、<span style=\"color: #0000cc\">エディタの右下で現在進行中のタスクが表示</span>されます。</p><p>また、クリックする事で<span style=\"color: #0000cc\">詳細を確認する事も可能</span>です。<br />\n<br />\n</p>\n\n<table>\n    <tr>\n    <td><span itemscope itemtype=\"http://schema.org/Photograph\"><img src=\"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200902/20200902072913.gif\" alt=\"f:id:kan_kikuchi:20200902072913g:plain\" title=\"f:id:kan_kikuchi:20200902072913g:plain\" class=\"hatena-fotolife\" itemprop=\"image\"></span></td>\n    </tr>\n</table><p><br />\nちなみに<span style=\"color: #0000cc\">EditorCoroutineUtility</span>を使うと、</p><p><span style=\"color: #0000cc\">エディタ拡張時でも非同期処理(コルーチン)を簡単に実装</span>出来ます。</p><p>(<span style=\"color: #ff0000\">※EditorCoroutineはパッケージマネージャーからインストールする必要あり</span>)<br />\n<br />\n</p>\n\n<table>\n    <tr>\n    <td><span itemscope itemtype=\"http://schema.org/Photograph\"><img src=\"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200828/20200828080630.gif\" alt=\"f:id:kan_kikuchi:20200828080630g:plain\" title=\"f:id:kan_kikuchi:20200828080630g:plain\" class=\"hatena-fotolife\" itemprop=\"image\"></span></td>\n    </tr>\n</table><p><iframe src=\"https://hatenablog-parts.com/embed?url=https%3A%2F%2Fkan-kikuchi.hatenablog.com%2Fentry%2FEditorCoroutineUtility\" title=\"エディタ拡張でUnityを再生していない時でもコルーチンを使い非同期処理が行える EditorCoroutineUtility【Unity】【エディタ拡張】 - (:3[kanのメモ帳]\" class=\"embed-card embed-blogcard\" scrolling=\"no\" frameborder=\"0\" style=\"display: block; width: 100%; height: 190px; max-width: 500px; margin: 10px 0px;\"></iframe></p><br />\n<p>実際に<span style=\"color: #0000cc\">EditorCoroutineUtility</span>と<span style=\"color: #0000cc\">Progress</span>を使って、</p><p><span style=\"color: #0000cc\">エディタ拡張で非同期処理を行い、その進捗を表示</span>してみると以下のような感じに。</p><br />\n<p><script src=\"https://gist.github.com/kankikuchi/b90327aa1186d49108f99fdd33e8489a.js\"> </script></p>\n\n<table>\n    <tr>\n    <td><span itemscope itemtype=\"http://schema.org/Photograph\"><img src=\"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200902/20200902073739.gif\" alt=\"f:id:kan_kikuchi:20200902073739g:plain\" title=\"f:id:kan_kikuchi:20200902073739g:plain\" class=\"hatena-fotolife\" itemprop=\"image\"></span></td>\n    </tr>\n</table><p><br />\n一応<span style=\"color: #ff0000\">EditorUtility.Display(Cancelable)ProgressBarで代用出来ない事もない</span>ですが、</p><p><span style=\"color: #0000cc\">進捗表示に画面を専有しない</span>、<span style=\"color: #0000cc\">エラーが出ても自動で停止する</span>など、</p><p><span style=\"color: #0000cc\">使い勝手はProgressの方が良さそう</span>でした。</p><br />\n<p><hr></p>\n\n</div>","descriptionType":"html","publishedDate":"Wed, 09 Sep 2020 23:46:29 +0000","feedId":46511,"bgimg":"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200902/20200902073739.gif","linkMd5":"3d08e10c7530e9e9926a86b5379cc9e0","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn48@2020_1/2020/10/20/05-38-53-866_59b44a518df8408b.webp","destWidth":640,"destHeight":429,"sourceBytes":1191701,"destBytes":1194098,"author":"kan_kikuchi","enclosureType":"image/gif","enclosureUrl":"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200902/20200902073739.gif","articleImgCdnMap":{"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200330/20200330091721.gif":"https://cdn.jsdelivr.net/gh/myreaderx16/cdn51@2020_1/2020/10/20/05-38-58-019_e8ab1c8f97a17a58.webp","https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200902/20200902073739.gif":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn48@2020_1/2020/10/20/05-38-53-866_59b44a518df8408b.webp","https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200902/20200902072913.gif":"https://cdn.jsdelivr.net/gh/myreaderx27/cdn59@2020_5/2020/10/20/05-39-06-795_bf80eb2b87209e6a.webp","https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200828/20200828080630.gif":"https://cdn.jsdelivr.net/gh/myreaderx19/cdn53@2020_3/2020/10/20/05-39-00-759_788d8ae2e4f0b146.webp"},"publishedOrCreatedDate":1603172328338}],"record":{"createdTime":"2020-10-20 13:38:48","updatedTime":"2020-10-20 13:38:48","feedId":46511,"fetchDate":"Tue, 20 Oct 2020 05:38:48 +0000","fetchMs":1442,"handleMs":5429,"totalMs":26832,"newArticles":0,"totalArticles":30,"status":1,"type":0,"ip":"6da9f5c5105826521b693cdf674daebe","hostName":"us-016*","requestId":"f0a1caeb52f6491f9686508dd03e0ea6_46511","contentType":"application/atom+xml; charset=utf-8","totalBytes":3136550,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":4,"articlesImgsGithubTotal":4,"successGithubMap":{"myreaderx16":1,"myreaderx27":1,"myreaderx32":1,"myreaderx19":1},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 03:42:03","updatedTime":"2020-09-07 06:00:51","id":46511,"name":"(:3[kanのメモ帳]","url":"http://kan-kikuchi.hatenablog.com/feed","subscriber":69,"website":null,"icon":"https://kan-kikuchi.hatenablog.com/favicon.ico","icon_jsdelivr":null,"description":"個人ゲーム開発者kan.kikuchiのメモ的技術ブログ。月木更新でUnity関連がメイン。","weekly":null,"link":"https://kan-kikuchi.hatenablog.com"},"noPictureArticleList":[],"tmpCommonImgCdnBytes":1194098,"tmpBodyImgCdnBytes":1942452,"tmpBgImgCdnBytes":0,"extra4":{"start":1603172321291,"total":0,"statList":[{"spend":1618,"msg":"获取xml内容"},{"spend":5429,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":12223,"msg":"正文链接上传到cdn"}]},"extra5":4,"extra6":4,"extra7ImgCdnFailResultVector":[],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-013.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-002.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-014.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200902/20200902073739.gif","sourceStatusCode":200,"destWidth":640,"destHeight":429,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn48@2020_1/2020/10/20/05-38-53-866_59b44a518df8408b.webp","sourceBytes":1191701,"destBytes":1194098,"targetWebpQuality":75,"feedId":46511,"totalSpendMs":7549,"convertSpendMs":5297,"createdTime":"2020-10-20 13:38:48","host":"us-039*","referer":"https://kan-kikuchi.hatenablog.com/entry/UnityEditor_Progress?utm_source=feed","linkMd5ListStr":"3d08e10c7530e9e9926a86b5379cc9e0,3d08e10c7530e9e9926a86b5379cc9e0,3d08e10c7530e9e9926a86b5379cc9e0","githubUser":"myreaderx32","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"destSize":"1.1 MB","compressRate":"100.2%","sourceSize":"1.1 MB"},{"code":1,"isDone":false,"source":"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200330/20200330091721.gif","sourceStatusCode":200,"destWidth":640,"destHeight":452,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx16/cdn51@2020_1/2020/10/20/05-38-58-019_e8ab1c8f97a17a58.webp","sourceBytes":345326,"destBytes":257032,"targetWebpQuality":75,"feedId":46511,"totalSpendMs":3273,"convertSpendMs":1853,"createdTime":"2020-10-20 13:38:55","host":"us-013*","referer":"https://kan-kikuchi.hatenablog.com/entry/UnityEditor_Progress?utm_source=feed","linkMd5ListStr":"3d08e10c7530e9e9926a86b5379cc9e0","githubUser":"myreaderx16","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"destSize":"251 KB","compressRate":"74.4%","sourceSize":"337.2 KB"},{"code":1,"isDone":false,"source":"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200828/20200828080630.gif","sourceStatusCode":200,"destWidth":640,"destHeight":630,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx19/cdn53@2020_3/2020/10/20/05-39-00-759_788d8ae2e4f0b146.webp","sourceBytes":928197,"destBytes":939846,"targetWebpQuality":75,"feedId":46511,"totalSpendMs":6122,"convertSpendMs":4373,"createdTime":"2020-10-20 13:38:55","host":"us-014*","referer":"https://kan-kikuchi.hatenablog.com/entry/UnityEditor_Progress?utm_source=feed","linkMd5ListStr":"3d08e10c7530e9e9926a86b5379cc9e0","githubUser":"myreaderx19","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"destSize":"917.8 KB","compressRate":"101.3%","sourceSize":"906.4 KB"},{"code":1,"isDone":false,"source":"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200902/20200902072913.gif","sourceStatusCode":200,"destWidth":640,"destHeight":589,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx27/cdn59@2020_5/2020/10/20/05-39-06-795_bf80eb2b87209e6a.webp","sourceBytes":1067169,"destBytes":745574,"targetWebpQuality":75,"feedId":46511,"totalSpendMs":12187,"convertSpendMs":9678,"createdTime":"2020-10-20 13:38:55","host":"us-002*","referer":"https://kan-kikuchi.hatenablog.com/entry/UnityEditor_Progress?utm_source=feed","linkMd5ListStr":"3d08e10c7530e9e9926a86b5379cc9e0","githubUser":"myreaderx27","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"destSize":"728.1 KB","compressRate":"69.9%","sourceSize":"1 MB"}],"successGithubMap":{"myreaderx16":1,"myreaderx27":1,"myreaderx32":1,"myreaderx19":1},"failGithubMap":{}}