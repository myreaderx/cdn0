{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-10-13 14:52:03","updatedTime":"2020-10-13 14:52:03","title":"Search Pluginで、orConditions() みたいなのを使いながら同時に絞り込む","link":"http://cakephp.seesaa.net/article/386427257.html","description":"\nついでにもうひとつ書いておきます。<br /><br /><a href=\"https://github.com/CakeDC/search\" target=\"_blank\">https://github.com/CakeDC/search</a><br />の Search Pluginの説明を見ると、 orConditions() のようなメソッドを自分で書くと、「同じキーワードで複数フィールドを検索できちゃったりするよ」と書いてあります。<br /><br />モデル.php の中に、<br /><code><br />public $filterArgs = array(<br />        'filter' => array('type' => 'query', 'method' => 'orConditions'),<br />    );<br /></code><br />とか書いて、<br /><code><br />    public function orConditions($data = array()) {<br />        $filter = $data['filter'];<br />        $cond = array(<br />            'OR' => array(<br />                $this->alias . '.title LIKE' => '%' . $filter . '%',<br />                $this->alias . '.body LIKE' => '%' . $filter . '%',<br />            ));<br />        return $cond;<br />    }<br /></code><br />というコードに誘導してやれば、titleフィールドとbodyフィールドを両方検索できちゃいますよ、と。<br />でもこれをそのまま素直に使うと、検索項目が複数あるときに問題になってしまいます。<br /><br />せっかくサンプルの標準状態では、<br />SQLのクエリが、<br />　~~~ WHERE モデル.フィールドA='A' AND モデル.フィールドB='B' AND モデル.フィールドC='C' <br />のように絞り込みになっているのに、上記をそのままつっこむと、<br />　~~~ WHERE モデル.フィールドA='A' OR モデル.title='B' OR モデル.body='B' AND モデル.フィールドC='C'<br />とかになってしまうんです。 <br />これは使えない！<br /><br />で、これの解決策ですが、ちょっと考えると思いつきます。<br />下記のように\"きちんと\"設定しましょう。<br /><code><br />    public function orConditions($data = array()) {<br />        $filter = $data['filter'];<br />        $cond = array(<br />            'AND'=>array(<br />                'OR' => array(<br />                    $this->alias . '.title LIKE' => '%' . $filter . '%',<br />                    $this->alias . '.body LIKE' => '%' . $filter . '%',<br />                )<br />            ));<br />        return $cond;<br />    }<br /></code><br /><br />こうするだけで、<br /><br />　~~~ WHERE モデル.フィールドA='A' AND (モデル.title='B' OR モデル.body='B') AND モデル.フィールドC='C'<br /><br />というSQLになります。<br /><br /><br /><br /><br /><br /><br /><a name=\"more\"></a>\n\n\n","descriptionType":"html","publishedDate":"Wed, 29 Jan 2014 08:17:01 +0000","feedId":46095,"bgimg":"","linkMd5":"054e0cea38955952211891e8727c42c6","bgimgJsdelivr":"","metaImg":"","author":"SDozono","publishedOrCreatedDate":1602571923170}],"record":{"createdTime":"2020-10-13 14:52:03","updatedTime":"2020-10-13 14:52:03","feedId":46095,"fetchDate":"Tue, 13 Oct 2020 06:52:03 +0000","fetchMs":499,"handleMs":25915,"totalMs":26415,"newArticles":0,"totalArticles":15,"status":1,"type":0,"ip":"08698c1ba48214bba72482c5ab48ce2d","hostName":"europe65*","requestId":"98bd9751d0be4a32affeb269738a28de_46095","contentType":"application/xml","totalBytes":0,"bgimgsTotal":0,"bgimgsGithubTotal":0,"articlesImgsTotal":0,"articlesImgsGithubTotal":0,"successGithubMap":{},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 03:40:34","updatedTime":"2020-09-07 05:59:20","id":46095,"name":"CakePHP のおいしい食べ方","url":"http://cakephp.seesaa.net/index.rdf","subscriber":69,"website":null,"icon":"http://cakephp.seesaa.net/favicon.ico","icon_jsdelivr":null,"description":"CakePHPは、PHP言語の高速開発用フレームワークです。日々、発展を遂げる各種フレームワークの動向を見極めつつ、日本発のCakePHP応援ブログとして、最新情報をお届けします。","weekly":null,"link":"http://cakephp.seesaa.net"},"noPictureArticleList":[],"tmpCommonImgCdnBytes":0,"tmpBodyImgCdnBytes":0,"tmpBgImgCdnBytes":0,"extra4":{"start":1602571896755,"total":0,"statList":[{"spend":500,"msg":"获取xml内容"},{"spend":25915,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"正文链接上传到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"}]},"extra5":0,"extra6":0,"extra7ImgCdnFailResultVector":[],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{},"extra12ImgCdnSuccessResultVector":[],"successGithubMap":{},"failGithubMap":{}}