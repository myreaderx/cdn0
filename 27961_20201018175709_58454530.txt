{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-10-19 01:56:44","updatedTime":"2020-10-19 01:56:44","title":"Using DNS Traffic Management to Add Resiliency to Shopify’s Services","link":"https://engineering.shopify.com/blogs/engineering/using-dns-traffic-management-add-resiliency-shopify-services","description":"<p><em>If you are lacking understanding of what is DNS, traffic management, or why we would even use it, read <a href=\"https://engineering.shopify.com/blogs/engineering/introduction-dns-traffic-management\" target=\"_blank\" title=\"An Introduction to DNS Traffic Management\" rel=\"noopener noreferrer\">Part 1: Introduction to DNS traffic management</a>.</em></p> \n<p>Distributed systems are only as resilient as we build them to be. Domain Name System (DNS) traffic management (TM) is a well-used approach to do so. In this second part of the two-part series, we’re sharing Shopify’s DNS traffic management journey from the numerous manually set-up, maintained, and updated traffic management approaches to the fully automated self-served system used by 40+ domains owned amongst 12+ different teams, handling 100M+ requests per day.</p> \n<h1>Shopify’s Previous Approaches to DNS Traffic Management</h1> \n<p>DNS traffic management isn’t entirely new at Shopify. A number of different teams had their own way of doing traffic management through DNS changes before we automated in 2019, which brought different sets of features and techniques to update records.&nbsp;</p> \n<p style=\"text-align: left;\"><img alt=\"Traffic management through DNS changes\" src=\"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R001_before-yolo-fakelogos_3770x1493_a2b0ad36-32e2-4cf4-be84-20b2e8b8ffc2.gif?v=1596570536\" style=\"display: block; float: none; margin-left: auto; margin-right: auto;\" /></p> \n<h2>Streaming Platform Team</h2> \n<p>The team handling our Kafka pipelines used Kubernetes ConfigMaps to define target clusters. So, making changes required</p> \n<ul> \n <li>creating a pull request (PR) to the git repository holding the deployment configuration</li> \n <li>getting the PR approved</li> \n <li>merging the PR</li> \n <li>waiting for the tests to pass</li> \n <li> <a href=\"https://engineering.shopify.com/blogs/engineering/automatic-deployment-at-shopify\" target=\"_blank\" title=\"Automatic Deployment at Shopify\" rel=\"noopener noreferrer\">waiting for the shipping pipeline to run and deploy the change</a>, which can take a few minutes depending on the circumstances</li> \n</ul> \n<p>On top of the process duration which isn't ideal for failover time, using this manual approach doesn't open the door to any active/active configuration (where we share the traffic between two active clusters), since it would require to use two target clusters at once, while this only allows using the one defined in the ConfigMaps. At the time, being able to share traffic wasn't considered necessary for Kafka.</p> \n<h2>Search Platform Team</h2> \n<p>The team handling Elasticsearch set up the beginnings of DNS updates automation. They used <a href=\"https://engineering.shopify.com/blogs/engineering/implementing-chatops-into-our-incident-management-procedure\" target=\"_blank\" title=\"Implementing ChatOps into our Incident Management Procedure\" rel=\"noopener noreferrer\">our chatops bot</a>, spy, to run commands requesting failovers. The bot creates a PR in our record-store repository (which uses <a href=\"https://github.com/Shopify/record_store/\" target=\"_blank\" title=\"Shopify - record_store - GitHub\" rel=\"noopener noreferrer\">the record_store open source project</a>) with the requested DNS change, which then needs to be approved, merged, and deployed after passing the tests. Except for the automation, it’s a similar approach to the manual one, hence it has the same limitations with failover delays and active/active capabilities.</p> \n<h2>Edgescale Team</h2> \n<p>Part of the Edgescale team's responsibilities is to handle our assets (images and static files) and Content Delivery Networks (CDN), which bring the assets as close to the client as possible thanks to a network of distributed servers that store those files. To succeed in this mission, the team wanted more control and active/active capabilities. They used DNS providers allowing for weighted traffic management. They set weights to their records and define which share of traffic goes to which endpoint. It allowed them to share the traffic between their two CDN providers. To set this up, they used the DNS provider’s APIs with weights that could span from 0 (disabled) to 15, using DNS A records (hostname to IP address). To make their lives easier, they wrote a spy cdn command, responsible for making the API calls to the two DNS providers. It reduced the limitations of failover time, as well as provided the active/active capabilities. However, we couldn’t produce a stable, easy to reproduce, and version-controlled configuration of the providers. Adding endpoints to the traffic management was to be done manually, and thus prone to errors. The providers we use for our CDN needs don’t perform the same way in every region of the world and incur different costs in those regions. Using different traffic shares depending on the geographical location of the requesters is one of the traffic-management use-cases we presented in Part 1: Introduction to DNS traffic management(URL), but that wasn’t available here.</p> \n<h2>Other Teams</h2> \n<p>Finally, a few other teams decided to manually create records in one of the DNS providers used by the team handling our assets. They had fast failover and active/active capabilities but didn’t have a stable configuration, nor redundancy from using a single DNS provider.</p> \n<p>We had too many setups going all over the place, corresponding to maintainability problems. Also, any impactful changes needed a lot of coordination and moving pieces. All of these setups had similar use cases and needs. We started working on how to improve and consolidate our approach to DNS traffic management to</p> \n<ul> \n <li>reduce the limitations encountered by teams</li> \n <li>connect other teams with similar needs</li> \n <li>improve maintainability</li> \n <li>create ownership</li> \n</ul> \n<h1>Consolidation and Ownership of DNS Traffic Management</h1> \n<p>The first step of creating a better service used by many teams at Shopify was to define the requirements and goals. We wanted a reliable and redundant system that would provide</p> \n<ul> \n <li>regionalized traffic</li> \n <li>fine-grained traffic sharing</li> \n <li>failover capabilities</li> \n <li>easy setup and updating by the teams owning traffic-managed domains</li> \n</ul> \n<p style=\"text-align: center;\"><img alt=\"Consolidation and ownership of DNS traffic management\" src=\"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R002_after_924x418_b2a5d436-de0c-4be7-96ac-f901b22bc8ba.png?v=1596570680\" style=\"float: none;\" /></p> \n<p>The final state of our setup provides a unified way of setting up and handling our services. We use a <code>git</code> repository to store the domain's configuration that’s then deployed to two DNS providers. The configuration can be tweaked in a fast and easy manner for both providers through a set of spy commands, allowing for efficient failovers. Let's talk about those choices to build our system, and how we built it.</p> \n<h2>Establish Reliability and Redundancy</h2> \n<p>Each domain name has a set of nameservers, and when using a DNS client, one of those nameservers is selected and queried first, another one is used when a timeout occurs. Shopify used a single DNS provider until 2016, where a large DNS outage happened while our DNS provider was under a distributed denial of service (DDoS) attack, effectively dropping a large number of legitimate requests. We learned from our mistakes and increased our reliability and redundancy by using more than one DNS provider.</p> \n<p>When CDN traffic management was set up, it used two different DNS providers to follow in the steps of our static DNS records in the <code>record_store</code>. The decision for our new system was easy to make since it prevented being dependent on a single provider, we wanted to follow the same approach and adopt two providers to build our new standard.</p> \n<h2>Define The Traffic Management Layers</h2> \n<p>Two of our DNS providers allowed for regionalized and weighted traffic management, as well as multiple failover layers. It was just a matter of defining how we wanted things to work and build the equivalent approach for both providers.</p> \n<p>We defined our approach in <em>layers</em> of traffic management and considered that each <em>layer</em> had a decision to make that would reduce the set of options that the next <em>layers</em> can choose from.</p> \n<h3>Layer 1 Geographical Fencing</h3> \n<p style=\"float: right;\"><img alt=\"The layer supports globally matching endpoints, which are mandatory\" src=\"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R003_filtering-geo_320x243_c20d4f46-1907-41f3-98df-2130e979817b.gif?v=1596583200\" style=\"float: right; margin-left: 10px; margin-bottom: 10px;\">The layer supports globally matching endpoints, which are mandatory. We always have an answer to a DNS request for an existing traffic-managed domain, even if there is no region specifically matching the requester. We defined a global region that is selected when nothing more specific matches. The geographical fencing layer selects the endpoints that fit the region where the request originates from. This layer selects the <em>best geographical match</em> with the client’s request. For instance, we set a rule to have endpoint A answered for Canada and endpoint B for Quebec. When we get a request originating from Montreal, we return B. If the request originates from Ottawa, we return A.</img></p> \n<h3>Layer 2 Endpoint Status</h3> \n<p style=\"float: left;\"><img alt=\"Automatically setting endpoints status depends on a process called health checking or monitoring\" src=\"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R004_filtering-up_320x243_7bca103d-4f51-4b9a-b198-d50a05903298.gif?v=1596582178\" style=\"float: left; margin-right: 10px; margin-bottom: 10px;\">We provided a way to enable and disable the use of endpoints depending on their status, which is manually or automatically set. Automatically setting endpoints status depends on a process called <em>health checking</em> or <em>monitoring</em>, where we try to reach the endpoint regularly in order to verify if it does (healthy) or does not (unhealthy) answer. We added a layer of traffic management based on the endpoint status aimed at selecting only the endpoints currently considered as healthy. However, we don’t want the requester to receive an empty answer for a domain that does exist, as it would trigger the negative TTL, most of the time higher than our traffic-managed domain TTL. If any of the endpoints is healthy, then only the healthy endpoints are returned by Layer 2. If none of the endpoints are healthy, all the endpoints are returned. The logic behind this is simple: returning something that doesn’t work is better than not returning anything, as it allows the client to start back using the service as soon as endpoints are back online.</img></p> \n<h3>Layer 3 Endpoint Priority</h3> \n<p style=\"float: right;\"><img alt=\"Endpoint priority. We allow users to define levels of priorities for the traffic shares of their domains\" src=\"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R005_filtering-priority_320x246_2a8196e6-9ce0-47cd-9cc6-7b0dd613e189.gif?v=1596583243\" style=\"float: right; margin-left: 10px; margin-bottom: 10px;\">Another aspect we want control over is the failover approach for our endpoints. We allow users to define levels of priorities for the traffic shares of their domains. For instance, they could define, as the highest priority, that three endpoints A, B, and C would receive 100%, 0%, and 0% of the traffic respectively. However, when A is unhealthy, instead of using B and C, we define, as a second priority, that B would receive 100% of the traffic. This can’t be done without a layer selecting endpoints based on their priority, as we’d be sending a share of the normal traffic to B, or we don’t have automated control over how B and C share the traffic in the case where A is failing. Endpoints of higher priority layers with a weight set to 0 (not receiving traffic) are also considered down for those layers. This means when the endpoints receiving traffic are unhealthy, through health checking, any higher-priority endpoints get discarded at Layer 2, allowing Layer 3 to keep only the highest priority endpoints left in the returned list.</img></p> \n<h3>Layer 4 Weighted Selection</h3> \n<p style=\"float: left;\"><img alt=\"This final layer deals with the weights defined for the endpoints\" src=\"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R006_filtering-weight_320x245_a9061f7f-eb23-4773-8cb6-b12949ff5783.gif?v=1596583333\" style=\"float: left; margin-right: 10px; margin-bottom: 10px;\">This final layer deals with the weights defined for the endpoints. Each endpoint <code>E</code> reaching this layer has a probability <code>P<sub>E</sub></code> of being selected as the answer. <code>P<sub>E</sub></code> is obtained through the formula <strong>&lt;weight of E&gt;/&lt;sum of the weights of all endpoints reaching Layer 4&gt;</strong>. Any 0-weighted endpoints will be automatically discarded unless there are only 0-weighted endpoints where all endpoints will have an equal chance of being selected and returned to the requester.&nbsp;</img></p> \n<h2><b>Deploying and Maintaining The Traffic-Managed Domains</b></h2> \n<p>We try to build tooling in a self-service way. It creates a new standard requiring us to make tooling easily accessible for other teams to deploy their traffic-managed domains. Since we use <a href=\"https://www.terraform.io/\" target=\"_blank\" title=\"Terraforme\" rel=\"noopener noreferrer\">Terraform</a> with <a href=\"https://www.runatlantis.io/\" target=\"_blank\" title=\"Atlantis Terraform Pull Request Automation\" rel=\"noopener noreferrer\">Atlantis</a> for a number of our deployments, we built a Terraform module that receives only the required parameters for an application owner and hides most of the work happening behind the scenes to configure our providers.</p> \n<p><script src=\"https://gist.github.com/ShopifyEng/473e2612007a631248aa550275cc5d9b.js\"></script></p> \n<p>The above code represents the gist of what an application owner needs to provide to deploy their own traffic-managed domain.</p> \n<p>We work to keep our deployments organized, so we derive the <code>zone</code> and <code>subdomain</code> parameters from the path of the domain being terraformed. For example, the path to this file is <code>terraform/tm.shopifysvc.com/test/domain.tf</code> allows deriving that the zone is <code>tm.shopifysvc.com</code> and the subdomain is <code>test</code>.</p> \n<p>When an application owner wants to make changes to their traffic-managed domain, they just need to update the <code>domain.tf</code> file and apply the terraform change. There are a number of extra features that control</p> \n<ul> \n <li>automated monitoring and failover for their domains&nbsp;</li> \n <li>monitoring configuration for domains</li> \n <li>paging when a failover is automatically triggered or not.</li> \n</ul> \n<p>When we make changes to how traffic-managed domains are deployed, or add new features, we update the module and move domains to the new module version one by one. Everything stays transparent for the application owners and easy to maintain for us, the Edgescale team.</p> \n<h2>Everyday Traffic Steering Operations</h2> \n<p>We allowed the users of our new standard to make changes fast and easily applied to their traffic-managed domain. We built a new command in our chatops bot, <code>spy endpoints</code>, to perform operations on the traffic-managed domains.</p> \n<p>Those commands will operate on relative and absolute domains. Relative domains will automatically receive our default traffic-managed zone as a suffix. It’s also possible to specify in which region the change should apply by using square brackets; for example, <code>cdn[us-*,na]</code> would concern the <code>cdn</code> traffic-managed domain but only in region na and only ones starting with <code>us-</code>.</p> \n<p style=\"text-align: left;\"><img alt=\"The spy endpoints get command gets the current traffic shares between endpoints for a given domain\" src=\"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R007_get_test.tm.shopifysvc.com_gif.2020-06-08_17_19_41_1037x533_f40d72e0-2830-42cd-8751-b48c5b91b10f.gif?v=1596572726\" style=\"display: block; float: none; margin-left: auto; margin-right: auto;\" /></p> \n<p>The spy endpoints get command gets the current traffic shares between endpoints for a given domain. If all providers are holding the same data (which should be the case most of the time), then the command results without any mention of the DNS providers. When results are different (the providers went out of sync), the data will be shown with mentions of the providers to make sure that the current traffic shares are known.</p> \n<p style=\"text-align: left;\"><img alt=\"The spy endpoints set command changes the traffic shares using specific weight values we provide\" src=\"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R008_set_test.tm.shopifysvc.com_gif.2020-06-08_17_38_48_1314x851_c9eeee03-2770-42e2-831c-17492b7ee831.gif?v=1596572785\" style=\"display: block; float: none; margin-left: auto; margin-right: auto;\" /></p> \n<p>The <code>spy endpoints set</code> command changes the traffic shares using specific weight values we provide. It updates every provider and runs the <code>spy endpoints set</code> command to show the new traffic shares. Instead of specifying the weights for each endpoint, it’s possible to use a number of defined <em>profiles</em> that set predefined traffic shares. For example, our test domain with its two endpoints&nbsp;<code>mostly[central-4]</code> will define weights of 95 for <code>central-4</code> and 5 for <code>central-5</code>.</p> \n<h1>Our Success Stories</h1> \n<p><strong>Moving to ElasticSearch 7.0.0</strong> - We talked about the process that was used by the ElasticSearch team and the fact that it was limited to failovers and didn’t allow traffic shares. When we moved our internal ElasticSearch clusters to ElasticSearch 7.0.0, the team was able to use the weighted load balancing provided by our tools to move the traffic chunk by chunk and ensure everything was working properly. It allowed them to keep the regular traffic going and mitigate any issue they might have encountered along the way, making the transition to ElasticSearch 7.0.0 seamless to the different systems using it.</p> \n<p><strong>Recovering from Kafka overload during a flash sale</strong> - During a large flash sale, the Kafka brokers in one of our clusters started overloading from the traffic they had to handle. Once the problem was identified, it took a few minutes for the Kafka team to realize that they now had traffic share capabilities from our DNS traffic manager. They used it to divert half the traffic from the overloaded region and send it to another available region. Less than five minutes after making that change, the Kafka queues started recovering.</p> \n<p><strong>Relieving on-call stress</strong> - Being on-call is stressful, especially when running errands and we don’t want to be stuck at home waiting for our phone to ring. Even with the great on-call culture at Shopify, and people always happy to override parts of your shift, being able to use the DNS traffic manager to steer traffic of an application to another cluster when something happens helps in so many cases. One aspect the different teams appreciated is that work can be done from the phone easily (thanks <code>spy</code>!). Another one is allowing Shopifolk to stay serene while solving the incidents which are mitigated thanks to traffic management and don’t impact our merchants and their clients. In summary, easy to use tooling and practical features together improve the experience of both our merchants and coworkers.</p> \n<p>Since the creation of our new DNS traffic management standard in the middle of 2019, we’ve onboarded more than 40 different domains across more than 12 different teams.</p> \n<h1>Why Ownership Is Important. Demonstrated By Example</h1> \n<p>A few months ago, while we moved teams to use the initial version of our DNS traffic manager, we got an email from one of our DNS providers letting us know that they would discontinue their service because it would be merged with the services of the company that bought them a few years prior. Of course, we weren’t so lucky, having their systems merged together would require action on our part. We needed to manually migrate our zones to the new provider.</p> \n<p>We launched a project to find our next DNS provider as a result. Since we needed to manually migrate our zones and consequently all of our tooling, we might as well evaluate our options. We looked at more than 40 providers, keeping in mind our needs for our static zones and traffic management requirements. We selected a few providers that fit our needs and decided on which one to sign a contract with.</p> \n<p>Once we chose the provider, the big migration happened. First, we updated our terraform module to support the new provider and deployed the traffic-managed domains in the three providers. Then we updated our spy endpoints tooling to update all providers when making changes so everything was ready and in sync. Next, we moved the nameservers of our traffic-managed zone one by one from the DNS provider we were leaving to the new DNS provider, making sure that in case of a problem only a controlled share of the traffic would be affected. We explained our migration plans to the different teams owning domains in the traffic manager, letting them know when it would happen, and that it should be transparent to them, but if anything unexpected seems to be happening, they should contact us. We also told the incident manager on-call of the changes happening and the timelines.</p> \n<p style=\"text-align: left;\"><img alt=\"\" src=\"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R009_dns-traffic-management-nameservers-migration_924x537_optimized_low_quality.gif?v=1596575483\" style=\"display: block; margin-left: auto; margin-right: auto; float: none;\" /></p> \n<p>Everything was in the plan for the change to happen. However, 30 minutes before change time, the provider we were leaving had an incident, preventing us from moving traffic and happening at the same time as one of the application owners having an incident that they wanted to mitigate with the traffic manager. It pushed our timeline forward, but we continued with the change without any issue and it was fully transparent to all the application owners.</p> \n<p>Looking back to how things were before we rolled out our new standard for DNS traffic management, we easily can say that moving to a new DNS provider wouldn’t have been that smooth. We would have had to</p> \n<ul> \n <li>contact every team using their own approach to gather their needs and usage so we could find a good alternative to our current DNS provider (luckily this was done while preparing and building this project)</li> \n <li>coordinate between those teams for the change to happen, and then chase after them to make sure they updated any tooling used</li> \n</ul> \n<p>The change couldn’t be handled for all of them as a whole as there wasn’t one product that one team handles, but many products that many teams handle.</p> \n<p>With our DNS traffic management system, we brought ownership to this aspect of our infrastructure because we understand the capabilities and requirements of teams, and how we can maintain and evolve as our teams’ needs evolve, improving the experience of our merchants and their customers.</p> \n<hr> \n <p>Our DNS traffic management journey took us from many manually setup, maintained, and updated traffic management approaches to a fully automated self-served system used by more than 40 domains owned by more than 12 different teams, and handling more than 100M requests per 24h. If building systems from the ground up to solve real-world problems interests you, our Engineering blog has stories about other challenges we have encountered. Visit our <a href=\"http://www.shopify.com/careers/specialties/engineering?itcat=EngBlog&amp;itterm=Post\">Engineering career page</a> to find out about our open positions.&nbsp;<span>J</span><span>oin our remote team and work (almost) anywhere.&nbsp;</span><span></span><a href=\"https://www.shopify.com/careers/work-anywhere\">Learn about&nbsp;how<span>&nbsp;</span>we’re hiring to design the future together - a future that is<span>&nbsp;</span>digital by default</a><span>.</span></p> \n</hr>","descriptionType":"html","publishedDate":"Wed, 05 Aug 2020 14:49:00 +0000","feedId":27961,"bgimg":"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R001_before-yolo-fakelogos_3770x1493_a2b0ad36-32e2-4cf4-be84-20b2e8b8ffc2.gif?v=1596570536","linkMd5":"8fbc38d310accb028066d8510e82efeb","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx33/cdn89@2020_2/2020/10/18/17-57-02-701_e2c77c6c3cbc5357.webp","destWidth":3770,"destHeight":1493,"sourceBytes":1371635,"destBytes":1438588,"author":"Raphaël Beamonte","articleImgCdnMap":{"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R001_before-yolo-fakelogos_3770x1493_a2b0ad36-32e2-4cf4-be84-20b2e8b8ffc2.gif?v=1596570536":"https://cdn.jsdelivr.net/gh/myreaderx33/cdn89@2020_2/2020/10/18/17-57-02-701_e2c77c6c3cbc5357.webp","https://cdn.shopify.com/s/files/1/0779/4361/files/P02R002_after_924x418_b2a5d436-de0c-4be7-96ac-f901b22bc8ba.png?v=1596570680":"https://cdn.jsdelivr.net/gh/myreaderx1/cdn5@2020_5/2020/10/18/17-57-04-403_433a9644e68c4eba.webp","https://cdn.shopify.com/s/files/1/0779/4361/files/P02R003_filtering-geo_320x243_c20d4f46-1907-41f3-98df-2130e979817b.gif?v=1596583200":"https://cdn.jsdelivr.net/gh/myreaderx16/cdn98@2020_5/2020/10/18/17-57-05-485_456d2c056ac8a175.webp","https://cdn.shopify.com/s/files/1/0779/4361/files/P02R004_filtering-up_320x243_7bca103d-4f51-4b9a-b198-d50a05903298.gif?v=1596582178":"https://cdn.jsdelivr.net/gh/myreaderx21/cdn9@2020_6/2020/10/18/17-57-06-042_a12755ac656bae04.webp","https://cdn.shopify.com/s/files/1/0779/4361/files/P02R005_filtering-priority_320x246_2a8196e6-9ce0-47cd-9cc6-7b0dd613e189.gif?v=1596583243":"https://cdn.jsdelivr.net/gh/myreaderx4/cdn21@2020_6/2020/10/18/17-57-05-803_ef37b8a9cf3b6990.webp","https://cdn.shopify.com/s/files/1/0779/4361/files/P02R006_filtering-weight_320x245_a9061f7f-eb23-4773-8cb6-b12949ff5783.gif?v=1596583333":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn14@2020_5/2020/10/18/17-57-07-332_808370158615a101.webp","https://cdn.shopify.com/s/files/1/0779/4361/files/P02R007_get_test.tm.shopifysvc.com_gif.2020-06-08_17_19_41_1037x533_f40d72e0-2830-42cd-8751-b48c5b91b10f.gif?v=1596572726":"https://cdn.jsdelivr.net/gh/myreaderx6/cdn18@2020_3/2020/10/18/17-57-05-188_9e3054f9dfb0e93b.webp","https://cdn.shopify.com/s/files/1/0779/4361/files/P02R008_set_test.tm.shopifysvc.com_gif.2020-06-08_17_38_48_1314x851_c9eeee03-2770-42e2-831c-17492b7ee831.gif?v=1596572785":null,"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R009_dns-traffic-management-nameservers-migration_924x537_optimized_low_quality.gif?v=1596575483":"https://cdn.jsdelivr.net/gh/myreaderx5oss/cdn99@2020_1/2020/10/18/17-57-05-420_e8a8f91e7ec9165c.webp"},"publishedOrCreatedDate":1603043804039}],"record":{"createdTime":"2020-10-19 01:56:44","updatedTime":"2020-10-19 01:56:44","feedId":27961,"fetchDate":"Sun, 18 Oct 2020 17:56:44 +0000","fetchMs":512,"handleMs":30,"totalMs":25422,"newArticles":0,"totalArticles":30,"status":1,"type":0,"ip":"aa5b771909b552db8ae765322bbc0947","hostName":"europe-24*","requestId":"65935fd7536e42679aa37d7132d6ed3c_27961","contentType":"application/atom+xml; charset=utf-8","totalBytes":3646510,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":9,"articlesImgsGithubTotal":8,"successGithubMap":{"myreaderx16":1,"myreaderx6":1,"myreaderx32":1,"myreaderx4":1,"myreaderx21":1,"myreaderx33":1,"myreaderx1":1,"myreaderx5oss":1},"failGithubMap":{"myreaderx23":1}},"feed":{"createdTime":"2020-09-07 02:42:47","updatedTime":"2020-09-07 04:45:46","id":27961,"name":"Shopify Engineering - Shopify Engineering","url":"http://engineering.shopify.com/blogs/engineering.atom","subscriber":116,"website":null,"icon":"https://cdn.shopify.com/s/files/1/0779/4361/files/shopify_glyph_7c804f74-69aa-4a31-b9b5-f0610bbf2cf9_32x32.png?v=1559751462","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx65/cdn20@2020_4/2020/09/06/20-45-44-897_ffc30c882b02c9b7.webp","description":"","weekly":null,"link":null},"noPictureArticleList":[{"createdTime":"2020-10-19 01:57:08","updatedTime":"2020-10-19 01:57:08","id":null,"feedId":27961,"linkMd5":"8fbc38d310accb028066d8510e82efeb"}],"tmpCommonImgCdnBytes":1438588,"tmpBodyImgCdnBytes":2207922,"tmpBgImgCdnBytes":0,"extra4":{"start":1603043803448,"total":0,"statList":[{"spend":561,"msg":"获取xml内容"},{"spend":30,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":4760,"msg":"正文链接上传到cdn"}]},"extra5":9,"extra6":9,"extra7ImgCdnFailResultVector":[{"code":1,"isDone":false,"source":"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R008_set_test.tm.shopifysvc.com_gif.2020-06-08_17_38_48_1314x851_c9eeee03-2770-42e2-831c-17492b7ee831.gif?v=1596572785","sourceStatusCode":200,"destWidth":1314,"destHeight":851,"sourceBytes":482324,"destBytes":350852,"targetWebpQuality":75,"feedId":27961,"totalSpendMs":1940,"convertSpendMs":1609,"createdTime":"2020-10-19 01:57:04","host":"us-030*","referer":"https://engineering.shopify.com/blogs/engineering/using-dns-traffic-management-add-resiliency-shopify-services","linkMd5ListStr":"8fbc38d310accb028066d8510e82efeb","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx23/cdn25/contents/2020/10/18/17-57-06-131_11339a7b1eb44753.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 69189253.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Sun, 18 Oct 2020 17:57:06 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"status":["403 Forbidden"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["89DC:0C71:1D1CB45:47CEAFC:5F8C81E8"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, read:packages, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1603044105"],"x-ratelimit-used":["60"],"x-xss-protection":["1; mode=block"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx23/cdn25/contents/2020/10/18/17-57-06-131_11339a7b1eb44753.webp","historyStatusCode":[],"spendMs":67},"base64UserPassword":null,"token":"df0b9******************************93a6e"},"githubUser":"myreaderx23","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"471 KB","destSize":"342.6 KB","compressRate":"72.7%"},{"code":1,"isDone":false,"source":"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R008_set_test.tm.shopifysvc.com_gif.2020-06-08_17_38_48_1314x851_c9eeee03-2770-42e2-831c-17492b7ee831.gif?v=1596572785","sourceStatusCode":200,"destWidth":1314,"destHeight":851,"sourceBytes":482324,"destBytes":350852,"targetWebpQuality":75,"feedId":27961,"totalSpendMs":1785,"convertSpendMs":1652,"createdTime":"2020-10-19 01:57:06","host":"us-030*","referer":"https://engineering.shopify.com/blogs/engineering/using-dns-traffic-management-add-resiliency-shopify-services","linkMd5ListStr":"8fbc38d310accb028066d8510e82efeb","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx23/cdn25/contents/2020/10/18/17-57-08-007_11339a7b1eb44753.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 69189253.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Sun, 18 Oct 2020 17:57:08 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"status":["403 Forbidden"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["89DC:0C71:1D1CBA5:47CEF71:5F8C81F2"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, read:packages, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1603044105"],"x-ratelimit-used":["60"],"x-xss-protection":["1; mode=block"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx23/cdn25/contents/2020/10/18/17-57-08-007_11339a7b1eb44753.webp","historyStatusCode":[],"spendMs":55},"base64UserPassword":null,"token":"df0b9******************************93a6e"},"githubUser":"myreaderx23","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"471 KB","destSize":"342.6 KB","compressRate":"72.7%"}],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-038.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-037.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-002.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://europe64.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-030.herokuapp.com/":{"failCount":0,"successCount":2,"resultList":[200,200]},"http://us-52.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-014.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-026.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R001_before-yolo-fakelogos_3770x1493_a2b0ad36-32e2-4cf4-be84-20b2e8b8ffc2.gif?v=1596570536","sourceStatusCode":200,"destWidth":3770,"destHeight":1493,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx33/cdn89@2020_2/2020/10/18/17-57-02-701_e2c77c6c3cbc5357.webp","sourceBytes":1371635,"destBytes":1438588,"targetWebpQuality":75,"feedId":27961,"totalSpendMs":18244,"convertSpendMs":16592,"createdTime":"2020-10-19 01:56:45","host":"us-010*","referer":"https://engineering.shopify.com/blogs/engineering/using-dns-traffic-management-add-resiliency-shopify-services","linkMd5ListStr":"8fbc38d310accb028066d8510e82efeb,8fbc38d310accb028066d8510e82efeb","githubUser":"myreaderx33","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"1.3 MB","destSize":"1.4 MB","compressRate":"104.9%"},{"code":1,"isDone":false,"source":"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R002_after_924x418_b2a5d436-de0c-4be7-96ac-f901b22bc8ba.png?v=1596570680","sourceStatusCode":200,"destWidth":924,"destHeight":418,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx1/cdn5@2020_5/2020/10/18/17-57-04-403_433a9644e68c4eba.webp","sourceBytes":27160,"destBytes":27160,"feedId":27961,"totalSpendMs":992,"convertSpendMs":0,"createdTime":"2020-10-19 01:57:04","host":"us-026*","referer":"https://engineering.shopify.com/blogs/engineering/using-dns-traffic-management-add-resiliency-shopify-services","linkMd5ListStr":"8fbc38d310accb028066d8510e82efeb","githubUser":"myreaderx1","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"26.5 KB","destSize":"26.5 KB","compressRate":"100%"},{"code":1,"isDone":false,"source":"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R009_dns-traffic-management-nameservers-migration_924x537_optimized_low_quality.gif?v=1596575483","sourceStatusCode":200,"destWidth":924,"destHeight":537,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx5oss/cdn99@2020_1/2020/10/18/17-57-05-420_e8a8f91e7ec9165c.webp","sourceBytes":561669,"destBytes":225936,"targetWebpQuality":75,"feedId":27961,"totalSpendMs":2482,"convertSpendMs":1037,"createdTime":"2020-10-19 01:57:04","host":"us-038*","referer":"https://engineering.shopify.com/blogs/engineering/using-dns-traffic-management-add-resiliency-shopify-services","linkMd5ListStr":"8fbc38d310accb028066d8510e82efeb","githubUser":"myreaderx5oss","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"548.5 KB","destSize":"220.6 KB","compressRate":"40.2%"},{"code":1,"isDone":false,"source":"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R003_filtering-geo_320x243_c20d4f46-1907-41f3-98df-2130e979817b.gif?v=1596583200","sourceStatusCode":200,"destWidth":320,"destHeight":243,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx16/cdn98@2020_5/2020/10/18/17-57-05-485_456d2c056ac8a175.webp","sourceBytes":440805,"destBytes":397440,"targetWebpQuality":75,"feedId":27961,"totalSpendMs":2514,"convertSpendMs":1093,"createdTime":"2020-10-19 01:57:04","host":"us-037*","referer":"https://engineering.shopify.com/blogs/engineering/using-dns-traffic-management-add-resiliency-shopify-services","linkMd5ListStr":"8fbc38d310accb028066d8510e82efeb","githubUser":"myreaderx16","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"430.5 KB","destSize":"388.1 KB","compressRate":"90.2%"},{"code":1,"isDone":false,"source":"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R007_get_test.tm.shopifysvc.com_gif.2020-06-08_17_19_41_1037x533_f40d72e0-2830-42cd-8751-b48c5b91b10f.gif?v=1596572726","sourceStatusCode":200,"destWidth":1037,"destHeight":533,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx6/cdn18@2020_3/2020/10/18/17-57-05-188_9e3054f9dfb0e93b.webp","sourceBytes":111160,"destBytes":93448,"targetWebpQuality":75,"feedId":27961,"totalSpendMs":2639,"convertSpendMs":819,"createdTime":"2020-10-19 01:57:04","host":"europe64*","referer":"https://engineering.shopify.com/blogs/engineering/using-dns-traffic-management-add-resiliency-shopify-services","linkMd5ListStr":"8fbc38d310accb028066d8510e82efeb","githubUser":"myreaderx6","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"108.6 KB","destSize":"91.3 KB","compressRate":"84.1%"},{"code":1,"isDone":false,"source":"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R005_filtering-priority_320x246_2a8196e6-9ce0-47cd-9cc6-7b0dd613e189.gif?v=1596583243","sourceStatusCode":200,"destWidth":320,"destHeight":246,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx4/cdn21@2020_6/2020/10/18/17-57-05-803_ef37b8a9cf3b6990.webp","sourceBytes":372420,"destBytes":273200,"targetWebpQuality":75,"feedId":27961,"totalSpendMs":2668,"convertSpendMs":1109,"createdTime":"2020-10-19 01:57:04","host":"us-52*","referer":"https://engineering.shopify.com/blogs/engineering/using-dns-traffic-management-add-resiliency-shopify-services","linkMd5ListStr":"8fbc38d310accb028066d8510e82efeb","githubUser":"myreaderx4","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"363.7 KB","destSize":"266.8 KB","compressRate":"73.4%"},{"code":1,"isDone":false,"source":"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R004_filtering-up_320x243_7bca103d-4f51-4b9a-b198-d50a05903298.gif?v=1596582178","sourceStatusCode":200,"destWidth":320,"destHeight":243,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx21/cdn9@2020_6/2020/10/18/17-57-06-042_a12755ac656bae04.webp","sourceBytes":569547,"destBytes":470330,"targetWebpQuality":75,"feedId":27961,"totalSpendMs":2919,"convertSpendMs":1674,"createdTime":"2020-10-19 01:57:04","host":"us-014*","referer":"https://engineering.shopify.com/blogs/engineering/using-dns-traffic-management-add-resiliency-shopify-services","linkMd5ListStr":"8fbc38d310accb028066d8510e82efeb","githubUser":"myreaderx21","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"556.2 KB","destSize":"459.3 KB","compressRate":"82.6%"},{"code":1,"isDone":false,"source":"https://cdn.shopify.com/s/files/1/0779/4361/files/P02R006_filtering-weight_320x245_a9061f7f-eb23-4773-8cb6-b12949ff5783.gif?v=1596583333","sourceStatusCode":200,"destWidth":320,"destHeight":245,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn14@2020_5/2020/10/18/17-57-07-332_808370158615a101.webp","sourceBytes":914201,"destBytes":720408,"targetWebpQuality":75,"feedId":27961,"totalSpendMs":4601,"convertSpendMs":2453,"createdTime":"2020-10-19 01:57:04","host":"us-002*","referer":"https://engineering.shopify.com/blogs/engineering/using-dns-traffic-management-add-resiliency-shopify-services","linkMd5ListStr":"8fbc38d310accb028066d8510e82efeb","githubUser":"myreaderx32","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"892.8 KB","destSize":"703.5 KB","compressRate":"78.8%"}],"successGithubMap":{"myreaderx16":1,"myreaderx6":1,"myreaderx32":1,"myreaderx4":1,"myreaderx21":1,"myreaderx33":1,"myreaderx1":1,"myreaderx5oss":1},"failGithubMap":{"myreaderx23":1}}