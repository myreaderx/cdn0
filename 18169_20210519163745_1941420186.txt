{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2021-05-20 00:37:11","updatedTime":"2021-05-20 00:37:11","title":"The mystery of high pending counts","link":"http://relengofthenerds.blogspot.com/2015/09/the-mystery-of-high-pending-counts-and.html","description":"<div xmlns=\"http://www.w3.org/1999/xhtml\">In September, Mozilla release engineering started experiencing high pending counts on our test pools, notably Windows, but also Linux (and consequently Android).  High pending counts mean that there are thousands of jobs queued to run on the machines that are busy running other jobs.  The time developers have to wait for their test results is longer than ideal.<br /><br /><div class=\"separator\" style=\"clear: both; text-align: center;\"><a href=\"http://4.bp.blogspot.com/-jHmM3SuASI4/VgWXEpAqbLI/AAAAAAAAEe8/EHhyzrdQlE4/s1600/Screen%2BShot%2B2015-09-25%2Bat%2B2.48.06%2BPM.png\" style=\"margin-left: 1em; margin-right: 1em;\"><img border=\"0\" height=\"251\" src=\"http://4.bp.blogspot.com/-jHmM3SuASI4/VgWXEpAqbLI/AAAAAAAAEe8/EHhyzrdQlE4/s640/Screen%2BShot%2B2015-09-25%2Bat%2B2.48.06%2BPM.png\" width=\"640\" /></a></div><br />Usually, pending counts clear overnight as less code is pushed during the night (in North America) which invokes fewer builds and tests.  However, as you can see from the graph above, the Windows test pending counts were flat last night. They did not clear up overnight. You will also note that try, which usually comprises 63% of our load, has very highest pending counts compared to other branches.  This is because many people land on try before pushing to other branches, and tests aren't coalesced on try.<br /><br /><br />The work to determine the cause of high pending counts is always an interesting mystery.<br /><ul><li><div class=\"\" id=\"magicdomid27\"><span class=\"author-g-qklxbfb5dwnyy0ck\">Are end to end times for tests increasing?</span><span class=\"author-g-qklxbfb5dwnyy0ck\"> </span></div></li><li><span class=\"author-g-qklxbfb5dwnyy0ck\">Have more tests been enabled recently?</span></li><li><span class=\"author-g-qklxbfb5dwnyy0ck\">Are retries increasing? (Tests the run multiple times because the initial runs fail due to infrastructure issues)</span></li><li><span class=\"author-g-qklxbfb5dwnyy0ck\">Are jobs that are coalesced being backfilled and consuming capacity? </span></li><li>Are tests being chunked into smaller jobs that increase end to end time due to the added start up time? <span class=\"author-g-qklxbfb5dwnyy0ck\"><br /></span></li></ul><table align=\"center\" cellpadding=\"0\" cellspacing=\"0\" class=\"tr-caption-container\" style=\"margin-left: auto; margin-right: auto; text-align: center;\"><tbody><tr><td style=\"text-align: center;\"><a href=\"http://2.bp.blogspot.com/-sW5Uyreylso/VgWSbn6xm7I/AAAAAAAAEew/dvk2-_7ICRU/s1600/6883500405_cbc44561e9_o.jpg\" style=\"margin-left: auto; margin-right: auto;\"><img border=\"0\" height=\"379\" src=\"http://2.bp.blogspot.com/-sW5Uyreylso/VgWSbn6xm7I/AAAAAAAAEew/dvk2-_7ICRU/s640/6883500405_cbc44561e9_o.jpg\" width=\"640\" /></a></td></tr><tr><td class=\"tr-caption\" style=\"text-align: center;\">Mystery by <a href=\"https://flic.kr/p/bugJRt\">©Stuart Richards</a>, Creative Commons by-nc-sa 2.0</td></tr></tbody></table><br /><a href=\"https://elvis314.wordpress.com/\">Joel Maher </a>and I looked at the data for this last week and discovered what we believe to be the source of the problem.  We <span class=\"author-p-3131\">have determined that since the end of August a  number of new test jobs were enabled that increased the compute time per push on  Windows by 13% or 2.5 hours per push.  Most of these new test jobs are for  <a href=\"http://benjamin.smedbergs.us/weekly-updates.fcgi/project/electrolysis\">e10s</a>.  </span><br /><table align=\"center\" cellpadding=\"0\" cellspacing=\"0\" class=\"tr-caption-container\" style=\"margin-left: auto; margin-right: auto; text-align: center;\"><tbody><tr><td style=\"text-align: center;\"><a href=\"http://3.bp.blogspot.com/-Vb4peyejyiI/VgWdUJr7TzI/AAAAAAAAEfM/e6tPYWTbGBI/s1600/Screen%2BShot%2B2015-09-25%2Bat%2B3.14.45%2BPM.png\" style=\"margin-left: auto; margin-right: auto;\"><img border=\"0\" height=\"328\" src=\"http://3.bp.blogspot.com/-Vb4peyejyiI/VgWdUJr7TzI/AAAAAAAAEfM/e6tPYWTbGBI/s640/Screen%2BShot%2B2015-09-25%2Bat%2B3.14.45%2BPM.png\" width=\"640\" /></a></td></tr><tr><td class=\"tr-caption\" style=\"text-align: left;\">Increase in seconds that new jobs added to the total compute time per push.  (Some existing jobs also reduced their compute time for a total difference about about 2.5 more hours per push on Windows)</td></tr></tbody></table><span class=\"author-p-3131\">The <a href=\"https://wiki.mozilla.org/Electrolysis\">e10s initiative is an important initiative for Mozilla</a> to make Firefox performance and security even better.  However, since new e10s and old tests will continue to run in parallel, we need to get creative on how to have acceptable wait times given the limitations of our current Windows tests pools.  (All of our Windows test run on bare metal in our  datacentre, not on Amazon). </span><br />  <br />Release engineering is working to reduce this pending counts given our current hardware constraints with the following initiatives:<b><span class=\"author-p-3131\"> </span></b><br /><br /><b><span class=\"author-p-3131\">To reduce Linux pending counts:</span></b><br /><div class=\"\" id=\"magicdomid4\"><ul class=\"list-bullet1\"><li><span class=\"author-p-3131\">Added 200 new instances to the tst-emulator64 pool (run Android test jobs on Linux emulators) (</span><a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=1204756\">bug 1204756</a>)</li><li><span class=\"author-p-3131\">In process of adding more Linux32 and Linux64 buildbot masters (</span><a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=1205409\">bug 1205409</a><span class=\"author-p-3131\">) which will allow us to expand our capacity more</span></li></ul></div><br /><b><span class=\"author-p-3131\">Ongoing work to reduce the Windows pending counts:</span></b><br /><br /><ul><li><span class=\"author-p-3131\">Disable Linux32 Talos tests and redeploy these machines as Windows test machines (</span><a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=1204920\" rel=\"noreferrer\" target=\"_blank\">bug 1204920</a><span class=\"author-p-3131\"> and <a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=1208449\">bug 1208449</a>)</span></li><li><span class=\"author-p-3131\">Reduce the number of talos jobs by running SETA on talos (<a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=1192994\">bug 1192994</a>)</span></li><li><span class=\"author-p-3131\">Developer productivity team is investigating whether non-operating specific tests that run on multiple windows test platforms can run on fewer platforms.</span></li></ul><br /><b><span class=\"author-p-3131\">How can you help?  </span></b><br /><br /><span class=\"author-p-3131\">Please be considerate when invoking try pushes and  only select the platforms that you explicitly require to test.  Each  try push for all platforms and all tests invokes over 800 jobs.</span></div>\r\n    ","descriptionType":"xhtml","publishedDate":"Fri, 25 Sep 2015 19:47:00 +0000","feedId":18169,"bgimg":"http://4.bp.blogspot.com/-jHmM3SuASI4/VgWXEpAqbLI/AAAAAAAAEe8/EHhyzrdQlE4/s640/Screen%2BShot%2B2015-09-25%2Bat%2B2.48.06%2BPM.png","linkMd5":"6a74810a93cc16ca436c81c1277722d7","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx33/cdn46@2020_4/2021/05/19/16-37-12-014_678a84d799b06ad5.webp","destWidth":640,"destHeight":251,"sourceBytes":67402,"destBytes":19214,"author":"Kim Moir","articleImgCdnMap":{"http://4.bp.blogspot.com/-jHmM3SuASI4/VgWXEpAqbLI/AAAAAAAAEe8/EHhyzrdQlE4/s640/Screen%2BShot%2B2015-09-25%2Bat%2B2.48.06%2BPM.png":"https://cdn.jsdelivr.net/gh/myreaderx33/cdn46@2020_4/2021/05/19/16-37-12-014_678a84d799b06ad5.webp","http://2.bp.blogspot.com/-sW5Uyreylso/VgWSbn6xm7I/AAAAAAAAEew/dvk2-_7ICRU/s640/6883500405_cbc44561e9_o.jpg":"https://cdn.jsdelivr.net/gh/myreaderx3/cdn52@2020_4/2021/05/19/16-37-45-095_8f59c4174de9dd1c.webp","http://3.bp.blogspot.com/-Vb4peyejyiI/VgWdUJr7TzI/AAAAAAAAEfM/e6tPYWTbGBI/s640/Screen%2BShot%2B2015-09-25%2Bat%2B3.14.45%2BPM.png":null},"publishedOrCreatedDate":1621442231490}],"record":{"createdTime":"2021-05-20 00:37:11","updatedTime":"2021-05-20 00:37:11","feedId":18169,"fetchDate":"Wed, 19 May 2021 16:37:11 +0000","fetchMs":329,"handleMs":81,"totalMs":34311,"newArticles":0,"totalArticles":75,"status":1,"type":0,"ip":"af6ca12eefe249e94a3f077d15d7c168","hostName":"europe-23*","requestId":"d5d79d3a1edc4135955767d3d12991a1_18169","contentType":"application/xml","totalBytes":44346,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":3,"articlesImgsGithubTotal":2,"successGithubMap":{"myreaderx33":1,"myreaderx3":1},"failGithubMap":{"myreaderx14":1}},"feed":{"createdTime":"2020-09-07 02:16:52","updatedTime":"2020-09-07 02:49:48","id":18169,"name":"Planet Release Engineering","url":"http://planet.mozilla.org/releng/atom.xml","subscriber":182,"website":null,"icon":"https://planet.mozilla.org/img/mozilla-16.png","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx63/cdn5@2020_2/2020/09/06/18-49-43-082_bfc1b42b681def57.png","description":"","weekly":null,"link":null},"noPictureArticleList":[{"createdTime":"2021-05-20 00:37:45","updatedTime":"2021-05-20 00:37:45","id":null,"feedId":18169,"linkMd5":"6a74810a93cc16ca436c81c1277722d7"}],"tmpCommonImgCdnBytes":19214,"tmpBodyImgCdnBytes":25132,"tmpBgImgCdnBytes":0,"extra4":{"start":1621442231073,"total":0,"statList":[{"spend":336,"msg":"获取xml内容"},{"spend":81,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":32784,"msg":"正文链接上传到cdn"}]},"extra5":3,"extra6":3,"extra7ImgCdnFailResultVector":[{"code":1,"isDone":false,"source":"http://3.bp.blogspot.com/-Vb4peyejyiI/VgWdUJr7TzI/AAAAAAAAEfM/e6tPYWTbGBI/s640/Screen%2BShot%2B2015-09-25%2Bat%2B3.14.45%2BPM.png","sourceStatusCode":200,"destWidth":640,"destHeight":329,"sourceBytes":22712,"destBytes":9316,"targetWebpQuality":75,"feedId":18169,"totalSpendMs":340,"convertSpendMs":8,"createdTime":"2021-05-20 00:37:12","host":"us-037*","referer":"http://relengofthenerds.blogspot.com/2015/09/the-mystery-of-high-pending-counts-and.html","linkMd5ListStr":"6a74810a93cc16ca436c81c1277722d7","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx14/cdn49/contents/2021/05/19/16-37-13-029_ab6fc5f54a861cb9.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 68584859.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Resource, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Wed, 19 May 2021 16:37:13 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["ADC4:648A:1C9E41D:54A4FF1:60A53EB9"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1621445031"],"x-ratelimit-resource":["core"],"x-ratelimit-used":["60"],"x-xss-protection":["0"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx14/cdn49/contents/2021/05/19/16-37-13-029_ab6fc5f54a861cb9.webp","historyStatusCode":[],"spendMs":32},"base64UserPassword":null,"token":"6b67d******************************91b08"},"githubUser":"myreaderx14","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"22.2 KB","destSize":"9.1 KB","compressRate":"41%"},{"code":1,"isDone":false,"source":"http://3.bp.blogspot.com/-Vb4peyejyiI/VgWdUJr7TzI/AAAAAAAAEfM/e6tPYWTbGBI/s640/Screen%2BShot%2B2015-09-25%2Bat%2B3.14.45%2BPM.png","sourceStatusCode":200,"destWidth":640,"destHeight":329,"sourceBytes":22712,"destBytes":9316,"targetWebpQuality":75,"feedId":18169,"totalSpendMs":54,"convertSpendMs":8,"createdTime":"2021-05-20 00:37:13","host":"us-037*","referer":"http://relengofthenerds.blogspot.com/2015/09/the-mystery-of-high-pending-counts-and.html","linkMd5ListStr":"6a74810a93cc16ca436c81c1277722d7","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx14/cdn49/contents/2021/05/19/16-37-13-147_ab6fc5f54a861cb9.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 68584859.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Resource, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Wed, 19 May 2021 16:37:13 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["ADC4:648A:1C9E42A:54A5009:60A53EB9"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1621445031"],"x-ratelimit-resource":["core"],"x-ratelimit-used":["60"],"x-xss-protection":["0"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx14/cdn49/contents/2021/05/19/16-37-13-147_ab6fc5f54a861cb9.webp","historyStatusCode":[],"spendMs":39},"base64UserPassword":null,"token":"6b67d******************************91b08"},"githubUser":"myreaderx14","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"22.2 KB","destSize":"9.1 KB","compressRate":"41%"},null],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-038.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://us-037.herokuapp.com/":{"failCount":0,"successCount":3,"resultList":[200,200,200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"http://4.bp.blogspot.com/-jHmM3SuASI4/VgWXEpAqbLI/AAAAAAAAEe8/EHhyzrdQlE4/s640/Screen%2BShot%2B2015-09-25%2Bat%2B2.48.06%2BPM.png","sourceStatusCode":200,"destWidth":640,"destHeight":251,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx33/cdn46@2020_4/2021/05/19/16-37-12-014_678a84d799b06ad5.webp","sourceBytes":67402,"destBytes":19214,"targetWebpQuality":75,"feedId":18169,"totalSpendMs":1075,"convertSpendMs":9,"createdTime":"2021-05-20 00:37:11","host":"europe-22*","referer":"http://relengofthenerds.blogspot.com/2015/09/the-mystery-of-high-pending-counts-and.html","linkMd5ListStr":"6a74810a93cc16ca436c81c1277722d7,6a74810a93cc16ca436c81c1277722d7","githubUser":"myreaderx33","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"65.8 KB","destSize":"18.8 KB","compressRate":"28.5%"},{"code":1,"isDone":false,"source":"http://2.bp.blogspot.com/-sW5Uyreylso/VgWSbn6xm7I/AAAAAAAAEew/dvk2-_7ICRU/s640/6883500405_cbc44561e9_o.jpg","sourceStatusCode":200,"destWidth":640,"destHeight":382,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx3/cdn52@2020_4/2021/05/19/16-37-45-095_8f59c4174de9dd1c.webp","sourceBytes":56291,"destBytes":25132,"targetWebpQuality":75,"feedId":18169,"totalSpendMs":479,"convertSpendMs":10,"createdTime":"2021-05-20 00:37:44","host":"us-037*","referer":"http://relengofthenerds.blogspot.com/2015/09/the-mystery-of-high-pending-counts-and.html","linkMd5ListStr":"6a74810a93cc16ca436c81c1277722d7","githubUser":"myreaderx3","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"55 KB","destSize":"24.5 KB","compressRate":"44.6%"}],"successGithubMap":{"myreaderx33":1,"myreaderx3":1},"failGithubMap":{"myreaderx14":1}}