{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-10-13 04:29:13","updatedTime":"2020-10-13 04:29:13","title":"Use Magit API to rebase to closest branch","link":"http://blog.binchen.org/posts/use-magit-api-to-rebase-to-closest-branch/","description":"<div><p>\nMy workflow in Git is,\n</p>\n\n<ul class=\"org-ul\">\n<li>Create a new feature branch based on main branch</li>\n<li>Add some small commits into feature branch</li>\n<li>Rebase feature branch interactively</li>\n</ul>\n\n<p>\nThe final rebase step happens a lot.\n</p>\n\n<p>\nSo I could use Magit api <code>magit-rebase-interactive</code> to speed up it.\n</p>\n\n<p>\nThe key is to analyze output of <code>git log --decorate --oneline</code> to find the main branch commit.\n</p>\n\n<p>\nCode,\n</p>\n\n<div class=\"org-src-container\">\n\n<pre><code class=\"lang-lisp\">(defun my-git-extract-based (target)\n  \"Extract based version from TARGET.\"\n  (replace-regexp-in-string \"^tag: +\"\n                            \"\"\n                            (car (nreverse (split-string target \", +\")))))\n\n(defun my-git-rebase-interactive (&amp;optional user-select-branch)\n  \"Rebase interactively on the closest branch or tag in git log output.\nIf USER-SELECT-BRANCH is not nil, rebase on the tag or branch selected by user.\"\n  (interactive \"P\")\n  (let* ((log-output (shell-command-to-string \"git --no-pager log --decorate --oneline -n 1024\"))\n         (lines (split-string log-output \"\\n\"))\n         (targets (delq nil\n                        (mapcar (lambda (e)\n                                  (when (and (string-match \"^[a-z0-9]+ (\\\\([^()]+\\\\)) \" e)\n                                             (not (string-match \"^[a-z0-9]+ (HEAD \" e)))\n                                    (match-string 1 e))) lines)))\n         based)\n    (cond\n     ((or (not targets) (eq (length targets) 0))\n      (message \"No tag or branch is found to base on.\"))\n     ((or (not user-select-branch)) (eq (length targets) 1)\n      ;; select the closest/only tag or branch\n      (setq based (my-git-extract-based (nth 0 targets))))\n     (t\n      ;; select the one tag or branch\n      (setq based (my-git-extract-based (completing-read \"Select based: \" targets)))))\n\n    ;; start git rebase\n    (when based\n      (magit-rebase-interactive based nil))))\n</code></pre>\n\n</div>\n\n<p>\nScreencast:\n</p>\n\n<div class=\"figure\">\n<p><img src=\"http://blog.binchen.org/wp-content/magit-rebase-api.gif\" alt=\"magit-rebase-api.gif\">\n</p></div></div>","descriptionType":"text/html","publishedDate":"Tue, 14 Apr 2020 13:54:28 +0000","feedId":31314,"bgimg":"http://blog.binchen.org/wp-content/magit-rebase-api.gif","linkMd5":"6d0e63ea83fd7d7002f51ca2e3cfe57c","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx19/cdn23@2020_6/2020/10/12/20-33-10-256_5e77040e9a14c2d9.webp","destWidth":1024,"destHeight":768,"sourceBytes":5378755,"destBytes":6580854,"author":"Chen Bin","articleImgCdnMap":{"http://blog.binchen.org/wp-content/magit-rebase-api.gif":null},"publishedOrCreatedDate":1602534553589}],"record":{"createdTime":"2020-10-13 04:29:13","updatedTime":"2020-10-13 04:29:13","feedId":31314,"fetchDate":"Mon, 12 Oct 2020 20:29:13 +0000","fetchMs":44,"handleMs":48,"totalMs":241154,"newArticles":0,"totalArticles":10,"status":1,"type":0,"ip":"6da9f5c5105826521b693cdf674daebe","hostName":"us-026*","requestId":"6b5e4bdaeaec4997b1fa8d22dad0e89f_31314","contentType":"application/xml","totalBytes":0,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":1,"articlesImgsGithubTotal":0,"successGithubMap":{"myreaderx19":1},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 02:52:18","updatedTime":"2020-09-07 02:52:18","id":31314,"name":"Chen's blog","url":"http://blog.binchen.org/rss.xml","subscriber":103,"website":null,"icon":"http://blog.binchen.org/favicon.ico","icon_jsdelivr":null,"description":"Linux, Programming, Emacs","weekly":null,"link":"http://blog.binchen.org"},"noPictureArticleList":[{"createdTime":"2020-10-13 04:33:14","updatedTime":"2020-10-13 04:33:14","id":null,"feedId":31314,"linkMd5":"6d0e63ea83fd7d7002f51ca2e3cfe57c"}],"tmpCommonImgCdnBytes":0,"tmpBodyImgCdnBytes":0,"tmpBgImgCdnBytes":0,"extra4":{"start":1602534553495,"total":0,"statList":[{"spend":46,"msg":"获取xml内容"},{"spend":48,"msg":"解释文章"},{"spend":119909,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":120423,"msg":"正文链接上传到cdn"}]},"extra5":1,"extra6":0,"extra7ImgCdnFailResultVector":[null,null,null,null,null],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-007.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://us-035.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"http://blog.binchen.org/wp-content/magit-rebase-api.gif","sourceStatusCode":200,"destWidth":1024,"destHeight":768,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx19/cdn23@2020_6/2020/10/12/20-33-10-256_5e77040e9a14c2d9.webp","sourceBytes":5378755,"destBytes":6580854,"targetWebpQuality":67,"feedId":31314,"totalSpendMs":56331,"convertSpendMs":53939,"createdTime":"2020-10-13 04:32:16","host":"us-008*","referer":"http://blog.binchen.org/posts/use-magit-api-to-rebase-to-closest-branch/","linkMd5ListStr":"6d0e63ea83fd7d7002f51ca2e3cfe57c,6d0e63ea83fd7d7002f51ca2e3cfe57c","githubUser":"myreaderx19","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"5.1 MB","destSize":"6.3 MB","compressRate":"122.3%"}],"successGithubMap":{"myreaderx19":1},"failGithubMap":{}}