{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2021-05-07 00:15:18","updatedTime":"2021-05-07 00:15:18","title":"再谈synchronized锁升级","link":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","description":"<div><div><div id=\"media\" class=\"rich_media_thumb_wrp\">\n\n            <img class=\"rich_media_thumb\" src=\"http://content.sov5.cn/mmbiz_jpg/eZzl4LXykQwoGjHsTyEjnjsSgap0icG9CrbwzElL5HLUUlbFtURRxqm0fbg7OSH248Oib9rZh2fcL2Paxqq2ZcicQ?imageView2/1/w/600\">\n        </div>\n    \n\n    \n\n    <div class=\"rich_media_content\" id=\"js_content\">\n                    \n\n                    \n                    \n                    \n                    <p style=\"text-align: center;\"><span style=\"font-size: 14px;letter-spacing: 0.5440000295639038px;text-align: center;max-width: 100%;color: rgb(255, 41, 65);line-height: 22.4px;\">（给</span><span style=\"font-size: 14px;letter-spacing: 0.5440000295639038px;text-align: center;max-width: 100%;line-height: 22.4px;color: rgb(0, 128, 255);\">ImportNew</span><span style=\"font-size: 14px;letter-spacing: 0.5440000295639038px;text-align: center;max-width: 100%;color: rgb(255, 41, 65);line-height: 22.4px;\">加星标，提高Java技能）</span></p><blockquote><p><span style=\"font-size: 14px;\">转自：码农参上 / Dr Hydra</span></p></blockquote><p><span style=\"background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left>在</span><span style=\"background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left>图文详解Java</span><span style=\"background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left>对象内存布局</span><span style=\"background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left>这篇文章中，在研究对象头时我们了解了</span><code style=\"text-align: left;margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>synchronized</code><span style=\"background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left>锁升级的过程，由于篇幅有限，对锁升级的过程介绍的比较简略，本文在上一篇的基础上，来详细研究一下锁升级的过程以及各个状态下锁的原理。</span><span style=\"background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left>本文结构如下：</span><br></p><ul class=\"list-paddingleft-2\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb break-word><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><p style=\"max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;\">1 无锁</p></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><p style=\"max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;\">2 偏向锁</p></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><p style=\"max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;\">3 轻量级锁</p></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><p style=\"max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;\">4 重量级锁</p></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><p style=\"max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;\">总结</p></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 20px;margin-top: 20px;\"><span style=\"color: rgb(123, 12, 0);\"><strong>1 无锁</strong></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>在上一篇文章中，我们提到过 jvm会有4秒的偏向锁开启的延迟时间，在这个偏向延迟内对象处于为无锁态。如果关闭偏向锁启动延迟、或是经过4秒且没有线程竞争对象的锁，那么对象会进入<strong style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">无锁可偏向</strong>状态。</p><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>准确来说，无锁可偏向状态应该叫做<strong style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">匿名偏向</strong>(<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>Anonymously biased</code>)状态，因为这时对象的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>mark word</code>中后三位已经是<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>101</code>，但是<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>threadId</code>指针部分仍然全部为0，它还没有向任何线程偏向。综上所述，对象在刚被创建时，根据jvm的配置对象可能会处于 <strong style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">无锁</strong> 或 <strong style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">匿名偏向</strong> 两个状态。</p><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>此外，如果在jvm的参数中关闭偏向锁，那么直到有线程获取这个锁对象之前，会一直处于无锁不可偏向状态。修改jvm启动参数：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-size: 16px;text-align: left;background-color: rgb(255, 255, 255);border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"margin-bottom: -7px;max-width: 100%;display: block;background: url(\" https: no-repeat rgb border-box break-word></span><code style=\"padding: 15px 16px 16px;max-width: 100%;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: \" operator mono consolas monaco menlo monospace rgb border-box break-word>-XX:-UseBiasedLocking<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>延迟5s后打印对象内存布局：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-size: 16px;text-align: left;background-color: rgb(255, 255, 255);border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"margin-bottom: -7px;max-width: 100%;display: block;background: url(\" https: no-repeat rgb border-box break-word></span><code style=\"padding: 15px 16px 16px;max-width: 100%;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: \" operator mono consolas monaco menlo monospace rgb border-box break-word><span style=\"max-width: 100%;line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">public</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">static</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">void</span> <span style=\"max-width: 100%;color: rgb(97, 174, 238);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">main</span><span style=\"max-width: 100%;line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">(String[] args)</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">throws</span> InterruptedException </span>{<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    User user=<span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">new</span> User();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    TimeUnit.SECONDS.sleep(<span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">5</span>);<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    System.out.println(ClassLayout.parseInstance(user).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">}<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"></code></pre><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.18438003220611915\" data-type=\"png\" data-w=\"1242\" style=\"margin-right: auto; margin-left: auto; display: block; box-sizing: border-box !important; overflow-wrap: break-word !important; width: 677px !important; visibility: visible !important; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jPV9kGeCzrztTVTTCywic2JYv25iaO8V9UShudOJXAib7mphNQAgicORLeg/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>可以看到，即使经过一定的启动延时，对象一直处于<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>001</code>无锁不可偏向状态。大家可能会有疑问，在无锁状态下，为什么要存在一个不可偏向状态呢？通过查阅资料得到的解释是：</p><blockquote data-tool=\"mdnice编辑器\" style=\"margin-top: 20px;margin-bottom: 20px;padding: 10px 10px 10px 20px;border-left-color: rgba(0, 0, 0, 0.4);color: rgb(106, 115, 125);font-size: 0.9em;max-width: 100%;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal none auto rgba border-box break-word><p style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;font-size: 16px;color: black;line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">JVM内部的代码有很多地方也用到了synchronized，明确在这些地方存在线程的竞争，如果还需要从偏向状态再逐步升级，会带来额外的性能损耗，所以JVM设置了一个偏向锁的启动延迟，来降低性能损耗</p></blockquote><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>也就是说，在无锁不可偏向状态下，如果有线程试图获取锁，那么将跳过升级偏向锁的过程，直接使用轻量级锁。使用代码进行验证：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-size: 16px;text-align: left;background-color: rgb(255, 255, 255);border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"margin-bottom: -7px;max-width: 100%;display: block;background: url(\" https: no-repeat rgb border-box break-word></span><code style=\"padding: 15px 16px 16px;max-width: 100%;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: \" operator mono consolas monaco menlo monospace rgb border-box break-word><span style=\"max-width: 100%;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">//-XX:-UseBiasedLocking</span><br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"max-width: 100%;line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">public</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">static</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">void</span> <span style=\"max-width: 100%;color: rgb(97, 174, 238);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">main</span><span style=\"max-width: 100%;line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">(String[] args)</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">throws</span> InterruptedException </span>{<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    User user=<span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">new</span> User();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">synchronized</span> (user){<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        System.out.println(ClassLayout.parseInstance(user).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">}<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>查看结果可以看到，在关闭偏向锁情况下使用<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>synchronized</code>，锁会直接升级为轻量级锁（<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>00</code>状态）:</p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.1750599520383693\" data-type=\"png\" data-w=\"1251\" style=\"margin-right: auto; margin-left: auto; display: block; box-sizing: border-box !important; overflow-wrap: break-word !important; width: 677px !important; visibility: visible !important; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jjjeRg5KL24eT7C96TJ9GNf6QlK8BLQibZKxQoW22h3OBfGKrRl3Gg8A/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>在目前的基础上，可以用流程图概括上面的过程：</p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.41514726507713884\" data-type=\"png\" data-w=\"713\" style=\"margin-right: auto; margin-left: auto; display: block; box-sizing: border-box !important; overflow-wrap: break-word !important; width: 677px !important; visibility: visible !important; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jmo5xf4aP9aJpwibvYandh58pAMCU5eaAMrWEMsCG2ibN4SQic2iaAvonPQ/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>额外注意一点就是匿名偏向状态下，如果调用系统的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>hashCode()</code>方法，会使对象回到无锁态，并在<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>markword</code>中写入<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>hashCode</code>。并且在这个状态下，如果有线程尝试获取锁，会直接从无锁升级到轻量级锁，不会再升级为偏向锁。</p><h3 data-tool=\"mdnice编辑器\" style=\"margin-top: 20px;margin-bottom: 20px;\"><span style=\"color: rgb(123, 12, 0);\"><strong>2 偏向锁</strong></span></h3><h4 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 20px;margin-top: 20px;\"><span style=\"color: rgb(123, 12, 0);\"><strong>2.1 偏向锁原理</strong></span></h4><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>匿名偏向状态是偏向锁的初始状态，在这个状态下第一个试图获取该对象的锁的线程，会使用CAS操作（汇编命令<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>CMPXCHG</code>）尝试将自己的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>threadID</code>写入对象头的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>mark word</code>中，使匿名偏向状态升级为<strong style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">已偏向</strong>（Biased）的偏向锁状态。在已偏向状态下，线程指针<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>threadID</code>非空，且偏向锁的时间戳<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>epoch</code>为有效值。</p><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>如果之后有线程再次尝试获取锁时，需要检查<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>mark word</code>中存储的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>threadID</code>是否与自己相同即可，如果相同那么表示当前线程已经获得了对象的锁，不需要再使用CAS操作来进行加锁。</p><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>如果<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>mark word</code>中存储的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>threadID</code>与当前线程不同，那么将执行CAS操作，试图将当前线程的ID替换<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>mark word</code>中的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>threadID</code>。只有当对象处于下面两种状态中时，才可以执行成功：</p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb break-word><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\">对象处于匿名偏向状态</section></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\">对象处于<strong style=\"max-width: 100%;color: black;box-sizing: border-box !important;overflow-wrap: break-word !important;\">可重偏向</strong>（Rebiasable）状态，新线程可使用CAS将<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>threadID</code>指向自己</section></li></ul><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>如果对象不处于上面两个状态，说明锁存在线程竞争，在CAS替换失败后会执行<strong style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">偏向锁撤销</strong>操作。偏向锁的撤销需要等待全局安全点<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>Safe Point</code>（安全点是 jvm为了保证在垃圾回收的过程中引用关系不会发生变化设置的安全状态，在这个状态上会暂停所有线程工作），在这个安全点会挂起获得偏向锁的线程。</p><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>在暂停线程后，会通过遍历当前jvm的所有线程的方式，检查持有偏向锁的线程状态是否存活：</p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb break-word><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\"><p style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;line-height: 26px;color: black;box-sizing: border-box !important;overflow-wrap: break-word !important;\">如果线程还存活，且线程正在执行同步代码块中的代码，则升级为轻量级锁</p></section></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\"><p style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;line-height: 26px;color: black;box-sizing: border-box !important;overflow-wrap: break-word !important;\">如果持有偏向锁的线程未存活，或者持有偏向锁的线程未在执行同步代码块中的代码，则进行校验是否允许重偏向：</p></section></li><ul class=\"list-paddingleft-2\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;max-width: 100%;list-style-type: square;overflow-wrap: break-word !important;\"><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\"><p style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;line-height: 26px;color: black;box-sizing: border-box !important;overflow-wrap: break-word !important;\">不允许重偏向，则撤销偏向锁，将<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>mark word</code>升级为轻量级锁，进行CAS竞争锁</p></section></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\"><p style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;line-height: 26px;color: black;box-sizing: border-box !important;overflow-wrap: break-word !important;\">允许重偏向，设置为匿名偏向锁状态，CAS将偏向锁重新指向新线程</p></section></li></ul></ul><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>完成上面的操作后，唤醒暂停的线程，从安全点继续执行代码。可以使用流程图总结上面的过程：</p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.48413897280966767\" data-type=\"png\" data-w=\"1324\" style=\"margin-right: auto; margin-left: auto; display: block; box-sizing: border-box !important; overflow-wrap: break-word !important; width: 677px !important; visibility: visible !important; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jxOd4rmDHPkeutoGa7kiccr9ty2pXJvN12VNJVw71VedAvUjptswF6Ig/640?wx_fmt=png\"></figure><h4 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 20px;margin-top: 20px;\"><span style=\"color: rgb(123, 12, 0);\"><strong>2.2 偏向锁升级</strong></span></h4><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>在上面的过程中，我们已经知道了匿名偏向状态可以变为无锁态或升级为偏向锁，接下来看一下偏向锁的其他状态的改变</p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb break-word><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\">偏向锁升级为轻量级锁</section></li></ul><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-size: 16px;text-align: left;background-color: rgb(255, 255, 255);border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"margin-bottom: -7px;max-width: 100%;display: block;background: url(\" https: no-repeat rgb border-box break-word></span><code style=\"padding: 15px 16px 16px;max-width: 100%;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: \" operator mono consolas monaco menlo monospace rgb border-box break-word><span style=\"max-width: 100%;line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">public</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">static</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">void</span> <span style=\"max-width: 100%;color: rgb(97, 174, 238);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">main</span><span style=\"max-width: 100%;line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">(String[] args)</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">throws</span> InterruptedException </span>{<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    User user=<span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">new</span> User();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">synchronized</span> (user){<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        System.out.println(ClassLayout.parseInstance(user).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    Thread thread = <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">new</span> Thread(() -&gt; {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">synchronized</span> (user) {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            System.out.println(<span style=\"max-width: 100%;color: rgb(152, 195, 121);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">\"--THREAD--:\"</span>+ClassLayout.parseInstance(user).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    });<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    thread.start();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    thread.join();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    System.out.println(<span style=\"max-width: 100%;color: rgb(152, 195, 121);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">\"--END--:\"</span>+ClassLayout.parseInstance(user).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">}<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>查看内存布局，偏向锁升级为轻量级锁，在执行完成同步代码后释放锁，变为无锁不可偏向状态：</p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.599037690457097\" data-type=\"png\" data-w=\"1247\" style=\"margin-right: auto; margin-left: auto; display: block; box-sizing: border-box !important; overflow-wrap: break-word !important; width: 677px !important; visibility: visible !important; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5j3MTc44vCcpgynA4XecCCia1t0Gol23nNel1f5UFDPW1ZghJYNHVnCYA/640?wx_fmt=png\"></figure><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb break-word><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\">偏向锁升级为重量级锁</section></li></ul><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-size: 16px;text-align: left;background-color: rgb(255, 255, 255);border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"margin-bottom: -7px;max-width: 100%;display: block;background: url(\" https: no-repeat rgb border-box break-word></span><code style=\"padding: 15px 16px 16px;max-width: 100%;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: \" operator mono consolas monaco menlo monospace rgb border-box break-word><span style=\"max-width: 100%;line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">public</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">static</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">void</span> <span style=\"max-width: 100%;color: rgb(97, 174, 238);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">main</span><span style=\"max-width: 100%;line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">(String[] args)</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">throws</span> InterruptedException </span>{<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    User user=<span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">new</span> User();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    Thread thread = <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">new</span> Thread(() -&gt; {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">synchronized</span> (user) {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            System.out.println(<span style=\"max-width: 100%;color: rgb(152, 195, 121);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">\"--THREAD1--:\"</span> + ClassLayout.parseInstance(user).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">try</span> {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">                user.wait(<span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">2000</span>);<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            } <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">catch</span> (InterruptedException e) {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">                e.printStackTrace();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            System.out.println(<span style=\"max-width: 100%;color: rgb(152, 195, 121);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">\"--THREAD END--:\"</span> + ClassLayout.parseInstance(user).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    });<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    thread.start();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    thread.join();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    TimeUnit.SECONDS.sleep(<span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">3</span>);<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    System.out.println(ClassLayout.parseInstance(user).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">}<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>查看内存布局，可以看到在调用了对象的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>wait()</code>方法后，直接从偏向锁升级成了重量级锁，并在锁释放后变为无锁态：</p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.5888888888888889\" data-type=\"png\" data-w=\"1260\" style=\"margin-right: auto; margin-left: auto; display: block; box-sizing: border-box !important; overflow-wrap: break-word !important; width: 677px !important; visibility: visible !important; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jc32GAdd6pNiapkDTC6FZbfBzwZOhuhDToYb0X8GoKCNEvVm68dLjgow/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>这里是因为<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>wait()</code>方法调用过程中依赖于重量级锁中与对象关联的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>monitor</code>，在调用<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>wait()</code>方法后<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>monitor</code>会把线程变为<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>WAITING</code>状态，所以才会强制升级为重量级锁。除此之外，调用<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>hashCode</code>方法时也会使偏向锁直接升级为重量级锁。</p><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>在上面分析的基础上，再加上我们上一篇中讲到的轻量级锁升级到重量级锁的知识，就可以对上面的流程图进行完善了：</p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.3389121338912134\" data-type=\"png\" data-w=\"956\" style=\"margin-right: auto; margin-left: auto; display: block; box-sizing: border-box !important; overflow-wrap: break-word !important; width: 677px !important; visibility: visible !important; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jybUxYtFCZB3sBx3U9avuy8xU9hYOAiasscQeeub1mGsb5UEz7Fh9mhQ/640?wx_fmt=png\"></figure><h4 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 20px;margin-top: 20px;\"><span style=\"color: rgb(123, 12, 0);\"><strong>2.3 批量重偏向</strong></span></h4><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>在未禁用偏向锁的情况下，当一个线程建立了大量对象，并且对它们执行完同步操作解锁后，所有对象处于偏向锁状态，此时若再来另一个线程也尝试获取这些对象的锁，就会导偏向锁的<strong style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">批量重偏向</strong>（Bulk Rebias）。当触发批量重偏向后，第一个线程结束同步操作后的锁对象当再被同步访问时会被重置为可重偏向状态，以便允许快速重偏向，这样能够减少撤销偏向锁再升级为轻量级锁的性能消耗。</p><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>首先看一下和偏向锁有关的参数，修改jvm启动参数，使用下面的命令可以在项目启动时打印jvm的默认参数值：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-size: 16px;text-align: left;background-color: rgb(255, 255, 255);border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"margin-bottom: -7px;max-width: 100%;display: block;background: url(\" https: no-repeat rgb border-box break-word></span><code style=\"padding: 15px 16px 16px;max-width: 100%;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: \" operator mono consolas monaco menlo monospace rgb border-box break-word>-XX:+PrintFlagsFinal<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>需要关注的属性有下面3个：</p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.10104166666666667\" data-type=\"png\" data-w=\"960\" style=\"margin-right: auto; margin-left: auto; display: block; box-sizing: border-box !important; overflow-wrap: break-word !important; width: 677px !important; visibility: visible !important; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jG3sG6sK69bbh7WrQybuAoVbrh5tsDgObnOMpxVCqSYP8NOrjBYqoNA/640?wx_fmt=png\"></figure><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb break-word><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\"><code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>BiasedLockingBulkRebiasThreshold</code>：偏向锁批量重偏向阈值，默认为20次</section></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\"><code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>BiasedLockingBulkRevokeThreshold</code>：偏向锁批量撤销阈值，默认为40次</section></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\"><code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>BiasedLockingDecayTime</code>：重置计数的延迟时间，默认值为25000毫秒（即25秒）</section></li></ul><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>批量重偏向是以<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>class</code>而不是对象为单位的，每个<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>class</code>会维护一个偏向锁的撤销计数器，每当该<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>class</code>的对象发生偏向锁的撤销时，该计数器会加一，当这个值达到默认阈值20时，jvm就会认为这个锁对象不再适合原线程，因此进行批量重偏向。而距离上次批量重偏向的25秒内，如果撤销计数达到40，就会发生批量撤销，如果超过25秒，那么就会重置在[20, 40)内的计数。</p><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>上面这段理论是不是听上去有些难理解，没关系，我们先用代码验证批量重偏向的过程：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-size: 16px;text-align: left;background-color: rgb(255, 255, 255);border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"margin-bottom: -7px;max-width: 100%;display: block;background: url(\" https: no-repeat rgb border-box break-word></span><code style=\"padding: 15px 16px 16px;max-width: 100%;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: \" operator mono consolas monaco menlo monospace rgb border-box break-word><span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">private</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">static</span> Thread t1,t2;<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"max-width: 100%;line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">public</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">static</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">void</span> <span style=\"max-width: 100%;color: rgb(97, 174, 238);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">main</span><span style=\"max-width: 100%;line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">(String[] args)</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">throws</span> InterruptedException </span>{      <br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    TimeUnit.SECONDS.sleep(<span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">5</span>);<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    List<object> list = <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">new</span> ArrayList&lt;&gt;();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">for</span> (<span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">int</span> i = <span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">0</span>; i 40; i++) {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        list.add(<span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">new</span> Object());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    t1 = <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">new</span> Thread(() -&gt; {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">for</span> (<span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">int</span> i = <span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">0</span>; i             <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">synchronized</span> (list.get(i)) {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        LockSupport.unpark(t2);<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    });<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    t2 = <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">new</span> Thread(() -&gt; {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        LockSupport.park();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">for</span> (<span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">int</span> i = <span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">0</span>; i 30; i++) {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            Object o = list.get(i);<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">synchronized</span> (o) {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">                <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">if</span> (i == <span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">18</span> || i == <span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">19</span>) {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">                    System.out.println(<span style=\"max-width: 100%;color: rgb(152, 195, 121);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">\"THREAD-2 Object\"</span>+(i+<span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">1</span>)+<span style=\"max-width: 100%;color: rgb(152, 195, 121);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">\":\"</span>+ClassLayout.parseInstance(o).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">                }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    });<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    t1.start();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    t2.start();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    t2.join();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    TimeUnit.SECONDS.sleep(<span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">3</span>);<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    System.out.println(<span style=\"max-width: 100%;color: rgb(152, 195, 121);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">\"Object19:\"</span>+ClassLayout.parseInstance(list.get(<span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">18</span>)).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    System.out.println(<span style=\"max-width: 100%;color: rgb(152, 195, 121);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">\"Object20:\"</span>+ClassLayout.parseInstance(list.get(<span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">19</span>)).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    System.out.println(<span style=\"max-width: 100%;color: rgb(152, 195, 121);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">\"Object30:\"</span>+ClassLayout.parseInstance(list.get(<span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">29</span>)).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    System.out.println(<span style=\"max-width: 100%;color: rgb(152, 195, 121);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">\"Object31:\"</span>+ClassLayout.parseInstance(list.get(<span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">30</span>)).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">}<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"></object></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>分析上面的代码，当线程<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>t1</code>运行结束后，数组中所有对象的锁都偏向<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>t1</code>，然后<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>t1</code>唤醒被挂起的线程<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>t2</code>，线程<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>t2</code>尝试获取前30个对象的锁。我们打印线程<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>t2</code>获取到的第19和第20个对象的锁状态：</p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.38735177865612647\" data-type=\"png\" data-w=\"1265\" style=\"margin-right: auto; margin-left: auto; display: block; box-sizing: border-box !important; overflow-wrap: break-word !important; width: 677px !important; visibility: visible !important; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5j0o9znuRpM2D4JzgDv84C6iaD13LRVSGuOWcEr7jC4kzVxwLFMwoJ00g/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>线程<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>t2</code>在访问前19个对象时对象的偏向锁会升级到轻量级锁，在访问后11个对象（下标19-29）时，因为偏向锁撤销次数达到了20，会触发批量重偏向，将锁的状态变为偏向线程<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>t2</code>。在全部线程结束后，再次查看第19、20、30、31个对象锁的状态：</p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.8055555555555556\" data-type=\"png\" data-w=\"1008\" style=\"margin-right: auto; margin-left: auto; display: block; box-sizing: border-box !important; overflow-wrap: break-word !important; width: 677px !important; visibility: visible !important; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5j6ziaZvshLMiaicbesTTPIlpVPHhpw8TZzmbhSf3Nxb84PPibVQohWXuVzg/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>线程<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>t2</code>结束后，第1-19的对象释放轻量级锁变为无锁不可偏向状态，第20-30的对象状态为偏向锁、但从偏向<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>t1</code>改为偏向<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>t2</code>，第31-40的对象因为没有被线程<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>t2</code>访问所以保持偏向线程<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>t1</code>不变。</p><h4 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 20px;margin-top: 20px;\"><span style=\"color: rgb(123, 12, 0);\"><strong>2.4 批量撤销</strong></span></h4><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>在多线程竞争激烈的状况下，使用偏向锁将会导致性能降低，因此产生了批量撤销机制，接下来使用代码进行测试：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-size: 16px;text-align: left;background-color: rgb(255, 255, 255);border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"margin-bottom: -7px;max-width: 100%;display: block;background: url(\" https: no-repeat rgb border-box break-word></span><code style=\"padding: 15px 16px 16px;max-width: 100%;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: \" operator mono consolas monaco menlo monospace rgb border-box break-word><span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">private</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">static</span> Thread t1, t2, t3;<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"max-width: 100%;line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">public</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">static</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">void</span> <span style=\"max-width: 100%;color: rgb(97, 174, 238);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">main</span><span style=\"max-width: 100%;line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">(String[] args)</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">throws</span> InterruptedException </span>{<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    TimeUnit.SECONDS.sleep(<span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">5</span>);<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    List<object> list = <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">new</span> ArrayList&lt;&gt;();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">for</span> (<span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">int</span> i = <span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">0</span>; i 40; i++) {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        list.add(<span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">new</span> Object());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    t1 = <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">new</span> Thread(() -&gt; {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">for</span> (<span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">int</span> i = <span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">0</span>; i             <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">synchronized</span> (list.get(i)) {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        LockSupport.unpark(t2);<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    });<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    t2 = <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">new</span> Thread(() -&gt; {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        LockSupport.park();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">for</span> (<span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">int</span> i = <span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">0</span>; i             Object o = list.get(i);<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">synchronized</span> (o) {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">                <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">if</span> (i == <span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">18</span> || i == <span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">19</span>) {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">                    System.out.println(<span style=\"max-width: 100%;color: rgb(152, 195, 121);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">\"THREAD-2 Object\"</span>+(i+<span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">1</span>)+<span style=\"max-width: 100%;color: rgb(152, 195, 121);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">\":\"</span>+ClassLayout.parseInstance(o).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">                }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        LockSupport.unpark(t3);<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    });<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    t3 = <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">new</span> Thread(() -&gt; {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        LockSupport.park();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">for</span> (<span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">int</span> i = <span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">0</span>; i             Object o = list.get(i);<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">synchronized</span> (o) {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">                System.out.println(<span style=\"max-width: 100%;color: rgb(152, 195, 121);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">\"THREAD-3 Object\"</span>+(i+<span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">1</span>)+<span style=\"max-width: 100%;color: rgb(152, 195, 121);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">\":\"</span>+ClassLayout.parseInstance(o).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    });<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    t1.start();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    t2.start();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    t3.start();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    t3.join();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    System.out.println(<span style=\"max-width: 100%;color: rgb(152, 195, 121);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">\"New: \"</span>+ClassLayout.parseInstance(<span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">new</span> Object()).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">}<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"></object></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>对上面的运行流程进行分析：</p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb break-word><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\">线程<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>t1</code>中，第1-40的锁对象状态变为偏向锁</section></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\">线程<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>t2</code>中，第1-19的锁对象撤销偏向锁升级为轻量级锁，然后对第20-40的对象进行批量重偏向</section></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\">线程<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>t3</code>中，首先直接对第1-19个对象竞争轻量级锁，而从第20个对象开始往后的对象不会再次进行批量重偏向，因此第20-39的对象进行偏向锁撤销升级为轻量级锁，这时<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>t2</code>和<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>t3</code>线程一共执行了40次的锁撤销，触发锁的批量撤销机制，对偏向锁进行撤销置为轻量级锁</section></li></ul><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>看一下在3个线程都结束后创建的新对象：</p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.20449077786688052\" data-type=\"png\" data-w=\"1247\" style=\"margin-right: auto; margin-left: auto; display: block; box-sizing: border-box !important; overflow-wrap: break-word !important; width: 677px !important; visibility: visible !important; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jSW0ia3q8FD846WBAEzsxAURqAyNvOrT4IgXhjJQCjdGWxxP9R6jaR1g/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>可以看到，创建的新对象为无锁不可偏向状态<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>001</code>，说明当类触发了批量撤销机制后，jvm会禁用该类创建对象时的可偏向性，该类新创建的对象全部为无锁不可偏向状态。</p><h4 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 20px;margin-top: 20px;\"><span style=\"color: rgb(123, 12, 0);\"><strong>2.5 总结</strong></span></h4><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>偏向锁通过消除资源无竞争情况下的同步原语，提高了程序在<strong style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">单线程</strong>下访问同步资源的运行性能，但是当出现多个线程竞争时，就会撤销偏向锁、升级为轻量级锁。</p><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>如果我们的应用系统是高并发、并且代码中同步资源一直是被多线程访问的，那么撤销偏向锁这一步就显得多余，偏向锁撤销时进入<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>Safe Point</code>产生<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>STW</code>的现象应该是被极力避免的，这时应该通过禁用偏向锁来减少性能上的损耗。</p><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 20px;margin-top: 20px;\"><span style=\"color: rgb(123, 12, 0);\"><strong>3 轻量级锁</strong></span></h3><h4 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 20px;\"><span style=\"color: rgb(123, 12, 0);\"><strong>3.1 轻量级锁原理</strong></span></h4><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>1、在代码访问同步资源时，如果锁对象处于无锁不可偏向状态，jvm首先将在当前线程的栈帧中创建一条锁记录（<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>lock record</code>），用于存放：</p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb break-word><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\"><code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>displaced mark word</code>（置换标记字）：存放锁对象当前的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>mark word</code>的拷贝</section></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\"><code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>owner</code>指针：指向当前的锁对象的指针，在拷贝<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>mark word</code>阶段暂时不会处理它</section></li></ul><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.37664473684210525\" data-type=\"png\" data-w=\"608\" style=\"margin-right: auto; margin-left: auto; display: block; box-sizing: border-box !important; overflow-wrap: break-word !important; width: 608px !important; visibility: visible !important; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jedw06lQFqRtpKZrm3x4Wo2oz7FdIbEagtRpY63uzRsCqScbsZ4mZbA/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>2、在拷贝<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>mark word</code>完成后，首先会挂起线程，jvm使用CAS操作尝试将对象的 <code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>mark word</code>中的 <code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>lock record</code> 指针指向栈帧中的锁记录，并将锁记录中的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>owner</code>指针指向锁对象的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>mark word</code></p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb break-word><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\">如果CAS替换成功，表示竞争锁对象成功，则将锁标志位设置成 <code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>00</code>，表示对象处于轻量级锁状态，执行同步代码中的操作</section></li></ul><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.3958691910499139\" data-type=\"png\" data-w=\"581\" style=\"margin-right: auto; margin-left: auto; display: block; box-sizing: border-box !important; overflow-wrap: break-word !important; width: 581px !important; visibility: visible !important; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jIgcCxmWhWe7SGiaqLiaicg7jR5PMB12wPCHpZrGFRPfUKJibnLRNG20KUw/640?wx_fmt=png\"></figure><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb break-word><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\">如果CAS替换失败，则判断当前对象的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>mark word</code>是否指向当前线程的栈帧：</section></li><ul class=\"list-paddingleft-2\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;max-width: 100%;list-style-type: square;overflow-wrap: break-word !important;\"><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\">如果是则表示当前线程已经持有对象的锁，执行的是<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>synchronized</code>的锁重入过程，可以直接执行同步代码块</section></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\">否则说明该其他线程已经持有了该对象的锁，如果在自旋一定次数后仍未获得锁，那么轻量级锁需要升级为重量级锁，将锁标志位变成<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>10</code>，后面等待的线程将会进入阻塞状态</section></li></ul></ul><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>4、轻量级锁的释放同样使用了CAS操作，尝试将<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>displaced mark word</code> 替换回<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>mark word</code>，这时需要检查锁对象的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>mark word</code>中<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>lock record</code>指针是否指向当前线程的锁记录：</p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb break-word><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\">如果替换成功，则表示没有竞争发生，整个同步过程就完成了</section></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\">如果替换失败，则表示当前锁资源存在竞争，有可能其他线程在这段时间里尝试过获取锁失败，导致自身被挂起，并修改了锁对象的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>mark word</code>升级为重量级锁，最后在执行重量级锁的解锁流程后唤醒被挂起的线程</section></li></ul><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>用流程图对上面的过程进行描述：</p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.9522388059701492\" data-type=\"png\" data-w=\"670\" style=\"margin-right: auto; margin-left: auto; display: block; box-sizing: border-box !important; overflow-wrap: break-word !important; width: 670px !important; visibility: visible !important; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jvzP0XKbC4McEaupM2L0bWQRlg9vlSMIjeD6weYQjYQscOQhTTriaFvg/640?wx_fmt=png\"></figure><h4 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 20px;margin-top: 20px;\"><span style=\"color: rgb(123, 12, 0);\"><strong>3.2 轻量级锁重入</strong></span></h4><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>我们知道，<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>synchronized</code>是可以锁重入的，在轻量级锁的情况下重入也是依赖于栈上的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>lock record</code>完成的。以下面的代码中3次锁重入为例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-size: 16px;text-align: left;background-color: rgb(255, 255, 255);border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"margin-bottom: -7px;max-width: 100%;display: block;background: url(\" https: no-repeat rgb border-box break-word></span><code style=\"padding: 15px 16px 16px;max-width: 100%;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: \" operator mono consolas monaco menlo monospace rgb border-box break-word><span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">synchronized</span> (user){<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">synchronized</span> (user){<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">synchronized</span> (user){<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            <span style=\"max-width: 100%;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">//TODO</span><br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">}<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>轻量级锁的每次重入，都会在栈中生成一个<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>lock record</code>，但是保存的数据不同：</p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb break-word><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\">首次分配的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>lock record</code>，<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>displaced mark word</code>复制了锁对象的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>mark word</code>，<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>owner</code>指针指向锁对象</section></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\">之后重入时在栈中分配的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>lock record</code>中的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>displaced mark word</code>为<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>null</code>，只存储了指向对象的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>owner</code>指针</section></li></ul><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.8056042031523643\" data-type=\"png\" data-w=\"571\" style=\"margin-right: auto; margin-left: auto; display: block; box-sizing: border-box !important; overflow-wrap: break-word !important; width: 571px !important; visibility: visible !important; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jrPBWpctk6Eff1c71hxdJvDrvUdKG6hPuRumkTDQ21k5Bt2ibsMicQWjQ/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>轻量级锁中，重入的次数等于该锁对象在栈帧中<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>lock record</code>的数量，这个数量隐式地充当了锁重入机制的计数器。这里需要计数的原因是每次解锁都需要对应一次加锁，只有最后解锁次数等于加锁次数时，锁对象才会被真正释放。在释放锁的过程中，如果是重入则删除栈中的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>lock record</code>，直到没有重入时则使用CAS替换锁对象的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>mark word</code>。</p><h4 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;margin-top: 15px;\"><span style=\"color: rgb(123, 12, 0);\"><strong>3.3 轻量级锁升级</strong></span></h4><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>在jdk1.6以前，默认轻量级锁自旋次数是10次，如果超过这个次数或自旋线程数超过CPU核数的一半，就会升级为重量级锁。这时因为如果自旋次数过多，或过多线程进入自旋，会导致消耗过多cpu资源，重量级锁情况下线程进入等待队列可以降低cpu资源的消耗。自旋次数的值也可以通过jvm参数进行修改：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-size: 16px;text-align: left;background-color: rgb(255, 255, 255);border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"margin-bottom: -7px;max-width: 100%;display: block;background: url(\" https: no-repeat rgb border-box break-word></span><code style=\"padding: 15px 16px 16px;max-width: 100%;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: \" operator mono consolas monaco menlo monospace rgb border-box break-word>-XX:PreBlockSpin<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>jdk1.6以后加入了<strong style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">自适应自旋锁</strong> （<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>Adapative Self Spinning</code>），自旋的次数不再固定，由jvm自己控制，由前一次在同一个锁上的自旋时间及锁的拥有者的状态来决定：</p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb break-word><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\">对于某个锁对象，如果自旋等待刚刚成功获得过锁，并且持有锁的线程正在运行中，那么虚拟机就会认为这次自旋也是很有可能再次成功，进而允许自旋等待持续相对更长时间</section></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\">对于某个锁对象，如果自旋很少成功获得过锁，那在以后尝试获取这个锁时将可能省略掉自旋过程，直接阻塞线程，避免浪费处理器资源。</section></li></ul><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>下面通过代码验证轻量级锁升级为重量级锁的过程：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-size: 16px;text-align: left;background-color: rgb(255, 255, 255);border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"margin-bottom: -7px;max-width: 100%;display: block;background: url(\" https: no-repeat rgb border-box break-word></span><code style=\"padding: 15px 16px 16px;max-width: 100%;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: \" operator mono consolas monaco menlo monospace rgb border-box break-word><span style=\"max-width: 100%;line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">public</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">static</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">void</span> <span style=\"max-width: 100%;color: rgb(97, 174, 238);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">main</span><span style=\"max-width: 100%;line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">(String[] args)</span> <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">throws</span> InterruptedException </span>{<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    User user = <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">new</span> User();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    System.out.println(<span style=\"max-width: 100%;color: rgb(152, 195, 121);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">\"--MAIN--:\"</span> + ClassLayout.parseInstance(user).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    Thread thread1 = <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">new</span> Thread(() -&gt; {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">synchronized</span> (user) {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            System.out.println(<span style=\"max-width: 100%;color: rgb(152, 195, 121);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">\"--THREAD1--:\"</span> + ClassLayout.parseInstance(user).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">try</span> {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">                TimeUnit.SECONDS.sleep(<span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">5</span>);<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            } <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">catch</span> (InterruptedException e) {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">                e.printStackTrace();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    });<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    Thread thread2 = <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">new</span> Thread(() -&gt; {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">try</span> {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            TimeUnit.SECONDS.sleep(<span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">2</span>);<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        } <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">catch</span> (InterruptedException e) {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            e.printStackTrace();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        <span style=\"max-width: 100%;color: rgb(198, 120, 221);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">synchronized</span> (user) {<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">            System.out.println(<span style=\"max-width: 100%;color: rgb(152, 195, 121);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">\"--THREAD2--:\"</span> + ClassLayout.parseInstance(user).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">        }<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    });<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    thread1.start();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    thread2.start();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    thread1.join();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    thread2.join();<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    TimeUnit.SECONDS.sleep(<span style=\"max-width: 100%;color: rgb(209, 154, 102);line-height: 26px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">3</span>);<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">    System.out.println(ClassLayout.parseInstance(user).toPrintable());<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">}<br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>在上面的代码中，线程2在启动后休眠两秒后再尝试获取锁，确保线程1能够先得到锁，在此基础上造成锁对象的资源竞争。查看对象锁状态变化：</p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.5911251980982567\" data-type=\"png\" data-w=\"1262\" style=\"margin-right: auto; margin-left: auto; display: block; box-sizing: border-box !important; overflow-wrap: break-word !important; width: 677px !important; visibility: visible !important; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5j2riaJABWj9fZ4zomlKMTysc6K8dBbLoVZndhoEnLqtRZf0r7IHAicAeg/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>在线程1持有轻量级锁的情况下，线程2尝试获取锁，导致资源竞争，使轻量级锁升级到重量级锁。在两个线程都运行结束后，可以看到对象的状态恢复为了无锁不可偏向状态，在下一次线程尝试获取锁时，会直接从轻量级锁状态开始。</p><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>上面在最后一次打印前将主线程休眠3秒的原因是锁的释放过程需要一定的时间，如果在线程执行完成后直接打印对象内存布局，对象可能仍处于重量级锁状态。</p><h4 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 20px;margin-top: 20px;\"><span style=\"color: rgb(123, 12, 0);\"><strong>3.4 总结</strong></span></h4><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>轻量级锁与偏向锁类似，都是jdk对于多线程的优化，不同的是轻量级锁是通过CAS来避免开销较大的互斥操作，而偏向锁是在无资源竞争的情况下完全消除同步。</p><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>轻量级锁的“轻量”是相对于重量级锁而言的，它的性能会稍好一些。轻量级锁尝试利用CAS，在升级为重量级锁之前进行补救，目的是为了减少多线程进入互斥，当多个线程交替执行同步块时，jvm使用轻量级锁来保证同步，避免线程切换的开销，不会造成用户态与内核态的切换。但是如果过度自旋，会引起cpu资源的浪费，这种情况下轻量级锁消耗的资源可能反而会更多。</p><h3 data-tool=\"mdnice编辑器\" style=\"margin-top: 20px;margin-bottom: 20px;\"><strong><span style=\"color: rgb(123, 12, 0);\">4 重量级锁</span></strong></h3><h4 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 20px;\"><span style=\"color: rgb(123, 12, 0);\"><strong>4.1 Monitor</strong></span></h4><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>重量级锁是依赖对象内部的monitor（监视器/管程）来实现的 ，而monitor 又依赖于操作系统底层的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>Mutex Lock</code>（互斥锁）实现，这也就是为什么说重量级锁比较“重”的原因了，操作系统在实现线程之间的切换时，需要从用户态切换到内核态，成本非常高。在学习重量级锁的工作原理前，首先需要了解一下monitor中的核心概念：</p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb break-word><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\"><code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>owner</code>：标识拥有该<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>monitor</code>的线程，初始时和锁被释放后都为null</section></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\"><code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>cxq (ConnectionList)</code>：竞争队列，所有竞争锁的线程都会首先被放入这个队列中</section></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\"><code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>EntryList</code>：候选者列表，当<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>owner</code>解锁时会将<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>cxq</code>队列中的线程移动到该队列中</section></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\"><code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>OnDeck</code>：在将线程从<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>cxq</code>移动到<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>EntryList</code>时，会指定某个线程为Ready状态（即<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>OnDeck</code>），表明它可以竞争锁，如果竞争成功那么称为<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>owner</code>线程，如果失败则放回<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>EntryList</code>中</section></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\"><code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>WaitSet</code>：因为调用<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>wait()</code>或<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>wait(time)</code>方法而被阻塞的线程会被放在该队列中</section></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\"><code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>count</code>：monitor的计数器，数值加1表示当前对象的锁被一个线程获取，线程释放monitor对象时减1</section></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\"><code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>recursions</code>：线程重入次数</section></li></ul><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>用图来表示线程竞争的的过程：</p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.46338028169014084\" data-type=\"png\" data-w=\"710\" style=\"margin-right: auto; margin-left: auto; display: block; box-sizing: border-box !important; overflow-wrap: break-word !important; width: 677px !important; visibility: visible !important; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jnlrMjI5uiarlfDxtibBV54hxeia3XpQVW3AKM420Dq5QjPe4szpooHjsQ/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>当线程调用<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>wait()</code>方法，将释放当前持有的monitor，将<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>owner</code>置为null，进入<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>WaitSet</code>集合中等待被唤醒。当有线程调用<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>notify()</code>或<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>notifyAll()</code>方法时，也会释放持有的monitor，并唤醒<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>WaitSet</code>的线程重新参与monitor的竞争。</p><h4 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 20px;margin-top: 20px;\"><span style=\"color: rgb(123, 12, 0);\"><strong>4.2 重量级锁原理</strong></span></h4><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>当升级为重量级锁的情况下，锁对象的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>mark word</code>中的指针不再指向线程栈中的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>lock record</code>，而是指向堆中与锁对象关联的monitor对象。当多个线程同时访问同步代码时，这些线程会先尝试获取当前锁对象对应的monitor的所有权：</p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb break-word><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\">获取成功，判断当前线程是不是重入，如果是重入那么<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>recursions+1</code></section></li><li style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);box-sizing: border-box !important;overflow-wrap: break-word !important;\">获取失败，当前线程会被阻塞，等待其他线程解锁后被唤醒，再次竞争锁对象</section></li></ul><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>在重量级锁的情况下，加解锁的过程涉及到操作系统的<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>Mutex Lock</code>进行互斥操作，线程间的调度和线程的状态变更过程需要在用户态和核心态之间进行切换，会导致消耗大量的cpu资源，导致性能降低。</p><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 20px;margin-top: 20px;\"><span style=\"color: rgb(123, 12, 0);\"><strong>总结</strong></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>在jdk1.6中，引入了偏向锁和轻量级锁，并使用锁升级机制对<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>synchronized</code>进行了充分的优化。其实除锁升级外，还使用了锁消除、锁粗化等优化手段，所以对它的认识要脱离“重量级”这一概念，不要再单纯的认为它的性能差了。在某些场景下，<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>synchronized</code>的性能甚至已经超过了<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>Lock</code>同步锁。</p><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>尽管java对<code style=\"margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.047);font-family: \" operator mono consolas monaco menlo monospace break-all border-box break-word>synchronized</code>做了这些优化，但是在使用过程中，我们还是要尽量减少锁的竞争，通过减小加锁粒度和减少同步代码的执行时间，来降低锁竞争，尽量使锁维持在偏向锁和轻量级锁的级别，避免升级为重量级锁，造成性能的损耗。</p><p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb border-box break-word>最后不得不再提一句，在java15中已经默认禁用了偏向锁，并弃用所有相关的命令行选项，虽然说不确定未来的LTS版本会怎样改动，但是了解一下偏向锁的基础也没什么不好的，毕竟你发任你发，我用java8~</p><p style=\"white-space: normal;text-align: center;\"><span style=\"font-size: 15px;color: rgb(136, 136, 136);\">- EOF -</span></p><section donone=\"shifuMouseDownCard('shifu_c_030')\" label=\"Copyright Reserved by PLAYHUDONG.\" style=\"margin-top: 1em;margin-bottom: 1em;white-space: normal;text-align: start;max-width: 100%;caret-color: rgb(0, 0, 0);color: rgb(0, 0, 0);border-width: 0px;border-style: initial;border-color: initial;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-left: 1em;max-width: 100%;line-height: 1.4;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"padding: 3px 8px;max-width: 100%;border-radius: 4px;color: rgb(255, 255, 255);background-color: rgb(255, 105, 31);font-family: inherit;text-align: inherit;text-decoration: inherit;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">推荐阅读</span>  <span style=\"margin-left: 4px;padding: 3px 8px;max-width: 100%;border-radius: 1.2em;color: rgb(255, 255, 255);line-height: 1.2;background-color: rgb(204, 204, 204);font-family: inherit;text-align: inherit;text-decoration: inherit;border-color: rgb(249, 110, 87);font-size: 12px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">点击标题可跳转</span></section><section style=\"margin-top: -11px;padding: 22px 16px 16px;max-width: 100%;border-width: 1px;border-style: solid;border-color: rgb(255, 105, 31);color: rgb(51, 51, 51);font-size: 1em;font-family: inherit;text-align: inherit;text-decoration: inherit;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><p style=\"max-width: 100%;min-height: 1em;line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><a target=\"_blank\" href=\"http://mp.weixin.qq.com/s?__biz=MjM5NzMyMjAwMA==&amp;mid=2651494369&amp;idx=2&amp;sn=940e5269433dd9939d6e1ec8427ce688&amp;chksm=bd25fb9e8a5272881227f62b9c5bcc2764c93f928371154c7f399d11a77677e8e1d4ead216a1&amp;scene=21#wechat_redirect\" data-itemshowtype=\"11\" tab=\"innerlink\" style=\"font-size: 12px;\" data-linktype=\"2\"><span style=\"font-size: 12px;\">Synchronized 的一个点，面试官可能都记错了</span></a><br></p><p style=\"max-width: 100%;min-height: 1em;line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><a target=\"_blank\" href=\"http://mp.weixin.qq.com/s?__biz=MjM5NzMyMjAwMA==&amp;mid=2651490811&amp;idx=1&amp;sn=a9d8cd131933d3cf3124ef4f1f045805&amp;chksm=bd25e5848a526c92169b7a0588f16f3c1a5f6a13f0d46aec10e23a0c1359106ff7c2a6716d4f&amp;scene=21#wechat_redirect\" data-itemshowtype=\"11\" tab=\"innerlink\" style=\"font-size: 12px;\" data-linktype=\"2\"><span style=\"font-size: 12px;\">看了synchronized源码，请别和我说它慢</span></a><br></p><p style=\"max-width: 100%;min-height: 1em;line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><a target=\"_blank\" href=\"http://mp.weixin.qq.com/s?__biz=MjM5NzMyMjAwMA==&amp;mid=2651484446&amp;idx=1&amp;sn=d98927babc32ec0676540edfdd12a8a4&amp;chksm=bd251d618a529477af77caaa5516ca79e17298c706e14fa47c03a5adb1e44a260ea1fa47cbfc&amp;scene=21#wechat_redirect\" data-itemshowtype=\"0\" tab=\"innerlink\" data-linktype=\"2\"><span style=\"font-size: 12px;\">Java 并发编程：Synchronized 及其实现原理</span></a></p></section></section><p style=\"white-space: normal;caret-color: rgb(0, 0, 0);color: rgb(0, 0, 0);text-align: start;max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><br></p><p style=\"text-align: center;\"><span style=\"max-width: 100%;font-size: 14px;color: rgb(255, 169, 0);box-sizing: border-box !important;overflow-wrap: break-word !important;\">看完本文有收获？请转发分享给更多人</span><br></p><p style=\"white-space: normal;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><strong style=\"max-width: 100%;color: rgb(255, 169, 0);box-sizing: border-box !important;overflow-wrap: break-word !important;\">关注「ImportNew」，提升Java技能</strong></p><p style=\"white-space: normal;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><img data-ratio=\"0.9166666666666666\" data-s=\"300,640\" data-type=\"jpeg\" data-w=\"600\" style=\"box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 600px !important; max-width: 600px\" width=\"auto\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/2A8tXicCG8ylbWIGfdoDED35IRRySQZTXUkJ1eop9MHApzFibKnOo0diboXpl0rmS5mH78YJhsWQv0dhv718A6kUA/640?wx_fmt=jpeg\"></p><p style=\"text-align: right;\"><span style=\"font-size: 14px;text-align: right;\"></span><span style=\"max-width: 100%;font-family: -apple-system-font, system-ui, \" helvetica neue sc sans gb yahei ui arial sans-serif center break-word border-box>点赞和在看就是最大的支持</span><span style=\"max-width: 100%;font-family: -apple-system-font, system-ui, \" helvetica neue sc sans gb yahei ui arial sans-serif center break-word border-box>❤️</span><span style=\"font-size: 14px;text-align: right;\"></span></p><p><br></p>\n                </div>\n\n    \n    <br>\n\n    \n        <a target=\"_blank\" href=\"http://mp.weixin.qq.com/s?__biz=MjM5NzMyMjAwMA==&amp;mid=2651494940&amp;idx=1&amp;sn=b4d66cb00e22ba0fb33dc284cd596ffa&amp;chksm=bd25f6638a527f7575d6a85b0a1bbf570537347784632f0f3cac6185e102737887b97cd0d82f&amp;scene=0#rd\" style=\"color: blue\" class=\"media_tool_meta meta_primary\">原文</a>\n        <br>\n    \n\n    \n\n    <img alt=\"\" width=\"1px\" height=\"1px\" class=\"\" style=\"width:1px;height:1px;display:none\" src=\"http://www.jintiankansha.me/rss_static/11757/T5z06HdwU2\"></div></div>","descriptionType":"html","publishedDate":"Tue, 04 May 2021 03:30:00 +0000","feedId":2521,"bgimg":"http://content.sov5.cn/mmbiz_jpg/eZzl4LXykQwoGjHsTyEjnjsSgap0icG9CrbwzElL5HLUUlbFtURRxqm0fbg7OSH248Oib9rZh2fcL2Paxqq2ZcicQ?imageView2/1/w/600","linkMd5":"bea6eba02e24ca5e6c0720a212d35855","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx30/cdn96@2020_3/2021/05/06/16-15-21-478_347e45695b4c0050.webp","destWidth":600,"destHeight":435,"sourceBytes":58055,"destBytes":56440,"author":"","articleImgCdnMap":{"http://content.sov5.cn/mmbiz_jpg/eZzl4LXykQwoGjHsTyEjnjsSgap0icG9CrbwzElL5HLUUlbFtURRxqm0fbg7OSH248Oib9rZh2fcL2Paxqq2ZcicQ?imageView2/1/w/600":"https://cdn.jsdelivr.net/gh/myreaderx30/cdn96@2020_3/2021/05/06/16-15-21-478_347e45695b4c0050.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jPV9kGeCzrztTVTTCywic2JYv25iaO8V9UShudOJXAib7mphNQAgicORLeg/640?wx_fmt=png":null,"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jjjeRg5KL24eT7C96TJ9GNf6QlK8BLQibZKxQoW22h3OBfGKrRl3Gg8A/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx21/cdn21@2020_1/2021/05/06/16-16-44-253_33cd6f990ff47e60.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jmo5xf4aP9aJpwibvYandh58pAMCU5eaAMrWEMsCG2ibN4SQic2iaAvonPQ/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx24/cdn55@2020_4/2021/05/06/16-15-36-020_294973b388d1a6ca.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jxOd4rmDHPkeutoGa7kiccr9ty2pXJvN12VNJVw71VedAvUjptswF6Ig/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx11/cdn63@2020_2/2021/05/06/16-15-27-557_0465482ddf8a9bf7.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5j3MTc44vCcpgynA4XecCCia1t0Gol23nNel1f5UFDPW1ZghJYNHVnCYA/640?wx_fmt=png":null,"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jc32GAdd6pNiapkDTC6FZbfBzwZOhuhDToYb0X8GoKCNEvVm68dLjgow/640?wx_fmt=png":null,"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jybUxYtFCZB3sBx3U9avuy8xU9hYOAiasscQeeub1mGsb5UEz7Fh9mhQ/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx22/cdn26@2020_6/2021/05/06/16-16-39-037_902d697711714bf6.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jG3sG6sK69bbh7WrQybuAoVbrh5tsDgObnOMpxVCqSYP8NOrjBYqoNA/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx13/cdn9@2020_1/2021/05/06/16-15-26-074_e50ddb955b0ddd95.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5j0o9znuRpM2D4JzgDv84C6iaD13LRVSGuOWcEr7jC4kzVxwLFMwoJ00g/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx29/cdn48@2020_1/2021/05/06/16-15-41-998_55d6abef8b210737.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5j6ziaZvshLMiaicbesTTPIlpVPHhpw8TZzmbhSf3Nxb84PPibVQohWXuVzg/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx15/cdn3@2020_1/2021/05/06/16-16-37-524_83cc737c7f959e9c.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jSW0ia3q8FD846WBAEzsxAURqAyNvOrT4IgXhjJQCjdGWxxP9R6jaR1g/640?wx_fmt=png":null,"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jedw06lQFqRtpKZrm3x4Wo2oz7FdIbEagtRpY63uzRsCqScbsZ4mZbA/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx7/cdn12@2020_2/2021/05/06/16-15-33-802_84326cc87f6f854a.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jIgcCxmWhWe7SGiaqLiaicg7jR5PMB12wPCHpZrGFRPfUKJibnLRNG20KUw/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx10/cdn8@2020_6/2021/05/06/16-15-33-844_289c1e591c62c135.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jvzP0XKbC4McEaupM2L0bWQRlg9vlSMIjeD6weYQjYQscOQhTTriaFvg/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx6/cdn33@2020_2/2021/05/06/16-15-29-755_f8eba9fb7422fe4e.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jrPBWpctk6Eff1c71hxdJvDrvUdKG6hPuRumkTDQ21k5Bt2ibsMicQWjQ/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx25/cdn2@2020_4/2021/05/06/16-15-32-779_cbd0b0cfa5b1ed2d.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5j2riaJABWj9fZ4zomlKMTysc6K8dBbLoVZndhoEnLqtRZf0r7IHAicAeg/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx18/cdn31@2020_6/2021/05/06/16-16-46-152_698b0302eaa5856f.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jnlrMjI5uiarlfDxtibBV54hxeia3XpQVW3AKM420Dq5QjPe4szpooHjsQ/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx19/cdn38@2020_6/2021/05/06/16-15-23-759_8579dd7922ae433e.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/2A8tXicCG8ylbWIGfdoDED35IRRySQZTXUkJ1eop9MHApzFibKnOo0diboXpl0rmS5mH78YJhsWQv0dhv718A6kUA/640?wx_fmt=jpeg":"https://cdn.jsdelivr.net/gh/myreaderx12/cdn27@2020_4/2021/05/06/16-15-39-141_f93d0239d4369c75.webp","http://www.jintiankansha.me/rss_static/11757/T5z06HdwU2":null},"publishedOrCreatedDate":1620317718315}],"record":{"createdTime":"2021-05-07 00:15:18","updatedTime":"2021-05-07 00:15:18","feedId":2521,"fetchDate":"Thu, 06 May 2021 16:15:18 +0000","fetchMs":354,"handleMs":28,"totalMs":248716,"newArticles":0,"totalArticles":5,"status":1,"type":0,"ip":"4cf9ab886509ef3fd2ece0a16b714d9c","hostName":"europe66*","requestId":"0dc570f8088e4032b6c7709c270ed9ba_2521","contentType":"application/rss+xml","totalBytes":509952,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":20,"articlesImgsGithubTotal":15,"successGithubMap":{"myreaderx25":1,"myreaderx15":1,"myreaderx7":1,"myreaderx6":1,"myreaderx21":1,"myreaderx10":1,"myreaderx22":1,"myreaderx11":1,"myreaderx12":1,"myreaderx13":1,"myreaderx24":1,"myreaderx30":1,"myreaderx18":1,"myreaderx29":1,"myreaderx19":1},"failGithubMap":{"myreaderx23":1}},"feed":{"createdTime":"2020-08-24 21:31:41","updatedTime":"2020-09-01 10:09:47","id":2521,"name":"ImportNew","url":"http://feedmaker.kindle4rss.com/feeds/importnew.weixin.xml","subscriber":null,"website":null,"icon":"http://www.sogou.com/images/logo/new/favicon.ico?v=4","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx63/cdn9@2020_3/2020/09/01/02-08-31-388_d24121c9beed1de6.ico","description":"伯乐在线旗下账号，专注Java技术分享，包括Java基础技术、进阶技能、架构设计和Java技术领域动态等。","weekly":null,"link":null},"noPictureArticleList":[{"createdTime":"2021-05-07 00:19:26","updatedTime":"2021-05-07 00:19:26","id":null,"feedId":2521,"linkMd5":"bea6eba02e24ca5e6c0720a212d35855"}],"tmpCommonImgCdnBytes":56440,"tmpBodyImgCdnBytes":453512,"tmpBgImgCdnBytes":0,"extra4":{"start":1620317717517,"total":0,"statList":[{"spend":770,"msg":"获取xml内容"},{"spend":28,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":244103,"msg":"正文链接上传到cdn"}]},"extra5":20,"extra6":18,"extra7ImgCdnFailResultVector":[{"code":1,"isDone":false,"source":"http://www.jintiankansha.me/rss_static/11757/T5z06HdwU2","sourceStatusCode":405,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":823,"convertSpendMs":0,"createdTime":"2021-05-07 00:15:22","host":"us-036*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[405],"sourceSize":"0","destSize":"0"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jvzP0XKbC4McEaupM2L0bWQRlg9vlSMIjeD6weYQjYQscOQhTTriaFvg/640?wx_fmt=png","sourceStatusCode":403,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":968,"convertSpendMs":0,"createdTime":"2021-05-07 00:15:22","host":"us-51*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","extra22GetBytesInfo":"2、Referer字段 ： http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","extra23historyStatusCode":[403,403],"sourceSize":"0","destSize":"0"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5j6ziaZvshLMiaicbesTTPIlpVPHhpw8TZzmbhSf3Nxb84PPibVQohWXuVzg/640?wx_fmt=png","sourceStatusCode":403,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":1128,"convertSpendMs":0,"createdTime":"2021-05-07 00:15:22","host":"europe-60*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","extra22GetBytesInfo":"2、Referer字段 ： http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","extra23historyStatusCode":[403,403],"sourceSize":"0","destSize":"0"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jmo5xf4aP9aJpwibvYandh58pAMCU5eaAMrWEMsCG2ibN4SQic2iaAvonPQ/640?wx_fmt=png","sourceStatusCode":403,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":1146,"convertSpendMs":0,"createdTime":"2021-05-07 00:15:22","host":"europe21*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","extra22GetBytesInfo":"2、Referer字段 ： http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","extra23historyStatusCode":[403,403],"sourceSize":"0","destSize":"0"},{"code":1,"isDone":false,"source":"http://www.jintiankansha.me/rss_static/11757/T5z06HdwU2","sourceStatusCode":405,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":539,"convertSpendMs":0,"createdTime":"2021-05-07 00:15:23","host":"us-034*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[405],"sourceSize":"0","destSize":"0"},null,null,{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jc32GAdd6pNiapkDTC6FZbfBzwZOhuhDToYb0X8GoKCNEvVm68dLjgow/640?wx_fmt=png","sourceStatusCode":403,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":1039,"convertSpendMs":0,"createdTime":"2021-05-07 00:16:22","host":"europe63*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","extra22GetBytesInfo":"2、Referer字段 ： http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","extra23historyStatusCode":[403,403],"sourceSize":"0","destSize":"0"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jSW0ia3q8FD846WBAEzsxAURqAyNvOrT4IgXhjJQCjdGWxxP9R6jaR1g/640?wx_fmt=png","sourceStatusCode":403,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":943,"convertSpendMs":0,"createdTime":"2021-05-07 00:16:22","host":"us-017*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","extra22GetBytesInfo":"2、Referer字段 ： http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","extra23historyStatusCode":[403,403],"sourceSize":"0","destSize":"0"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5j6ziaZvshLMiaicbesTTPIlpVPHhpw8TZzmbhSf3Nxb84PPibVQohWXuVzg/640?wx_fmt=png","sourceStatusCode":403,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":1128,"convertSpendMs":0,"createdTime":"2021-05-07 00:15:22","host":"europe-60*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","extra22GetBytesInfo":"2、Referer字段 ： http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","extra23historyStatusCode":[403,403],"sourceSize":"0","destSize":"0"},null,null,null,null,null,{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jSW0ia3q8FD846WBAEzsxAURqAyNvOrT4IgXhjJQCjdGWxxP9R6jaR1g/640?wx_fmt=png","sourceStatusCode":200,"destWidth":1080,"destHeight":221,"sourceBytes":90544,"destBytes":27352,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":18427,"convertSpendMs":15,"createdTime":"2021-05-07 00:16:23","host":"us-022*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx23/cdn99/contents/2021/05/06/16-16-41-872_535297878548c340.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 69189253.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Resource, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Thu, 06 May 2021 16:16:41 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["84E0:759C:2C3C52:65794B:60941669"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1620320980"],"x-ratelimit-resource":["core"],"x-ratelimit-used":["60"],"x-xss-protection":["0"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx23/cdn99/contents/2021/05/06/16-16-41-872_535297878548c340.webp","historyStatusCode":[],"spendMs":32},"base64UserPassword":null,"token":"df0b9******************************93a6e"},"githubUser":"myreaderx23","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"88.4 KB","destSize":"26.7 KB","compressRate":"30.2%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jc32GAdd6pNiapkDTC6FZbfBzwZOhuhDToYb0X8GoKCNEvVm68dLjgow/640?wx_fmt=png","sourceStatusCode":403,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":1039,"convertSpendMs":0,"createdTime":"2021-05-07 00:16:22","host":"europe63*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","extra22GetBytesInfo":"2、Referer字段 ： http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","extra23historyStatusCode":[403,403],"sourceSize":"0","destSize":"0"},null,null,{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jc32GAdd6pNiapkDTC6FZbfBzwZOhuhDToYb0X8GoKCNEvVm68dLjgow/640?wx_fmt=png","sourceStatusCode":403,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":1039,"convertSpendMs":0,"createdTime":"2021-05-07 00:16:22","host":"europe63*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","extra22GetBytesInfo":"2、Referer字段 ： http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","extra23historyStatusCode":[403,403],"sourceSize":"0","destSize":"0"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jc32GAdd6pNiapkDTC6FZbfBzwZOhuhDToYb0X8GoKCNEvVm68dLjgow/640?wx_fmt=png","sourceStatusCode":403,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":1039,"convertSpendMs":0,"createdTime":"2021-05-07 00:16:22","host":"europe63*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","extra22GetBytesInfo":"2、Referer字段 ： http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","extra23historyStatusCode":[403,403],"sourceSize":"0","destSize":"0"}],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://europe-24.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[403]},"http://us-53.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://us-039.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://europe63.herokuapp.com/":{"failCount":1,"successCount":1,"resultList":[200,403]},"http://us-034.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[405]},"http://europe-58.herokuapp.com/":{"failCount":2,"successCount":3,"resultList":[200,200,200,403,null]},"http://us-005.herokuapp.com/":{"failCount":1,"successCount":1,"resultList":[200,null]},"http://europe61.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://us-028.herokuapp.com/":{"failCount":1,"successCount":1,"resultList":[200,403]},"http://us-022.herokuapp.com/":{"failCount":0,"successCount":3,"resultList":[200,200,200]},"http://europe-60.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[403]},"http://us-52.herokuapp.com/":{"failCount":1,"successCount":1,"resultList":[200,403]},"http://us-024.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://europe70.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://us-006.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://europe69.herokuapp.com/":{"failCount":0,"successCount":2,"resultList":[200,200]},"http://us-017.herokuapp.com/":{"failCount":1,"successCount":1,"resultList":[200,403]},"http://us-036.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[405]},"http://europe21.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[403]},"http://europe-59.herokuapp.com/":{"failCount":0,"successCount":2,"resultList":[200,200]},"http://us-51.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[403]},"http://us-014.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"http://content.sov5.cn/mmbiz_jpg/eZzl4LXykQwoGjHsTyEjnjsSgap0icG9CrbwzElL5HLUUlbFtURRxqm0fbg7OSH248Oib9rZh2fcL2Paxqq2ZcicQ?imageView2/1/w/600","sourceStatusCode":200,"destWidth":600,"destHeight":435,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx30/cdn96@2020_3/2021/05/06/16-15-21-478_347e45695b4c0050.webp","sourceBytes":58055,"destBytes":56440,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":3773,"convertSpendMs":14,"createdTime":"2021-05-07 00:15:18","host":"europe21*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855,bea6eba02e24ca5e6c0720a212d35855","githubUser":"myreaderx30","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"56.7 KB","destSize":"55.1 KB","compressRate":"97.2%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jnlrMjI5uiarlfDxtibBV54hxeia3XpQVW3AKM420Dq5QjPe4szpooHjsQ/640?wx_fmt=png","sourceStatusCode":200,"destWidth":710,"destHeight":329,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx19/cdn38@2020_6/2021/05/06/16-15-23-759_8579dd7922ae433e.webp","sourceBytes":14209,"destBytes":14768,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":1824,"convertSpendMs":8,"createdTime":"2021-05-07 00:15:22","host":"us-52*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","githubUser":"myreaderx19","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"13.9 KB","destSize":"14.4 KB","compressRate":"103.9%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jG3sG6sK69bbh7WrQybuAoVbrh5tsDgObnOMpxVCqSYP8NOrjBYqoNA/640?wx_fmt=png","sourceStatusCode":200,"destWidth":960,"destHeight":97,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx13/cdn9@2020_1/2021/05/06/16-15-26-074_e50ddb955b0ddd95.webp","sourceBytes":21430,"destBytes":14270,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":4290,"convertSpendMs":12,"createdTime":"2021-05-07 00:15:22","host":"europe-58*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","githubUser":"myreaderx13","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"20.9 KB","destSize":"13.9 KB","compressRate":"66.6%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jxOd4rmDHPkeutoGa7kiccr9ty2pXJvN12VNJVw71VedAvUjptswF6Ig/640?wx_fmt=png","sourceStatusCode":200,"destWidth":1080,"destHeight":523,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx11/cdn63@2020_2/2021/05/06/16-15-27-557_0465482ddf8a9bf7.webp","sourceBytes":70266,"destBytes":36202,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":5818,"convertSpendMs":22,"createdTime":"2021-05-07 00:15:22","host":"europe-58*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","githubUser":"myreaderx11","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"68.6 KB","destSize":"35.4 KB","compressRate":"51.5%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jvzP0XKbC4McEaupM2L0bWQRlg9vlSMIjeD6weYQjYQscOQhTTriaFvg/640?wx_fmt=png","sourceStatusCode":200,"destWidth":670,"destHeight":638,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx6/cdn33@2020_2/2021/05/06/16-15-29-755_f8eba9fb7422fe4e.webp","sourceBytes":79735,"destBytes":30926,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":6881,"convertSpendMs":19,"createdTime":"2021-05-07 00:15:23","host":"europe-58*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","githubUser":"myreaderx6","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"77.9 KB","destSize":"30.2 KB","compressRate":"38.8%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jrPBWpctk6Eff1c71hxdJvDrvUdKG6hPuRumkTDQ21k5Bt2ibsMicQWjQ/640?wx_fmt=png","sourceStatusCode":200,"destWidth":571,"destHeight":460,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx25/cdn2@2020_4/2021/05/06/16-15-32-779_cbd0b0cfa5b1ed2d.webp","sourceBytes":28586,"destBytes":14114,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":10912,"convertSpendMs":11,"createdTime":"2021-05-07 00:15:22","host":"us-022*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","githubUser":"myreaderx25","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"27.9 KB","destSize":"13.8 KB","compressRate":"49.4%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jedw06lQFqRtpKZrm3x4Wo2oz7FdIbEagtRpY63uzRsCqScbsZ4mZbA/640?wx_fmt=png","sourceStatusCode":200,"destWidth":608,"destHeight":229,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx7/cdn12@2020_2/2021/05/06/16-15-33-802_84326cc87f6f854a.webp","sourceBytes":20102,"destBytes":9874,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":11850,"convertSpendMs":7,"createdTime":"2021-05-07 00:15:22","host":"us-005*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","githubUser":"myreaderx7","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"19.6 KB","destSize":"9.6 KB","compressRate":"49.1%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jIgcCxmWhWe7SGiaqLiaicg7jR5PMB12wPCHpZrGFRPfUKJibnLRNG20KUw/640?wx_fmt=png","sourceStatusCode":200,"destWidth":581,"destHeight":230,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx10/cdn8@2020_6/2021/05/06/16-15-33-844_289c1e591c62c135.webp","sourceBytes":25826,"destBytes":12772,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":12098,"convertSpendMs":7,"createdTime":"2021-05-07 00:15:22","host":"europe-59*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","githubUser":"myreaderx10","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"25.2 KB","destSize":"12.5 KB","compressRate":"49.5%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jmo5xf4aP9aJpwibvYandh58pAMCU5eaAMrWEMsCG2ibN4SQic2iaAvonPQ/640?wx_fmt=png","sourceStatusCode":200,"destWidth":713,"destHeight":296,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx24/cdn55@2020_4/2021/05/06/16-15-36-020_294973b388d1a6ca.webp","sourceBytes":40360,"destBytes":16682,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":12878,"convertSpendMs":11,"createdTime":"2021-05-07 00:15:23","host":"us-017*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","githubUser":"myreaderx24","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"39.4 KB","destSize":"16.3 KB","compressRate":"41.3%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/2A8tXicCG8ylbWIGfdoDED35IRRySQZTXUkJ1eop9MHApzFibKnOo0diboXpl0rmS5mH78YJhsWQv0dhv718A6kUA/640?wx_fmt=jpeg","sourceStatusCode":200,"destWidth":600,"destHeight":550,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx12/cdn27@2020_4/2021/05/06/16-15-39-141_f93d0239d4369c75.webp","sourceBytes":37143,"destBytes":31608,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":17649,"convertSpendMs":11,"createdTime":"2021-05-07 00:15:22","host":"europe63*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","githubUser":"myreaderx12","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"36.3 KB","destSize":"30.9 KB","compressRate":"85.1%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5j0o9znuRpM2D4JzgDv84C6iaD13LRVSGuOWcEr7jC4kzVxwLFMwoJ00g/640?wx_fmt=png","sourceStatusCode":200,"destWidth":1080,"destHeight":418,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx29/cdn48@2020_1/2021/05/06/16-15-41-998_55d6abef8b210737.webp","sourceBytes":179259,"destBytes":53028,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":20389,"convertSpendMs":23,"createdTime":"2021-05-07 00:15:22","host":"europe69*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","githubUser":"myreaderx29","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"175.1 KB","destSize":"51.8 KB","compressRate":"29.6%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5j6ziaZvshLMiaicbesTTPIlpVPHhpw8TZzmbhSf3Nxb84PPibVQohWXuVzg/640?wx_fmt=png","sourceStatusCode":200,"destWidth":1008,"destHeight":812,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx15/cdn3@2020_1/2021/05/06/16-16-37-524_83cc737c7f959e9c.webp","sourceBytes":108129,"destBytes":91124,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":14305,"convertSpendMs":32,"createdTime":"2021-05-07 00:16:23","host":"us-028*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","githubUser":"myreaderx15","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"105.6 KB","destSize":"89 KB","compressRate":"84.3%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jybUxYtFCZB3sBx3U9avuy8xU9hYOAiasscQeeub1mGsb5UEz7Fh9mhQ/640?wx_fmt=png","sourceStatusCode":200,"destWidth":956,"destHeight":324,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx22/cdn26@2020_6/2021/05/06/16-16-39-037_902d697711714bf6.webp","sourceBytes":58395,"destBytes":26618,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":14906,"convertSpendMs":14,"createdTime":"2021-05-07 00:16:24","host":"us-022*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","githubUser":"myreaderx22","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"57 KB","destSize":"26 KB","compressRate":"45.6%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5jjjeRg5KL24eT7C96TJ9GNf6QlK8BLQibZKxQoW22h3OBfGKrRl3Gg8A/640?wx_fmt=png","sourceStatusCode":200,"destWidth":1080,"destHeight":189,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx21/cdn21@2020_1/2021/05/06/16-16-44-253_33cd6f990ff47e60.webp","sourceBytes":94005,"destBytes":26882,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":20387,"convertSpendMs":11,"createdTime":"2021-05-07 00:16:24","host":"europe-59*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","githubUser":"myreaderx21","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"91.8 KB","destSize":"26.3 KB","compressRate":"28.6%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicZs9lJF2NoicPJC8HhBeYA5j2riaJABWj9fZ4zomlKMTysc6K8dBbLoVZndhoEnLqtRZf0r7IHAicAeg/640?wx_fmt=png","sourceStatusCode":200,"destWidth":1080,"destHeight":638,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx18/cdn31@2020_6/2021/05/06/16-16-46-152_698b0302eaa5856f.webp","sourceBytes":264173,"destBytes":74644,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":22397,"convertSpendMs":37,"createdTime":"2021-05-07 00:16:24","host":"europe69*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E5%86%8D%E8%B0%88synchronized%E9%94%81%E5%8D%87%E7%BA%A7","linkMd5ListStr":"bea6eba02e24ca5e6c0720a212d35855","githubUser":"myreaderx18","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"258 KB","destSize":"72.9 KB","compressRate":"28.3%"}],"successGithubMap":{"myreaderx25":1,"myreaderx15":1,"myreaderx7":1,"myreaderx6":1,"myreaderx21":1,"myreaderx10":1,"myreaderx22":1,"myreaderx11":1,"myreaderx12":1,"myreaderx13":1,"myreaderx24":1,"myreaderx30":1,"myreaderx18":1,"myreaderx29":1,"myreaderx19":1},"failGithubMap":{"myreaderx23":1}}