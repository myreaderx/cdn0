{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-10-13 14:04:04","updatedTime":"2020-10-13 14:04:04","title":"Java Spring Boot 2.0 实战之制作Docker镜像并推送到Docker Hub和阿里云仓库","link":"https://www.centos.bz/?p=24221","description":"<p>内容摘要：大规模集群快速部署Java应用，需要制作Docker镜像，本次课程详细介绍如何制作Java程序的Docker镜像文件，深入解析DockerFile核心参数，以及实践演练把我们制作的Docker镜像推送到DockerHub仓库，国内可以使用阿里云Docker仓库加速，以及安全保护机制。</p>\n<p>今天我们都来实战Java Spring Boot 2.0，制作Java Docker镜像，然后推送到DockerHub和阿里云Docker仓库，推送到公共镜像仓库的原因是便于后期大规模服务器集群部署。</p>\n<h2>1、Docker安装</h2>\n<p>如果你不熟悉安装，可以参考这个文章 《<a href=\"https://yq.aliyun.com/articles/691596\" rel=\"noopener\" target=\"_blank\">Java Spring Boot 2.0实战Docker容器与架构原理，视频与课件，基于Linux环境</a>》</p>\n<p>Mac可以参考《<a href=\"https://yq.aliyun.com/articles/692030\" rel=\"noopener\" target=\"_blank\">Mac OS安装Docker容器的3种方式与差别：Docker for Mac</a>》</p>\n<h2>2、创建Java程序，为了制作Docker镜像</h2>\n<p>这里我们就使用最原始的Java代码，编写一个HelloWorld的例子。</p>\n<p>基于Maven构建Spring Boot 2.0镜像文件，可以参考前面文章。<br />\n非常简单的Java代码，输出字符串信息。可以使用Eclipse工具编写。</p>\n<p><img src=\"https://www.centos.bz/wp-content/uploads/2019/07/1-20.png\" alt=\"\" width=\"1678\" height=\"528\" class=\"alignnone size-full wp-image-24222\" srcset=\"https://www.centos.bz/wp-content/uploads/2019/07/1-20.png 1678w, https://www.centos.bz/wp-content/uploads/2019/07/1-20-768x242.png 768w\" sizes=\"(max-width: 1678px) 100vw, 1678px\" /></p>\n<p>保存为JavaDocker.java文件。</p>\n<h2>3、制作Java 原始的Docker镜像</h2>\n<p>这里还没有使用maven 项目，Maven有Docker插件，可以更方便的构建镜像。上一篇文章里讲过了。</p>\n<pre><code>docker build -t java-docker-demo .\n</code></pre>\n<p>会看到日志信息</p>\n<pre><code>Sending build context to Docker daemon  3.072kB\nStep 1/5 : FROM java:8\n ---&#62; d23bdf5b1b1b\nStep 2/5 : COPY . /var/test/java\n ---&#62; Using cache\n ---&#62; b21b800e13a1\nStep 3/5 : WORKDIR /var/test/java\n ---&#62; Using cache\n ---&#62; 1926e9870140\nStep 4/5 : RUN javac JavaDocker.java\n ---&#62; Using cache\n ---&#62; 8fad6e1451df\nStep 5/5 : CMD [\"java\", \"JavaDocker\"]\n ---&#62; Using cache\n ---&#62; 0d18c8ddf582\nSuccessfully built 0d18c8ddf582\nSuccessfully tagged java-docker-hello-world:latest\n</code></pre>\n<p>Docker会生产一个镜像文件。docker images 查看镜像信息</p>\n<p><img src=\"https://www.centos.bz/wp-content/uploads/2019/07/2-4.png\" alt=\"\" width=\"2146\" height=\"686\" class=\"alignnone size-full wp-image-24223\" srcset=\"https://www.centos.bz/wp-content/uploads/2019/07/2-4.png 2146w, https://www.centos.bz/wp-content/uploads/2019/07/2-4-768x246.png 768w\" sizes=\"(max-width: 2146px) 100vw, 2146px\" /></p>\n<h2>4、注册DockerHub或者阿里云Docker仓库</h2>\n<p>国外可以在DockerHub注册镜像仓库，<a href=\"https://hub.docker.com\" rel=\"noopener\" target=\"_blank\">https://hub.docker.com</a>。</p>\n<p><img src=\"https://www.centos.bz/wp-content/uploads/2019/07/3-3.png\" alt=\"\" width=\"2448\" height=\"854\" class=\"alignnone size-full wp-image-24224\" srcset=\"https://www.centos.bz/wp-content/uploads/2019/07/3-3.png 2448w, https://www.centos.bz/wp-content/uploads/2019/07/3-3-768x268.png 768w\" sizes=\"(max-width: 2448px) 100vw, 2448px\" /></p>\n<p>国内可以选择阿里云Docker仓库<a href=\"https://cr.console.aliyun.com\" rel=\"noopener\" target=\"_blank\">https://cr.console.aliyun.com</a>，<br />\n都是免费的服务器，阿里云和Docker官方合作，公益事业，同步官方的全部镜像，免费给国内开发者使用。<br />\n企业在国内大规模部署Docker镜像服务器是不错的选择。</p>\n<p><img src=\"https://www.centos.bz/wp-content/uploads/2019/07/4-1.png\" alt=\"\" width=\"2466\" height=\"860\" class=\"alignnone size-full wp-image-24225\" srcset=\"https://www.centos.bz/wp-content/uploads/2019/07/4-1.png 2466w, https://www.centos.bz/wp-content/uploads/2019/07/4-1-768x268.png 768w\" sizes=\"(max-width: 2466px) 100vw, 2466px\" /></p>\n<p>创建仓库，并指定命令空间，后面向某个仓库提交镜像，实际里面很多官方镜像，我们可以直接搜索下载，也可以自己提交镜像。</p>\n<h2>5、推送镜像到DockerHub或者阿里云Docker仓库</h2>\n<p>在仓库创建完成以后，可以在本地推送制作好的镜像了。<br />\n第一次连接DockerHub或者阿里云Docker仓库，都需要登陆Login，输入一次用户名和密码即可，缓存起来。Mac版本的Docker一样的。<br />\n我们这里使用的是Linux环境作为测试。</p>\n<pre><code>sudo docker push frankxulei/alibaba-java-docker-demo\n</code></pre>\n<p><img src=\"https://www.centos.bz/wp-content/uploads/2019/07/5-1.png\" alt=\"\" width=\"2276\" height=\"486\" class=\"alignnone size-full wp-image-24226\" srcset=\"https://www.centos.bz/wp-content/uploads/2019/07/5-1.png 2276w, https://www.centos.bz/wp-content/uploads/2019/07/5-1-768x164.png 768w\" sizes=\"(max-width: 2276px) 100vw, 2276px\" /></p>\n<p>显示已经推送完成。</p>\n<h2>6、登陆DockerHub查看镜像是否成功</h2>\n<p>DockerHub网页版进入镜像仓库，可以看到刚才推送的镜像文件。</p>\n<p><img src=\"https://www.centos.bz/wp-content/uploads/2019/07/6-1.png\" alt=\"\" width=\"2446\" height=\"1068\" class=\"alignnone size-full wp-image-24227\" srcset=\"https://www.centos.bz/wp-content/uploads/2019/07/6-1.png 2446w, https://www.centos.bz/wp-content/uploads/2019/07/6-1-768x335.png 768w\" sizes=\"(max-width: 2446px) 100vw, 2446px\" /></p>\n<p>可以看到我们推送的镜像已经进入了DockerHub镜像仓库。<br />\n进行大规模部署的时候，每个服务器上的Docker客户端可以搜索我们的镜像，然后执行下载和运行命令。就可以实现快速大规模部署工作。<br />\n后期我们可以增进K8S和Docker结合实战的工作。</p>\n","descriptionType":"html","publishedDate":"Tue, 23 Jul 2019 04:33:29 +0000","feedId":26579,"bgimg":"https://www.centos.bz/wp-content/uploads/2019/07/1-20.png","linkMd5":"2ffb6925b5e2db461e8b0e34d36d4f12","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn2@2020_6/2020/10/13/06-04-07-120_d4426d10c151ac39.webp","destWidth":1678,"destHeight":528,"sourceBytes":63864,"destBytes":30790,"author":"sa","articleImgCdnMap":{"https://www.centos.bz/wp-content/uploads/2019/07/1-20.png":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn2@2020_6/2020/10/13/06-04-07-120_d4426d10c151ac39.webp","https://www.centos.bz/wp-content/uploads/2019/07/2-4.png":"https://cdn.jsdelivr.net/gh/myreaderx25/cdn29@2020_4/2020/10/13/06-04-15-226_8cdb06eb1b1c9607.webp","https://www.centos.bz/wp-content/uploads/2019/07/3-3.png":"https://cdn.jsdelivr.net/gh/myreaderx7/cdn25@2020_4/2020/10/13/06-04-13-894_d0a0173b8e501fde.webp","https://www.centos.bz/wp-content/uploads/2019/07/4-1.png":"https://cdn.jsdelivr.net/gh/myreaderx13/cdn33@2020_6/2020/10/13/06-04-24-615_b192d5081a845fa2.webp","https://www.centos.bz/wp-content/uploads/2019/07/5-1.png":"https://cdn.jsdelivr.net/gh/myreaderx10/cdn17@2020_1/2020/10/13/06-04-25-356_f2a291fe877ad735.webp","https://www.centos.bz/wp-content/uploads/2019/07/6-1.png":"https://cdn.jsdelivr.net/gh/myreaderx3/cdn21@2020_1/2020/10/13/06-04-13-702_08974c8b598a01bd.webp"},"publishedOrCreatedDate":1602569044358}],"record":{"createdTime":"2020-10-13 14:04:04","updatedTime":"2020-10-13 14:04:04","feedId":26579,"fetchDate":"Tue, 13 Oct 2020 06:04:04 +0000","fetchMs":8961,"handleMs":11,"totalMs":31418,"newArticles":0,"totalArticles":10,"status":1,"type":0,"ip":"28b677c0686b1311e8d67d204ad5933d","hostName":"europe70*","requestId":"003f73ada1b24c7db882b22869bd534f_26579","contentType":"application/rss+xml; charset=UTF-8","totalBytes":515166,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":6,"articlesImgsGithubTotal":6,"successGithubMap":{"myreaderx25":1,"myreaderx7":1,"myreaderx32":1,"myreaderx10":1,"myreaderx3":1,"myreaderx13":1},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 02:38:57","updatedTime":"2020-09-07 04:38:41","id":26579,"name":"Linux运维日志","url":"http://www.centos.bz/feed/","subscriber":123,"website":null,"icon":"https://www.centos.bz/favicon.ico","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx62/cdn6@2020_4/2020/09/06/20-38-41-193_71ca1da3116b7d61.ico","description":"关于CentOS和Ubuntu等系统的运维","weekly":null,"link":null},"noPictureArticleList":[],"tmpCommonImgCdnBytes":30790,"tmpBodyImgCdnBytes":484376,"tmpBgImgCdnBytes":0,"extra4":{"start":1602569035087,"total":0,"statList":[{"spend":9260,"msg":"获取xml内容"},{"spend":11,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":18463,"msg":"正文链接上传到cdn"}]},"extra5":6,"extra6":6,"extra7ImgCdnFailResultVector":[],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-017.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-005.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://europe67.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-51.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-029.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://www.centos.bz/wp-content/uploads/2019/07/1-20.png","sourceStatusCode":200,"destWidth":1678,"destHeight":528,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn2@2020_6/2020/10/13/06-04-07-120_d4426d10c151ac39.webp","sourceBytes":63864,"destBytes":30790,"targetWebpQuality":75,"feedId":26579,"totalSpendMs":3525,"convertSpendMs":59,"createdTime":"2020-10-13 14:04:04","host":"us-025*","referer":"https://www.centos.bz/?p=24221","linkMd5ListStr":"2ffb6925b5e2db461e8b0e34d36d4f12,2ffb6925b5e2db461e8b0e34d36d4f12","githubUser":"myreaderx32","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"62.4 KB","destSize":"30.1 KB","compressRate":"48.2%"},{"code":1,"isDone":false,"source":"https://www.centos.bz/wp-content/uploads/2019/07/6-1.png","sourceStatusCode":200,"destWidth":2446,"destHeight":1068,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx3/cdn21@2020_1/2020/10/13/06-04-13-702_08974c8b598a01bd.webp","sourceBytes":232329,"destBytes":79346,"targetWebpQuality":75,"feedId":26579,"totalSpendMs":4559,"convertSpendMs":195,"createdTime":"2020-10-13 14:04:10","host":"us-029*","referer":"https://www.centos.bz/?p=24221","linkMd5ListStr":"2ffb6925b5e2db461e8b0e34d36d4f12","githubUser":"myreaderx3","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"226.9 KB","destSize":"77.5 KB","compressRate":"34.2%"},{"code":1,"isDone":false,"source":"https://www.centos.bz/wp-content/uploads/2019/07/3-3.png","sourceStatusCode":200,"destWidth":2448,"destHeight":854,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx7/cdn25@2020_4/2020/10/13/06-04-13-894_d0a0173b8e501fde.webp","sourceBytes":156352,"destBytes":56898,"targetWebpQuality":75,"feedId":26579,"totalSpendMs":6665,"convertSpendMs":105,"createdTime":"2020-10-13 14:04:08","host":"us-017*","referer":"https://www.centos.bz/?p=24221","linkMd5ListStr":"2ffb6925b5e2db461e8b0e34d36d4f12","githubUser":"myreaderx7","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"152.7 KB","destSize":"55.6 KB","compressRate":"36.4%"},{"code":1,"isDone":false,"source":"https://www.centos.bz/wp-content/uploads/2019/07/2-4.png","sourceStatusCode":200,"destWidth":2146,"destHeight":686,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx25/cdn29@2020_4/2020/10/13/06-04-15-226_8cdb06eb1b1c9607.webp","sourceBytes":189252,"destBytes":151436,"targetWebpQuality":75,"feedId":26579,"totalSpendMs":8052,"convertSpendMs":93,"createdTime":"2020-10-13 14:04:08","host":"us-005*","referer":"https://www.centos.bz/?p=24221","linkMd5ListStr":"2ffb6925b5e2db461e8b0e34d36d4f12","githubUser":"myreaderx25","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"184.8 KB","destSize":"147.9 KB","compressRate":"80%"},{"code":1,"isDone":false,"source":"https://www.centos.bz/wp-content/uploads/2019/07/4-1.png","sourceStatusCode":200,"destWidth":2466,"destHeight":860,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx13/cdn33@2020_6/2020/10/13/06-04-24-615_b192d5081a845fa2.webp","sourceBytes":245615,"destBytes":69628,"targetWebpQuality":75,"feedId":26579,"totalSpendMs":17841,"convertSpendMs":118,"createdTime":"2020-10-13 14:04:08","host":"europe67*","referer":"https://www.centos.bz/?p=24221","linkMd5ListStr":"2ffb6925b5e2db461e8b0e34d36d4f12","githubUser":"myreaderx13","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"239.9 KB","destSize":"68 KB","compressRate":"28.3%"},{"code":1,"isDone":false,"source":"https://www.centos.bz/wp-content/uploads/2019/07/5-1.png","sourceStatusCode":200,"destWidth":2276,"destHeight":486,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx10/cdn17@2020_1/2020/10/13/06-04-25-356_f2a291fe877ad735.webp","sourceBytes":142576,"destBytes":127068,"targetWebpQuality":75,"feedId":26579,"totalSpendMs":18312,"convertSpendMs":62,"createdTime":"2020-10-13 14:04:08","host":"us-51*","referer":"https://www.centos.bz/?p=24221","linkMd5ListStr":"2ffb6925b5e2db461e8b0e34d36d4f12","githubUser":"myreaderx10","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"139.2 KB","destSize":"124.1 KB","compressRate":"89.1%"}],"successGithubMap":{"myreaderx25":1,"myreaderx7":1,"myreaderx32":1,"myreaderx10":1,"myreaderx3":1,"myreaderx13":1},"failGithubMap":{}}