{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-10-13 05:39:32","updatedTime":"2020-10-13 05:39:32","title":"[C++/CX] コマンドの紐付け","link":"http://blogs.wankuma.com/episteme/archive/2013/04/07/327449.aspx","description":"<p>おつぎはちょっとだけメンドクセーこと。<br>ボタンのクリックイベント・ハンドラを廃しプロパティに紐付ける。<br>これができればコード・ビハインドが減るし、MVVMとかゆー<strong>小洒落た</strong>マネができるとな。</p><p>現時点でふたつのボタンのClickイベント・ハンドラを TrialPage.xaml.hおよびcppから取っ払う。<br>しかるのち ボタンのCommand属性を追加。</p><p><img src=\"http://www1.c3-net.ne.jp/episteme/images/cppcx_6th/step1.png\"></p><p>紐付けたプロパティ:Increment/Decremenet をCounterModelに追加。<br>プロパティの型は Windows::UI::Xaml::Input::ICommand^ なのでヘッダはこんな:</p><p><font face=\"Courier New\">// --- Countermodel.h<br>&nbsp; ...<br>&nbsp; [Windows::UI::Xaml::Data::Bindable] <br>&nbsp; public ref class CounterModel sealed : public Common::BindableBase {<br>&nbsp; public:<br>&nbsp;&nbsp;&nbsp; ...<br><font color=\"#ff0000\">&nbsp;&nbsp;&nbsp; property Windows::UI::Xaml::Input::ICommand^ Increment <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { Windows::UI::Xaml::Input::ICommand^ get(); }<br>&nbsp;&nbsp;&nbsp; property Windows::UI::Xaml::Input::ICommand^ Decrement <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { Windows::UI::Xaml::Input::ICommand^ get(); }<br></font>&nbsp;&nbsp;&nbsp; void clear();<br>&nbsp; private:<br>&nbsp;&nbsp;&nbsp; void increment();<br>&nbsp;&nbsp;&nbsp; void decrement();<br>&nbsp;&nbsp;&nbsp; ...<br>&nbsp; };</font></p><p>cpp側では Windows::UI::Xaml::Input::ICommand を実装したインスタンスを返さにゃならんのだが、そいつがちとばかしメンドーです。<br>まずヘルパー・クラスを用意する。</p><p><font face=\"Courier New\">// --- CounterModel.cpp<br><font color=\"#ff0000\">namespace {</font></font></p><p><font color=\"#ff0000\" face=\"Courier New\">&nbsp; delegate void Action(Object^ arg);</font></p><p><font color=\"#ff0000\" face=\"Courier New\">&nbsp; ref class Command sealed : ICommand {<br>&nbsp; public:<br>&nbsp;&nbsp;&nbsp; Command(Action^ action) { action_ = action; }<br>&nbsp;&nbsp;&nbsp; virtual void Execute(Object^ arg) { action_(arg); }<br>&nbsp;&nbsp;&nbsp; virtual bool CanExecute(Object^ arg) { return true; }<br>&nbsp;&nbsp;&nbsp; virtual event EventHandler<object^>^ CanExecuteChanged;<br>&nbsp; private:<br>&nbsp;&nbsp;&nbsp; Action^ action_;<br>&nbsp; };</object^></font></p><p><font color=\"#ff0000\" face=\"Courier New\">}</font></p><p>んでもって:</p><p><font face=\"Courier New\">// --- CounterModel.cpp<br>namespace App1 {<br>&nbsp; ...<br><font color=\"#ff0000\">&nbsp; ICommand^ CounterModel::Increment::get() {<br>&nbsp;&nbsp;&nbsp; return ref new Command(ref new Action([this](Object^ arg) { increment();}));<br>&nbsp; }<br>&nbsp; ICommand^ CounterModel::Decrement::get() {<br>&nbsp;&nbsp;&nbsp; return ref new Command(ref new Action([this](Object^ arg) { decrement();}));<br>&nbsp; }<br></font>}</font></p><p>「increment()/decrement() を呼び出す<strong>ラムダ式</strong>」から起こした ICommand を返すって<strong>スンポー</strong>ですな。<br></p><p>&nbsp;</p><img src =\"http://blogs.wankuma.com/episteme/aggbug/327449.aspx\" width = \"1\" height = \"1\" />","descriptionType":"text/html","publishedDate":"Sun, 07 Apr 2013 21:30:00 +0000","feedId":42717,"bgimg":"http://www1.c3-net.ne.jp/episteme/images/cppcx_6th/step1.png","linkMd5":"ad167473f05a4eb69bd8fa12961b6b29","author":"επιστημη","articleImgCdnMap":{"http://www1.c3-net.ne.jp/episteme/images/cppcx_6th/step1.png":null,"http://blogs.wankuma.com/episteme/aggbug/327449.aspx":"https://cdn.jsdelivr.net/gh/myreaderx18/cdn71@2020_4/2020/10/12/21-41-36-710_c6743724dbe6f155.webp"},"publishedOrCreatedDate":1602538772852}],"record":{"createdTime":"2020-10-13 05:39:32","updatedTime":"2020-10-13 05:39:32","feedId":42717,"fetchDate":"Mon, 12 Oct 2020 21:39:32 +0000","fetchMs":1375,"handleMs":8,"totalMs":248141,"newArticles":0,"totalArticles":15,"status":1,"type":0,"ip":"96c330f7a9d7d08f2adfacbb5227a07a","hostName":"europe-25*","requestId":"4b333eef9bca4a67abcb269096b1b5cc_42717","contentType":"text/xml; charset=utf-8","totalBytes":72,"bgimgsTotal":1,"bgimgsGithubTotal":0,"articlesImgsTotal":2,"articlesImgsGithubTotal":1,"successGithubMap":{"myreaderx18":1},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 03:28:31","updatedTime":"2020-09-07 05:45:37","id":42717,"name":"東方算程譚","url":"http://blogs.wankuma.com/episteme/rss.aspx","subscriber":75,"website":null,"icon":"http://blogs.wankuma.com/favicon.ico","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx65/cdn7@2020_2/2020/09/06/21-45-35-292_b6c8dd6c90018ccc.ico","description":"Oriental Code Talk ── επιστημηが与太をこく、弾幕とは無縁のシロモノ。","weekly":null,"link":null},"noPictureArticleList":[{"createdTime":"2020-10-13 05:43:38","updatedTime":"2020-10-13 05:43:38","id":null,"feedId":42717,"linkMd5":"ad167473f05a4eb69bd8fa12961b6b29"}],"tmpCommonImgCdnBytes":0,"tmpBodyImgCdnBytes":72,"tmpBgImgCdnBytes":0,"extra4":{"start":1602538770742,"total":0,"statList":[{"spend":2102,"msg":"获取xml内容"},{"spend":8,"msg":"解释文章"},{"spend":121799,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":123255,"msg":"正文链接上传到cdn"}]},"extra5":2,"extra6":1,"extra7ImgCdnFailResultVector":[null,null,null,null,null,null],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-020.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://us-019.herokuapp.com/":{"failCount":1,"successCount":1,"resultList":[200,null]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"http://blogs.wankuma.com/episteme/aggbug/327449.aspx","sourceStatusCode":200,"destWidth":1,"destHeight":1,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx18/cdn71@2020_4/2020/10/12/21-41-36-710_c6743724dbe6f155.webp","sourceBytes":43,"destBytes":72,"targetWebpQuality":75,"feedId":42717,"totalSpendMs":1760,"convertSpendMs":4,"createdTime":"2020-10-13 05:41:35","host":"us-019*","referer":"http://blogs.wankuma.com/episteme/archive/2013/04/07/327449.aspx","linkMd5ListStr":"ad167473f05a4eb69bd8fa12961b6b29","githubUser":"myreaderx18","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"43 B","destSize":"72 B","compressRate":"167.4%"}],"successGithubMap":{"myreaderx18":1},"failGithubMap":{}}