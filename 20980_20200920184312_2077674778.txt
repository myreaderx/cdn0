{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-09-21 02:38:39","updatedTime":"2020-09-21 02:38:39","title":"Retina 显示屏下 @2x 图片的模拟","link":"http://www.aoao.org.cn/?p=174","description":"<p>前几天在不小心看到传说中Apple在其网站让网页图片支持 Retina Display 的 JS <a href=\"https://gist.github.com/2029936\">image_replacer.js</a> ，结果认真看了一下，代码中比较好玩的地方是用 ☃ 当“变量”，但核心实现却无比坑爹，居然是图片多做一份@2x 的版本，发现是高分屏，就把图片的地址换下。 =。=</p>\n<p>在高分屏下，正常图片一般让人感觉模糊一点，条件允许的情况下，多做份@2x 的图片当然后是效果更好，并不是所有的图片都方便处理成@2x，有没有@2x的版本还不知道呢，程序如果能自动化处理的话，成本自然低了，不过，我还不知道有啥程序算法可以把已经丢了细节的图片还原回去。</p>\n<p>这时我想起了 <a href=\"http://shawphy.com/2011/08/convolution-matrix-in-canvas.html\">在HTML 5 的 Canvas 中应用卷积矩阵对图像处理</a>，我偷拷了他的代码 顺便修改了处理图片边缘跟透明度的部分，做了个<a href=\"http://labs.aoao.org.cn/demo/image@2x\">图片锐化的效果</a>，如果你用电脑看的话，放大一下网页还是勉强可以看出效果，不过没 Retina Display 的设备明显，可以用iPhone 4+ 或者new iPad 试一下，或者看我的截图。<br />\n<img class=\"alignnone size-full wp-image-175\" title=\"用canvas模拟@2x 图片的效果\" src=\"http://www.aoao.org.cn/wp-content/uploads/2012/04/2x.jpg\" alt=\"\" width=\"640\" height=\"960\" srcset=\"http://www.aoao.org.cn/wp-content/uploads/2012/04/2x.jpg 640w, http://www.aoao.org.cn/wp-content/uploads/2012/04/2x-200x300.jpg 200w\" sizes=\"(max-width: 640px) 100vw, 640px\" /></p>\n<p>优点</p>\n<ul>\n<li>大部分图片效果比原来好，不用做@2x 的图片</li>\n<li>多终端统一维护，脚本渐进增强</li>\n<li>文件小省带宽，3G 时还是有一定的优势 用EDGE的就更不用说了。</li>\n</ul>\n<p>缺点</p>\n<ul>\n<li>效果真心没 @2x的好，当然如果有更好的算法也难说</li>\n<li>canvas 读图片数据存在跨域问题 （有所谓的解决方案，见后面）</li>\n<li>锐化目前的实现，基本就是读点的操作，大图片手机估计吃不消</li>\n</ul>\n<p>以上方案纯属研究，如要投入生产还要再三考虑。</p>\n<p>顺便说下 js可以能过 <code>window.devicePixelRatio</code> 来判断 是否为Retina。</p>\n<p><strong>canvas 读取跨域图片数据的解决方案</strong></p>\n<p>当年用的iframe 来解决跨域的方案再次改造实现，挖哈哈。在图片所在的域下放一网页用来读图片数据跟通讯，不过这次是改用 <code>postMessage</code> 来传图片数据。</p>\n<p>这里有份之前实现的代码 <a href=\"https://github.com/aoao/Image64\">github.com/aoao/Image64</a> ，那时是做图片分析时写的，有兴趣的同学可以看一下。如果有更好的方式也介绍给我，我一直觉得这方式太坑爹了，在电脑上用可能还行，在手机上跑可能比较不适合。</p>\n<p>扩展阅读</p>\n<ul>\n<li><a href=\"http://shawphy.github.com/share/2011/matrix.html\">应用卷积矩阵对图片进行模糊、锐化、浮雕等效果体验</a></li>\n<li><a href=\"http://css3.bradshawenterprises.com/blog/retina-image-replacement-for-new-ipad/\">Retina Image Replacement for the New iPad</a></li>\n</ul>\n","descriptionType":"html","publishedDate":"Mon, 02 Apr 2012 06:52:11 +0000","feedId":20980,"bgimg":"http://www.aoao.org.cn/wp-content/uploads/2012/04/2x.jpg","linkMd5":"ccb429427f5374f7d04f2a508f09c962","author":"aoao","articleImgCdnMap":{"http://www.aoao.org.cn/wp-content/uploads/2012/04/2x.jpg":null},"publishedOrCreatedDate":1600627119103}],"record":{"createdTime":"2020-09-21 02:38:39","updatedTime":"2020-09-21 02:38:39","feedId":20980,"fetchDate":"Sun, 20 Sep 2020 18:38:39 +0000","fetchMs":76,"handleMs":181502,"totalMs":454673,"newArticles":0,"totalArticles":20,"status":1,"type":0,"ip":"13ceeb0da42989d3de6751ce913d735f","hostName":"us-021*","requestId":"640c679fe0e54137b85b0135c45fe69a_20980","contentType":"application/rss+xml; charset=UTF-8","totalBytes":0,"bgimgsTotal":1,"bgimgsGithubTotal":0,"articlesImgsTotal":1,"articlesImgsGithubTotal":0,"successGithubMap":{},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 02:23:51","updatedTime":"2020-09-07 04:15:08","id":20980,"name":"样式之美","url":"http://feeds.feedburner.com/aoao","subscriber":158,"website":null,"icon":"http://www.aoao.org.cn/favicon.ico","icon_jsdelivr":null,"description":"没落的角落","weekly":null,"link":"http://www.aoao.org.cn"},"noPictureArticleList":[{"createdTime":"2020-09-21 02:43:12","updatedTime":"2020-09-21 02:43:12","id":null,"feedId":20980,"linkMd5":"ccb429427f5374f7d04f2a508f09c962"}],"tmpCommonImgCdnBytes":0,"tmpBodyImgCdnBytes":0,"tmpBgImgCdnBytes":0,"extra4":{"start":1600626937523,"total":0,"statList":[{"spend":78,"msg":"获取xml内容"},{"spend":181502,"msg":"解释文章"},{"spend":120277,"msg":"正文链接上传到cdn"},{"spend":121530,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"}]},"extra5":1,"extra6":0,"extra7ImgCdnFailResultVector":[null,null,null,null,null,null],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{},"extra12ImgCdnSuccessResultVector":[],"successGithubMap":{},"failGithubMap":{}}