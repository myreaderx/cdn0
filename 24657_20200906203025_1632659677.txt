{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-09-07 04:30:07","updatedTime":"2020-09-07 04:30:07","title":"「プロを目指す人のためのRuby入門」で6.3.3項のサンプルコードがなぜか動いてしまう場合の対処法","link":"https://blog.jnito.com/entry/2020/09/06/150547","description":"<p>このエントリは拙著「プロを目指す人のためのRuby入門（通称・チェリー本）」のサポート記事です。</p><p><div class=\"hatena-asin-detail\"><a href=\"https://www.amazon.co.jp/exec/obidos/ASIN/B077Q8BXHC/junic05-22/\"><img src=\"https://m.media-amazon.com/images/I/51tyOVaM2HL._SL160_.jpg\" class=\"hatena-asin-detail-image\" alt=\"プロを目指す人のためのRuby入門 言語仕様からテスト駆動開発・デバッグ技法まで Software Design plus\" title=\"プロを目指す人のためのRuby入門 言語仕様からテスト駆動開発・デバッグ技法まで Software Design plus\"></a><div class=\"hatena-asin-detail-info\"><p class=\"hatena-asin-detail-title\"><a href=\"https://www.amazon.co.jp/exec/obidos/ASIN/B077Q8BXHC/junic05-22/\">プロを目指す人のためのRuby入門 言語仕様からテスト駆動開発・デバッグ技法まで Software Design plus</a></p><ul><li><span class=\"hatena-asin-detail-label\">作者:</span><a href=\"http://d.hatena.ne.jp/keyword/%B0%CB%C6%A3%20%BD%DF%B0%EC\" class=\"keyword\">伊藤 淳一</a></li><li><span class=\"hatena-asin-detail-label\">発売日:</span> 2017/11/25</li><li><span class=\"hatena-asin-detail-label\">メディア:</span> Kindle版</li></ul></div><div class=\"hatena-asin-detail-foot\"></div></div></p><p>6.3.3項（187〜188ページ）に載っている<a href=\"https://github.com/JunichiIto/ruby-book-codes/blob/master/sample-codes/chapter_06/code_6.03.03.rb\">&#x30B5;&#x30F3;&#x30D7;&#x30EB;&#x30B3;&#x30FC;&#x30C9;</a>をirb上で写経していくと、書籍ではエラーになるはずのコードがエラーにならないケースがあります。</p><p><span itemscope itemtype=\"http://schema.org/Photograph\"><img src=\"https://cdn-ak.f.st-hatena.com/images/fotolife/J/JunichiIto/20200906/20200906144357.png\" alt=\"f:id:JunichiIto:20200906144357p:plain\" title=\"f:id:JunichiIto:20200906144357p:plain\" class=\"hatena-fotolife\" itemprop=\"image\"></span></p><p>これはirb上で連続してコードを打ち込んでいるためです。<br />\n一度irbを再起動させてからエラーになるコードを入力すると、書籍の説明通りエラー（NameError）が発生します。</p><p><span itemscope itemtype=\"http://schema.org/Photograph\"><img src=\"https://cdn-ak.f.st-hatena.com/images/fotolife/J/JunichiIto/20200906/20200906144614.png\" alt=\"f:id:JunichiIto:20200906144614p:plain\" title=\"f:id:JunichiIto:20200906144614p:plain\" class=\"hatena-fotolife\" itemprop=\"image\"></span><br />\n</p>\n\n<div class=\"section\">\n    <h4>もっとくわしく</h4>\n    <p>6.3.3項のサンプルコードをirb上で打ち込むと、次のコードを実行することになります。</p>\n<pre class=\"code lang-ruby\" data-lang=\"ruby\" data-unlink>text = <span class=\"synSpecial\">'</span><span class=\"synConstant\">私の誕生日は1977年7月17日です。</span><span class=\"synSpecial\">'</span>\n<span class=\"synComment\"># キャプチャの名前がそのままローカル変数に割り当てられる</span>\n<span class=\"synStatement\">if</span> <span class=\"synSpecial\">/(?&lt;year&gt;\\d+)</span><span class=\"synConstant\">年</span><span class=\"synSpecial\">(?&lt;month&gt;\\d+)</span><span class=\"synConstant\">月</span><span class=\"synSpecial\">(?&lt;day&gt;\\d+)</span><span class=\"synConstant\">日</span><span class=\"synSpecial\">/</span> =~ text\n  puts <span class=\"synSpecial\">&quot;#{</span>year<span class=\"synSpecial\">}</span><span class=\"synConstant\">/</span><span class=\"synSpecial\">#{</span>month<span class=\"synSpecial\">}</span><span class=\"synConstant\">/</span><span class=\"synSpecial\">#{</span>day<span class=\"synSpecial\">}&quot;</span> <span class=\"synComment\">#=&gt; 1977/7/17</span>\n<span class=\"synStatement\">end</span>\n</pre><p>この時点で<code>year</code>、<code>month</code>、<code>day</code>という3つのローカル変数がirb内に定義されます。</p><p>その次に出てくる以下のサンプルコードは、「正規表現を使ってもローカル変数が作成されない」ということを説明するためのコードです。</p>\n<pre class=\"code lang-ruby\" data-lang=\"ruby\" data-unlink>text = <span class=\"synSpecial\">'</span><span class=\"synConstant\">私の誕生日は1977年7月17日です。</span><span class=\"synSpecial\">'</span>\n<span class=\"synComment\"># 正規表現が右辺に来るとローカル変数が作成されない</span>\n<span class=\"synStatement\">if</span> text =~ <span class=\"synSpecial\">/(?&lt;year&gt;\\d+)</span><span class=\"synConstant\">年</span><span class=\"synSpecial\">(?&lt;month&gt;\\d+)</span><span class=\"synConstant\">月</span><span class=\"synSpecial\">(?&lt;day&gt;\\d+)</span><span class=\"synConstant\">日</span><span class=\"synSpecial\">/</span>\n  puts <span class=\"synSpecial\">&quot;#{</span>year<span class=\"synSpecial\">}</span><span class=\"synConstant\">/</span><span class=\"synSpecial\">#{</span>month<span class=\"synSpecial\">}</span><span class=\"synConstant\">/</span><span class=\"synSpecial\">#{</span>day<span class=\"synSpecial\">}&quot;</span>\n<span class=\"synStatement\">end</span>\n<span class=\"synComment\">#=&gt; NameError: undefined local variable or method `year' for main:Object</span>\n</pre><p>なのですが、1つ前のコードを実行したことにより、すでに<code>year</code>、<code>month</code>、<code>day</code>がローカル変数として定義されてしまっています。<br />\nそのため、本来であれば「<code>year</code>が未定義なのでエラー（NameError）」となるべきところが、エラーにならず普通に実行できてしまうわけです。</p>\n<pre class=\"code lang-ruby\" data-lang=\"ruby\" data-unlink><span class=\"synComment\"># 本当はyearもmonthもdayもないよ！となるはずが、すでに存在するので動いてしまう</span>\nputs <span class=\"synSpecial\">&quot;#{</span>year<span class=\"synSpecial\">}</span><span class=\"synConstant\">/</span><span class=\"synSpecial\">#{</span>month<span class=\"synSpecial\">}</span><span class=\"synConstant\">/</span><span class=\"synSpecial\">#{</span>day<span class=\"synSpecial\">}&quot;</span>\n</pre><p>irbを再起動すればローカル変数はすべてクリアされます。<br />\nですので、再起動した直後に先ほどのコードをもう一度実行すれば、期待どおり「<code>year</code>が未定義なのでエラー（NameError）」になります。</p>\n\n</div>\n<div class=\"section\">\n    <h4>まとめ</h4>\n    <p>この件は<a href=\"https://bootcamp.fjord.jp/\">&#x30D5;&#x30A3;&#x30E8;&#x30EB;&#x30C9;&#x30D6;&#x30FC;&#x30C8;&#x30AD;&#x30E3;&#x30F3;&#x30D7;</a>の生徒さんやSNS上の読者さんで、同じ疑問を持っていた人を見かけたので、今回ブログ記事として説明させてもらいました。<br />\n記述ミスではないとはいえ、初心者さんにとってはたしかにややこしい落とし穴になってしまっているため、改訂版を出す機会があればこの点をひとこと補足しておこうと思います。</p><p><div class=\"hatena-asin-detail\"><a href=\"https://www.amazon.co.jp/exec/obidos/ASIN/B077Q8BXHC/junic05-22/\"><img src=\"https://m.media-amazon.com/images/I/51tyOVaM2HL._SL160_.jpg\" class=\"hatena-asin-detail-image\" alt=\"プロを目指す人のためのRuby入門 言語仕様からテスト駆動開発・デバッグ技法まで Software Design plus\" title=\"プロを目指す人のためのRuby入門 言語仕様からテスト駆動開発・デバッグ技法まで Software Design plus\"></a><div class=\"hatena-asin-detail-info\"><p class=\"hatena-asin-detail-title\"><a href=\"https://www.amazon.co.jp/exec/obidos/ASIN/B077Q8BXHC/junic05-22/\">プロを目指す人のためのRuby入門 言語仕様からテスト駆動開発・デバッグ技法まで Software Design plus</a></p><ul><li><span class=\"hatena-asin-detail-label\">作者:</span><a href=\"http://d.hatena.ne.jp/keyword/%B0%CB%C6%A3%20%BD%DF%B0%EC\" class=\"keyword\">伊藤 淳一</a></li><li><span class=\"hatena-asin-detail-label\">発売日:</span> 2017/11/25</li><li><span class=\"hatena-asin-detail-label\">メディア:</span> Kindle版</li></ul></div><div class=\"hatena-asin-detail-foot\"></div></div></p>\n\n</div>","descriptionType":"html","publishedDate":"Sun, 06 Sep 2020 06:05:47 +0000","feedId":24657,"bgimg":"https://cdn-ak.f.st-hatena.com/images/fotolife/J/JunichiIto/20200824/20200824082608.jpg","linkMd5":"4fb30fddeaaeabb1996f11e404c1ab60","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx21/cdn89@2020_4/2020/09/06/20-30-23-737_e752d37a4d67cb97.webp","destWidth":793,"destHeight":1000,"sourceBytes":102463,"destBytes":54880,"author":"JunichiIto","enclosureType":"image/jpeg","enclosureUrl":"https://cdn-ak.f.st-hatena.com/images/fotolife/J/JunichiIto/20200824/20200824082608.jpg","articleImgCdnMap":{"https://m.media-amazon.com/images/I/51tyOVaM2HL._SL160_.jpg":null,"https://cdn-ak.f.st-hatena.com/images/fotolife/J/JunichiIto/20200906/20200906144357.png":"https://cdn.jsdelivr.net/gh/myreaderx25/cdn100@2020_3/2020/09/06/20-30-07-677_5a53d2bf1821c768.webp","https://cdn-ak.f.st-hatena.com/images/fotolife/J/JunichiIto/20200906/20200906144614.png":"https://cdn.jsdelivr.net/gh/myreaderx22/cdn93@2020_3/2020/09/06/20-30-08-528_cb47bb011d574bd5.webp"},"publishedOrCreatedDate":1599424207405}],"record":{"createdTime":"2020-09-07 04:30:07","updatedTime":"2020-09-07 04:30:07","feedId":24657,"fetchDate":"Sun, 06 Sep 2020 20:30:07 +0000","fetchMs":1738,"handleMs":6447,"totalMs":26107,"newArticles":0,"totalArticles":30,"status":1,"type":0,"ip":"b61367955ce0c617c692299987db8df0","hostName":"europe-60*","requestId":"95594a62b8924dba827c69739f1f9ce9_24657","contentType":"application/atom+xml; charset=utf-8","totalBytes":591802,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":3,"articlesImgsGithubTotal":2,"successGithubMap":{"myreaderx25":1,"myreaderx21":1,"myreaderx22":1},"failGithubMap":{"myreaderx14":1}},"feed":{"createdTime":"2020-09-07 02:33:47","updatedTime":"2020-09-07 02:33:47","id":24657,"name":"give IT a try","url":"http://blog.jnito.com/feed","subscriber":133,"website":null,"icon":"https://blog.jnito.com/favicon.ico","icon_jsdelivr":null,"description":"プログラミング、リモートワーク、田舎暮らし、音楽、etc.","weekly":null,"link":"https://blog.jnito.com"},"noPictureArticleList":[{"createdTime":"2020-09-07 04:30:24","updatedTime":"2020-09-07 04:30:24","id":null,"feedId":24657,"linkMd5":"4fb30fddeaaeabb1996f11e404c1ab60"}],"tmpCommonImgCdnBytes":0,"tmpBodyImgCdnBytes":591802,"tmpBgImgCdnBytes":0,"extra4":{"start":1599424198807,"total":0,"statList":[{"spend":2151,"msg":"获取xml内容"},{"spend":6447,"msg":"解释文章"},{"spend":2317,"msg":"正文链接上传到cdn"},{"spend":17508,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"}]},"extra5":3,"extra6":3,"extra7ImgCdnFailResultVector":[{"code":1,"isDone":false,"source":"https://m.media-amazon.com/images/I/51tyOVaM2HL._SL160_.jpg","sourceStatusCode":200,"destWidth":126,"destHeight":160,"sourceBytes":5828,"destBytes":4642,"targetWebpQuality":75,"feedId":24657,"totalSpendMs":294,"convertSpendMs":4,"createdTime":"2020-09-07 04:30:07","host":"europe-56*","referer":"https://blog.jnito.com/entry/2020/09/06/150547","linkMd5ListStr":"4fb30fddeaaeabb1996f11e404c1ab60,4fb30fddeaaeabb1996f11e404c1ab60","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx14/cdn98/contents/2020/09/06/20-30-07-572_b91ab74b760d0d84.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 68584859.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Sun, 06 Sep 2020 20:30:07 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"status":["403 Forbidden"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["C1B6:5DBD:E7B9371:11775133:5F5546CA"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, read:packages, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1599426441"],"x-ratelimit-used":["61"],"x-xss-protection":["1; mode=block"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx14/cdn98/contents/2020/09/06/20-30-07-572_b91ab74b760d0d84.webp","historyStatusCode":[],"spendMs":148},"base64UserPassword":null,"token":"6b67d******************************91b08"},"githubUser":"myreaderx14","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"destSize":"4.5 KB","compressRate":"79.6%","sourceSize":"5.7 KB"},{"code":1,"isDone":false,"source":"https://m.media-amazon.com/images/I/51tyOVaM2HL._SL160_.jpg","sourceStatusCode":200,"destWidth":126,"destHeight":160,"sourceBytes":5828,"destBytes":4642,"targetWebpQuality":75,"feedId":24657,"totalSpendMs":212,"convertSpendMs":3,"createdTime":"2020-09-07 04:30:07","host":"europe-56*","referer":"https://blog.jnito.com/entry/2020/09/06/150547","linkMd5ListStr":"4fb30fddeaaeabb1996f11e404c1ab60,4fb30fddeaaeabb1996f11e404c1ab60","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx14/cdn98/contents/2020/09/06/20-30-07-790_b91ab74b760d0d84.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 68584859.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Sun, 06 Sep 2020 20:30:07 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"status":["403 Forbidden"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["C1B6:5DBD:E7B93A5:1177575C:5F5546CF"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, read:packages, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1599426441"],"x-ratelimit-used":["61"],"x-xss-protection":["1; mode=block"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx14/cdn98/contents/2020/09/06/20-30-07-790_b91ab74b760d0d84.webp","historyStatusCode":[],"spendMs":152},"base64UserPassword":null,"token":"6b67d******************************91b08"},"githubUser":"myreaderx14","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"destSize":"4.5 KB","compressRate":"79.6%","sourceSize":"5.7 KB"}],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://cdn-ak.f.st-hatena.com/images/fotolife/J/JunichiIto/20200906/20200906144357.png","sourceStatusCode":200,"destWidth":1200,"destHeight":672,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx25/cdn100@2020_3/2020/09/06/20-30-07-677_5a53d2bf1821c768.webp","sourceBytes":554102,"destBytes":251524,"targetWebpQuality":75,"feedId":24657,"totalSpendMs":1859,"convertSpendMs":79,"createdTime":"2020-09-07 04:30:07","host":"europe-57*","referer":"https://blog.jnito.com/entry/2020/09/06/150547","linkMd5ListStr":"4fb30fddeaaeabb1996f11e404c1ab60","githubUser":"myreaderx25","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"destSize":"245.6 KB","compressRate":"45.4%","sourceSize":"541.1 KB"},{"code":1,"isDone":false,"source":"https://cdn-ak.f.st-hatena.com/images/fotolife/J/JunichiIto/20200906/20200906144614.png","sourceStatusCode":200,"destWidth":1200,"destHeight":679,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx22/cdn93@2020_3/2020/09/06/20-30-08-528_cb47bb011d574bd5.webp","sourceBytes":672419,"destBytes":340278,"targetWebpQuality":75,"feedId":24657,"totalSpendMs":2130,"convertSpendMs":149,"createdTime":"2020-09-07 04:30:07","host":"us-007*","referer":"https://blog.jnito.com/entry/2020/09/06/150547","linkMd5ListStr":"4fb30fddeaaeabb1996f11e404c1ab60","githubUser":"myreaderx22","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"destSize":"332.3 KB","compressRate":"50.6%","sourceSize":"656.7 KB"},{"code":1,"isDone":false,"source":"https://cdn-ak.f.st-hatena.com/images/fotolife/J/JunichiIto/20200824/20200824082608.jpg","sourceStatusCode":200,"destWidth":793,"destHeight":1000,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx21/cdn89@2020_4/2020/09/06/20-30-23-737_e752d37a4d67cb97.webp","sourceBytes":102463,"destBytes":54880,"targetWebpQuality":75,"feedId":24657,"totalSpendMs":1037,"convertSpendMs":32,"createdTime":"2020-09-07 04:30:23","host":"us-019*","referer":"https://blog.jnito.com/entry/2020/09/06/150547","linkMd5ListStr":"4fb30fddeaaeabb1996f11e404c1ab60","githubUser":"myreaderx21","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"destSize":"53.6 KB","compressRate":"53.6%","sourceSize":"100.1 KB"}],"successGithubMap":{"myreaderx25":1,"myreaderx21":1,"myreaderx22":1},"failGithubMap":{"myreaderx14":1}}