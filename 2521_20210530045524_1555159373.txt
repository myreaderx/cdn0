{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2021-05-30 12:53:07","updatedTime":"2021-05-30 12:53:07","title":"扔掉源码，15张图带你彻底理解Java AQS","link":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","description":"<div><div><div id=\"media\" class=\"rich_media_thumb_wrp\">\n\n            <img class=\"rich_media_thumb\" src=\"http://content.sov5.cn/mmbiz_jpg/eZzl4LXykQwtM2UVvtuReIibpibu6wHF49ljTo3ictg1q8ib69vNvZrgKicgibATNDhhSia5jzQvA3svfl88nic8U82Zfw?imageView2/1/w/600\">\n        </div>\n    \n\n    \n\n    <div class=\"rich_media_content\" id=\"js_content\">\n                    \n\n                    \n                    \n                    \n                    <p style=\"white-space: normal;\"><span style=\"color: rgb(171, 25, 66);\"><strong><span style=\"font-size: 15px;text-align: left;\"></span></strong></span></p><p style=\"text-align: left;\"><span style=\"text-align: left;font-size: 15px;\">J</span><span style=\"text-align: left;font-size: 15px;\">ava 中 AQS </span><span style=\"text-align: left;font-size: 15px;\">是 </span><span style=\"text-align: left;font-size: 15px;\">AbstractQueuedSynchronizer </span><span style=\"text-align: left;font-size: 15px;\">类</span><span style=\"text-align: left;font-size: 15px;\">。</span><span style=\"text-align: left;font-size: 15px;\">AQS 依赖 </span><span style=\"text-align: left;font-size: 15px;\">FIFO 队列来提供一个框架</span><span style=\"text-align: left;font-size: 15px;\">。</span><span style=\"text-align: left;font-size: 15px;\">这个框架用于实现锁以及锁相关的同步器，比如信号量、事件等</span><span style=\"text-align: left;font-size: 15px;\">。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>在 AQS 中，主要有两部分功能：一部分是操作 state 变量，第二部分是实现排队和阻塞机制。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify rgb>注意：AQS并没有实现任何同步接口，它只是提供了类似acquireInterruptible的方法，调用这些方法可以实现锁和同步器。</span></p><h2 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></h2><h2 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><span style=\"color: rgb(171, 25, 66);\"><strong><span style=\"color: rgb(171, 25, 66);font-size: 15px;text-align: left;\">1 管程模型</span></strong></span></h2><p style=\"text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>Java 使用 MESA 管程模型来管理类的成员变量和方法，让这个类的成员变量和方法的操作是线程安全的。下图是 MESA 管程模型，里面除了定义共享变量外，还定义了条件变量和条件变量等待队列：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif center normal rgb flex column border-box break-word><img data-ratio=\"0.8402203856749312\" data-type=\"png\" data-w=\"726\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeCNuwFLibqBVaWgoQjJODKp63wI1ryKF0T0NX4NGVoD6Og6jNgrTtd4g/640?wx_fmt=png\"><span style=\"color: rgb(136, 136, 136);font-size: 12px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif>MESA 管程模型</span></figure><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>Java 中 的 MESA 模型有一点改进，就是管程内部只有一个条件变量和一个等待队列。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>下图是 AQS 的管程模型：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.732620320855615\" data-type=\"png\" data-w=\"748\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeFm6YgXzRL95wZq0txSUU5PF4hspicJBvoCWh75wE1q9qaF5hvrYibpLA/640?wx_fmt=png\"><span style=\"color: rgb(136, 136, 136);font-size: 12px;text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif>AQS 的管程模型</span></figure><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>AQS 的管程模型依赖 AQS 中的 FIFO 队列实现入口等待队列，而 ConditionObject 则实现了条件队列，这个队列可以创建多个。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>本文主要讲解入口等待队列获取锁的几种方式。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><h2 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><span style=\"color: rgb(171, 25, 66);\"><strong><span style=\"color: rgb(171, 25, 66);font-size: 15px;text-align: left;\">2 获取独占锁</span></strong></span></h2><p style=\"text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><h3 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><span style=\"color: rgb(171, 25, 66);\"><strong><span style=\"color: rgb(171, 25, 66);font-size: 15px;text-align: left;\">2.1 独占，忽略 interrupts</span></strong></span></h3><p><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><section class=\"code-snippet__fix code-snippet__js\"><ul class=\"code-snippet__line-index code-snippet__js\"><li><li><li><li><li></ul><pre class=\"code-snippet__js\" data-lang=\"java\"><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__function\"><span class=\"code-snippet__keyword\">public</span> <span class=\"code-snippet__keyword\">final</span> <span class=\"code-snippet__keyword\">void</span> <span class=\"code-snippet__title\">acquire</span><span class=\"code-snippet__params\">(<span class=\"code-snippet__keyword\">int</span> arg)</span> </span>{</span></code><code><span class=\"code-snippet_outer\">    <span class=\"code-snippet__keyword\">if</span> (!tryAcquire(arg) &amp;&amp;</span></code><code><span class=\"code-snippet_outer\">        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span></code><code><span class=\"code-snippet_outer\">        selfInterrupt();</span></code><code><span class=\"code-snippet_outer\">}</span></code></pre></section><p style=\"text-align: left;\"><br><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify rgb>这里的 tryAcquire 是抽象方法，有 AQS 的子类来实现，因为每个子类实现的锁是不一样的。</span></p><h4 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></h4><h4 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>入队</span></strong></h4><p style=\"text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>上面的代码可以看到，获取锁失败后，会先执行 addWaiter 方法加入队列，然后执行 acquireQueued 方法自旋地获取锁直到成功。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>addWaiter 代码逻辑如下图。简单说就是把 node 入队，入队后返回 node 参数给 acquireQueued 方法：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.4102296450939457\" data-type=\"png\" data-w=\"958\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeDSWtpz0MdfNQibs7xlBcxW2oYDyER6aUST5mbicMcVT4KsEvPMnCPReg/640?wx_fmt=png\"><span style=\"color: rgb(136, 136, 136);font-size: 12px;text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif>addWaiter 代码逻辑</span></figure><p style=\"white-space: normal;text-align: left;\"><br></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify rgb>这里需要注意：如果队列为空，则新建一个 Node 作为队头。</span></p><h4 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></h4><h4 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>入队后获取锁</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></h4><p style=\"text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>acquireQueued自旋获取锁逻辑如下图：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"1.0665322580645162\" data-type=\"png\" data-w=\"496\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXe08PkpibWuf59Z6KcyZKzCzzoQqy4JBhNYC1zjOVeScvduAVM33rqyog/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><span style=\"color: rgb(136, 136, 136);font-size: 12px;\">acquireQueued 自旋获取锁逻辑</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>这里有几个细节：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>1. waitStatus</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"white-space: normal;text-align: left;\"><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>CANCELLED(1)：当前节点取消获取锁。当等待超时或被中断（响应中断），会触发变更为此状态，进入该状态后节点状态不再变化；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>SIGNAL(-1)：后面节点等待当前节点唤醒；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>CONDITION(-2)：Condition 中使用，当前线程阻塞在 Condition。如果其他线程调用了 Condition 的 signal 方法，这个结点将从等待队列转移到同步队列队尾，等待获取同步锁；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>PROPAGATE(-3)：共享模式，前置节点唤醒后面节点后，唤醒操作无条件传播下去；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>0：中间状态，当前节点后面的节点已经唤醒，但是当前节点线程还没有执行完成。</span></section></li></ul><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>2. 获取锁失败后挂起</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>如果前置节点不是头节点，或者前置节点是头节点但当前节点获取锁失败，这时当前节点需要挂起，分三种情况：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.33858267716535434\" data-type=\"png\" data-w=\"508\" style=\"white-space: normal; text-align: left; width: 470px; height: 159px; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeCnfNRfZToicIsJ1WDibGNF82YPpsEgCgnl91TUDDsysoPbibRRd0LI2yg/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><span style=\"font-size: 12px;color: rgb(136, 136, 136);\">前置节点 waitStatus=-1</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.6522491349480969\" data-type=\"png\" style=\"white-space: normal;text-align: left;width: 507px;height: 331px;\" data-w=\"\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeKOXD2ocbMESn4ibp0o905TX197Cp96LTkmwdXDxY6ceWjx6RqLLXLsQ/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><span style=\"font-size: 12px;color: rgb(136, 136, 136);\">前置节点 waitStatus &gt; 0</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.5515370705244123\" data-type=\"png\" data-w=\"553\" style=\"white-space: normal; text-align: left; width: 424px; height: 234px; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeU4FWdBqDgibpdUOia6Kibsibbs9GZC8tYXVvs1CSmbDXyg4EG9lqKsNcibQ/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify rgb>前置节点 waitStatus &lt; 0，不等于 -1</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>3. 取消获取锁</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>如果获取锁抛出异常，则取消获取锁，如果当前节点是 tail 节点，分两种情况如下图：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"1.2297939778129952\" data-type=\"png\" data-w=\"631\" style=\"white-space: normal; text-align: left; width: 500px; height: 615px; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeVWIKKXJfZzfwdASAF7oic34js8z9AgGmMWzdyFbUoQrXcicDniccSNUHA/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>如果当前节点不是 tail 节点，也分两种情况，如下图：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"1.0211081794195251\" data-type=\"png\" data-w=\"758\" style=\"white-space: normal; text-align: left; width: 500px; height: 511px; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeVwHFETwXIketpF5W80Z0icdlKZaayhJ7A8G5z1ckk4GI8ubmvSGFwyQ/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>4. 对中断状态忽略</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>5. 如果前置节点的状态是 0 或 PROPAGATE，会被当前节点自旋过程中更新成 -1，以便之后通知当前节点。</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></p><h3 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></h3><h3 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><span style=\"color: rgb(171, 25, 66);\"><strong><span style=\"color: rgb(171, 25, 66);font-size: 15px;text-align: left;\">2.2 独占 + 响应中断</span></strong></span></h3><p style=\"text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>对应方法 acquireInterruptibly(int arg)。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>跟忽略中断（acquire 方法）不同的是要响应中断，下面两个地方响应中断：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"white-space: normal;text-align: left;\"><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>获取锁之前会检查当前线程是否中断；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>获取锁失败入队，在队列中自旋获取锁的过程中也会检查当前线程是否中断。</span></section></li></ul><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>如果检查到当前线程已经中断，则抛出 InterruptedException，当前线程退出。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><h3 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><span style=\"color: rgb(171, 25, 66);\"><strong><span style=\"color: rgb(171, 25, 66);font-size: 15px;text-align: left;\">2.3 独占 + 响应中断 + 考虑超时</span></strong></span></h3><p style=\"text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>对应方法 tryAcquireNanos(int arg, long nanosTimeout)。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>这个方法具备了<strong>独占 + 响应中断 + 超时</strong>的功能，下面两个地方要判断是否超时：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"white-space: normal;text-align: left;\"><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>自旋获取锁的过程中每次获取锁失败都要判断是否超时；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>获取锁失败 park 之前要判断超时时间是否大于自旋的阈值时间 (spinForTimeoutThreshold = 1ns)。</span></section></li></ul><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>另外，park 线程的操作使用 parkNanos 传入阻塞时间。</span></p><p data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><br></p><h2 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><span style=\"color: rgb(171, 25, 66);\"><strong><span style=\"color: rgb(171, 25, 66);font-size: 15px;text-align: left;\">3 释放独占锁</span></strong></span></h2><p style=\"text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>独占锁释放分两步：释放锁，唤醒后继节点。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\"><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\">释放锁的方法 tryReleas</span><span style=\"font-size: 15px;text-align: justify;\">e 是抽象的，由子类去实现。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>我们看一下唤醒后继节点的逻辑。首先需要满足两个条件：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"white-space: normal;text-align: left;\"><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>head 节点不等于 null；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>head 节点 waitStatus 不等于 0。</span></section></li></ul><section style=\"white-space: normal;text-align: left;\"><br></section><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>这里有两种情况（在方法 unparkSuccessor）：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"white-space: normal;text-align: left;\"><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>情况一：后继节点 waitStatus &lt;= 0，直接唤醒后继节点，如下图：</span></section></li></ul><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.9932432432432432\" data-type=\"png\" data-w=\"296\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXesrUvyFSl60lk88npvEaickeDxyTq2eI0S1V7hM4U6YeAhe5CWTHMJuA/640?wx_fmt=png\"></figure><p><span style=\"font-size: 15px;\"></span></p><p style=\"text-align: center;\"><span style=\"font-size: 12px;color: rgb(136, 136, 136);\">后继节点 waitStatus &lt;= 0</span></p><p style=\"text-align: center;\"><br></p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"white-space: normal;text-align: left;\"><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>情况二：后继节点为空或者 waitStatus &gt; 0，从后往前查找最接近当前节点的节点进行唤醒，如下图：</span></section></li></ul><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.846820809248555\" data-type=\"png\" data-w=\"346\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXekgIRCXbTlL0LBcx8ic8H5ZdFsffjFsfgZRdpt6iaWPycXgMPPs6tRt5g/640?wx_fmt=png\"><span style=\"color: rgb(136, 136, 136);font-size: 12px;text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif>后继节点为空或 waitStatus &gt; 0</span></figure><h2 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></h2><h2 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><span style=\"color: rgb(171, 25, 66);\"><strong><span style=\"color: rgb(171, 25, 66);font-size: 15px;text-align: left;\">4 获取共享锁</span></strong></span></h2><p style=\"text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>之前我们讲了独占锁，这一小节我们谈共享锁。二者有什么不同呢？</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><h3 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><span style=\"color: rgb(171, 25, 66);\"><strong><span style=\"color: rgb(171, 25, 66);font-size: 15px;text-align: left;\">4.1 共享，忽略 interrupts</span></strong></span></h3><p style=\"text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>对应方法 acquireShared，代码如下：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><section class=\"code-snippet__fix code-snippet__js\"><ul class=\"code-snippet__line-index code-snippet__js\"><li><li><li><li></ul><pre class=\"code-snippet__js\" data-lang=\"java\"><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__function\"><span class=\"code-snippet__keyword\">public</span> <span class=\"code-snippet__keyword\">final</span> <span class=\"code-snippet__keyword\">void</span> <span class=\"code-snippet__title\">acquireShared</span><span class=\"code-snippet__params\">(<span class=\"code-snippet__keyword\">int</span> arg)</span> </span>{</span></code><code><span class=\"code-snippet_outer\">    <span class=\"code-snippet__keyword\">if</span> (tryAcquireShared(arg) &lt; <span class=\"code-snippet__number\">0</span>)</span></code><code><span class=\"code-snippet_outer\">        doAcquireShared(arg);</span></code><code><span class=\"code-snippet_outer\">}</span></code></pre></section><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></p><h4 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><br></h4><h4 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><span style=\"color: rgb(171, 25, 66);\"><strong><span style=\"color: rgb(171, 25, 66);font-size: 15px;text-align: left;\">4.2 tryAcquireShared</span></strong></span></h4><p style=\"text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>这里获取锁使用的方法是 tryAcquireShared，获取的是共享锁。获取共享锁跟获取独占锁不同的是，会返回一个整数值，说明如下:</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"white-space: normal;text-align: left;\"><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>返回负数：获取锁失败；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>返回0：获取锁成功但是之后再由线程来获取共享锁时就会失败；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>返回正数:获取锁成功而且之后再有线程来获取共享锁时也可能会成功。所以需要把唤醒操作传播下去。</span></section></li></ul><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>tryAcquireShared 获取锁失败后(返回负数)，就需要入队后自旋获取，也就是执行方法 doAcquireShared。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><h4 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><span style=\"color: rgb(171, 25, 66);\"><strong><span style=\"color: rgb(171, 25, 66);font-size: 15px;text-align: left;\">4.3 doAcquireShared</span></strong></span></h4><p style=\"text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify rgb>怎么判断队列中等待节点是在等待共享锁呢？nextWaiter == SHARED，这个参数值是入队新建节点的时候构造函数传入的。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>自旋过程中，如果获取锁成功（返回正数），首先把自己设置成新的 head 节点，然后把通知传播下去。如下图：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.9353932584269663\" data-type=\"png\" data-w=\"356\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeoLL2RuAnlQvOiaicVJ4opf1yGT0kJXwsfmDX56P2yQoEvXHE0Elxdnfg/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><span style=\"color: rgb(136, 136, 136);font-size: 12px;\">自旋过程中获取锁成功</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>之后会唤醒后面节点并保证唤醒操作可以传播下去。但是需要满足四个条件中的一个：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"white-space: normal;text-align: left;\"><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>tryAcquireShared 返回值大于 0，有多余的锁，可以继续唤醒后继节点；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>旧的 head 节点 waitStatus &lt; 0，应该是其他线程释放共享锁过程中把它的状态更新成了 -3；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>新的 head 节点 waitStatus &lt; 0，只要不是 tail 节点，就可能是 -1。</span><span style=\"font-size: 15px;text-align: justify;color: rgb(136, 136, 136);\">这里会造成不必要的唤醒，因为唤醒后获取不到锁只能继续入队等待</span><span style=\"font-size: 15px;text-align: justify;color: rgb(154, 154, 154);\">；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>当前节点的后继节点是空或者非空但正在等待共享锁。</span></section></li></ul><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>唤醒后面节点的操作，其实就是释放共享锁，对应方法是 doReleaseShared，见释放共享锁一节。</span></p><h4 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></h4><h4 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><span style=\"color: rgb(171, 25, 66);\"><strong><span style=\"color: rgb(171, 25, 66);font-size: 15px;text-align: left;\">4.4 共享 + 响应中断</span></strong></span></h4><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>对应方法acquireSharedInterruptibly(int arg)。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>跟共享忽略中断（acquireShared 方法）不同的是要响应中断，下面两个地方响应中断：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"white-space: normal;text-align: left;\"><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>获取锁之前会检查当前线程是否中断。</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>获取锁失败入队，在队列中自旋获取锁的过程中也会检查当前线程是否中断。</span></section></li></ul><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>如果检查到当前线程已经中断，则抛出InterruptedException，当前线程退出。</span></p><h4 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></h4><h4 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><span style=\"color: rgb(171, 25, 66);\"><strong><span style=\"color: rgb(171, 25, 66);font-size: 15px;text-align: left;\">4.5 共享 + 响应中断 + 考虑超时</span></strong></span></h4><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>对应方法tryAcquireSharedNanos(int arg, long nanosTimeout)。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>这个方法具备了共享 + 响应中断 + 超时的功能，下面两个个地方要判断是否超时：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"white-space: normal;text-align: left;\"><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>自旋获取锁的过程中每次获取锁失败都要判断是否超时；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>获取锁失败 park 之前要判断超时时间是否大于自旋的阈值时间 spinForTimeoutThreshold = 1ns。</span></section></li></ul><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>另外，park 线程的操作使用 parkNanos 传入阻塞时间。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><h2 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><span style=\"color: rgb(171, 25, 66);\"><strong><span style=\"color: rgb(171, 25, 66);font-size: 15px;text-align: left;\">5 释放共享锁</span></strong></span></h2><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>释放共享锁代码如下：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><section class=\"code-snippet__fix code-snippet__js\"><ul class=\"code-snippet__line-index code-snippet__js\"><li><li><li><li><li><li><li></ul><pre class=\"code-snippet__js\" data-lang=\"java\"><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__function\"><span class=\"code-snippet__keyword\">public</span> <span class=\"code-snippet__keyword\">final</span> <span class=\"code-snippet__keyword\">boolean</span> <span class=\"code-snippet__title\">releaseShared</span><span class=\"code-snippet__params\">(<span class=\"code-snippet__keyword\">int</span> arg)</span> </span>{</span></code><code><span class=\"code-snippet_outer\">    <span class=\"code-snippet__keyword\">if</span> (tryReleaseShared(arg)) {</span></code><code><span class=\"code-snippet_outer\">        doReleaseShared();</span></code><code><span class=\"code-snippet_outer\">        <span class=\"code-snippet__keyword\">return</span> <span class=\"code-snippet__keyword\">true</span>;</span></code><code><span class=\"code-snippet_outer\">    }</span></code><code><span class=\"code-snippet_outer\">    <span class=\"code-snippet__keyword\">return</span> <span class=\"code-snippet__keyword\">false</span>;</span></code><code><span class=\"code-snippet_outer\">}</span></code></pre></section><pre data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><p><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></p><p><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p></pre><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>首先，尝试释放共享锁。tryReleaseShared 代码由子类来实现。释放成功后执行 AQS 中的 doReleaseShared 方法，是一个自旋操作。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>自旋的条件是队列中至少有两个节点，这里分三种情况。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>情况一</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></p><p data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><br></p><p style=\"text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>当前节点 waitStatus 是 -1，如下图：</span></p><p><br></p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.6193078324225865\" data-type=\"png\" data-w=\"549\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeIu5wTSZrr7dRgf1l0rRvOVPpQicbl7T9ibalSljrJTKZ4YB1VricNcteg/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><span style=\"color: rgb(136, 136, 136);font-size: 12px;\">当前节点 waitStatus 是 -1</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>情况二</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></p><p data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><br></p><p style=\"text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>当前节点 waitStatus 是 0（被其他线程更新成了中间状态)，如下图：</span></p><p><br></p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.6355353075170843\" data-type=\"png\" data-w=\"439\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXe6tc1PlvLibUmM9DtTcHVErrHK6Nc6f782Kl5ajCr3NvMNpk717xDaHg/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><span style=\"color: rgb(136, 136, 136);font-size: 12px;\">当前节点 waitStatus 是 0</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>情况三</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></p><p data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><br></p><p style=\"text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>当前节点 waitStatus 是 -3，为什么会这样呢？</span></p><p style=\"text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>需要解释一下，head 节点唤醒后继节点之前 waitStatus 已经被更新中间态 0 了，唤醒后继节点动作还没有执行，又被其他线程更成了 -3.</span></p><p style=\"text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>也就是其他线程释放锁执行了上面情况二。这时需要先把 waitStatus 再更成 0（在方法 unparkSuccessor），如下图：</span></p><p><br></p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.8227513227513228\" data-type=\"png\" data-w=\"378\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeia8EKh3hzq9fPtSUOe4ibFvKQTkYx0f1HaicTPKHDOR4UXpKMvfJqox8Q/640?wx_fmt=png\"></figure><h2 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify rgb>先把 waitStatus 再更成 0</span></h2><h2 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></h2><h2 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><span style=\"color: rgb(171, 25, 66);\"><strong><span style=\"color: rgb(171, 25, 66);font-size: 15px;text-align: left;\">6 抽象方法</span></strong></span></h2><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>上面的讲解可以看出，如果要基于 AQS 来实现并发锁，可以根据需求重写下面四个方法来实现，这四个方法在 AQS 中没有具体实现：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"white-space: normal;text-align: left;\"><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>tryAcquire(int arg)：获取独占锁</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>tryRelease(int arg)：释放独占锁</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>tryAcquireShared(int arg)：获取共享锁</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>tryReleaseShared(int arg)：释放共享锁 </span></section></li></ul><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>AQS 的子类需要重写上面的方法来修改 state 值，并且定义获取锁或者释放锁时 state值的变化。子类也可以定义自己的 state 变量，但只有更新 AQS 中的 state 变量才会对同步起作用。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>还有一个判断当前线程是否持有独占锁的方法 isHeldExclusively，也可以供子类重写后使用。</span></p><h2 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></h2><h2 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><span style=\"color: rgb(171, 25, 66);\"><strong><span style=\"color: rgb(171, 25, 66);font-size: 15px;text-align: left;\">总结</span></strong></span></h2><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>AQS 使用 FIFO 队列实现了一个锁相关的并发器模板，可以基于这个模板来实现各种锁，包括独占锁、共享锁、信号量等。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>AQS 中有一个核心状态是 waitStatus，这个代表节点的状态，决定了当前节点的后续操作，比如是否等待唤醒，是否要唤醒后继节点。</span></p><p style=\"white-space: normal;\"><span style=\"font-size: 15px;\"></span></p><p style=\"white-space: normal;text-align: center;\"><br></p><p style=\"white-space: normal;text-align: center;\"><span style=\"font-size: 15px;color: rgb(136, 136, 136);\">- EOF -</span></p><section donone=\"shifuMouseDownCard('shifu_c_030')\" label=\"Copyright Reserved by PLAYHUDONG.\" style=\"margin-top: 1em;margin-bottom: 1em;white-space: normal;text-align: start;max-width: 100%;caret-color: rgb(0, 0, 0);color: rgb(0, 0, 0);border-width: 0px;border-style: initial;border-color: initial;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-left: 1em;max-width: 100%;line-height: 1.4;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"padding: 3px 8px;max-width: 100%;border-radius: 4px;color: rgb(255, 255, 255);background-color: rgb(255, 105, 31);font-family: inherit;text-align: inherit;text-decoration: inherit;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">推荐阅读</span>  <span style=\"margin-left: 4px;padding: 3px 8px;max-width: 100%;border-radius: 1.2em;color: rgb(255, 255, 255);line-height: 1.2;background-color: rgb(204, 204, 204);font-family: inherit;text-align: inherit;text-decoration: inherit;border-color: rgb(249, 110, 87);font-size: 12px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">点击标题可跳转</span></section><section style=\"margin-top: -11px;padding: 22px 16px 16px;max-width: 100%;border-width: 1px;border-style: solid;border-color: rgb(255, 105, 31);color: rgb(51, 51, 51);font-size: 1em;font-family: inherit;text-align: inherit;text-decoration: inherit;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><p style=\"max-width: 100%;min-height: 1em;line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"text-decoration: underline;font-size: 13px;\">1、<a target=\"_blank\" href=\"http://mp.weixin.qq.com/s?__biz=MjM5NzMyMjAwMA==&amp;mid=2651484834&amp;idx=1&amp;sn=f430f45a58e1173a4cb5d9cdb5823a1a&amp;chksm=bd251edd8a5297cbcfdd7dac3a0678bd06995083b9970a803a862fd78fa29f07be7eca7feabd&amp;scene=21#wechat_redirect\" data-itemshowtype=\"11\" tab=\"innerlink\" data-linktype=\"2\">Java 并发之 AQS 详解</a></span></p><p style=\"max-width: 100%;min-height: 1em;line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"text-decoration: underline;font-size: 13px;\">2、<a target=\"_blank\" href=\"http://mp.weixin.qq.com/s?__biz=MjM5NzMyMjAwMA==&amp;mid=2651478398&amp;idx=1&amp;sn=39d74bce59865d8ab5645940842ecd24&amp;chksm=bd2535018a52bc177dabdc88cf587da6e15ed62965e4feb850b271c808e4f30a3ea390c169e2&amp;scene=21#wechat_redirect\" data-itemshowtype=\"0\" tab=\"innerlink\" data-linktype=\"2\">扒一扒 ReentrantLock 以及 AQS 实现原理</a></span></p><p style=\"max-width: 100%;min-height: 1em;line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"text-decoration: underline;font-size: 13px;\">3、<a target=\"_blank\" href=\"http://mp.weixin.qq.com/s?__biz=MjM5NzMyMjAwMA==&amp;mid=2651478991&amp;idx=2&amp;sn=7449d4949d5dd4cf4a66bd97a2ce2754&amp;chksm=bd2537b08a52bea69835ea07c4b04c35b3dd72c84ed96f33790b446337006bfee88d94e1a571&amp;scene=21#wechat_redirect\" data-itemshowtype=\"0\" tab=\"innerlink\" data-linktype=\"2\">JAVA REENTRANTLOCK、SEMAPHORE 的实现与 AQS 框架</a></span></p></section></section><p style=\"white-space: normal;caret-color: rgb(0, 0, 0);color: rgb(0, 0, 0);text-align: start;max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><br></p><p style=\"white-space: normal;text-align: center;\"><span style=\"max-width: 100%;font-size: 14px;color: rgb(255, 169, 0);box-sizing: border-box !important;overflow-wrap: break-word !important;\">看完本文有收获？请转发分享给更多人</span><br></p><p style=\"white-space: normal;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><strong style=\"max-width: 100%;color: rgb(255, 169, 0);box-sizing: border-box !important;overflow-wrap: break-word !important;\">关注「ImportNew」，提升Java技能</strong></p><p style=\"white-space: normal;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><img data-ratio=\"0.9166666666666666\" data-s=\"300,640\" data-type=\"jpeg\" data-w=\"600\" style=\"box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 600px !important; max-width: 600px\" width=\"auto\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/2A8tXicCG8ylbWIGfdoDED35IRRySQZTXUkJ1eop9MHApzFibKnOo0diboXpl0rmS5mH78YJhsWQv0dhv718A6kUA/640?wx_fmt=jpeg\"></p><p style=\"white-space: normal;text-align: right;\"><span style=\"font-size: 14px;\"></span><span style=\"max-width: 100%;font-family: -apple-system-font, system-ui, \" helvetica neue sc sans gb yahei ui arial sans-serif center break-word border-box>点赞和在看就是最大的支持</span><span style=\"max-width: 100%;font-family: -apple-system-font, system-ui, \" helvetica neue sc sans gb yahei ui arial sans-serif center break-word border-box>❤️</span></p>\n                </div>\n\n    \n    <br>\n\n    \n        <a target=\"_blank\" href=\"http://mp.weixin.qq.com/s?__biz=MjM5NzMyMjAwMA==&amp;mid=2651495685&amp;idx=1&amp;sn=a5fe76d8d94326b083a24cc2d3d0200b&amp;chksm=bd25f17a8a52786c40635e0318cf27804ac551dc14e04a857fa52071a61e830fe9268adf37b4&amp;scene=0#rd\" style=\"color: blue\" class=\"media_tool_meta meta_primary\">原文</a>\n        <br>\n    \n\n    \n\n    <img alt=\"\" width=\"1px\" height=\"1px\" class=\"\" style=\"width:1px;height:1px;display:none\" src=\"http://www.jintiankansha.me/rss_static/11757/jWDcpubME4\"></div></div>","descriptionType":"html","publishedDate":"Thu, 27 May 2021 03:30:00 +0000","feedId":2521,"bgimg":"http://content.sov5.cn/mmbiz_jpg/eZzl4LXykQwtM2UVvtuReIibpibu6wHF49ljTo3ictg1q8ib69vNvZrgKicgibATNDhhSia5jzQvA3svfl88nic8U82Zfw?imageView2/1/w/600","linkMd5":"268f55317afc97b3f6f4254fc79426e2","destWidth":600,"destHeight":545,"sourceBytes":6304,"destBytes":4272,"author":"","articleImgCdnMap":{"http://content.sov5.cn/mmbiz_jpg/eZzl4LXykQwtM2UVvtuReIibpibu6wHF49ljTo3ictg1q8ib69vNvZrgKicgibATNDhhSia5jzQvA3svfl88nic8U82Zfw?imageView2/1/w/600":null,"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeCNuwFLibqBVaWgoQjJODKp63wI1ryKF0T0NX4NGVoD6Og6jNgrTtd4g/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx12/cdn41@2020_3/2021/05/30/04-54-35-213_437997ed3c53fb9c.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeFm6YgXzRL95wZq0txSUU5PF4hspicJBvoCWh75wE1q9qaF5hvrYibpLA/640?wx_fmt=png":null,"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeDSWtpz0MdfNQibs7xlBcxW2oYDyER6aUST5mbicMcVT4KsEvPMnCPReg/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn85@2020_6/2021/05/30/04-54-28-709_e94705ab557d825f.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXe08PkpibWuf59Z6KcyZKzCzzoQqy4JBhNYC1zjOVeScvduAVM33rqyog/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx22/cdn70@2020_4/2021/05/30/04-54-17-659_c5b21dcad039edff.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeCnfNRfZToicIsJ1WDibGNF82YPpsEgCgnl91TUDDsysoPbibRRd0LI2yg/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx/cdn91@2020_3/2021/05/30/04-54-16-249_8152d978732e91b8.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeKOXD2ocbMESn4ibp0o905TX197Cp96LTkmwdXDxY6ceWjx6RqLLXLsQ/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx33/cdn32@2020_6/2021/05/30/04-55-23-990_6b9b643c92f4d4d5.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeU4FWdBqDgibpdUOia6Kibsibbs9GZC8tYXVvs1CSmbDXyg4EG9lqKsNcibQ/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx27/cdn50@2020_2/2021/05/30/04-54-20-383_dc6219c0a53f1505.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeVWIKKXJfZzfwdASAF7oic34js8z9AgGmMWzdyFbUoQrXcicDniccSNUHA/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx11/cdn30@2020_2/2021/05/30/04-54-33-806_4f269d80f1e992c1.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeVwHFETwXIketpF5W80Z0icdlKZaayhJ7A8G5z1ckk4GI8ubmvSGFwyQ/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx25/cdn43@2020_2/2021/05/30/04-54-20-430_b36ebd6c5a4977a0.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXesrUvyFSl60lk88npvEaickeDxyTq2eI0S1V7hM4U6YeAhe5CWTHMJuA/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx13/cdn53@2020_6/2021/05/30/04-54-16-504_58880decf11e9cf4.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXekgIRCXbTlL0LBcx8ic8H5ZdFsffjFsfgZRdpt6iaWPycXgMPPs6tRt5g/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx4/cdn89@2020_4/2021/05/30/04-54-12-727_ce172ce6c5ce315b.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeoLL2RuAnlQvOiaicVJ4opf1yGT0kJXwsfmDX56P2yQoEvXHE0Elxdnfg/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx16/cdn77@2020_6/2021/05/30/04-54-13-029_2d2b3e9136aae307.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeIu5wTSZrr7dRgf1l0rRvOVPpQicbl7T9ibalSljrJTKZ4YB1VricNcteg/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx29/cdn36@2020_3/2021/05/30/04-54-16-359_7155b82b7ee5cbcb.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXe6tc1PlvLibUmM9DtTcHVErrHK6Nc6f782Kl5ajCr3NvMNpk717xDaHg/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx8/cdn72@2020_4/2021/05/30/04-54-15-067_df23d479ebe58e3a.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeia8EKh3hzq9fPtSUOe4ibFvKQTkYx0f1HaicTPKHDOR4UXpKMvfJqox8Q/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx10/cdn57@2020_5/2021/05/30/04-54-16-277_a74020db3b1110d1.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/2A8tXicCG8ylbWIGfdoDED35IRRySQZTXUkJ1eop9MHApzFibKnOo0diboXpl0rmS5mH78YJhsWQv0dhv718A6kUA/640?wx_fmt=jpeg":"https://cdn.jsdelivr.net/gh/myreaderx3/cdn61@2020_2/2021/05/30/04-54-18-567_f93d0239d4369c75.webp","http://www.jintiankansha.me/rss_static/11757/jWDcpubME4":null},"publishedOrCreatedDate":1622350387262}],"record":{"createdTime":"2021-05-30 12:53:07","updatedTime":"2021-05-30 12:53:07","feedId":2521,"fetchDate":"Sun, 30 May 2021 04:53:07 +0000","fetchMs":592,"handleMs":17,"totalMs":137905,"newArticles":0,"totalArticles":5,"status":1,"type":0,"ip":"4cf9ab886509ef3fd2ece0a16b714d9c","hostName":"europe-24*","requestId":"e6972e169a274751b8da21198ba318cc_2521","contentType":"application/rss+xml","totalBytes":200950,"bgimgsTotal":1,"bgimgsGithubTotal":0,"articlesImgsTotal":18,"articlesImgsGithubTotal":15,"successGithubMap":{"myreaderx25":1,"myreaderx8":1,"myreaderx27":1,"myreaderx16":1,"myreaderx32":1,"myreaderx4":1,"myreaderx10":1,"myreaderx33":1,"myreaderx3":1,"myreaderx11":1,"myreaderx22":1,"myreaderx12":1,"myreaderx13":1,"myreaderx29":1,"myreaderx":1},"failGithubMap":{"myreaderx14":1,"myreaderx31":1}},"feed":{"createdTime":"2020-08-24 21:31:41","updatedTime":"2020-09-01 10:09:47","id":2521,"name":"ImportNew","url":"http://feedmaker.kindle4rss.com/feeds/importnew.weixin.xml","subscriber":null,"website":null,"icon":"http://www.sogou.com/images/logo/new/favicon.ico?v=4","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx63/cdn9@2020_3/2020/09/01/02-08-31-388_d24121c9beed1de6.ico","description":"伯乐在线旗下账号，专注Java技术分享，包括Java基础技术、进阶技能、架构设计和Java技术领域动态等。","weekly":null,"link":null},"noPictureArticleList":[{"createdTime":"2021-05-30 12:55:24","updatedTime":"2021-05-30 12:55:24","id":null,"feedId":2521,"linkMd5":"268f55317afc97b3f6f4254fc79426e2"}],"tmpCommonImgCdnBytes":0,"tmpBodyImgCdnBytes":200950,"tmpBgImgCdnBytes":0,"extra4":{"start":1622350386334,"total":0,"statList":[{"spend":911,"msg":"获取xml内容"},{"spend":17,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":73375,"msg":"正文链接上传到cdn"}]},"extra5":18,"extra6":18,"extra7ImgCdnFailResultVector":[null,{"code":1,"isDone":false,"source":"http://content.sov5.cn/mmbiz_jpg/eZzl4LXykQwtM2UVvtuReIibpibu6wHF49ljTo3ictg1q8ib69vNvZrgKicgibATNDhhSia5jzQvA3svfl88nic8U82Zfw?imageView2/1/w/600","sourceStatusCode":200,"destWidth":600,"destHeight":545,"sourceBytes":6304,"destBytes":4272,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":1873,"convertSpendMs":11,"createdTime":"2021-05-30 12:54:08","host":"us-034*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2,268f55317afc97b3f6f4254fc79426e2","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx14/cdn98/contents/2021/05/30/04-54-10-800_2294da5149f29266.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 68584859.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Resource, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Sun, 30 May 2021 04:54:10 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["D840:3D69:21A89F:6976E7:60B31A72"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1622352171"],"x-ratelimit-resource":["core"],"x-ratelimit-used":["60"],"x-xss-protection":["0"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx14/cdn98/contents/2021/05/30/04-54-10-800_2294da5149f29266.webp","historyStatusCode":[],"spendMs":29},"base64UserPassword":null,"token":"6b67d******************************91b08"},"githubUser":"myreaderx14","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"6.2 KB","destSize":"4.2 KB","compressRate":"67.8%"},{"code":1,"isDone":false,"source":"http://www.jintiankansha.me/rss_static/11757/jWDcpubME4","sourceStatusCode":405,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":461,"convertSpendMs":0,"createdTime":"2021-05-30 12:54:10","host":"us-038*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[405],"sourceSize":"0","destSize":"0"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeKOXD2ocbMESn4ibp0o905TX197Cp96LTkmwdXDxY6ceWjx6RqLLXLsQ/640?wx_fmt=png","sourceStatusCode":403,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":968,"convertSpendMs":0,"createdTime":"2021-05-30 12:54:10","host":"europe67*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","extra22GetBytesInfo":"2、Referer字段 ： http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","extra23historyStatusCode":[403,403],"sourceSize":"0","destSize":"0"},{"code":1,"isDone":false,"source":"http://www.jintiankansha.me/rss_static/11757/jWDcpubME4","sourceStatusCode":405,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":705,"convertSpendMs":0,"createdTime":"2021-05-30 12:54:11","host":"us-036*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[405],"sourceSize":"0","destSize":"0"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeU4FWdBqDgibpdUOia6Kibsibbs9GZC8tYXVvs1CSmbDXyg4EG9lqKsNcibQ/640?wx_fmt=png","sourceStatusCode":403,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":1445,"convertSpendMs":0,"createdTime":"2021-05-30 12:54:10","host":"us-022*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","extra22GetBytesInfo":"2、Referer字段 ： http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","extra23historyStatusCode":[403,403],"sourceSize":"0","destSize":"0"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeFm6YgXzRL95wZq0txSUU5PF4hspicJBvoCWh75wE1q9qaF5hvrYibpLA/640?wx_fmt=png","sourceStatusCode":200,"destWidth":748,"destHeight":548,"sourceBytes":52908,"destBytes":16406,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":4623,"convertSpendMs":32,"createdTime":"2021-05-30 12:54:10","host":"europe64*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx31/cdn82/contents/2021/05/30/04-54-15-345_21e53b2b68d8155a.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 69855631.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Resource, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Sun, 30 May 2021 04:54:15 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["D13A:8CA8:92E6F4:9CE4E6:60B31A77"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1622352147"],"x-ratelimit-resource":["core"],"x-ratelimit-used":["61"],"x-xss-protection":["0"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx31/cdn82/contents/2021/05/30/04-54-15-345_21e53b2b68d8155a.webp","historyStatusCode":[],"spendMs":160},"base64UserPassword":null,"token":"da243******************************d9e47"},"githubUser":"myreaderx31","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"51.7 KB","destSize":"16 KB","compressRate":"31%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeFm6YgXzRL95wZq0txSUU5PF4hspicJBvoCWh75wE1q9qaF5hvrYibpLA/640?wx_fmt=png","sourceStatusCode":200,"destWidth":748,"destHeight":548,"sourceBytes":52908,"destBytes":16406,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":2619,"convertSpendMs":16,"createdTime":"2021-05-30 12:54:15","host":"us-002*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx31/cdn82/contents/2021/05/30/04-54-18-137_21e53b2b68d8155a.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 69855631.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Resource, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Sun, 30 May 2021 04:54:18 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["81F4:10D5:15425A1:292131D:60B31A7A"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1622352147"],"x-ratelimit-resource":["core"],"x-ratelimit-used":["61"],"x-xss-protection":["0"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx31/cdn82/contents/2021/05/30/04-54-18-137_21e53b2b68d8155a.webp","historyStatusCode":[],"spendMs":29},"base64UserPassword":null,"token":"da243******************************d9e47"},"githubUser":"myreaderx31","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"51.7 KB","destSize":"16 KB","compressRate":"31%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeKOXD2ocbMESn4ibp0o905TX197Cp96LTkmwdXDxY6ceWjx6RqLLXLsQ/640?wx_fmt=png","sourceStatusCode":403,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":968,"convertSpendMs":0,"createdTime":"2021-05-30 12:54:10","host":"europe67*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","extra22GetBytesInfo":"2、Referer字段 ： http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","extra23historyStatusCode":[403,403],"sourceSize":"0","destSize":"0"}],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-013.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-018.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://europe68.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-002.herokuapp.com/":{"failCount":0,"successCount":2,"resultList":[200,200]},"http://us-034.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-005.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-022.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[403]},"http://europe-60.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-030.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-52.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-038.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[405]},"http://us-017.herokuapp.com/":{"failCount":0,"successCount":2,"resultList":[200,200]},"http://us-036.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[405]},"http://us-033.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://europe64.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-010.herokuapp.com/":{"failCount":1,"successCount":1,"resultList":[200,403]},"http://europe67.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[403]},"http://europe-22.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-014.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXekgIRCXbTlL0LBcx8ic8H5ZdFsffjFsfgZRdpt6iaWPycXgMPPs6tRt5g/640?wx_fmt=png","sourceStatusCode":200,"destWidth":346,"destHeight":293,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx4/cdn89@2020_4/2021/05/30/04-54-12-727_ce172ce6c5ce315b.webp","sourceBytes":15728,"destBytes":5834,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":2043,"convertSpendMs":9,"createdTime":"2021-05-30 12:54:10","host":"us-017*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","githubUser":"myreaderx4","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"15.4 KB","destSize":"5.7 KB","compressRate":"37.1%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeoLL2RuAnlQvOiaicVJ4opf1yGT0kJXwsfmDX56P2yQoEvXHE0Elxdnfg/640?wx_fmt=png","sourceStatusCode":200,"destWidth":356,"destHeight":333,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx16/cdn77@2020_6/2021/05/30/04-54-13-029_2d2b3e9136aae307.webp","sourceBytes":15747,"destBytes":5516,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":2271,"convertSpendMs":6,"createdTime":"2021-05-30 12:54:10","host":"us-002*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","githubUser":"myreaderx16","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"15.4 KB","destSize":"5.4 KB","compressRate":"35%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXe6tc1PlvLibUmM9DtTcHVErrHK6Nc6f782Kl5ajCr3NvMNpk717xDaHg/640?wx_fmt=png","sourceStatusCode":200,"destWidth":439,"destHeight":279,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx8/cdn72@2020_4/2021/05/30/04-54-15-067_df23d479ebe58e3a.webp","sourceBytes":16611,"destBytes":5730,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":4411,"convertSpendMs":6,"createdTime":"2021-05-30 12:54:10","host":"us-014*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","githubUser":"myreaderx8","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"16.2 KB","destSize":"5.6 KB","compressRate":"34.5%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeCnfNRfZToicIsJ1WDibGNF82YPpsEgCgnl91TUDDsysoPbibRRd0LI2yg/640?wx_fmt=png","sourceStatusCode":200,"destWidth":508,"destHeight":172,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx/cdn91@2020_3/2021/05/30/04-54-16-249_8152d978732e91b8.webp","sourceBytes":21203,"destBytes":9170,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":5486,"convertSpendMs":5,"createdTime":"2021-05-30 12:54:10","host":"us-018*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","githubUser":"myreaderx","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"20.7 KB","destSize":"9 KB","compressRate":"43.2%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeia8EKh3hzq9fPtSUOe4ibFvKQTkYx0f1HaicTPKHDOR4UXpKMvfJqox8Q/640?wx_fmt=png","sourceStatusCode":200,"destWidth":378,"destHeight":311,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx10/cdn57@2020_5/2021/05/30/04-54-16-277_a74020db3b1110d1.webp","sourceBytes":16526,"destBytes":5924,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":5786,"convertSpendMs":6,"createdTime":"2021-05-30 12:54:10","host":"europe-22*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","githubUser":"myreaderx10","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"16.1 KB","destSize":"5.8 KB","compressRate":"35.8%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeIu5wTSZrr7dRgf1l0rRvOVPpQicbl7T9ibalSljrJTKZ4YB1VricNcteg/640?wx_fmt=png","sourceStatusCode":200,"destWidth":549,"destHeight":340,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx29/cdn36@2020_3/2021/05/30/04-54-16-359_7155b82b7ee5cbcb.webp","sourceBytes":30292,"destBytes":9794,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":5816,"convertSpendMs":12,"createdTime":"2021-05-30 12:54:10","host":"europe68*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","githubUser":"myreaderx29","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"29.6 KB","destSize":"9.6 KB","compressRate":"32.3%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXesrUvyFSl60lk88npvEaickeDxyTq2eI0S1V7hM4U6YeAhe5CWTHMJuA/640?wx_fmt=png","sourceStatusCode":200,"destWidth":296,"destHeight":294,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx13/cdn53@2020_6/2021/05/30/04-54-16-504_58880decf11e9cf4.webp","sourceBytes":14525,"destBytes":5744,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":5744,"convertSpendMs":5,"createdTime":"2021-05-30 12:54:10","host":"us-010*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","githubUser":"myreaderx13","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"14.2 KB","destSize":"5.6 KB","compressRate":"39.5%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXe08PkpibWuf59Z6KcyZKzCzzoQqy4JBhNYC1zjOVeScvduAVM33rqyog/640?wx_fmt=png","sourceStatusCode":200,"destWidth":496,"destHeight":529,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx22/cdn70@2020_4/2021/05/30/04-54-17-659_c5b21dcad039edff.webp","sourceBytes":51429,"destBytes":15472,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":6924,"convertSpendMs":12,"createdTime":"2021-05-30 12:54:10","host":"us-013*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","githubUser":"myreaderx22","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"50.2 KB","destSize":"15.1 KB","compressRate":"30.1%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/2A8tXicCG8ylbWIGfdoDED35IRRySQZTXUkJ1eop9MHApzFibKnOo0diboXpl0rmS5mH78YJhsWQv0dhv718A6kUA/640?wx_fmt=jpeg","sourceStatusCode":200,"destWidth":600,"destHeight":550,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx3/cdn61@2020_2/2021/05/30/04-54-18-567_f93d0239d4369c75.webp","sourceBytes":37143,"destBytes":31608,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":8100,"convertSpendMs":11,"createdTime":"2021-05-30 12:54:10","host":"europe-60*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","githubUser":"myreaderx3","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"36.3 KB","destSize":"30.9 KB","compressRate":"85.1%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeU4FWdBqDgibpdUOia6Kibsibbs9GZC8tYXVvs1CSmbDXyg4EG9lqKsNcibQ/640?wx_fmt=png","sourceStatusCode":200,"destWidth":553,"destHeight":305,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx27/cdn50@2020_2/2021/05/30/04-54-20-383_dc6219c0a53f1505.webp","sourceBytes":34962,"destBytes":10828,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":8151,"convertSpendMs":11,"createdTime":"2021-05-30 12:54:12","host":"us-017*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","githubUser":"myreaderx27","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"34.1 KB","destSize":"10.6 KB","compressRate":"31%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeVwHFETwXIketpF5W80Z0icdlKZaayhJ7A8G5z1ckk4GI8ubmvSGFwyQ/640?wx_fmt=png","sourceStatusCode":200,"destWidth":758,"destHeight":774,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx25/cdn43@2020_2/2021/05/30/04-54-20-430_b36ebd6c5a4977a0.webp","sourceBytes":81080,"destBytes":25068,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":9865,"convertSpendMs":22,"createdTime":"2021-05-30 12:54:10","host":"us-034*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","githubUser":"myreaderx25","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"79.2 KB","destSize":"24.5 KB","compressRate":"30.9%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeDSWtpz0MdfNQibs7xlBcxW2oYDyER6aUST5mbicMcVT4KsEvPMnCPReg/640?wx_fmt=png","sourceStatusCode":200,"destWidth":958,"destHeight":393,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn85@2020_6/2021/05/30/04-54-28-709_e94705ab557d825f.webp","sourceBytes":48561,"destBytes":14438,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":17955,"convertSpendMs":14,"createdTime":"2021-05-30 12:54:10","host":"us-52*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","githubUser":"myreaderx32","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"47.4 KB","destSize":"14.1 KB","compressRate":"29.7%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeVWIKKXJfZzfwdASAF7oic34js8z9AgGmMWzdyFbUoQrXcicDniccSNUHA/640?wx_fmt=png","sourceStatusCode":200,"destWidth":631,"destHeight":776,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx11/cdn30@2020_2/2021/05/30/04-54-33-806_4f269d80f1e992c1.webp","sourceBytes":70598,"destBytes":20884,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":23054,"convertSpendMs":20,"createdTime":"2021-05-30 12:54:10","host":"us-005*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","githubUser":"myreaderx11","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"68.9 KB","destSize":"20.4 KB","compressRate":"29.6%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeCNuwFLibqBVaWgoQjJODKp63wI1ryKF0T0NX4NGVoD6Og6jNgrTtd4g/640?wx_fmt=png","sourceStatusCode":200,"destWidth":726,"destHeight":610,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx12/cdn41@2020_3/2021/05/30/04-54-35-213_437997ed3c53fb9c.webp","sourceBytes":78513,"destBytes":21180,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":24525,"convertSpendMs":22,"createdTime":"2021-05-30 12:54:10","host":"us-033*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","githubUser":"myreaderx12","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"76.7 KB","destSize":"20.7 KB","compressRate":"27%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicdicNctmGzWtMv35xBTnCJHXeKOXD2ocbMESn4ibp0o905TX197Cp96LTkmwdXDxY6ceWjx6RqLLXLsQ/640?wx_fmt=png","sourceStatusCode":200,"destWidth":578,"destHeight":377,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx33/cdn32@2020_6/2021/05/30/04-55-23-990_6b9b643c92f4d4d5.webp","sourceBytes":47044,"destBytes":13760,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":11008,"convertSpendMs":17,"createdTime":"2021-05-30 12:55:13","host":"us-030*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+%E6%89%94%E6%8E%89%E6%BA%90%E7%A0%81%EF%BC%8C15%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Java%20AQS","linkMd5ListStr":"268f55317afc97b3f6f4254fc79426e2","githubUser":"myreaderx33","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"45.9 KB","destSize":"13.4 KB","compressRate":"29.2%"}],"successGithubMap":{"myreaderx25":1,"myreaderx8":1,"myreaderx27":1,"myreaderx16":1,"myreaderx32":1,"myreaderx4":1,"myreaderx10":1,"myreaderx33":1,"myreaderx3":1,"myreaderx11":1,"myreaderx22":1,"myreaderx12":1,"myreaderx13":1,"myreaderx29":1,"myreaderx":1},"failGithubMap":{"myreaderx14":1,"myreaderx31":1}}