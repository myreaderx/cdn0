{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-11-16 15:24:45","updatedTime":"2020-11-16 15:24:45","title":"æ·±å…¥æµ…å‡º MySQL ä¼˜å…ˆé˜Ÿåˆ—(ä½ ä¸€å®šä¼šè¸©åˆ°çš„order by limit é—®é¢˜)","link":"https://segmentfault.com/a/1190000038180339","description":"<blockquote>\n è‹±è¯­å’Œç®—æ³•æ˜¯ç¨‹åºå‘˜çš„ä¸¤æ¡è…¿\n</blockquote>\n<p>æœ¬æ–‡é€‚ç”¨äº MySQL 5.6 åŠä»¥ä¸Šç‰ˆæœ¬</p>\n<h2>0.å…ˆæŠ›é—®é¢˜</h2>\n<p>å‡è®¾å­—æ®µ<code>category</code>æ— ç´¢å¼•ä¸”æœ‰é‡å¤å€¼ï¼Œ<code>order by category</code> å’Œ<code> limit </code>ç»„åˆä½¿ç”¨çš„ç»“æœä¼šå’Œé¢„æœŸä¸ç¬¦ã€‚</p>\n<h3>é—®é¢˜å¤ç°ï¼š</h3>\n<p>è¡¨ç»“æ„ï¼ˆå°±æ˜¯ä¸¤ä¸ªå­—æ®µï¼‰</p>\n<pre><code class=\"java\">CREATE TABLE `ratings` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `category` int(11) DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;</code></pre>\n<p>å¯¹æ‰€æœ‰æ•°æ®æŒ‰<code>category</code>å­—æ®µæ’åºï¼š <code>select * from ratings order by category;</code></p>\n<table>\n <thead>\n  <tr>\n   <th>id</th>\n   <th>category</th>\n  </tr>\n </thead>\n <tbody>\n  <tr>\n   <td>1</td>\n   <td>1</td>\n  </tr>\n  <tr>\n   <td>5</td>\n   <td>1</td>\n  </tr>\n  <tr>\n   <td>10</td>\n   <td>1</td>\n  </tr>\n  <tr>\n   <td>3</td>\n   <td>2</td>\n  </tr>\n  <tr>\n   <td>4</td>\n   <td>2</td>\n  </tr>\n  <tr>\n   <td>6</td>\n   <td>2</td>\n  </tr>\n  <tr>\n   <td>9</td>\n   <td>2</td>\n  </tr>\n  <tr>\n   <td>2</td>\n   <td>3</td>\n  </tr>\n  <tr>\n   <td>7</td>\n   <td>3</td>\n  </tr>\n  <tr>\n   <td>8</td>\n   <td>3</td>\n  </tr>\n </tbody>\n</table>\n<p>å½“æˆ‘ä»¬æƒ³åˆ†é¡µå±•ç¤ºå‰5æ¡æ—¶ä½¿ç”¨<code>select * from ratings order by category limit 5;</code></p>\n<p>æœŸæœ›å¾—åˆ°çš„<code>ID</code>é¡ºåºæ˜¯<code>1 5 10 3 4</code>ã€‚</p>\n<p>ä½†å®é™…ç»“æœå¦‚ä¸‹ï¼š</p>\n<table>\n <thead>\n  <tr>\n   <th>id</th>\n   <th>category</th>\n  </tr>\n </thead>\n <tbody>\n  <tr>\n   <td>1</td>\n   <td>1</td>\n  </tr>\n  <tr>\n   <td>10</td>\n   <td>1</td>\n  </tr>\n  <tr>\n   <td>5</td>\n   <td>1</td>\n  </tr>\n  <tr>\n   <td>3</td>\n   <td>2</td>\n  </tr>\n  <tr>\n   <td>4</td>\n   <td>2</td>\n  </tr>\n </tbody>\n</table>\n<p>æ€ä¹ˆè‚¥ä¼¼ï¼ŸMySQL å‡º Bug äº†ï¼Ÿ</p>\n<p>å¯èƒ½æœ‰åŒå­¦é‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜ï¼Œç™¾åº¦æˆ–è°·æ­Œä¸€ä¸‹è§£å†³äº†ï¼Œä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œä½ æŸ¥åˆ°çš„åŠæ³•æ˜¯æœ€ä¼˜è§£å—ï¼Ÿåˆ«äººæ˜¯æ€ä¹ˆå¾—å‡ºè¿™ä¸ªåŠæ³•çš„ï¼ŸMySQL ä¸ºä»€ä¹ˆä¼šè¿™æ ·åšï¼Œè·Ÿç‰ˆæœ¬æœ‰å…³å—ï¼Ÿ </p>\n<p>å…ˆæŠ›ç»“è®ºï¼š</p>\n<ol>\n <li>æœ€ä¼˜è§£æ˜¯åé¢å†åŠ ä¸ªåˆ—å€¼å”¯ä¸€çš„æ’åºå­—æ®µï¼Œå¦‚ï¼š<code>order by category,id</code>ï¼›</li>\n <li>MySQL ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿç­”æ¡ˆæ˜¯ä¸ºäº†å¿«ï¼ï¼ˆ<code>MySQL 5.6</code>åŠå…¶ä¹‹åæ‰æœ‰æ­¤ä¼˜åŒ–ï¼‰</li>\n <li>æ¬¡ä¼˜è§£æ˜¯å¯¹<code>order by</code>åé¢çš„<code>category</code> åŠ ç´¢å¼•ï¼ˆä¸ºä»€ä¹ˆæ˜¯æ¬¡ä¼˜è§£ï¼Ÿçœ‹å®Œæœ¬æ–‡ä½ å°†ä¼šæœ‰ç­”æ¡ˆï¼‰ï¼›</li>\n</ol>\n<p>ä¸‹é¢è¯¾ä»£è¡¨å°†è¿˜åŸä¸€ä¸‹è¿™ 3 æ¡ç»“è®ºçš„äº§å‡ºè¿‡ç¨‹ã€‚</p>\n<h2>1. æœ€ä¼˜è§£</h2>\n<p>MySQL æ–‡æ¡£ <a href=\"https://dev.mysql.com/doc/refman/8.0/en/limit-optimization.html\" rel=\"nofollow noreferrer\">8.2.1.19 LIMIT Query Optimization</a> ä¸­å¯¹æ­¤åœºæ™¯æœ‰å¦‚ä¸‹æè¿°ï¼š</p>\n<blockquote>\n If multiple rows have identical values in the \n <code>ORDER BY</code> columns, the server is free to return those rows in any order, and may do so differently depending on the overall execution plan. In other words, the sort order of those rows is nondeterministic with respect to the nonordered columns.\n <br>One factor that affects the execution plan is <code>LIMIT</code>, so an <code>ORDER BY</code> query with and without <code>LIMIT</code> may return rows in different orders.</br>\n</blockquote>\n<p>æ€»ç»“æ¥è¯´å°±æ˜¯ï¼š</p>\n<blockquote>\n å½“ ORDER BY åˆ—çš„å­—æ®µå€¼å­˜åœ¨é‡å¤ï¼Œé‚£ä¹ˆè¿™æ¡ ORDER BY è¯­å¥è¿”å›çš„æ•°æ®é¡ºåºä¼šå› ä¸º\n <code>LIMIT</code>çš„å­˜åœ¨è€Œå˜å¾—ä¸ä¸€æ ·\n</blockquote>\n<p>è¿™æ˜¯ MySQL é»˜è®¤å¯¹è¯¥åœºæ™¯åšçš„ä¼˜åŒ–ï¼Œå¦‚æœä½ éœ€è¦ä¿è¯åŠ ä¸åŠ  <code>LIMIT</code> é¡ºåºéƒ½è¦ä¸€è‡´ï¼Œå®˜æ–¹ä¹Ÿç»™å‡ºäº†åŠæ³•ï¼š</p>\n<blockquote>\n If it is important to ensure the same row order with and without \n <code>LIMIT</code>, include additional columns in the \n <code>ORDER BY</code> clause to make the order deterministic.\n</blockquote>\n<p>å°±æ˜¯åœ¨<code>ORDER BY</code> åé¢å†å¤šåŠ ä¸€ä¸ªæ’åºå­—æ®µï¼ˆæ¯”å¦‚ ID å­—æ®µï¼‰ã€‚</p>\n<p>ä»¥ä¸Šæè¿°æœ€æ—©å‡ºç°åœ¨<code>MySQL 5.6</code>æ–‡æ¡£ä¸­ï¼Œä»è¿™ä¸ªç‰ˆæœ¬å¼€å§‹ï¼Œå¼•å…¥äº†è¿™ä¸ªé’ˆå¯¹<code>ORDER BY LIMIT </code>çš„ä¼˜åŒ–ã€‚</p>\n<p>å¥½äº†ï¼Œ é’ˆå¯¹æ–‡ä¸­çš„åœºæ™¯ï¼Œæˆ‘ä»¬åªéœ€è¦<code>select * from ratings order by category,id;</code>å³å¯è§£å†³ã€‚</p>\n<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒMySQL ä¸ºä»€ä¹ˆè¦åšè¿™ä¹ˆä¸€ä¸ªçœ‹ä¼¼æ˜¯ Bug çš„ä¼˜åŒ–ï¼Ÿ</p>\n<h2>2.MySQL çš„ ORDER BY é€»è¾‘</h2>\n<p>é¡¾åæ€ä¹‰ï¼ŒORDER BY å°±æ˜¯æ’åºã€‚</p>\n<p>æ‰§è¡Œä¸€ä¸‹<code>explain select * from ratings order by category limit 5;</code></p>\n<pre><code class=\"json\">*************************** 1. row ***************************\n           id: 1\n  select_type: SIMPLE\n        table: ratings\n   partitions: NULL\n         type: ALL\npossible_keys: NULL\n          key: NULL\n      key_len: NULL\n          ref: NULL\n         rows: 10\n     filtered: 100.00\n        Extra: Using filesort\n1 row in set, 1 warning (0.00 sec)\n</code></pre>\n<p>å¯ä»¥çœ‹åˆ° <code>Extra: Using filesort</code> è¡¨ç¤ºéœ€è¦æ’åºã€‚</p>\n<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œ MySQL ä¼šæœ‰å†…å­˜æ’åºå’Œå¤–éƒ¨æ’åºä¸¤ç§ï¼š</p>\n<ul>\n <li>å¦‚æœå¾…æ’åºçš„æ•°æ®é‡å°äº<code>sort buffer size</code>ï¼Œæ’åºå°±åœ¨å†…å­˜ä¸­å®Œæˆ(å¿«é€Ÿæ’åº)ï¼›</li>\n <li>å¦‚æœå¾…æ’åºçš„æ•°æ®é‡å¤§äº<code>sort buffer size</code>ï¼Œå°±ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶è¿›è¡Œå¤–éƒ¨æ’åº(å½’å¹¶æ’åº);</li>\n</ul>\n<p>å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸¤ç§æ’åºéƒ½æ˜¯å¯¹æ‰€æœ‰ç»“æœå…¨éƒ¨æ’åºï¼Œè®²é“ç†ï¼Œä¸ç®¡æœ‰æ²¡æœ‰<code>LIMIT</code>ï¼Œéƒ½æ˜¯ä»æ’å®Œåºçš„ç»“æœä¸­æŒ‰é¡ºåºå–éœ€è¦çš„æ¡æ•°ï¼Œæœ‰æ²¡æœ‰<code>LIMIT</code>æ˜¯ä¸ä¼šå½±å“è¿”å›çš„ç»“æœé¡ºåºçš„ã€‚</p>\n<p>ä½†æ˜¯ï¼Œ<code>MySQL 5.6</code> ç‰ˆæœ¬é’ˆå¯¹ <code>ORDER BY LIMIT</code>åšäº†ä¸ªå°ä¼˜åŒ–ï¼ˆæ’åºå­—æ®µæ— ç´¢å¼•ï¼Œä¸”åˆ—å€¼ä¸å”¯ä¸€æ—¶ï¼‰ï¼šä¼˜åŒ–å™¨åœ¨é‡åˆ° <code>ORDER BY LIMIT</code>è¯­å¥çš„æ—¶å€™ï¼Œä½¿ç”¨äº†priority queueã€‚</p>\n<p><a href=\"https://dev.mysql.com/doc/dev/mysql-server/8.0.18/filesort_8cc.html\" rel=\"nofollow noreferrer\">filesort.cc</a> ä¸­æœ‰å¦‚ä¸‹ä¼ªä»£ç æè¿°è¯¥ä¼˜åŒ–ï¼š</p>\n<pre><code class=\"java\">while (get_next_sortkey())\n   {\n     if (using priority queue)\n       push sort key into queue\n     else\n     {\n       try to put sort key into buffer;\n       if (no free space in sort buffer)\n       {\n         do {\n           allocate new, larger buffer;\n           retry putting sort key into buffer;\n         } until (record fits or no space for new buffer)\n         if (no space for new buffer)\n         {\n           sort record pointers (all buffers);\n           dump sorted sequence to 'tempfile';\n           dump Merge_chunk describing sequence location into 'chunk_file';\n         }\n       }\n       if (key was packed)\n         tell sort buffer the actual number of bytes used;\n     }\n   }\n   if (buffer has some elements &amp;&amp; dumped at least once)\n     sort-dump-dump as above;\n   else\n     don't sort, leave sort buffer to be sorted by caller.</code></pre>\n<p>å¹¶åœ¨ <a href=\"https://dev.mysql.com/worklog/task/?id=1393\" rel=\"nofollow noreferrer\">WL#1393: Optimizing filesort with small limit </a> ä¸­é˜è¿°äº†è¯¥ä¼˜åŒ–é€»è¾‘:</p>\n<pre><code class=\"java\">Many web customers have to do\n\"SELECT ... ORDER BY non_index_column LIMIT X\",\n\nWhen X *  is smaller than sort_buff_size we can use\nthe following algoritm to speed up the sort:\n\n- Create a queue to hold 'limit' keys.\n- Scan through the table and store the first (last if DESC) keys in the queue\n- Return values from queue\n\nThis is much faster than the current algoritm that works as:</code></pre>\n<p>è¯¥ WorkLog ä¸­è®°å½•äº†ä¼˜åŒ–åçš„æ•ˆæœï¼š<code>10 to 20 times faster than a quicksort</code>(æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»é˜…è¯»åŸæ–‡)ã€‚</p>\n<p>æ‰€ä»¥ï¼Œå°±æ˜¯ä¸ºäº†å¿«ï¼</p>\n<p>MySQL è®¤ä¸ºè¿™ç§åœºæ™¯å°±æ˜¯æ±‚ TOP N çš„é—®é¢˜ï¼Œä½¿ç”¨ priority queue å°±èƒ½è§£å†³ã€‚</p>\n<h2>3.priority queue(ä¼˜å…ˆçº§é˜Ÿåˆ—)</h2>\n<p>priority queue å…¶å®å°±æ˜¯å †ï¼ŒJava ä¸­æœ‰<code>java.util.PriorityQueue</code>ç±»ï¼Œå…¶æœ¬è´¨å°±æ˜¯ å † è¿™ç§æ•°æ®ç»“æ„ã€‚</p>\n<p>ç®€å•è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯å †ï¼š</p>\n<p>å †æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼›</p>\n<p>å †ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¿…é¡»å¤§äºç­‰äºï¼ˆå¤§é¡¶å †ï¼‰æˆ–å°äºç­‰äºï¼ˆå°é¡¶å †ï¼‰å…¶å­æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å€¼ã€‚</p>\n<p>å¦‚æœ MySQL ä½¿ç”¨å½’å¹¶æˆ–å¿«æ’ï¼Œéœ€è¦æŠŠæ‰€æœ‰æ•°æ®éƒ½æ’å¥½åºï¼Œå†å–<code>LIMIT</code> çš„å‰å‡ æ¡ï¼Œå‰©ä½™å·²æ’åºçš„æ•°æ®å°±ç™½ç™½æµªè´¹äº†ã€‚</p>\n<p>è€Œé‡‡ç”¨ priority queue å¯ä»¥æ ¹æ® <code>LIMIT</code>çš„æ¡æ•°ç»´æŠ¤ä¸€ä¸ªå †ï¼Œåªéœ€è¦æŠŠæ‰€æœ‰æ•°æ®åœ¨è¿™ä¸ªå †é‡Œè¿‡ä¸€éå°±èƒ½å¾—åˆ°ç»“æœã€‚</p>\n<p>ä½¿ç”¨å¦‚ä¸‹è¯­å¥å¯ä»¥éªŒè¯ MySQL ä½¿ç”¨äº† priority queueï¼š</p>\n<pre><code class=\"java\">SET optimizer_trace='enabled=on';\nselect * from ratings order by category limit 5;\nSELECT * FROM `information_schema`.`OPTIMIZER_TRACE`\\G;</code></pre>\n<pre><code class=\"java\"> \"filesort_priority_queue_optimization\": {\n              \"limit\": 5,\n              \"chosen\": true\n            },</code></pre>\n<p>å¯ä»¥çœ‹åˆ° <code>filesort_priority_queue_optimization.chosen = true</code></p>\n<p>ä¸‹é¢ç”¨æµç¨‹å›¾è¿˜åŸä¸€ä¸‹ priority queue çš„æ‰§è¡Œé€»è¾‘ï¼ˆä»¥<code>LIMIT 5</code>ä¸ºä¾‹ï¼‰ï¼š</p>\n<p><strong>å‹æƒ…æç¤ºï¼šå›¾ä¸­çš„å°é¡¶å †ä»¥ category å€¼çš„å¤§å°æ’åº</strong></p>\n<ol>\n <li>å–å‰äº”æ¡æ•°æ®æ„æˆä¸€ä¸ªå°é¡¶å †ï¼š</li>\n</ol>\n<p><img src=\"https://segmentfault.com/img/bVcIj9c\" alt=\"image\" title=\"image\" /></p>\n<ol>\n <li>å–ä¸‹ä¸€è¡Œæ•°æ®(6,2),å‘ç° 2 å°äºå½“å‰å †ä¸­æœ€å¤§çš„<code>category</code> 3ï¼Œäºæ˜¯æŠŠ(2,3)ä»å †ä¸­åˆ æ‰ï¼ŒæŠŠ(6,2) å…¥å †ï¼š</li>\n</ol>\n<p><img src=\"https://segmentfault.com/img/bVcIj9m\" alt=\"image\" title=\"image\" /></p>\n<ol>\n <li>é‡å¤æ­¥éª¤ 2ï¼Œç›´è‡³ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„æ•°æ®éƒ½ç»å†è¿‡æ¯”è¾ƒå…¥å †ï¼Œæœ€ç»ˆå †ä¸­æ•°æ®å¦‚å›¾ï¼š</li>\n</ol>\n<p>ä»¥ä¸Šå°±æ˜¯é€šè¿‡ priority queue æ‰¾åˆ° æœ€å°çš„ 5 è¡Œ category æ•°æ®çš„æ‰§è¡Œè¿‡ç¨‹ã€‚<br><img src=\"https://segmentfault.com/img/bVcIj9n\" alt=\"image\" title=\"image\" /></br></p>\n<p>æœ€åæˆ‘ä»¬å°†å…¶å‡ºå †å³å¯å¾—åˆ°ç»“æœï¼Œæ¯æ¬¡å‡ºå †æœ€å°å…ƒç´ åå°†æœ€åä¸€ä¸ªå…ƒç´ æ”¾å…¥å †é¡¶ï¼ŒæŒ‰ç…§å°é¡¶å †é‡æ–°å †åŒ–ï¼Œè¿‡ç¨‹å¦‚å›¾ï¼š<br><img src=\"https://segmentfault.com/img/bVcIj9w\" alt=\"image\" title=\"image\" /></br></p>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç»“æœå’Œ<code>select * from ratings order by category limit 5;</code>çš„è¾“å‡ºä¸€è‡´</p>\n<h2>4.åŠ ç´¢å¼•ä¸ºä»€ä¹ˆæ˜¯æ¬¡ä¼˜è§£</h2>\n<p>æ˜¾ç„¶ï¼ŒæŒ‰ç…§ORDER BY çš„é€»è¾‘ï¼Œç›´æ¥å¯¹æ’åºå­—æ®µåŠ ç´¢å¼•ä¹Ÿå¯ä»¥çœå»å†…å­˜æ’åºæ­¥éª¤ï¼Œä»è€Œè§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>\n<p>ä½†ç´¢å¼•ä¹Ÿä¸æ˜¯é“¶å¼¹ï¼Œå¤šå‡ºæ¥çš„<code>category</code>ç´¢å¼•ä¼šå¢åŠ è¡¨çš„ç»´æŠ¤æˆæœ¬ï¼Œå¦‚æœæ²¡æœ‰æ˜æ˜¾çš„ä¸šåŠ¡éœ€è¦ï¼Œå•çº¯ä¸ºäº†ç»•è¿‡è¿™ä¸ªpriority queueçš„ä¼˜åŒ–è€ŒåŠ ç´¢å¼•ï¼Œè¯¾ä»£è¡¨è®¤ä¸ºæœ‰ç‚¹å¾—ä¸å¿å¤±ã€‚</p>\n<p>å°¤å…¶æ˜¯å½“è¡¨æ•°æ®é‡éå¸¸å¤§çš„æ—¶å€™ï¼Œç´¢å¼•çš„ä½“é‡ä¼šå¾ˆå¯è§‚ã€‚è€Œä¸”ï¼Œé’ˆå¯¹æ–‡ä¸­åœºæ™¯ï¼Œ<code>category</code>ä½œä¸ºåˆ†ç±»å­—æ®µï¼Œé‡å¤ç‡ä¼šæ¯”è¾ƒé«˜ï¼Œå³ä½¿æœ‰æŒ‰åˆ†ç±»æŸ¥è¯¢çš„ä¸šåŠ¡ SQL ï¼ŒMySQL ä¹Ÿä¸ä¸€å®šä¼šé€‰å–è¿™æ¡ç´¢å¼•ã€‚</p>\n<p>ç»¼ä¸Šï¼Œé’ˆå¯¹æœ¬åœºæ™¯ï¼Œä¸ªäººè®¤ä¸º<code>order by category,id</code>æ‰æ˜¯è¯¥é—®é¢˜çš„æœ€ä¼˜è§£ã€‚</p>\n<p>PSï¼šä¼šä¸ä¼šæœ‰äººé—®ï¼šå…³æˆ‘é¸Ÿäº‹ï¼Œæˆ‘ä»æ²¡å†™è¿‡å¸¦ LIMIT çš„ SQL å•Šï¼</p>\n<p>éš¾é“ä½ å†™çš„ CRUD åŠŸèƒ½éƒ½ä¸å¸¦åˆ†é¡µçš„å—ï¼Ÿ<code>PageHelper</code> æºç å»äº†è§£ä¸€ä¸‹ï¼Ÿ</p>\n<h2>5. æ€»ç»“</h2>\n<p>æœ¬æ–‡æ¡ˆä¾‹æ˜¯è¯¾ä»£è¡¨ä¸Šçº¿è¿‡ç¨‹ä¸­é­é‡åˆ°çš„å®é™…é—®é¢˜ï¼Œå’¨è¯¢äº†ä¸‹å‘¨å›´åŒå­¦ï¼Œæœ‰å¥½å‡ ä¸ªéƒ½é‡åˆ°è¿‡æ­¤é—®é¢˜ï¼Œç½‘ä¸Šæ–‡ç« å¤§å¤šæµ…å…¥æµ…å‡ºï¼Œè¯»å®Œæœ‰éš”é´æ”ç—’ä¹‹æ„Ÿï¼Œæ— æ³•è§£ç­”å¿ƒä¸­ç–‘æƒ‘ã€‚é‚æ•´ç†æ­¤æ–‡ã€‚</p>\n<p>å…¶ä¸­æ¶‰åŠ æ•°æ®ç»“æ„ï¼ŒPageHelperï¼ŒMySQL æ–‡æ¡£ï¼Œç›¸å…³å‚è€ƒèµ„æ–™ç½—åˆ—åœ¨æ–‡æœ«ï¼Œå¦‚æœæœ‰æ—¶é—´èƒ½é¡ºç€æ–‡ç« æ€è·¯äº²è‡ªè¯»ä¸€éå‚è€ƒæ–‡æ¡£ï¼Œç›¸ä¿¡ä¼šæœ‰æ›´æ·±çš„æ”¶è·ã€‚</p>\n<h2>6.å‚è€ƒèµ„æ–™ï¼š</h2>\n<ol>\n <li>ã€Šæ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ã€‹---ç‹äº‰ ç¬¬ 28,29 è®²</li>\n <li>ã€ŠMySQLå®æˆ˜45è®²ã€‹---æ—æ™“æ–Œ ç¬¬ 04ã€05ã€10ã€16ã€17 è®²</li>\n <li>8.2.1.16 LIMIT Query Optimization---<a href=\"https://dev.mysql.com/doc/refman/5.6/en/limit-optimization.html\" rel=\"nofollow noreferrer\">https://dev.mysql.com/doc/ref...</a></li>\n <li>MySQL Â· ç­”ç–‘è§£æƒ‘ Â· MySQL Sort åˆ†é¡µ---<a href=\"http://mysql.taobao.org/monthly/2015/06/04/\" rel=\"nofollow noreferrer\">http://mysql.taobao.org/month...</a></li>\n <li>filesort.cc---<a href=\"https://dev.mysql.com/doc/dev/mysql-server/8.0.18/filesort_8cc.html\" rel=\"nofollow noreferrer\">https://dev.mysql.com/doc/dev...</a></li>\n <li>WL#1393: Optimizing filesort with small limit---<a href=\"https://dev.mysql.com/worklog/task/?id=1393\" rel=\"nofollow noreferrer\">https://dev.mysql.com/worklog...</a></li>\n</ol>\n<hr>\n <p>ğŸ‘‡å…³æ³¨ Javaè¯¾ä»£è¡¨ï¼Œè·å–æœ€æ–° Java å¹²è´§ğŸ‘‡<br><img src=\"https://segmentfault.com/img/bVbLbSq\" alt=\"image\" title=\"image\" /></br></p>\n</hr>","descriptionType":"html","publishedDate":"Mon, 16 Nov 2020 02:50:00 +0000","feedId":6615,"bgimg":"https://segmentfault.com/img/bVcIj9c","linkMd5":"b993878ba905eb866a55a16ad278b8e0","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx18/cdn60@2020_6/2020/11/16/07-24-54-969_6c82542cb07cc348.webp","destWidth":354,"destHeight":336,"sourceBytes":12842,"destBytes":12842,"author":"Javaè¯¾ä»£è¡¨","articleImgCdnMap":{"https://segmentfault.com/img/bVcIj9c":"https://cdn.jsdelivr.net/gh/myreaderx18/cdn60@2020_6/2020/11/16/07-24-54-969_6c82542cb07cc348.webp","https://segmentfault.com/img/bVcIj9m":"https://cdn.jsdelivr.net/gh/myreaderx31/cdn65@2020_5/2020/11/16/07-24-59-682_cb588f621895c584.webp","https://segmentfault.com/img/bVcIj9n":null,"https://segmentfault.com/img/bVcIj9w":"https://cdn.jsdelivr.net/gh/myreaderx30/cdn74@2020_5/2020/11/16/07-24-59-715_eebac97977f91b32.webp","https://segmentfault.com/img/bVbLbSq":"https://cdn.jsdelivr.net/gh/myreaderx1/cdn63@2020_1/2020/11/16/07-24-58-238_e4ee0051d3ebdd4a.webp"},"publishedOrCreatedDate":1605511485830}],"record":{"createdTime":"2020-11-16 15:24:45","updatedTime":"2020-11-16 15:24:45","feedId":6615,"fetchDate":"Mon, 16 Nov 2020 07:24:45 +0000","fetchMs":5104,"handleMs":6683,"totalMs":28281,"newArticles":0,"totalArticles":50,"status":1,"type":0,"ip":"48b55560af3da9c096a2702d0ffd5d16","hostName":"us-021*","requestId":"24ce430837de4402a8c0375e77affa63_6615","contentType":"application/atom+xml; charset=UTF-8","totalBytes":97742,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":5,"articlesImgsGithubTotal":4,"successGithubMap":{"myreaderx1":1,"myreaderx30":1,"myreaderx31":1,"myreaderx18":1},"failGithubMap":{"myreaderx23":1}},"feed":{"createdTime":"2020-08-25 04:33:08","updatedTime":"2020-11-03 15:53:30","id":6615,"name":"SegmentFault æœ€æ–°çš„æ–‡ç« ","url":"http://segmentfault.com/feeds/blogs","subscriber":null,"website":null,"icon":"https://segmentfault.com/favicon.ico","icon_jsdelivr":null,"description":"","weekly":null,"link":"https://segmentfault.com"},"noPictureArticleList":[{"createdTime":"2020-11-16 15:25:00","updatedTime":"2020-11-16 15:25:00","id":null,"feedId":6615,"linkMd5":"b993878ba905eb866a55a16ad278b8e0"}],"tmpCommonImgCdnBytes":12842,"tmpBodyImgCdnBytes":84900,"tmpBgImgCdnBytes":0,"extra4":{"start":1605511472617,"total":0,"statList":[{"spend":6530,"msg":"è·å–xmlå†…å®¹"},{"spend":6683,"msg":"è§£é‡Šæ–‡ç« "},{"spend":0,"msg":"ä¸Šä¼ å°é¢å›¾åˆ°cdn"},{"spend":0,"msg":"ä¿®æ­£å°é¢å›¾ä¸Šä¼ å¤±è´¥é‡æ–°ä¸Šä¼ "},{"spend":5170,"msg":"æ­£æ–‡é“¾æ¥ä¸Šä¼ åˆ°cdn"}]},"extra5":5,"extra6":5,"extra7ImgCdnFailResultVector":[{"code":1,"isDone":false,"source":"https://segmentfault.com/img/bVcIj9n","sourceStatusCode":200,"destWidth":351,"destHeight":303,"sourceBytes":12620,"destBytes":12620,"feedId":6615,"totalSpendMs":2514,"convertSpendMs":0,"createdTime":"2020-11-16 15:24:55","host":"us-036*","referer":"https://segmentfault.com/a/1190000038180339","linkMd5ListStr":"b993878ba905eb866a55a16ad278b8e0","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx23/cdn71/contents/2020/11/16/07-24-58-224_478c6f29f4b16b52.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 69189253.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Mon, 16 Nov 2020 07:24:58 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"status":["403 Forbidden"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["A596:4472:2668542:3E5F96F:5FB22947"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1605514162"],"x-ratelimit-used":["60"],"x-xss-protection":["1; mode=block"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx23/cdn71/contents/2020/11/16/07-24-58-224_478c6f29f4b16b52.webp","historyStatusCode":[],"spendMs":32},"base64UserPassword":null,"token":"df0b9******************************93a6e"},"githubUser":"myreaderx23","githubHttpCode":403,"extra22GetBytesInfo":"1ã€æ²¡æœ‰Refererå­—æ®µ","extra23historyStatusCode":[200],"sourceSize":"12.3 KB","destSize":"12.3 KB","compressRate":"100%"},{"code":1,"isDone":false,"source":"https://segmentfault.com/img/bVcIj9n","sourceStatusCode":200,"destWidth":351,"destHeight":303,"sourceBytes":12620,"destBytes":12620,"feedId":6615,"totalSpendMs":2624,"convertSpendMs":0,"createdTime":"2020-11-16 15:24:58","host":"us-036*","referer":"https://segmentfault.com/a/1190000038180339","linkMd5ListStr":"b993878ba905eb866a55a16ad278b8e0","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx23/cdn71/contents/2020/11/16/07-25-00-138_478c6f29f4b16b52.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 69189253.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Mon, 16 Nov 2020 07:25:00 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"status":["403 Forbidden"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["A596:4472:266860F:3E5FB47:5FB2294A"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1605514162"],"x-ratelimit-used":["60"],"x-xss-protection":["1; mode=block"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx23/cdn71/contents/2020/11/16/07-25-00-138_478c6f29f4b16b52.webp","historyStatusCode":[],"spendMs":43},"base64UserPassword":null,"token":"df0b9******************************93a6e"},"githubUser":"myreaderx23","githubHttpCode":403,"extra22GetBytesInfo":"1ã€æ²¡æœ‰Refererå­—æ®µ","extra23historyStatusCode":[200],"sourceSize":"12.3 KB","destSize":"12.3 KB","compressRate":"100%"}],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-037.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-036.herokuapp.com/":{"failCount":0,"successCount":2,"resultList":[200,200]},"http://europe21.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://europe70.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://segmentfault.com/img/bVcIj9c","sourceStatusCode":200,"destWidth":354,"destHeight":336,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx18/cdn60@2020_6/2020/11/16/07-24-54-969_6c82542cb07cc348.webp","sourceBytes":12842,"destBytes":12842,"feedId":6615,"totalSpendMs":4529,"convertSpendMs":0,"createdTime":"2020-11-16 15:24:51","host":"us-020*","referer":"https://segmentfault.com/a/1190000038180339","linkMd5ListStr":"b993878ba905eb866a55a16ad278b8e0,b993878ba905eb866a55a16ad278b8e0","githubUser":"myreaderx18","githubHttpCode":201,"extra22GetBytesInfo":"1ã€æ²¡æœ‰Refererå­—æ®µ","extra23historyStatusCode":[200],"sourceSize":"12.5 KB","destSize":"12.5 KB","compressRate":"100%"},{"code":1,"isDone":false,"source":"https://segmentfault.com/img/bVbLbSq","sourceStatusCode":200,"destWidth":800,"destHeight":189,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx1/cdn63@2020_1/2020/11/16/07-24-58-238_e4ee0051d3ebdd4a.webp","sourceBytes":23028,"destBytes":23028,"feedId":6615,"totalSpendMs":3459,"convertSpendMs":0,"createdTime":"2020-11-16 15:24:55","host":"europe21*","referer":"https://segmentfault.com/a/1190000038180339","linkMd5ListStr":"b993878ba905eb866a55a16ad278b8e0","githubUser":"myreaderx1","githubHttpCode":201,"extra22GetBytesInfo":"1ã€æ²¡æœ‰Refererå­—æ®µ","extra23historyStatusCode":[200],"sourceSize":"22.5 KB","destSize":"22.5 KB","compressRate":"100%"},{"code":1,"isDone":false,"source":"https://segmentfault.com/img/bVcIj9w","sourceStatusCode":200,"destWidth":800,"destHeight":556,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx30/cdn74@2020_5/2020/11/16/07-24-59-715_eebac97977f91b32.webp","sourceBytes":49182,"destBytes":49182,"feedId":6615,"totalSpendMs":4974,"convertSpendMs":0,"createdTime":"2020-11-16 15:24:55","host":"us-037*","referer":"https://segmentfault.com/a/1190000038180339","linkMd5ListStr":"b993878ba905eb866a55a16ad278b8e0","githubUser":"myreaderx30","githubHttpCode":201,"extra22GetBytesInfo":"1ã€æ²¡æœ‰Refererå­—æ®µ","extra23historyStatusCode":[200],"sourceSize":"48 KB","destSize":"48 KB","compressRate":"100%"},{"code":1,"isDone":false,"source":"https://segmentfault.com/img/bVcIj9m","sourceStatusCode":200,"destWidth":354,"destHeight":315,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx31/cdn65@2020_5/2020/11/16/07-24-59-682_cb588f621895c584.webp","sourceBytes":12690,"destBytes":12690,"feedId":6615,"totalSpendMs":4740,"convertSpendMs":0,"createdTime":"2020-11-16 15:24:55","host":"europe70*","referer":"https://segmentfault.com/a/1190000038180339","linkMd5ListStr":"b993878ba905eb866a55a16ad278b8e0","githubUser":"myreaderx31","githubHttpCode":201,"extra22GetBytesInfo":"1ã€æ²¡æœ‰Refererå­—æ®µ","extra23historyStatusCode":[200],"sourceSize":"12.4 KB","destSize":"12.4 KB","compressRate":"100%"}],"successGithubMap":{"myreaderx1":1,"myreaderx30":1,"myreaderx31":1,"myreaderx18":1},"failGithubMap":{"myreaderx23":1}}