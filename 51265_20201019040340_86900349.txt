{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-10-19 12:02:18","updatedTime":"2020-10-19 12:02:18","title":"相关性分析之Predictive Power Score(PPS)","link":"https://www.biaodianfu.com/?p=11481","description":"<h2>常用相关性分析方法</h2>\n<p>在分析特征间相关性时，常使用的方法是<a href=\"https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.corr.html\">pandas.DataFrame.corr</a>：</p>\n<p>DataFrame.corr(self, method=&#8217;pearson&#8217;, min_periods=1)</p>\n<p>其中包含的方法主要为：</p>\n<ul>\n<li>pearson：<a href=\"https://www.biaodianfu.com/pearson-correlation-coefficient.html\">Pearson相关系数</a></li>\n<li>kendall：<a href=\"https://www.biaodianfu.com/kendall-rank.html\">Kendall秩相关系数</a></li>\n<li>Spearman：<a href=\"https://www.biaodianfu.com/spearman-coefficient.html\">Spearman等级相关系数</a></li>\n</ul>\n<h3>Pearson相关系数</h3>\n<p>Pearson相关系数是一种最简单的，能帮助理解特征和响应变量之间关系的方法，该方法衡量的是变量之间的线性相关性，结果的取值区间为[-1，1]，-1表示完全的负相关(这个变量下降，那个就会上升)，+1表示完全的正相关，0表示没有线性相关。</p>\n<p>Pearson Correlation速度快、易于计算，经常在拿到数据(经过清洗和特征提取之后的)之后第一时间就执行。<a href=\"https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.pearsonr.html\">Scipy的pearsonr方法</a>能够同时计算相关系数和p-value。</p><pre class=\"crayon-plain-tag\">import numpy as np\nfrom scipy.stats import pearsonr\n\nnp.random.seed(0)\nsize = 300\nx = np.random.normal(0, 1, size)\nprint(\"Lower noise\", pearsonr(x, x + np.random.normal(0, 1, size)))\nprint(\"Higher noise\", pearsonr(x, x + np.random.normal(0, 10, size)))\n\n# output:\n# Lower noise (0.7182483686213842, 7.324017312997672e-49)\n# Higher noise (0.05796429207933815, 0.31700993885325246)</pre><p>这个例子中，我们比较了变量在加入噪音之前和之后的差异。当噪音比较小的时候，相关性很强，p-value很低。</p>\n<p>Pearson相关系数的一个明显缺陷是，作为特征排序机制，他只对线性关系敏感。如果关系是非线性的，即便两个变量具有一一对应的关系，Pearson相关性也可能会接近0。</p><pre class=\"crayon-plain-tag\">import numpy as np\nfrom scipy.stats import pearsonr\n\nx = np.random.uniform(-1, 1, 100000)\nprint(pearsonr(x, x ** 2))\n\n# output:\n# (0.0020775478403054566, 0.511199686284783)</pre><p></p>\n<h3>Kendall秩相关系数</h3>\n<p>在统计学中，肯德尔相关系数是以<a href=\"http://en.wikipedia.org/wiki/Maurice_Kendall\">Maurice Kendall</a>命名的，并经常用希腊字母τ（tau）表示其值。肯德尔相关系数是一个用来测量两个随机变量相关性的统计值。一个肯德尔检验是一个无参数假设检验，它使用计算而得的相关系数去检验两个随机变量的统计依赖性。肯德尔相关系数的取值范围在-1到1之间，当τ为1时，表示两个随机变量拥有一致的等级相关性；当τ为-1时，表示两个随机变量拥有完全相反的等级相关性；当τ为0时，表示两个随机变量是相互独立的。</p>\n<p>原始的 Kendall 秩相关系数定义在一致对 (concordant pairs) 和分歧对 (discordant pairs) 的概念上。所谓一致对，就是两个变量取值的相对关系一致；分歧对则是指它们的相对关系不一致。这么说有点难以理解，简单的说就是将两个变量进行排序，判断两者的排序值是否一致。如果一致则为1，如果倒叙则为-1。<a href=\"https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.kendalltau.html\">Scipy的scipy.stats.kendalltau</a>提供的秩相关的检测方法：</p><pre class=\"crayon-plain-tag\">from scipy.stats import kendalltau\n\nx1 = [12, 2, 1, 12, 2]\nx2 = [1, 4, 7, 1, 0]\ntau, p_value = kendalltau(x1, x2)\nprint(tau, p_value)\n\n# output\n# -0.4714045207910316 0.2827454599327748</pre><p>肯德尔相关系数与斯皮尔曼相关系数对数据条件的要求相同。针对非线性数据有一定的误差。</p>\n<h3>Spearman等级相关系数</h3>\n<p>在统计学中，斯皮尔曼等级相关系数以Charles Spearman命名，并经常用希腊字母ρ（rho）表示其值。斯皮尔曼等级相关系数用来估计两个变量X、Y之间的相关性，其中变量间的相关性可以使用单调函数来描述。如果两个变量取值的两个集合中均不存在相同的两个元素，那么，当其中一个变量可以表示为另一个变量的很好的单调函数时（即两个变量的变化趋势相同），两个变量之间的ρ可以达到+1或-1。</p>\n<p>斯皮尔曼等级相关系数对数据条件的要求没有皮尔逊相关系数严格，只要两个变量的观测值是成对的等级评定资料，或者是由连续变量观测资料转化得到的等级资料，不论两个变量的总体分布形态、样本容量的大小如何，都可以用斯皮尔曼等级相关系数来进行研究。对于服从Pearson相关系数的数据亦可计算Spearman相关系数，但统计效能要低一些。Pearson相关系数的计算公式可以完全套用 Spearman相关系数计算公式，但公式中的x和y用相应的秩次代替即可。<a href=\"https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.spearmanr.html\">scipy.stats.spearmanr</a>：</p><pre class=\"crayon-plain-tag\">from scipy.stats import spearmanr\n\nx1 = [1, 2, 3, 4, 5]\nx2 = [5, 6, 7, 8, 7]\nrho, p_value = spearmanr(x1, x2)\nprint(rho, p_value)\n\n# output\n# 0.8207826816681233 0.08858700531354381</pre><p></p>\n<h3>相关性检测<span lang=\"EN-US\">Python</span>实战：</h3>\n<p></p><pre class=\"crayon-plain-tag\">import pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\ndf = pd.read_excel(\"data/train.xlsx\")\n\nplt.figure(figsize=(15, 13))\nsns.heatmap(df.corr(method=\"pearson\"), annot=True, vmin=-1, vmax=1, cmap='coolwarm', fmt=\".2f\")\nplt.title(\"pearson\")\nplt.savefig('corr_pearson.png')\n\nplt.figure(figsize=(15, 13))\nsns.heatmap(df.corr(method=\"kendall\"), annot=True, vmin=-1, vmax=1, cmap='coolwarm', fmt=\".2f\")\nplt.title(\"kendall\")\nplt.savefig('corr_kendall.png')\n\nplt.figure(figsize=(15, 13))\nsns.heatmap(df.corr(method=\"spearman\"), annot=True, vmin=-1, vmax=1, cmap='coolwarm', fmt=\".2f\")\nplt.title(\"spearman\")\nplt.savefig('corr_spearman.png')</pre><p><img class=\"alignnone wp-image-11482\" src=\"https://www.biaodianfu.com/wp-content/uploads/2020/05/pearson.png\" alt=\"\" width=\"693\" height=\"649\" srcset=\"https://www.biaodianfu.com/wp-content/uploads/2020/05/pearson.png 1159w, https://www.biaodianfu.com/wp-content/uploads/2020/05/pearson-300x281.png 300w, https://www.biaodianfu.com/wp-content/uploads/2020/05/pearson-1024x959.png 1024w, https://www.biaodianfu.com/wp-content/uploads/2020/05/pearson-768x719.png 768w\" sizes=\"(max-width: 693px) 100vw, 693px\" /></p>\n<p><img class=\"alignnone wp-image-11483\" src=\"https://www.biaodianfu.com/wp-content/uploads/2020/05/kendall.png\" alt=\"\" width=\"681\" height=\"638\" srcset=\"https://www.biaodianfu.com/wp-content/uploads/2020/05/kendall.png 1161w, https://www.biaodianfu.com/wp-content/uploads/2020/05/kendall-300x281.png 300w, https://www.biaodianfu.com/wp-content/uploads/2020/05/kendall-1024x960.png 1024w, https://www.biaodianfu.com/wp-content/uploads/2020/05/kendall-768x720.png 768w\" sizes=\"(max-width: 681px) 100vw, 681px\" /></p>\n<p><img class=\"alignnone wp-image-11484\" src=\"https://www.biaodianfu.com/wp-content/uploads/2020/05/spearman.png\" alt=\"\" width=\"681\" height=\"641\" srcset=\"https://www.biaodianfu.com/wp-content/uploads/2020/05/spearman.png 1156w, https://www.biaodianfu.com/wp-content/uploads/2020/05/spearman-300x283.png 300w, https://www.biaodianfu.com/wp-content/uploads/2020/05/spearman-1024x965.png 1024w, https://www.biaodianfu.com/wp-content/uploads/2020/05/spearman-768x723.png 768w\" sizes=\"(max-width: 681px) 100vw, 681px\" /></p>\n<h2>相关性分析Predictive Power Score（PPS）</h2>\n<h3>常用相关性分析存在的问题</h3>\n<p>1、有许多非线性的关系是分数根本无法检测到的，比如下图：</p>\n<p><img class=\"alignnone wp-image-11485\" src=\"https://www.biaodianfu.com/wp-content/uploads/2020/05/linear.png\" alt=\"\" width=\"677\" height=\"131\" srcset=\"https://www.biaodianfu.com/wp-content/uploads/2020/05/linear.png 1449w, https://www.biaodianfu.com/wp-content/uploads/2020/05/linear-300x58.png 300w, https://www.biaodianfu.com/wp-content/uploads/2020/05/linear-1024x199.png 1024w, https://www.biaodianfu.com/wp-content/uploads/2020/05/linear-768x149.png 768w\" sizes=\"(max-width: 677px) 100vw, 677px\" /></p>\n<p>2、计算出来的矩阵是对称的，即a与b的相关性同b与a的相同。更多的时候，关系是不对称的。一个有3个唯一值的列永远不可能完美地预测另一个有100个唯一值的列。 但事实可能恰恰相反。 显然，不对称很重要，因为它在现实世界中非常普遍。</p>\n<h3>Predictive Power Score (PPS)的实现逻辑</h3>\n<p>假设我们有两个列，想要计算 a 预测 b 的预测能力得分。 在这种情况下，我们将 b 视为目标变量，将 a 视为(唯一)特性。 我们现在可以计算一个交叉验证的决策树，并计算一个合适的评估度量。 当目标是数值时，我们可以使用决策树回归模型计算平均绝对误差(MAE)。 当目标是分类的，我们可以使用一个决策树分类器，并计算加权 F1。 你也可以使用其他的分数，比如 ROC 等。</p>\n<h3>PPS使用示例（Python）</h3>\n<p></p><pre class=\"crayon-plain-tag\">import pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport ppscore as pps\n\ndf = pd.read_excel(\"data/train.xlsx\")\n\nplt.figure(figsize=(15, 13))\nsns.heatmap(pps.matrix(df), annot=True, vmin=0, vmax=1, cmap='Blues', fmt=\".2f\")\nplt.title(\"Predictive Power Score\")\nplt.savefig('corr_pps.png')</pre><p>执行结果：</p>\n<p><img class=\"alignnone wp-image-11486\" src=\"https://www.biaodianfu.com/wp-content/uploads/2020/05/pps.png\" alt=\"\" width=\"714\" height=\"693\" srcset=\"https://www.biaodianfu.com/wp-content/uploads/2020/05/pps.png 1141w, https://www.biaodianfu.com/wp-content/uploads/2020/05/pps-300x291.png 300w, https://www.biaodianfu.com/wp-content/uploads/2020/05/pps-1024x994.png 1024w, https://www.biaodianfu.com/wp-content/uploads/2020/05/pps-768x746.png 768w\" sizes=\"(max-width: 714px) 100vw, 714px\" /></p>\n<p>参考链接：</p>\n<ul>\n<li><a href=\"https://towardsdatascience.com/rip-correlation-introducing-the-predictive-power-score-3d90808b9598\">https://towardsdatascience.com/rip-correlation-introducing-the-predictive-power-score-3d90808b9598</a></li>\n<li><a href=\"https://github.com/8080labs/ppscore\">https://github.com/8080labs/ppscore</a></li>\n</ul>\n<div class='yarpp-related-rss'>\n<p>Related posts:<ol>\n<li><a href=\"https://www.biaodianfu.com/python-correlation-analysis.html\" rel=\"bookmark\" title=\"使用Python进行相关性分析\">使用Python进行相关性分析 </a></li>\n<li><a href=\"https://www.biaodianfu.com/spearman-coefficient.html\" rel=\"bookmark\" title=\"相似度计算之斯皮尔曼等级相关系数\">相似度计算之斯皮尔曼等级相关系数 </a></li>\n<li><a href=\"https://www.biaodianfu.com/pearson-correlation-coefficient.html\" rel=\"bookmark\" title=\"相似度计算之皮尔逊相关系数\">相似度计算之皮尔逊相关系数 </a></li>\n</ol></p>\n</div>\n","descriptionType":"html","publishedDate":"Sat, 30 May 2020 10:51:03 +0000","feedId":51265,"bgimg":"https://www.biaodianfu.com/wp-content/uploads/2020/05/pearson.png","linkMd5":"b1675508442798bd8e269659c28b42f3","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx21/cdn24@2020_1/2020/10/19/04-02-23-747_a2ce61483e678180.webp","destWidth":1159,"destHeight":1085,"sourceBytes":377032,"destBytes":184112,"author":"标点符","articleImgCdnMap":{"https://www.biaodianfu.com/wp-content/uploads/2020/05/pearson.png":"https://cdn.jsdelivr.net/gh/myreaderx21/cdn24@2020_1/2020/10/19/04-02-23-747_a2ce61483e678180.webp","https://www.biaodianfu.com/wp-content/uploads/2020/05/kendall.png":"https://cdn.jsdelivr.net/gh/myreaderx6/cdn35@2020_2/2020/10/19/04-03-39-351_2d2bb2eb6c64a86d.webp","https://www.biaodianfu.com/wp-content/uploads/2020/05/spearman.png":"https://cdn.jsdelivr.net/gh/myreaderx2/cdn28@2020_1/2020/10/19/04-03-31-223_64a48ae8673a3b69.webp","https://www.biaodianfu.com/wp-content/uploads/2020/05/linear.png":"https://cdn.jsdelivr.net/gh/myreaderx12/cdn31@2020_5/2020/10/19/04-03-33-640_ec6095caff15263b.webp","https://www.biaodianfu.com/wp-content/uploads/2020/05/pps.png":"https://cdn.jsdelivr.net/gh/myreaderx13/cdn39@2020_3/2020/10/19/04-02-35-750_6c4cd2843908d336.webp"},"publishedOrCreatedDate":1603080138924}],"record":{"createdTime":"2020-10-19 12:02:18","updatedTime":"2020-10-19 12:02:18","feedId":51265,"fetchDate":"Mon, 19 Oct 2020 04:02:18 +0000","fetchMs":2026,"handleMs":4310,"totalMs":88140,"newArticles":0,"totalArticles":12,"status":1,"type":0,"ip":"968921f72eae30ea93929561be5caf5b","hostName":"us-001*","requestId":"8019a20142b04ca58caf508c75bd75b1_51265","contentType":"application/rss+xml; charset=UTF-8","totalBytes":777360,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":5,"articlesImgsGithubTotal":5,"successGithubMap":{"myreaderx6":1,"myreaderx21":1,"myreaderx2":1,"myreaderx12":1,"myreaderx13":1},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 03:59:47","updatedTime":"2020-10-14 10:07:29","id":51265,"name":"标点符","url":"https://www.biaodianfu.com/feed","subscriber":62,"website":null,"icon":"https://www.biaodianfu.com/favicon.ico","icon_jsdelivr":null,"description":"吾生也有涯，而知也无涯。以有涯随无涯，殆已！","weekly":null,"link":"https://www.biaodianfu.com"},"noPictureArticleList":[],"tmpCommonImgCdnBytes":184112,"tmpBodyImgCdnBytes":593248,"tmpBgImgCdnBytes":0,"extra4":{"start":1603080132354,"total":0,"statList":[{"spend":2261,"msg":"获取xml内容"},{"spend":4310,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":75577,"msg":"正文链接上传到cdn"}]},"extra5":5,"extra6":5,"extra7ImgCdnFailResultVector":[null,null,null],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-025.herokuapp.com/":{"failCount":0,"successCount":4,"resultList":[200,200,200,200]},"http://us-037.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://europe21.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://europe-59.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://www.biaodianfu.com/wp-content/uploads/2020/05/pearson.png","sourceStatusCode":200,"destWidth":1159,"destHeight":1085,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx21/cdn24@2020_1/2020/10/19/04-02-23-747_a2ce61483e678180.webp","sourceBytes":377032,"destBytes":184112,"targetWebpQuality":75,"feedId":51265,"totalSpendMs":5951,"convertSpendMs":71,"createdTime":"2020-10-19 12:02:18","host":"us-009*","referer":"https://www.biaodianfu.com/?p=11481","linkMd5ListStr":"b1675508442798bd8e269659c28b42f3,b1675508442798bd8e269659c28b42f3","githubUser":"myreaderx21","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"destSize":"179.8 KB","compressRate":"48.8%","sourceSize":"368.2 KB"},{"code":1,"isDone":false,"source":"https://www.biaodianfu.com/wp-content/uploads/2020/05/pps.png","sourceStatusCode":200,"destWidth":1141,"destHeight":1108,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx13/cdn39@2020_3/2020/10/19/04-02-35-750_6c4cd2843908d336.webp","sourceBytes":130674,"destBytes":168664,"targetWebpQuality":75,"feedId":51265,"totalSpendMs":12019,"convertSpendMs":118,"createdTime":"2020-10-19 12:02:24","host":"us-025*","referer":"https://www.biaodianfu.com/?p=11481","linkMd5ListStr":"b1675508442798bd8e269659c28b42f3","githubUser":"myreaderx13","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"destSize":"164.7 KB","compressRate":"129.1%","sourceSize":"127.6 KB"},{"code":1,"isDone":false,"source":"https://www.biaodianfu.com/wp-content/uploads/2020/05/spearman.png","sourceStatusCode":200,"destWidth":1156,"destHeight":1089,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx2/cdn28@2020_1/2020/10/19/04-03-31-223_64a48ae8673a3b69.webp","sourceBytes":382959,"destBytes":189256,"targetWebpQuality":75,"feedId":51265,"totalSpendMs":5844,"convertSpendMs":90,"createdTime":"2020-10-19 12:03:26","host":"us-025*","referer":"https://www.biaodianfu.com/?p=11481","linkMd5ListStr":"b1675508442798bd8e269659c28b42f3","githubUser":"myreaderx2","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"destSize":"184.8 KB","compressRate":"49.4%","sourceSize":"374 KB"},{"code":1,"isDone":false,"source":"https://www.biaodianfu.com/wp-content/uploads/2020/05/linear.png","sourceStatusCode":200,"destWidth":1449,"destHeight":281,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx12/cdn31@2020_5/2020/10/19/04-03-33-640_ec6095caff15263b.webp","sourceBytes":162028,"destBytes":50042,"targetWebpQuality":75,"feedId":51265,"totalSpendMs":8140,"convertSpendMs":46,"createdTime":"2020-10-19 12:03:26","host":"us-025*","referer":"https://www.biaodianfu.com/?p=11481","linkMd5ListStr":"b1675508442798bd8e269659c28b42f3","githubUser":"myreaderx12","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"destSize":"48.9 KB","compressRate":"30.9%","sourceSize":"158.2 KB"},{"code":1,"isDone":false,"source":"https://www.biaodianfu.com/wp-content/uploads/2020/05/kendall.png","sourceStatusCode":200,"destWidth":1161,"destHeight":1088,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx6/cdn35@2020_2/2020/10/19/04-03-39-351_2d2bb2eb6c64a86d.webp","sourceBytes":375134,"destBytes":185286,"targetWebpQuality":75,"feedId":51265,"totalSpendMs":15269,"convertSpendMs":165,"createdTime":"2020-10-19 12:03:25","host":"us-025*","referer":"https://www.biaodianfu.com/?p=11481","linkMd5ListStr":"b1675508442798bd8e269659c28b42f3","githubUser":"myreaderx6","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"destSize":"180.9 KB","compressRate":"49.4%","sourceSize":"366.3 KB"}],"successGithubMap":{"myreaderx6":1,"myreaderx21":1,"myreaderx2":1,"myreaderx12":1,"myreaderx13":1},"failGithubMap":{}}