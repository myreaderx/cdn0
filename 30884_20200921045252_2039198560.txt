{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-09-21 12:52:25","updatedTime":"2020-09-21 12:52:25","title":"【CVE-2019-16759】:pre-auth RCE in vBulletin 5.x","link":"http://chybeta.github.io/2019/09/28/【CVE-2019-16759】-pre-auth-RCE-in-vBulletin-5-x/","description":"<p>pre-auth RCE in vBulletin 5.x .</p> \n<p><a href=\"https://twitter.com/chybeta/status/1176702424045772800\" target=\"_blank\" rel=\"external\">https://twitter.com/chybeta/status/1176702424045772800</a></p> \n<p>中文： <a href=\"https://xz.aliyun.com/t/6419\" target=\"_blank\" rel=\"external\">https://xz.aliyun.com/t/6419</a><br><a id=\"more\"></a></br></p> \n<h1 id=\"0x01-Summary\"><a href=\"http://chybeta.github.io/2019/09/28/【CVE-2019-16759】-pre-auth-RCE-in-vBulletin-5-x/#0x01-Summary\" class=\"headerlink\" title=\"0x01 Summary\"></a>0x01 Summary</h1>\n<p><a href=\"https://seclists.org/fulldisclosure/2019/Sep/31\" target=\"_blank\" rel=\"external\">https://seclists.org/fulldisclosure/2019/Sep/31</a></p> \n<p><img src=\"https://xzfile.aliyuncs.com/media/upload/picture/20190925110357-1da1b282-df41-1.png\" alt=\"image.png\" /></p> \n<h1 id=\"0x02-Analysis\"><a href=\"http://chybeta.github.io/2019/09/28/【CVE-2019-16759】-pre-auth-RCE-in-vBulletin-5-x/#0x02-Analysis\" class=\"headerlink\" title=\"0x02 Analysis\"></a>0x02 Analysis</h1>\n<p>The first parameter <code>routestring</code> tell what template should vBulletin look for.</p> \n<p><img src=\"https://xzfile.aliyuncs.com/media/upload/picture/20190925112141-97aec176-df43-1.png\" alt=\"image.png\" /></p> \n<p>In the <code>callRender()</code>，<code>$routeInfo[2]</code> will be set as <code>widget_php</code> and <code>$params</code> will contains the render config <code>$widgetCongi[code]</code></p> \n<p><img src=\"https://xzfile.aliyuncs.com/media/upload/picture/20190925112241-bb67ba3c-df43-1.png\" alt=\"image.png\" /></p> \n<p>In <code>\\core\\install\\vbulletin-style.xml</code>，we can fidn a template named <code>widget_php</code> </p> \n<p><img src=\"https://xzfile.aliyuncs.com/media/upload/picture/20190925110854-cec45f9c-df41-1.png\" alt=\"image.png\" /></p> \n<p>So when <code>$widgetConfig['code']</code> is not null and the setting <code>disable_php_rendering</code> isn’t disabled, vBulletin will use the following syntax to render template：<br>\n  <figure class=\"highlight plain\">\n   <table>\n    <tr>\n     <td class=\"gutter\"><pre>\n       <div class=\"line\">\n        1\n       </div>\n       <div class=\"line\">\n        2\n       </div></pre></td>\n     <td class=\"code\"><pre>\n       <div class=\"line\">\n        {vb:action evaledPHP, bbcode, evalCode, {vb:raw widgetConfig.code}}\n       </div>\n       <div class=\"line\">\n        {vb:raw $evaledPHP}\n       </div></pre></td>\n    </tr>\n   </table>\n  </figure></br></p> \n<p>In <code>includes\\vb5\\frontend\\controller\\bbcode.php</code> , you can find how <code>evalCode</code> defined：</p> \n<p><img src=\"https://xzfile.aliyuncs.com/media/upload/picture/20190925111054-1602d960-df42-1.png\" alt=\"image.png\" /></p> \n<p>Finally cause PHP-Template injection and pre-auth RCE in vBulletin 5.x。</p> \n<h1 id=\"0x03-Reproduce\"><a href=\"http://chybeta.github.io/2019/09/28/【CVE-2019-16759】-pre-auth-RCE-in-vBulletin-5-x/#0x03-Reproduce\" class=\"headerlink\" title=\"0x03 Reproduce\"></a>0x03 Reproduce</h1>\n<p><img src=\"https://xzfile.aliyuncs.com/media/upload/picture/20190925124108-b1786d2c-df4e-1.png\" alt=\"image.png\" /></p>","descriptionType":"html","publishedDate":"Sat, 28 Sep 2019 00:21:34 +0000","feedId":30884,"bgimg":"https://xzfile.aliyuncs.com/media/upload/picture/20190925110357-1da1b282-df41-1.png","linkMd5":"91f36aa4937f73f2ed0e9aec26b22347","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx3/cdn7@2020_1/2020/09/21/04-52-31-898_52272a3b7dd63ed0.webp","destWidth":1362,"destHeight":1012,"sourceBytes":334902,"destBytes":156456,"author":"","articleImgCdnMap":{"https://xzfile.aliyuncs.com/media/upload/picture/20190925110357-1da1b282-df41-1.png":"https://cdn.jsdelivr.net/gh/myreaderx3/cdn7@2020_1/2020/09/21/04-52-31-898_52272a3b7dd63ed0.webp","https://xzfile.aliyuncs.com/media/upload/picture/20190925112141-97aec176-df43-1.png":"https://cdn.jsdelivr.net/gh/myreaderx2/cdn12@2020_3/2020/09/21/04-52-36-795_eff405909cf9c0d6.webp","https://xzfile.aliyuncs.com/media/upload/picture/20190925112241-bb67ba3c-df43-1.png":"https://cdn.jsdelivr.net/gh/myreaderx27/cdn16@2020_4/2020/09/21/04-52-50-988_5b31e97be8239b30.webp","https://xzfile.aliyuncs.com/media/upload/picture/20190925110854-cec45f9c-df41-1.png":"https://cdn.jsdelivr.net/gh/myreaderx14/cdn13@2020_2/2020/09/21/04-52-42-571_8922fe8e6ec1aac6.webp","https://xzfile.aliyuncs.com/media/upload/picture/20190925111054-1602d960-df42-1.png":"https://cdn.jsdelivr.net/gh/myreaderx31/cdn18@2020_5/2020/09/21/04-52-37-456_8449cf168c064477.webp","https://xzfile.aliyuncs.com/media/upload/picture/20190925124108-b1786d2c-df4e-1.png":"https://cdn.jsdelivr.net/gh/myreaderx5oss/cdn20@2020_5/2020/09/21/04-52-41-076_4e66f4321ac87562.webp"},"publishedOrCreatedDate":1600663945049}],"record":{"createdTime":"2020-09-21 12:52:25","updatedTime":"2020-09-21 12:52:25","feedId":30884,"fetchDate":"Mon, 21 Sep 2020 04:52:25 +0000","fetchMs":156,"handleMs":118,"totalMs":27243,"newArticles":0,"totalArticles":20,"status":1,"type":0,"ip":"bb68ba08b547c3cddc415a3fc1d525f9","hostName":"us-010*","requestId":"7458c11b48324a508c4f7e5ca440c0dc_30884","contentType":"application/xml","totalBytes":583572,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":6,"articlesImgsGithubTotal":6,"successGithubMap":{"myreaderx14":1,"myreaderx27":1,"myreaderx3":1,"myreaderx2":1,"myreaderx5oss":1,"myreaderx31":1},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 02:51:03","updatedTime":"2020-09-07 04:58:07","id":30884,"name":"Chybeta","url":"https://chybeta.github.io/atom.xml","subscriber":104,"website":null,"icon":"http://chybeta.github.io/favicon.ico?v=5.1.0","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx62/cdn36@2020_5/2020/09/06/20-58-06-242_68b9b22daa1d74c5.ico","description":"","weekly":null,"link":null},"noPictureArticleList":[],"tmpCommonImgCdnBytes":156456,"tmpBodyImgCdnBytes":427116,"tmpBgImgCdnBytes":0,"extra4":{"start":1600663944746,"total":0,"statList":[{"spend":186,"msg":"获取xml内容"},{"spend":118,"msg":"解释文章"},{"spend":1,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":19068,"msg":"正文链接上传到cdn"}]},"extra5":6,"extra6":6,"extra7ImgCdnFailResultVector":[],"extra10_invalidATagHrefValue":{"http://chybeta.github.io/2019/09/28/【CVE-2019-16759】-pre-auth-RCE-in-vBulletin-5-x/_#0x02-Analysis":"http://chybeta.github.io/2019/09/28/【CVE-2019-16759】-pre-auth-RCE-in-vBulletin-5-x/#0x02-Analysis","http://chybeta.github.io/2019/09/28/【CVE-2019-16759】-pre-auth-RCE-in-vBulletin-5-x/_#0x03-Reproduce":"http://chybeta.github.io/2019/09/28/【CVE-2019-16759】-pre-auth-RCE-in-vBulletin-5-x/#0x03-Reproduce","http://chybeta.github.io/2019/09/28/【CVE-2019-16759】-pre-auth-RCE-in-vBulletin-5-x/_#0x01-Summary":"http://chybeta.github.io/2019/09/28/【CVE-2019-16759】-pre-auth-RCE-in-vBulletin-5-x/#0x01-Summary"},"extra111_proxyServerAndStatMap":{"http://us-038.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-037.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-039.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-51.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-040.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://xzfile.aliyuncs.com/media/upload/picture/20190925110357-1da1b282-df41-1.png","sourceStatusCode":200,"destWidth":1362,"destHeight":1012,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx3/cdn7@2020_1/2020/09/21/04-52-31-898_52272a3b7dd63ed0.webp","sourceBytes":334902,"destBytes":156456,"targetWebpQuality":75,"feedId":30884,"totalSpendMs":7798,"convertSpendMs":88,"createdTime":"2020-09-21 12:52:25","host":"us-037*","referer":"http://chybeta.github.io/2019/09/28/【CVE-2019-16759】-pre-auth-RCE-in-vBulletin-5-x/","linkMd5ListStr":"91f36aa4937f73f2ed0e9aec26b22347,91f36aa4937f73f2ed0e9aec26b22347","githubUser":"myreaderx3","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"327.1 KB","destSize":"152.8 KB","compressRate":"46.7%"},{"code":1,"isDone":false,"source":"https://xzfile.aliyuncs.com/media/upload/picture/20190925112141-97aec176-df43-1.png","sourceStatusCode":200,"destWidth":944,"destHeight":195,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx2/cdn12@2020_3/2020/09/21/04-52-36-795_eff405909cf9c0d6.webp","sourceBytes":96495,"destBytes":32034,"targetWebpQuality":75,"feedId":30884,"totalSpendMs":5070,"convertSpendMs":74,"createdTime":"2020-09-21 12:52:32","host":"us-038*","referer":"http://chybeta.github.io/2019/09/28/【CVE-2019-16759】-pre-auth-RCE-in-vBulletin-5-x/","linkMd5ListStr":"91f36aa4937f73f2ed0e9aec26b22347","githubUser":"myreaderx2","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"94.2 KB","destSize":"31.3 KB","compressRate":"33.2%"},{"code":1,"isDone":false,"source":"https://xzfile.aliyuncs.com/media/upload/picture/20190925111054-1602d960-df42-1.png","sourceStatusCode":200,"destWidth":866,"destHeight":358,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx31/cdn18@2020_5/2020/09/21/04-52-37-456_8449cf168c064477.webp","sourceBytes":150997,"destBytes":54040,"targetWebpQuality":75,"feedId":30884,"totalSpendMs":5507,"convertSpendMs":38,"createdTime":"2020-09-21 12:52:32","host":"us-51*","referer":"http://chybeta.github.io/2019/09/28/【CVE-2019-16759】-pre-auth-RCE-in-vBulletin-5-x/","linkMd5ListStr":"91f36aa4937f73f2ed0e9aec26b22347","githubUser":"myreaderx31","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"147.5 KB","destSize":"52.8 KB","compressRate":"35.8%"},{"code":1,"isDone":false,"source":"https://xzfile.aliyuncs.com/media/upload/picture/20190925124108-b1786d2c-df4e-1.png","sourceStatusCode":200,"destWidth":1440,"destHeight":583,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx5oss/cdn20@2020_5/2020/09/21/04-52-41-076_4e66f4321ac87562.webp","sourceBytes":434517,"destBytes":113786,"targetWebpQuality":75,"feedId":30884,"totalSpendMs":9192,"convertSpendMs":101,"createdTime":"2020-09-21 12:52:32","host":"us-037*","referer":"http://chybeta.github.io/2019/09/28/【CVE-2019-16759】-pre-auth-RCE-in-vBulletin-5-x/","linkMd5ListStr":"91f36aa4937f73f2ed0e9aec26b22347","githubUser":"myreaderx5oss","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"424.3 KB","destSize":"111.1 KB","compressRate":"26.2%"},{"code":1,"isDone":false,"source":"https://xzfile.aliyuncs.com/media/upload/picture/20190925110854-cec45f9c-df41-1.png","sourceStatusCode":200,"destWidth":1593,"destHeight":622,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx14/cdn13@2020_2/2020/09/21/04-52-42-571_8922fe8e6ec1aac6.webp","sourceBytes":765013,"destBytes":121966,"targetWebpQuality":75,"feedId":30884,"totalSpendMs":10687,"convertSpendMs":106,"createdTime":"2020-09-21 12:52:32","host":"us-040*","referer":"http://chybeta.github.io/2019/09/28/【CVE-2019-16759】-pre-auth-RCE-in-vBulletin-5-x/","linkMd5ListStr":"91f36aa4937f73f2ed0e9aec26b22347","githubUser":"myreaderx14","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"747.1 KB","destSize":"119.1 KB","compressRate":"15.9%"},{"code":1,"isDone":false,"source":"https://xzfile.aliyuncs.com/media/upload/picture/20190925112241-bb67ba3c-df43-1.png","sourceStatusCode":200,"destWidth":1049,"destHeight":529,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx27/cdn16@2020_4/2020/09/21/04-52-50-988_5b31e97be8239b30.webp","sourceBytes":392206,"destBytes":105290,"targetWebpQuality":75,"feedId":30884,"totalSpendMs":19040,"convertSpendMs":50,"createdTime":"2020-09-21 12:52:32","host":"us-039*","referer":"http://chybeta.github.io/2019/09/28/【CVE-2019-16759】-pre-auth-RCE-in-vBulletin-5-x/","linkMd5ListStr":"91f36aa4937f73f2ed0e9aec26b22347","githubUser":"myreaderx27","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"383 KB","destSize":"102.8 KB","compressRate":"26.8%"}],"successGithubMap":{"myreaderx14":1,"myreaderx27":1,"myreaderx3":1,"myreaderx2":1,"myreaderx5oss":1,"myreaderx31":1},"failGithubMap":{}}