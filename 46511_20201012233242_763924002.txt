{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-10-13 07:32:21","updatedTime":"2020-10-13 07:32:21","title":"EditorWindowのOnGUIでマウスの位置を取得したい時はwantsMouseMoveを有効にする【Unity】【エディタ拡張】","link":"https://kan-kikuchi.hatenablog.com/entry/Editor_Window_Mouse_Position?utm_source=feed","description":"\n<ul>\n<li><a href=\"https://kan-kikuchi.hatenablog.com/entry/2013/11/25/000144\">&#x30A8;&#x30C7;&#x30A3;&#x30BF;&#x62E1;&#x5F35;&#x3068;&#x306F;</a></li>\n</ul><p> <br />\n <br />\nこの記事でのバージョン<br />\n<span style=\"color: #0000cc\">Unity 2019.4.9f1</span></p><br />\n<p></p>\n\n<div class=\"section\">\n    <h3>はじめに</h3>\n    <p>Unityのエディタ拡張には<span style=\"color: #0000cc\">簡単にウィンドウを作る事が出来るEditorWindow</span>があります。<br />\n<br />\n</p>\n<pre class=\"code lang-cs\" data-lang=\"cs\" data-unlink><span class=\"synStatement\">using</span> UnityEditor;\n\n<span class=\"synComment\">/// </span><span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">summary</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synComment\">/// EditorWindowのサンプル</span>\n<span class=\"synComment\">/// </span><span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">summary</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synType\">public</span> <span class=\"synType\">class</span> EditorWindowSample : EditorWindow {\n  \n  <span class=\"synComment\">//=================================================================================</span>\n  <span class=\"synComment\">//初期化</span>\n  <span class=\"synComment\">//=================================================================================</span>\n  \n  <span class=\"synComment\">//ウィンドウを開く</span>\n  [MenuItem(<span class=\"synConstant\">&quot;Tools/Editor Window Sample&quot;</span>)]\n  <span class=\"synType\">private</span> <span class=\"synType\">static</span> <span class=\"synType\">void</span> OpenWindow() {\n    GetWindow&lt;EditorWindowSample&gt;().Show();\n  }\n  \n}\n</pre>\n<table>\n    <tr>\n    <td><span itemscope itemtype=\"http://schema.org/Photograph\"><img src=\"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200909/20200909074333.jpg\" alt=\"f:id:kan_kikuchi:20200909074333j:plain\" title=\"f:id:kan_kikuchi:20200909074333j:plain\" class=\"hatena-fotolife\" itemprop=\"image\"></span></td>\n    </tr>\n</table><p><br />\n今回はそのEditorWindow上でのマウスの位置を取得する方法です。<br />\n<br />\n</p>\n\n<table>\n    <tr>\n    <td><span itemscope itemtype=\"http://schema.org/Photograph\"><img src=\"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200909/20200909081259.gif\" alt=\"f:id:kan_kikuchi:20200909081259g:plain\" title=\"f:id:kan_kikuchi:20200909081259g:plain\" class=\"hatena-fotolife\" itemprop=\"image\"></span></td>\n    </tr>\n</table><p> <br />\n <br />\n </p>\n\n</div>\n<div class=\"section\">\n    <h3>wantsMouseMove</h3>\n    <p>まず、<span style=\"color: #0000cc\">マウスの座標はEvent.current.mousePosition取得</span>できます。</p><p>ただし、EditorWindowのGUIを更新するメソッドである<span style=\"color: #ff0000\">OnGUIは常に実行されているわけではない</span>ので、</p><p>マウスの座標を表示しようとしてもカーソルがウィンドウから外れた時などにしか更新されません。<br />\n<br />\n</p>\n<pre class=\"code lang-cs\" data-lang=\"cs\" data-unlink><span class=\"synComment\">//表示するGUIの設定</span>\n<span class=\"synType\">private</span> <span class=\"synType\">void</span> OnGUI() {\n  EditorGUILayout.LabelField(<span class=\"synConstant\">&quot;マウスの位置&quot;</span>, Event.current.mousePosition.ToString());\n}\n</pre>\n<table>\n    <tr>\n    <td><span itemscope itemtype=\"http://schema.org/Photograph\"><img src=\"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200909/20200909075751.gif\" alt=\"f:id:kan_kikuchi:20200909075751g:plain\" title=\"f:id:kan_kikuchi:20200909075751g:plain\" class=\"hatena-fotolife\" itemprop=\"image\"></span></td>\n    </tr>\n</table><p><br />\nなので、OnGUIでマウスの位置を取得したい時は<span style=\"color: #0000cc\">wantsMouseMove</span>を有効にします。<br />\n<br />\n</p>\n\n    <blockquote>\n        <p>True に設定した場合、ウィンドウの上でマウスが動くたびにウィンドウは OnGUI 呼び出しを受信します。<br />\n注意: この関数は Repaint() を自動的に発生しません。</p>\n\n    </blockquote>\n<p><iframe src=\"https://hatenablog-parts.com/embed?url=https%3A%2F%2Fdocs.unity3d.com%2Fja%2F2018.4%2FScriptReference%2FEditorWindow-wantsMouseMove.html\" title=\"EditorWindow-wantsMouseMove - Unity スクリプトリファレンス\" class=\"embed-card embed-webcard\" scrolling=\"no\" frameborder=\"0\" style=\"display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;\"></iframe></p><br />\n<p>なおドキュメントにある通り、<span style=\"color: #ff0000\">Repaintは実行されない</span>ので別途実行する必要があります。<br />\n<br />\n</p>\n<pre class=\"code lang-cs\" data-lang=\"cs\" data-unlink><span class=\"synComment\">//表示するGUIの設定</span>\n<span class=\"synType\">private</span> <span class=\"synType\">void</span> OnGUI() {\n  EditorGUILayout.LabelField(<span class=\"synConstant\">&quot;マウスの位置&quot;</span>, Event.current.mousePosition.ToString());\n\n  <span class=\"synComment\">//wantsMouseMoveをトグルで切り替えられるように</span>\n  wantsMouseMove = EditorGUILayout.Toggle(<span class=\"synConstant\">&quot;wantsMouseMove&quot;</span>, wantsMouseMove);\n    \n  <span class=\"synComment\">//マウスが動いたら再描画(wantsMouseMoveが有効でないとOnGUI自体が呼ばれないの無意味)</span>\n  <span class=\"synStatement\">if</span> (Event.current.type == EventType.MouseMove) {\n    Repaint();\n  }\n}\n</pre>\n<table>\n    <tr>\n    <td><span itemscope itemtype=\"http://schema.org/Photograph\"><img src=\"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200909/20200909080508.gif\" alt=\"f:id:kan_kikuchi:20200909080508g:plain\" title=\"f:id:kan_kikuchi:20200909080508g:plain\" class=\"hatena-fotolife\" itemprop=\"image\"></span></td>\n    </tr>\n</table><p><br />\n余談ですがEditorWindowは<span style=\"color: #0000cc\">position.sizeでウィンドウのサイズ</span>を取得出来ます。</p><br />\n<p><iframe src=\"https://hatenablog-parts.com/embed?url=https%3A%2F%2Fkan-kikuchi.hatenablog.com%2Fentry%2FEditorWindow_Size\" title=\"EditorWindowの最小最大サイズや現在のサイズの取得と設定の方法【Unity】【エディタ拡張】 - (:3[kanのメモ帳]\" class=\"embed-card embed-blogcard\" scrolling=\"no\" frameborder=\"0\" style=\"display: block; width: 100%; height: 190px; max-width: 500px; margin: 10px 0px;\"></iframe></p><br />\n<p>ついでにウィンドウのサイズも表示してみると以下のような感じに。</p><p>ちなみに、<span style=\"color: #0000cc\">左上の座標が0, 0</span>になります<br />\n <br />\n </p>\n<pre class=\"code lang-cs\" data-lang=\"cs\" data-unlink><span class=\"synComment\">//表示するGUIの設定</span>\n<span class=\"synType\">private</span> <span class=\"synType\">void</span> OnGUI() {\n  EditorGUILayout.LabelField($<span class=\"synConstant\">&quot;ウィンドウのサイズ&quot;</span>, position.size.ToString());\n  EditorGUILayout.LabelField(<span class=\"synConstant\">&quot;マウスの位置&quot;</span>, Event.current.mousePosition.ToString());\n\n  <span class=\"synComment\">//wantsMouseMoveをトグルで切り替えられるように</span>\n  wantsMouseMove = EditorGUILayout.Toggle(<span class=\"synConstant\">&quot;wantsMouseMove&quot;</span>, wantsMouseMove);\n    \n  <span class=\"synComment\">//マウスが動いたら再描画(wantsMouseMoveが有効でないとOnGUI自体が呼ばれないの無意味)</span>\n  <span class=\"synStatement\">if</span> (Event.current.type == EventType.MouseMove) {\n    Repaint();\n  }\n}\n</pre>\n<table>\n    <tr>\n    <td><span itemscope itemtype=\"http://schema.org/Photograph\"><img src=\"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200909/20200909081259.gif\" alt=\"f:id:kan_kikuchi:20200909081259g:plain\" title=\"f:id:kan_kikuchi:20200909081259g:plain\" class=\"hatena-fotolife\" itemprop=\"image\"></span></td>\n    </tr>\n</table><p> <br />\n <hr></p>\n\n</div>","descriptionType":"html","publishedDate":"Thu, 01 Oct 2020 00:00:08 +0000","feedId":46511,"bgimg":"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200909/20200909081259.gif","linkMd5":"2d85b52cd56042219e7857ffe1c5c022","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx/cdn84@2020_1/2020/10/12/23-32-29-749_0c5ecf3934998824.webp","destWidth":640,"destHeight":492,"sourceBytes":1560821,"destBytes":1251506,"author":"kan_kikuchi","enclosureType":"image/gif","enclosureUrl":"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200909/20200909081259.gif","articleImgCdnMap":{"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200909/20200909074333.jpg":"https://cdn.jsdelivr.net/gh/myreaderx15/cdn87@2020_6/2020/10/12/23-32-32-253_feb4271a483d7959.webp","https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200909/20200909081259.gif":"https://cdn.jsdelivr.net/gh/myreaderx/cdn84@2020_1/2020/10/12/23-32-29-749_0c5ecf3934998824.webp","https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200909/20200909075751.gif":null,"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200909/20200909080508.gif":"https://cdn.jsdelivr.net/gh/myreaderx11/cdn95@2020_4/2020/10/12/23-32-38-371_3ee9b29200ba57eb.webp"},"publishedOrCreatedDate":1602545541817}],"record":{"createdTime":"2020-10-13 07:32:21","updatedTime":"2020-10-13 07:32:21","feedId":46511,"fetchDate":"Mon, 12 Oct 2020 23:32:21 +0000","fetchMs":1458,"handleMs":5499,"totalMs":28042,"newArticles":0,"totalArticles":30,"status":1,"type":0,"ip":"c95099efafc17f9e0beaf843cecd5c56","hostName":"us-52*","requestId":"7cee245f9b3640c7a93a27f12ce888f5_46511","contentType":"application/atom+xml; charset=utf-8","totalBytes":1989264,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":4,"articlesImgsGithubTotal":3,"successGithubMap":{"myreaderx15":1,"myreaderx11":1,"myreaderx":1},"failGithubMap":{"myreaderx14":1}},"feed":{"createdTime":"2020-09-07 03:42:03","updatedTime":"2020-09-07 06:00:51","id":46511,"name":"(:3[kanのメモ帳]","url":"http://kan-kikuchi.hatenablog.com/feed","subscriber":69,"website":null,"icon":"https://kan-kikuchi.hatenablog.com/favicon.ico","icon_jsdelivr":null,"description":"個人ゲーム開発者kan.kikuchiのメモ的技術ブログ。月木更新でUnity関連がメイン。","weekly":null,"link":"https://kan-kikuchi.hatenablog.com"},"noPictureArticleList":[{"createdTime":"2020-10-13 07:32:42","updatedTime":"2020-10-13 07:32:42","id":null,"feedId":46511,"linkMd5":"2d85b52cd56042219e7857ffe1c5c022"}],"tmpCommonImgCdnBytes":1251506,"tmpBodyImgCdnBytes":737758,"tmpBgImgCdnBytes":0,"extra4":{"start":1602545534655,"total":0,"statList":[{"spend":1663,"msg":"获取xml内容"},{"spend":5499,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":10724,"msg":"正文链接上传到cdn"}]},"extra5":4,"extra6":4,"extra7ImgCdnFailResultVector":[{"code":1,"isDone":false,"source":"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200909/20200909075751.gif","sourceStatusCode":200,"destWidth":640,"destHeight":407,"sourceBytes":531729,"destBytes":401344,"targetWebpQuality":75,"feedId":46511,"totalSpendMs":5313,"convertSpendMs":3798,"createdTime":"2020-10-13 07:32:31","host":"us-038*","referer":"https://kan-kikuchi.hatenablog.com/entry/Editor_Window_Mouse_Position?utm_source=feed","linkMd5ListStr":"2d85b52cd56042219e7857ffe1c5c022","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx14/cdn91/contents/2020/10/12/23-32-37-217_9eb275c7b26b984c.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 68584859.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Mon, 12 Oct 2020 23:32:37 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"status":["403 Forbidden"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["C0E8:1D65:16C4E2E:30487E0:5F84E78B"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, read:packages, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1602547518"],"x-ratelimit-used":["61"],"x-xss-protection":["1; mode=block"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx14/cdn91/contents/2020/10/12/23-32-37-217_9eb275c7b26b984c.webp","historyStatusCode":[],"spendMs":82},"base64UserPassword":null,"token":"6b67d******************************91b08"},"githubUser":"myreaderx14","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"519.3 KB","destSize":"391.9 KB","compressRate":"75.5%"},{"code":1,"isDone":false,"source":"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200909/20200909075751.gif","sourceStatusCode":200,"destWidth":640,"destHeight":407,"sourceBytes":531729,"destBytes":401344,"targetWebpQuality":75,"feedId":46511,"totalSpendMs":5314,"convertSpendMs":3785,"createdTime":"2020-10-13 07:32:37","host":"europe61*","referer":"https://kan-kikuchi.hatenablog.com/entry/Editor_Window_Mouse_Position?utm_source=feed","linkMd5ListStr":"2d85b52cd56042219e7857ffe1c5c022","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx14/cdn91/contents/2020/10/12/23-32-41-977_9eb275c7b26b984c.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 68584859.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Mon, 12 Oct 2020 23:32:42 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"status":["403 Forbidden"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["9232:2F1F:C91435D:EB41ED3:5F84E791"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, read:packages, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1602547518"],"x-ratelimit-used":["61"],"x-xss-protection":["1; mode=block"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx14/cdn91/contents/2020/10/12/23-32-41-977_9eb275c7b26b984c.webp","historyStatusCode":[],"spendMs":681},"base64UserPassword":null,"token":"6b67d******************************91b08"},"githubUser":"myreaderx14","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"519.3 KB","destSize":"391.9 KB","compressRate":"75.5%"}],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-038.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://europe61.herokuapp.com/":{"failCount":0,"successCount":2,"resultList":[200,200]},"http://us-026.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200909/20200909081259.gif","sourceStatusCode":200,"destWidth":640,"destHeight":492,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx/cdn84@2020_1/2020/10/12/23-32-29-749_0c5ecf3934998824.webp","sourceBytes":1560821,"destBytes":1251506,"targetWebpQuality":75,"feedId":46511,"totalSpendMs":9966,"convertSpendMs":7519,"createdTime":"2020-10-13 07:32:21","host":"europe-23*","referer":"https://kan-kikuchi.hatenablog.com/entry/Editor_Window_Mouse_Position?utm_source=feed","linkMd5ListStr":"2d85b52cd56042219e7857ffe1c5c022,2d85b52cd56042219e7857ffe1c5c022,2d85b52cd56042219e7857ffe1c5c022","githubUser":"myreaderx","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"1.5 MB","destSize":"1.2 MB","compressRate":"80.2%"},{"code":1,"isDone":false,"source":"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200909/20200909074333.jpg","sourceStatusCode":200,"destWidth":788,"destHeight":728,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx15/cdn87@2020_6/2020/10/12/23-32-32-253_feb4271a483d7959.webp","sourceBytes":25129,"destBytes":13584,"targetWebpQuality":75,"feedId":46511,"totalSpendMs":1113,"convertSpendMs":16,"createdTime":"2020-10-13 07:32:32","host":"europe61*","referer":"https://kan-kikuchi.hatenablog.com/entry/Editor_Window_Mouse_Position?utm_source=feed","linkMd5ListStr":"2d85b52cd56042219e7857ffe1c5c022","githubUser":"myreaderx15","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"24.5 KB","destSize":"13.3 KB","compressRate":"54.1%"},{"code":1,"isDone":false,"source":"https://cdn-ak.f.st-hatena.com/images/fotolife/k/kan_kikuchi/20200909/20200909080508.gif","sourceStatusCode":200,"destWidth":640,"destHeight":407,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx11/cdn95@2020_4/2020/10/12/23-32-38-371_3ee9b29200ba57eb.webp","sourceBytes":854622,"destBytes":724174,"targetWebpQuality":75,"feedId":46511,"totalSpendMs":7992,"convertSpendMs":4916,"createdTime":"2020-10-13 07:32:31","host":"us-026*","referer":"https://kan-kikuchi.hatenablog.com/entry/Editor_Window_Mouse_Position?utm_source=feed","linkMd5ListStr":"2d85b52cd56042219e7857ffe1c5c022","githubUser":"myreaderx11","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"834.6 KB","destSize":"707.2 KB","compressRate":"84.7%"}],"successGithubMap":{"myreaderx15":1,"myreaderx11":1,"myreaderx":1},"failGithubMap":{"myreaderx14":1}}