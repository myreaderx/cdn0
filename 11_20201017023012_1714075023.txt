{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-10-17 10:29:44","updatedTime":"2020-10-17 10:29:44","title":"Danger of Changing Default of log_error_verbosity on MySQL/Percona Server for MySQL 5.7","link":"https://www.percona.com/blog/?p=72083","description":"<img width=\"200\" height=\"112\" src=\"https://www.percona.com/blog/wp-content/uploads/2020/10/Changing-Default-of-log_error_verbosity-200x112.png\" class=\"webfeedsFeaturedVisual wp-post-image\" alt=\"Changing Default of log_error_verbosity mysql\" loading=\"lazy\" style=\"display: block; margin-bottom: 5px; clear:both;max-width: 100%;\" link_thumbnail=\"\" srcset=\"https://www.percona.com/blog/wp-content/uploads/2020/10/Changing-Default-of-log_error_verbosity-200x112.png 200w, https://www.percona.com/blog/wp-content/uploads/2020/10/Changing-Default-of-log_error_verbosity-300x168.png 300w, https://www.percona.com/blog/wp-content/uploads/2020/10/Changing-Default-of-log_error_verbosity-1024x572.png 1024w, https://www.percona.com/blog/wp-content/uploads/2020/10/Changing-Default-of-log_error_verbosity-367x205.png 367w, https://www.percona.com/blog/wp-content/uploads/2020/10/Changing-Default-of-log_error_verbosity.png 1200w\" sizes=\"(max-width: 200px) 100vw, 200px\" /><p><img loading=\"lazy\" class=\"alignright size-medium wp-image-72118\" src=\"https://www.percona.com/blog/wp-content/uploads/2020/10/Changing-Default-of-log_error_verbosity-300x168.png\" alt=\"Changing Default of log_error_verbosity mysql\" width=\"300\" height=\"168\" srcset=\"https://www.percona.com/blog/wp-content/uploads/2020/10/Changing-Default-of-log_error_verbosity-300x168.png 300w, https://www.percona.com/blog/wp-content/uploads/2020/10/Changing-Default-of-log_error_verbosity-1024x572.png 1024w, https://www.percona.com/blog/wp-content/uploads/2020/10/Changing-Default-of-log_error_verbosity-200x112.png 200w, https://www.percona.com/blog/wp-content/uploads/2020/10/Changing-Default-of-log_error_verbosity-367x205.png 367w, https://www.percona.com/blog/wp-content/uploads/2020/10/Changing-Default-of-log_error_verbosity.png 1200w\" sizes=\"(max-width: 300px) 100vw, 300px\" />Changing the default value (3) of log_error_verbosity in MySQL/Percona Server for MySQL 5.7 can have a hidden unintended effect! What does log_error_verbosity do exactly? As per the documentation:</p>\n<p>“<em>The log_error_verbosity system variable specifies the verbosity for handling events intended for the error log.</em>“</p>\n<p>Basically a value of 1 logs only [Errors]; 2 is 1)+[Warnings]; and 3 is 2)+[Notes].</p>\n<p>For example, one might be tempted to change the default of log_error_verbosity since the error.log might be bloated with thousands (or millions) of lines with [Notes], such as:</p><pre class=\"crayon-plain-tag\">2020-10-08T17:02:56.736179Z 3 [Note] Access denied for user 'root'@'localhost' (using password: NO)\n2020-10-08T17:04:48.149038Z 4 [Note] Aborted connection 4 to db: 'unconnected' user: 'root' host: 'localhost' (Got timeout reading communication packets)</pre><p>(P.S. you can read more about those Notes on this other Percona blog posts):</p>\n<p><span><a target=\"_blank\" href=\"https://www.percona.com/blog/2019/07/05/fixing-a-mysql-1045-error/\">Fixing MySQL 1045 Error: Access Denied</a></span></p>\n<p><span><a target=\"_blank\" href=\"https://www.percona.com/blog/2016/05/16/mysql-got-an-error-reading-communication-packet-errors/\">MySQL “Got an error reading communication packet”</a></span></p>\n<p>The problem is, after lowering log_error_verbosity to 1 or 2, no messages about server startup or shutdown would be printed to the log! That can really make troubleshooting really hard in the event of issues or system failure.  For completeness, on error.log from 5.7 at startup with default log_error_verbosity, the following should be seen:</p><pre class=\"crayon-plain-tag\">2020-10-08T16:36:07.302168Z 0 [Note] InnoDB: PUNCH HOLE support available\n2020-10-08T16:36:07.302188Z 0 [Note] InnoDB: Mutexes and rw_locks use GCC atomic builtins\n...\n2020-10-08T16:36:07.303998Z 0 [Note] InnoDB: Initializing buffer pool, total size = 128M, instances = 1, chunk size = 128M\n2020-10-08T16:36:07.307823Z 0 [Note] InnoDB: Completed initialization of buffer pool\n...\n2020-10-08T16:36:07.497571Z 0 [Note] /usr/sbin/mysqld: ready for connections.</pre><p>And on shutdown:</p><pre class=\"crayon-plain-tag\">2020-10-08T16:36:10.447002Z 0 [Note] Giving 0 client threads a chance to die gracefully\n2020-10-08T16:36:10.447022Z 0 [Note] Shutting down slave threads\n2020-10-08T16:36:10.447027Z 0 [Note] Forcefully disconnecting 0 remaining clients\n…\n2020-10-08T16:36:12.104099Z 0 [Note] /usr/sbin/mysqld: Shutdown complete</pre><p>With log_error_verbosity =2, there won&#8217;t be messages about MySQL startup, but some warnings that are only printed at startup might give a hint of the time of server restart such as:</p><pre class=\"crayon-plain-tag\">2020-10-08T16:30:21.966844Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).\n2020-10-08T16:30:22.181367Z 0 [Warning] CA certificate ca.pem is self signed.\n2020-10-08T16:30:22.221732Z 0 [Warning] Changed limits: table_open_cache: 431 (requested 6000)</pre><p>If there is no information about server restart, system logs can be checked for information about restarts:</p><pre class=\"crayon-plain-tag\"># cat /var/log/messages \n...\nOct  8 16:31:25 carlos-tutte-latest57-standalone-1 systemd: Starting MySQL Server...\nOct  8 16:31:26 carlos-tutte-latest57-standalone-1 systemd: Started MySQL Server.</pre><p>If still no clue when was MySQL last started, checking the “<a target=\"_blank\" href=\"https://dev.mysql.com/doc/refman/8.0/en/server-status-variables.html\">Uptime</a>” status variable can help in calculating the last startup.</p>\n<p>The problem does NOT occur on MySQL/Percona Server for MySQL 8.0 since even with log_error_verbosity = 1, the following startup/shutdown lines are printed on the error.log:</p><pre class=\"crayon-plain-tag\">2020-10-08T16:31:54.532504Z 0 [System] [MY-010116] [Server] /usr/sbin/mysqld (mysqld 8.0.20-11) starting as process 1052\n2020-10-08T16:31:54.540342Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.\n2020-10-08T16:31:55.026815Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.\n2020-10-08T16:31:55.136125Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Socket: '/var/lib/mysql/mysqlx.sock' bind-address: '::' port: 33060\n2020-10-08T16:31:55.270669Z 0 [System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections. Version: '8.0.20-11'  socket: '/var/lib/mysql/mysql.sock'  port: 3306  Percona Server (GPL), Release 11, Revision 5b5a5d2.\n2020-10-08T16:32:01.708932Z 0 [System] [MY-010910] [Server] /usr/sbin/mysqld: Shutdown complete (mysqld 8.0.20-11)  Percona Server (GPL), Release 11, Revision 5b5a5d2.</pre><p>In conclusion, if possible, avoid changing the default of log_error_verbosity on MySQL/Percona Server for MySQL 5.7. And if you need to change it, do it online with SET GLOBAL instead of through the config file, since, in the event of a restart, startup messages won’t be logged.</p>\n","descriptionType":"html","publishedDate":"Fri, 16 Oct 2020 18:29:10 +0000","feedId":11,"bgimg":"","linkMd5":"0125903b9bc7cf3b44c34cf78aa1dcde","bgimgJsdelivr":"","metaImg":"","author":"Carlos Tutte","articleImgCdnMap":{"https://www.percona.com/blog/wp-content/uploads/2020/10/Changing-Default-of-log_error_verbosity-200x112.png":"https://cdn.jsdelivr.net/gh/myreaderx5oss/cdn77@2020_1/2020/10/17/02-29-59-464_666239d1c138885d.webp","https://www.percona.com/blog/wp-content/uploads/2020/10/Changing-Default-of-log_error_verbosity-300x168.png":"https://cdn.jsdelivr.net/gh/myreaderx11/cdn76@2020_5/2020/10/17/02-30-11-407_7af743b538f33abb.webp"},"publishedOrCreatedDate":1602901784716}],"record":{"createdTime":"2020-10-17 10:29:44","updatedTime":"2020-10-17 10:29:44","feedId":11,"fetchDate":"Sat, 17 Oct 2020 02:29:44 +0000","fetchMs":143,"handleMs":182,"totalMs":28431,"newArticles":0,"totalArticles":40,"status":1,"type":0,"ip":"f6db38fc16ee9e62fc92cadc75f25f6b","hostName":"us-005*","requestId":"a1c553e2c5e3422bb6d33088b5f88d24_11","contentType":"application/rss+xml; charset=UTF-8","totalBytes":16692,"bgimgsTotal":0,"bgimgsGithubTotal":0,"articlesImgsTotal":2,"articlesImgsGithubTotal":2,"successGithubMap":{"myreaderx11":1,"myreaderx5oss":1},"failGithubMap":{}},"feed":{"createdTime":"2020-05-30 17:21:38","updatedTime":"2020-09-01 09:23:03","id":11,"name":"Percona Database Performance Blog","url":"https://www.percona.com/blog/feed/","subscriber":null,"website":null,"icon":"https://www.percona.com/blog/wp-content/uploads/2018/09/percona-32x32.png","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx63/cdn89@2020_6/2020/09/01/01-23-01-358_b72bb3b39c378fe6.png","description":"","weekly":null,"link":null},"noPictureArticleList":[],"tmpCommonImgCdnBytes":0,"tmpBodyImgCdnBytes":16692,"tmpBgImgCdnBytes":0,"extra4":{"start":1602901784366,"total":0,"statList":[{"spend":168,"msg":"获取xml内容"},{"spend":182,"msg":"解释文章"},{"spend":3,"msg":"上传封面图到cdn"},{"spend":1,"msg":"修正封面图上传失败重新上传"},{"spend":28068,"msg":"正文链接上传到cdn"}]},"extra5":2,"extra6":2,"extra7ImgCdnFailResultVector":[],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-013.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-012.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://www.percona.com/blog/wp-content/uploads/2020/10/Changing-Default-of-log_error_verbosity-200x112.png","sourceStatusCode":200,"destWidth":200,"destHeight":112,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx5oss/cdn77@2020_1/2020/10/17/02-29-59-464_666239d1c138885d.webp","sourceBytes":21163,"destBytes":5812,"targetWebpQuality":75,"feedId":11,"totalSpendMs":1376,"convertSpendMs":9,"createdTime":"2020-10-17 10:29:59","host":"us-013*","referer":"https://www.percona.com/blog/?p=72083","linkMd5ListStr":"0125903b9bc7cf3b44c34cf78aa1dcde","githubUser":"myreaderx5oss","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"20.7 KB","destSize":"5.7 KB","compressRate":"27.5%"},{"code":1,"isDone":false,"source":"https://www.percona.com/blog/wp-content/uploads/2020/10/Changing-Default-of-log_error_verbosity-300x168.png","sourceStatusCode":200,"destWidth":300,"destHeight":168,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx11/cdn76@2020_5/2020/10/17/02-30-11-407_7af743b538f33abb.webp","sourceBytes":39204,"destBytes":10880,"targetWebpQuality":75,"feedId":11,"totalSpendMs":1492,"convertSpendMs":101,"createdTime":"2020-10-17 10:30:10","host":"us-012*","referer":"https://www.percona.com/blog/?p=72083","linkMd5ListStr":"0125903b9bc7cf3b44c34cf78aa1dcde","githubUser":"myreaderx11","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"38.3 KB","destSize":"10.6 KB","compressRate":"27.8%"}],"successGithubMap":{"myreaderx11":1,"myreaderx5oss":1},"failGithubMap":{}}