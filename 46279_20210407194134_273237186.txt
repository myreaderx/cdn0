{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2021-04-08 03:39:49","updatedTime":"2021-04-08 03:39:49","title":"Specifying Per-Site Policy with Chromium’s URL Filter Format","link":"http://textslashplain.com/?p=3948","description":"\n<p>Chromium-based browsers like Microsoft Edge make <a href=\"https://textslashplain.com/2020/01/30/security-zones-in-edge/\">very limited use</a> of Windows Security Zones. Instead, most <a href=\"https://textslashplain.com/2021/03/29/per-site-permissions-in-edge/\">permissions and features</a> that offer administrators per-site configuration via <a href=\"https://chromeenterprise.google/policies/\">policy</a> rely on lists of rules in the <strong>URL Filter Format</strong>.</p>\n\n\n\n<p>Filters are expressed in a <a href=\"https://www.chromium.org/administrators/url-blocklist-filter-format\">syntax</a> that is <em>similar </em>to other matching rules, but different enough to cause confusion. For instance, consider a <code>URLBlocklist</code> rule expressed as follows:</p>\n\n\n\n<figure class=\"wp-block-image size-large\"><a href=\"https://textplain.files.wordpress.com/2021/03/image-3.png\"><img data-attachment-id=\"3953\" data-permalink=\"https://textslashplain.com/image-3-11/\" data-orig-file=\"https://textplain.files.wordpress.com/2021/03/image-3.png\" data-orig-size=\"935,145\" data-comments-opened=\"1\" data-image-meta=\"{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}\" data-image-title=\"image-3\" data-image-description=\"\" data-medium-file=\"https://textplain.files.wordpress.com/2021/03/image-3.png?w=300\" data-large-file=\"https://textplain.files.wordpress.com/2021/03/image-3.png?w=750\" src=\"https://textplain.files.wordpress.com/2021/03/image-3.png?w=935\" alt=\"\" class=\"wp-image-3953\" srcset=\"https://textplain.files.wordpress.com/2021/03/image-3.png 935w, https://textplain.files.wordpress.com/2021/03/image-3.png?w=150 150w, https://textplain.files.wordpress.com/2021/03/image-3.png?w=300 300w, https://textplain.files.wordpress.com/2021/03/image-3.png?w=768 768w\" sizes=\"(max-width: 935px) 100vw, 935px\" /></a></figure>\n\n\n\n<p>These filters don&#8217;t work as expected. The HTTPS rule should not have a trailing * in the path component (it won&#8217;t match anything), while the <strong><code>data: </code></strong>rule requires a trailing<strong> <code>*</code></strong> to function. </p>\n\n\n\n<p>The syntax has a few other oddities as well: </p>\n\n\n\n<ul><li>A leading dot before the host means <strong>exactly match</strong>; the filter <code><strong>.</strong>example.com</code> matches just <code><a href=\"https://example.com\" rel=\"nofollow\">https://example.com</a></code> but not <code>https://<strong>www.</strong>example.com</code></li><li>You may specify a path prefix (<code>example.com/foo</code>) but you must not include a wildcard <code><strong>*</strong></code> anywhere in the path</li><li>You may specify wildcards in a query (<code>example.com?bar=*</code>); you may omit the path to have the querystring checked on all pages, or include a path to only check the querystring on pages within the path.</li><li>A rule of <code>blob:*</code> doesn&#8217;t seem to match blob URLs, while a rule of <code>data:*</code> does seem to match all data URLs.</li></ul>\n\n\n\n<p>Unfortunately, there&#8217;s not a great debugger for figuring out the proper syntax. You can use the <code>chrome://policy</code> page to see whether Chrome finds any glaring error in the policy:</p>\n\n\n\n<figure class=\"wp-block-image size-large\"><a href=\"https://textplain.files.wordpress.com/2021/03/image-4.png\"><img data-attachment-id=\"3955\" data-permalink=\"https://textslashplain.com/image-4-11/\" data-orig-file=\"https://textplain.files.wordpress.com/2021/03/image-4.png\" data-orig-size=\"1317,516\" data-comments-opened=\"1\" data-image-meta=\"{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}\" data-image-title=\"image-4\" data-image-description=\"\" data-medium-file=\"https://textplain.files.wordpress.com/2021/03/image-4.png?w=300\" data-large-file=\"https://textplain.files.wordpress.com/2021/03/image-4.png?w=750\" src=\"https://textplain.files.wordpress.com/2021/03/image-4.png?w=1024\" alt=\"\" class=\"wp-image-3955\" srcset=\"https://textplain.files.wordpress.com/2021/03/image-4.png?w=1024 1024w, https://textplain.files.wordpress.com/2021/03/image-4.png?w=150 150w, https://textplain.files.wordpress.com/2021/03/image-4.png?w=300 300w, https://textplain.files.wordpress.com/2021/03/image-4.png?w=768 768w, https://textplain.files.wordpress.com/2021/03/image-4.png 1317w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" /></a></figure>\n\n\n\n<p>&#8230;but short of <em>testing </em>your policy there&#8217;s not a great way to verify it does what you hope.</p>\n\n\n\n<h4>Q: The problem of <em>special</em>-URLs</h4>\n\n\n\n<p>There are a variety of <em>special </em>URLs (particularly<strong> <code>blob</code></strong> and <strong><code>data</code></strong>) that do not directly express a hostname&#8211; instead, the URL exists within a <em>security context </em>that is not included in the URL itself. This can cause problems for Policies if the code implementing the policy does not check the URL of the <em>security context</em> and looks only at the blob/data URL directly. A system administrator might set a policy for downloads from <code><a href=\"https://example.com/download\" rel=\"nofollow\">https://example.com/download</a></code>, but if download page on that site uses a <a href=\"https://textslashplain.com/2018/08/06/script-generated-download-files/\">script-generated file download</a> (e.g. a <code>blob</code>), the policy check might overlook the rule for <code>example.com</code> because it checks just the <code>blob:</code> URL.</p>\n\n\n\n<p>An example bug can be found <a href=\"https://bugs.chromium.org/p/chromium/issues/detail?id=1152473\">here</a>.</p>\n\n\n\n<h4>Q: Can filters match on a site’s IP?</h4>\n\n\n\n<p>The&#160;<a href=\"https://docs.microsoft.com/en-us/DeployEdge/edge-learnmmore-url-list-filter%20format\">Permissions system’s “Site Lists”</a>&#160;feature does not support specifying an IP-range for allow and block lists.</p>\n\n\n\n<p>It does support specification of individual IP <strong>literals</strong>, but such rules are only respected if the user navigates to the site using said literal (e.g.&#160;<a href=\"https://127.0.0.1/\">http://127.0.0.1/</a>). If a hostname is used (<a href=\"http://localhost/\">http://localhost</a>), the IP Literal rule will not be respected even though the resolved IP of the host matches the filter-listed IP.</p>\n\n\n\n<h4>Q: Can filters match <em>just </em>dotless hostnames?</h4>\n\n\n\n<p>Not today, no. You must individually list each desired hostname, e.g. (<code><a href=\"https://payroll\" rel=\"nofollow\">https://payroll</a>, <a href=\"https://stock\" rel=\"nofollow\">https://stock</a>, <a href=\"https://who\" rel=\"nofollow\">https://who</a></code>,  etc).</p>\n\n\n\n<p>Chromium&#8217;s URL Filter Format is convenient if your intranet is structured under one private domain (e.g. <code>*.intranet.example.com</code>) but is much less convenient if your Intranet uses dotless hostnames (<a href=\"http://example\" rel=\"nofollow\">http://example</a>) or many disjoint private domains.</p>\n\n\n\n<p>The ability to match only hostnames not containing dots would be convenient to accommodate the old IE behavior whereby Windows would map dotless hostnames to the <a href=\"https://docs.microsoft.com/en-us/archive/blogs/ieinternals/the-intranet-zone\">Local Intranet Zone by default</a>. (<em>To my surprise, there&#8217;s been no significant demand for this capability in the first year of Edge&#8217;s existence, so perhaps corporate intranets are no longer using dotless hostnames very much?</em>)</p>\n\n\n\n<p></p>\n\n\n\n<h2>References</h2>\n\n\n\n<ul><li><a href=\"https://docs.microsoft.com/en-us/DeployEdge/edge-learnmmore-url-list-filter%20format\">Edge Docs: Filter format for URL list-based policies</a></li><li><a href=\"https://www.chromium.org/administrators/url-blocklist-filter-format\">Chrome Docs: URL list filter format</a> </li></ul>\n","descriptionType":"html","publishedDate":"Mon, 29 Mar 2021 22:22:21 +0000","feedId":46279,"bgimg":"https://textplain.files.wordpress.com/2021/03/image-3.png?w=935","linkMd5":"66dcb9f7ca1cd7015b359fb4146adccc","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx/cdn4@2020_1/2021/04/07/19-40-15-705_9b8f31e9995596c1.webp","destWidth":935,"destHeight":145,"sourceBytes":41864,"destBytes":11920,"author":"ericlaw","articleImgCdnMap":{"https://textplain.files.wordpress.com/2021/03/image-3.png?w=935":"https://cdn.jsdelivr.net/gh/myreaderx/cdn4@2020_1/2021/04/07/19-40-15-705_9b8f31e9995596c1.webp","https://textplain.files.wordpress.com/2021/03/image-4.png?w=1024":"https://cdn.jsdelivr.net/gh/myreaderx13/cdn7@2020_4/2021/04/07/19-41-33-540_77fe55e6fb49c246.webp"},"publishedOrCreatedDate":1617824389104}],"record":{"createdTime":"2021-04-08 03:39:49","updatedTime":"2021-04-08 03:39:49","feedId":46279,"fetchDate":"Wed, 07 Apr 2021 19:39:49 +0000","fetchMs":534,"handleMs":475,"totalMs":106077,"newArticles":0,"totalArticles":10,"status":1,"type":0,"ip":"5d553b69a1e855162aed218bb892c17c","hostName":"europe-56*","requestId":"3b742d248edf4674985e8a4982a9c087_46279","contentType":"application/rss+xml; charset=UTF-8","totalBytes":37882,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":2,"articlesImgsGithubTotal":2,"successGithubMap":{"myreaderx13":1,"myreaderx":1},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 03:41:13","updatedTime":"2020-09-07 05:59:23","id":46279,"name":"text/plain","url":"http://textslashplain.com/feed/","subscriber":69,"website":null,"icon":"https://secure.gravatar.com/blavatar/81e8313019076ebc4ae53e207f1dc691?s=96&d=https%3A%2F%2Fs0.wp.com%2Fi%2Fbuttonw-com.png","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx61/cdn86@2020_2/2020/09/06/21-59-22-016_bcd2dd1b5eba5f4c.png","description":"ericlaw talks about the web and software in general","weekly":null,"link":null},"noPictureArticleList":[],"tmpCommonImgCdnBytes":11920,"tmpBodyImgCdnBytes":25962,"tmpBgImgCdnBytes":0,"extra4":{"start":1617824388027,"total":0,"statList":[{"spend":605,"msg":"获取xml内容"},{"spend":475,"msg":"解释文章"},{"spend":4,"msg":"上传封面图到cdn"},{"spend":2,"msg":"修正封面图上传失败重新上传"},{"spend":77480,"msg":"正文链接上传到cdn"}]},"extra5":2,"extra6":2,"extra7ImgCdnFailResultVector":[null],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-039.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-036.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://textplain.files.wordpress.com/2021/03/image-3.png?w=935","sourceStatusCode":200,"destWidth":935,"destHeight":145,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx/cdn4@2020_1/2021/04/07/19-40-15-705_9b8f31e9995596c1.webp","sourceBytes":41864,"destBytes":11920,"targetWebpQuality":75,"feedId":46279,"totalSpendMs":954,"convertSpendMs":35,"createdTime":"2021-04-08 03:40:15","host":"europe-59*","referer":"http://textslashplain.com/?p=3948","linkMd5ListStr":"66dcb9f7ca1cd7015b359fb4146adccc,66dcb9f7ca1cd7015b359fb4146adccc","githubUser":"myreaderx","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"40.9 KB","destSize":"11.6 KB","compressRate":"28.5%"},{"code":1,"isDone":false,"source":"https://textplain.files.wordpress.com/2021/03/image-4.png?w=1024","sourceStatusCode":200,"destWidth":1024,"destHeight":401,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx13/cdn7@2020_4/2021/04/07/19-41-33-540_77fe55e6fb49c246.webp","sourceBytes":70186,"destBytes":25962,"targetWebpQuality":75,"feedId":46279,"totalSpendMs":776,"convertSpendMs":26,"createdTime":"2021-04-08 03:41:33","host":"us-039*","referer":"http://textslashplain.com/?p=3948","linkMd5ListStr":"66dcb9f7ca1cd7015b359fb4146adccc","githubUser":"myreaderx13","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"68.5 KB","destSize":"25.4 KB","compressRate":"37%"}],"successGithubMap":{"myreaderx13":1,"myreaderx":1},"failGithubMap":{}}