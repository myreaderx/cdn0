{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-11-18 13:15:42","updatedTime":"2020-11-18 13:15:42","title":"php socket编程问题","link":"https://segmentfault.com/q/1010000038208872","description":"<p>此文章的代码来自于这篇文章<a href=\"https://segmentfault.com/a/1190000016237660\">PHP socket初探 --- select系统调用</a></p>\n<pre><code>&lt;?php\n\n// BEGIN 创建一个tcp socket服务器\n$host = '0.0.0.0';\n$port = 9999;\n$listen_socket = socket_create( AF_INET, SOCK_STREAM, SOL_TCP );\nsocket_bind( $listen_socket, $host, $port );\nsocket_listen( $listen_socket );\n// END 创建服务器完毕 \n\n// 也将监听socket放入到read fd set中去，因为select也要监听listen_socket上发生事件\n$client = [ $listen_socket ];\n// 先暂时只引入读事件，避免有同学晕头\n$write = [];\n$exp = [];\n\n// 开始进入循环\nwhile( true ){\n  $read = $client;\n  // 当select监听到了fd变化，注意第四个参数为null\n  // 如果写成大于0的整数那么表示将在规定时间内超时\n  // 如果写成等于0的整数那么表示不断调用select，执行后立马返回，然后继续\n  // 如果写成null，那么表示select会阻塞一直到监听发生变化\n  if( socket_select( $read, $write, $exp, null ) &gt; 0 ){\n    // 判断listen_socket有没有发生变化，如果有就是有客户端发生连接操作了\n    if( in_array( $listen_socket, $read ) ){\n      // 将客户端socket加入到client数组中\n      $client_socket = socket_accept( $listen_socket );\n      $client[] = $client_socket;\n      // 然后将listen_socket从read中去除掉\n      $key = array_search( $listen_socket, $read );\n      unset( $read[ $key ] );\n    }\n    // 查看去除listen_socket中是否还有client_socket\n    if( count( $read ) &gt; 0 ){\n      $msg = 'hello world';\n      foreach( $read as $socket_item ){\n      // 从可读取的fd中读取出来数据内容，然后发送给其他客户端\n      $content = socket_read( $socket_item, 2048 );\n      // 循环client数组，将内容发送给其余所有客户端\n      foreach( $client as $client_socket ){\n        // 因为client数组中包含了 listen_socket 以及当前发送者自己socket，所以需要排除二者\n        if( $client_socket != $listen_socket &amp;&amp; $client_socket != $socket_item ){\n          socket_write( $client_socket, $content, strlen( $content ) );\n        }\n      }\n      }\n    }\n  } \n  // 当select没有监听到可操作fd的时候，直接continue进入下一次循环\n  else {\n    continue;\n  }\n  \n}</code></pre>\n<p>哪个大佬能解释下我图片标注的问题 谢谢<br>主要是没理解 $listen_socket 和 $read 的关系<br>在我的理解中 $listen_socket 代表 socket 资源在一开始创建 socket 时就已经定义了，$read 表示可读的 socket 数组，为什么 $listen_socket 会是 $read 的子元素？<br><img src=\"https://segmentfault.com/img/bVcKt2e\" alt=\"image\" title=\"image\" /></br></br></br></p>","descriptionType":"html","publishedDate":"Wed, 18 Nov 2020 03:43:07 +0000","feedId":27082,"bgimg":"https://segmentfault.com/img/bVcKt2e","linkMd5":"e67c310ddc419a2720924155ce98f432","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx1/cdn17@2020_4/2020/11/18/05-15-53-276_249fa67e2ce7870d.webp","destWidth":800,"destHeight":615,"sourceBytes":89448,"destBytes":89448,"author":"小伟男","articleImgCdnMap":{"https://segmentfault.com/img/bVcKt2e":"https://cdn.jsdelivr.net/gh/myreaderx1/cdn17@2020_4/2020/11/18/05-15-53-276_249fa67e2ce7870d.webp"},"publishedOrCreatedDate":1605676542287}],"record":{"createdTime":"2020-11-18 13:15:42","updatedTime":"2020-11-18 13:15:42","feedId":27082,"fetchDate":"Wed, 18 Nov 2020 05:15:42 +0000","fetchMs":21727,"handleMs":59339,"totalMs":144178,"newArticles":0,"totalArticles":50,"status":1,"type":0,"ip":"b2be3c55cb19b5d073c0077eda58a224","hostName":"us-004*","requestId":"8ead6a6ba0ea417e9e1476f66b78fc90_27082","contentType":"application/atom+xml; charset=UTF-8","totalBytes":89448,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":1,"articlesImgsGithubTotal":1,"successGithubMap":{"myreaderx1":1},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 02:40:21","updatedTime":"2020-10-09 23:55:34","id":27082,"name":"SegmentFault 最新的问题","url":"http://segmentfault.com/feeds","subscriber":121,"website":null,"icon":"https://segmentfault.com/favicon.ico","icon_jsdelivr":null,"description":"","weekly":null,"link":"https://segmentfault.com"},"noPictureArticleList":[],"tmpCommonImgCdnBytes":89448,"tmpBodyImgCdnBytes":0,"tmpBgImgCdnBytes":0,"extra4":{"start":1605676410466,"total":0,"statList":[{"spend":72482,"msg":"获取xml内容"},{"spend":59339,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":0,"msg":"正文链接上传到cdn"}]},"extra5":1,"extra6":1,"extra7ImgCdnFailResultVector":[],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://segmentfault.com/img/bVcKt2e","sourceStatusCode":200,"destWidth":800,"destHeight":615,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx1/cdn17@2020_4/2020/11/18/05-15-53-276_249fa67e2ce7870d.webp","sourceBytes":89448,"destBytes":89448,"feedId":27082,"totalSpendMs":7614,"convertSpendMs":0,"createdTime":"2020-11-18 13:15:46","host":"europe-56*","referer":"https://segmentfault.com/q/1010000038208872","linkMd5ListStr":"e67c310ddc419a2720924155ce98f432,e67c310ddc419a2720924155ce98f432","githubUser":"myreaderx1","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"87.4 KB","destSize":"87.4 KB","compressRate":"100%"}],"successGithubMap":{"myreaderx1":1},"failGithubMap":{}}