{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2021-05-28 00:09:49","updatedTime":"2021-05-28 00:09:49","title":"Jetpack Compose で AutoSizeableTextView 的なのを作る","link":"http://y-anz-m.blogspot.com/2021/05/jetpack-compose-autosizeabletextview.html","description":"残念ながらオフィシャルでのサポートは（まだ）ない。  <br><br> <a href=\"https://developer.android.com/reference/kotlin/androidx/compose/material/package-summary#Text%28kotlin.String,androidx.compose.ui.Modifier,androidx.compose.ui.graphics.Color,androidx.compose.ui.unit.TextUnit,androidx.compose.ui.text.font.FontStyle,androidx.compose.ui.text.font.FontWeight,androidx.compose.ui.text.font.FontFamily,androidx.compose.ui.unit.TextUnit,androidx.compose.ui.text.style.TextDecoration,androidx.compose.ui.text.style.TextAlign,androidx.compose.ui.unit.TextUnit,androidx.compose.ui.text.style.TextOverflow,kotlin.Boolean,kotlin.Int,kotlin.Function1,androidx.compose.ui.text.TextStyle%29\" target=\"_blank\">Text</a> の onTextLayout で TextLayoutResult の hasVisualOverflow (didOverflowWidth および didOverflowHeight もある) が true だったら remember {} してる文字サイズを変更するという方法でそれっぽいのは作れるが、State が変わる回数が多い（最終的な textSize と maxTextSize の差が大きい）と文字サイズが変わるアニメーションみたいになってしまうのがつらい。  <code name=\"code\" class=\"java\">@Composable fun AutoSizeableText(     text: String,     maxTextSize: Int = 16,     minTextSize: Int = 14,     modifier: Modifier ) {      var textSize by remember(text) { mutableStateOf(maxTextSize) }    Text(       text = text,       fontSize = textSize.sp,       maxLines = 1,       overflow = TextOverflow.Ellipsis,       modifier = modifier,       onTextLayout = {           if (it.hasVisualOverflow &amp;&amp; textSize > minTextSize) {               textSize -= 1           }       }   ) } </code> <div class=\"separator\" style=\"clear: both;\"><a href=\"https://1.bp.blogspot.com/-B1Vp3t_sZOQ/YK970fVMYUI/AAAAAAABNt4/Zf94H4rt1HwWIeyzOjwqD6Jddg9RX8W9ACLcBGAsYHQ/s1192/Screen%2BShot%2B2021-05-27%2Bat%2B19.44.53.png\" style=\"display: block; padding: 1em 0; text-align: left;\"><img alt=\"\" border=\"0\" width=\"600\" data-original-height=\"566\" data-original-width=\"1192\" src=\"https://1.bp.blogspot.com/-B1Vp3t_sZOQ/YK970fVMYUI/AAAAAAABNt4/Zf94H4rt1HwWIeyzOjwqD6Jddg9RX8W9ACLcBGAsYHQ/s600/Screen%2BShot%2B2021-05-27%2Bat%2B19.44.53.png\"/></a></div>   ↑だと1文字増減したときに maxTextSize からやり直しになるので、現在の文字サイズを覚えておいてそこから +/- するようにしたのが ↓  <code name=\"code\" class=\"java\">@Composable fun AutoSizeableText(     text: String,     maxTextSize: Int = 16,     minTextSize: Int = 14,     modifier: Modifier ) {      var textSize by remember { mutableStateOf(maxTextSize) }     val checked = remember(text) { mutableMapOf&lt;Int, Boolean?&gt;() }     var overflow by remember { mutableStateOf(TextOverflow.Clip) }      Text(         text = text,         fontSize = textSize.sp,         maxLines = 1,         overflow = overflow,         modifier = modifier,         onTextLayout = {             if (it.hasVisualOverflow) {                 checked[textSize] = true                 if (textSize > minTextSize) {                     textSize -= 1                 } else {                     overflow = TextOverflow.Ellipsis                 }             } else {                 checked[textSize] = false                 if (textSize &lt; maxTextSize) {                     if (checked[textSize + 1] == null) {                         textSize += 1                     }                 }             }         }     ) } </code> <div class=\"separator\" style=\"clear: both;\"><a href=\"https://1.bp.blogspot.com/-80cMGSg75T4/YK98tDmgIuI/AAAAAAABNuA/DtiKEJ507QcZlUz5ds3C6G_hvDg5BnOPgCLcBGAsYHQ/s1920/untitled.gif\" style=\"display: block; padding: 1em 0; text-align: left; \"><img alt=\"\" border=\"0\" height=\"600\" data-original-height=\"1920\" data-original-width=\"1080\" src=\"https://1.bp.blogspot.com/-80cMGSg75T4/YK98tDmgIuI/AAAAAAABNuA/DtiKEJ507QcZlUz5ds3C6G_hvDg5BnOPgCLcBGAsYHQ/s600/untitled.gif\"/></a></div> それでも State が変わる回数が多い（maxTextSize と minTextSize の差が大きくて、一度に長い文字をペーストするとか）と文字サイズが変わるアニメーションみたいになってしまうのがつらいんですよね〜。  <br><br><br> <br><br><br>  ","descriptionType":"html","publishedDate":"Thu, 27 May 2021 11:05:00 +0000","feedId":24693,"bgimg":"https://1.bp.blogspot.com/-B1Vp3t_sZOQ/YK970fVMYUI/AAAAAAABNt4/Zf94H4rt1HwWIeyzOjwqD6Jddg9RX8W9ACLcBGAsYHQ/s72-c/Screen%2BShot%2B2021-05-27%2Bat%2B19.44.53.png","linkMd5":"39b62202e56f989ac434752d4611378b","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx5oss/cdn16@2020_3/2021/05/27/16-09-50-142_43592954fd33d241.webp","destWidth":72,"destHeight":72,"sourceBytes":3661,"destBytes":1718,"author":"yanzm","articleImgCdnMap":{"https://1.bp.blogspot.com/-B1Vp3t_sZOQ/YK970fVMYUI/AAAAAAABNt4/Zf94H4rt1HwWIeyzOjwqD6Jddg9RX8W9ACLcBGAsYHQ/s600/Screen%2BShot%2B2021-05-27%2Bat%2B19.44.53.png":"https://cdn.jsdelivr.net/gh/myreaderx15/cdn5@2020_6/2021/05/27/16-09-49-691_54319273ca548e0d.webp","https://1.bp.blogspot.com/-80cMGSg75T4/YK98tDmgIuI/AAAAAAABNuA/DtiKEJ507QcZlUz5ds3C6G_hvDg5BnOPgCLcBGAsYHQ/s600/untitled.gif":"https://cdn.jsdelivr.net/gh/myreaderx33/cdn8@2020_3/2021/05/27/16-11-01-250_aa0011591506e2fd.webp"},"publishedOrCreatedDate":1622131789064}],"record":{"createdTime":"2021-05-28 00:09:49","updatedTime":"2021-05-28 00:09:49","feedId":24693,"fetchDate":"Thu, 27 May 2021 16:09:49 +0000","fetchMs":80,"handleMs":10,"totalMs":73493,"newArticles":0,"totalArticles":25,"status":1,"type":0,"ip":"af0629e1ae74a27744b4cbd27b40a78e","hostName":"us-007*","requestId":"9bda79422c7448998afa0a778665afe2_24693","contentType":"application/atom+xml; charset=UTF-8","totalBytes":4165346,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":2,"articlesImgsGithubTotal":2,"successGithubMap":{"myreaderx15":1,"myreaderx32":1,"myreaderx33":1,"myreaderx5oss":1},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 02:33:52","updatedTime":"2020-09-07 04:30:11","id":24693,"name":"Y.A.M の 雑記帳","url":"http://y-anz-m.blogspot.com/feeds/posts/default","subscriber":133,"website":null,"icon":"http://y-anz-m.blogspot.com/favicon.ico","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx65/cdn71@2020_6/2020/09/06/20-30-10-468_9ce2c39d825f1a01.ico","description":"","weekly":null,"link":null},"noPictureArticleList":[],"tmpCommonImgCdnBytes":0,"tmpBodyImgCdnBytes":4163628,"tmpBgImgCdnBytes":1718,"extra4":{"start":1622131788971,"total":0,"statList":[{"spend":83,"msg":"获取xml内容"},{"spend":10,"msg":"解释文章"},{"spend":1008,"msg":"上传封面图到cdn"},{"spend":386,"msg":"修正封面图上传失败重新上传"},{"spend":73399,"msg":"正文链接上传到cdn"}]},"extra5":2,"extra6":2,"extra7ImgCdnFailResultVector":[null],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://europe-59.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://europe-60.herokuapp.com/":{"failCount":0,"successCount":2,"resultList":[200,200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://1.bp.blogspot.com/-B1Vp3t_sZOQ/YK970fVMYUI/AAAAAAABNt4/Zf94H4rt1HwWIeyzOjwqD6Jddg9RX8W9ACLcBGAsYHQ/s72-c/Screen%2BShot%2B2021-05-27%2Bat%2B19.44.53.png","sourceStatusCode":200,"destWidth":72,"destHeight":72,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn3@2020_2/2021/05/27/16-09-49-675_43592954fd33d241.webp","sourceBytes":3661,"destBytes":1718,"targetWebpQuality":75,"feedId":24693,"totalSpendMs":867,"convertSpendMs":2,"createdTime":"2021-05-28 00:09:49","host":"europe61*","referer":"http://y-anz-m.blogspot.com/2021/05/jetpack-compose-autosizeabletextview.html","linkMd5ListStr":"39b62202e56f989ac434752d4611378b","githubUser":"myreaderx32","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"3.6 KB","destSize":"1.7 KB","compressRate":"46.9%"},{"code":1,"isDone":false,"source":"https://1.bp.blogspot.com/-B1Vp3t_sZOQ/YK970fVMYUI/AAAAAAABNt4/Zf94H4rt1HwWIeyzOjwqD6Jddg9RX8W9ACLcBGAsYHQ/s600/Screen%2BShot%2B2021-05-27%2Bat%2B19.44.53.png","sourceStatusCode":200,"destWidth":600,"destHeight":285,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx15/cdn5@2020_6/2021/05/27/16-09-49-691_54319273ca548e0d.webp","sourceBytes":41299,"destBytes":16818,"targetWebpQuality":75,"feedId":24693,"totalSpendMs":890,"convertSpendMs":8,"createdTime":"2021-05-28 00:09:49","host":"europe-60*","referer":"http://y-anz-m.blogspot.com/2021/05/jetpack-compose-autosizeabletextview.html","linkMd5ListStr":"39b62202e56f989ac434752d4611378b","githubUser":"myreaderx15","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"40.3 KB","destSize":"16.4 KB","compressRate":"40.7%"},{"code":1,"isDone":false,"source":"https://1.bp.blogspot.com/-B1Vp3t_sZOQ/YK970fVMYUI/AAAAAAABNt4/Zf94H4rt1HwWIeyzOjwqD6Jddg9RX8W9ACLcBGAsYHQ/s72-c/Screen%2BShot%2B2021-05-27%2Bat%2B19.44.53.png","sourceStatusCode":200,"destWidth":72,"destHeight":72,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx5oss/cdn16@2020_3/2021/05/27/16-09-50-142_43592954fd33d241.webp","sourceBytes":3661,"destBytes":1718,"targetWebpQuality":75,"feedId":24693,"totalSpendMs":359,"convertSpendMs":3,"createdTime":"2021-05-28 00:09:50","host":"us-039*","referer":"http://y-anz-m.blogspot.com/2021/05/jetpack-compose-autosizeabletextview.html","linkMd5ListStr":"39b62202e56f989ac434752d4611378b","githubUser":"myreaderx5oss","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"3.6 KB","destSize":"1.7 KB","compressRate":"46.9%"},{"code":1,"isDone":false,"source":"https://1.bp.blogspot.com/-80cMGSg75T4/YK98tDmgIuI/AAAAAAABNuA/DtiKEJ507QcZlUz5ds3C6G_hvDg5BnOPgCLcBGAsYHQ/s600/untitled.gif","sourceStatusCode":200,"destWidth":338,"destHeight":600,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx33/cdn8@2020_3/2021/05/27/16-11-01-250_aa0011591506e2fd.webp","sourceBytes":2755387,"destBytes":4146810,"targetWebpQuality":75,"feedId":24693,"totalSpendMs":11974,"convertSpendMs":10743,"createdTime":"2021-05-28 00:10:50","host":"europe-60*","referer":"http://y-anz-m.blogspot.com/2021/05/jetpack-compose-autosizeabletextview.html","linkMd5ListStr":"39b62202e56f989ac434752d4611378b","githubUser":"myreaderx33","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"2.6 MB","destSize":"4 MB","compressRate":"150.5%"}],"successGithubMap":{"myreaderx15":1,"myreaderx32":1,"myreaderx33":1,"myreaderx5oss":1},"failGithubMap":{}}