{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-11-17 14:12:14","updatedTime":"2020-11-17 14:12:14","title":"扫盲 XMPP(Jabber) - 一个自由开放的即时消息协议","link":"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html","description":"<p>这标题的命名方式哪里眼熟……</p> \n<p>想和谁在网上聊天的话，可以用的 IM 软件有不少，当然槽点也很多（这家伙要求真多.png）：</p> \n<ul class=\"simple\"> \n <li>WhatsApp , Line 之流： 从客户端到协议都是私有的，以及似乎有向审查屈服的倾向？</li> \n <li>Telegram ，服务端是私有的，官方客户端的源代码经常咕咕咕……</li> \n <li>Signal 和 Wire ，虽然服务端和客户端都是自由的，但是有人成功运行起来自己的服务端嘛 🤔</li> \n</ul> \n<p>……</p> \n<p>于是是时候试试看 XMPP 啦（编不下去了.webp.png 😂）</p> \n<div class=\"section\" id=\"xmpp\"> \n <h2><a class=\"toc-backref\" href=\"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html#id11\">XMPP 是啥？</a></h2> \n <p>可扩展消息与存在协议（XMPP，全称为Extensible Messaging and Presence Protocol，前称Jabber） 是一种以XML为基础的开放式即时通信协议，是经由互联网工程工作小组（IETF）通过的互联网标准。</p> \n <p>Jabber是一个开放源代码形式组织产生的网络即时通信协议。XMPP原本是为即时通讯而量身定制， 但由于XML Stanza本身是XML元素，在基于XML灵活发展的特性下，使得XMPP也可以适用其他方面， 已经得到了IETF的批准。XMPP与IMPP、PRIM、SIP（SIMPLE）合称四大IM协议主流，在此4大协议中，XMPP是最灵活的。</p> \n <p>（从维基百科抄的（雾））</p> \n <p>有不少聊天软件是 XMPP 的实现，例如 Google Talk 和 Facebook Messenger，以及 AOL 和 一些网络游戏的聊天等。</p> \n <p>因为传送的是 XML 嘛，所以 XMPP 协议本身十分灵活，不过传送二进制文件来就稍微有些困难了（不过有不同的扩展 可以提供文件上传等功能）。</p> \n <p>和电子邮件一样， XMPP 也是非中心化的协议，可以均衡负载和对抗封锁。当然有可以多处登录啦， XMPP 通过优先级来 区分不同的设备，优先级高的设备会收到相应的消息（有人认为这是个缺点，于是有了 MAM 在不同的设备间同步消息）。</p> \n <p>XMPP/Jabber实现多人聊天（MUC，Multiply User Chat）是采用聊天室的方式实现的，形如 <a class=\"reference external\" href=\"mailto:room@domain.tld\">room@domain.tld</a> 的形式， 用户可以添加这个聊天室进行群聊，不过介于不少客户端不支持群聊加密，于是 XMPP 更多的还是以私聊为主。</p> \n</div> \n<div class=\"section\" id=\"id1\"> \n <h2><a class=\"toc-backref\" href=\"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html#id12\">注册一个 XMPP/Jabber 帐号</a></h2> \n <p>因为 XMPP 是个自由开放的协议啦，所以网上有很多公开的 XMPP 服务， <a class=\"reference external\" href=\"https://www.jabberes.org/servers/servers_by_proxy_bytestreams.html\">这里</a> 有一个大而全的列表。 但是如果汝只是想找个速度合适的服务器的话，BLUG 整理出了一个 <a class=\"reference external\" href=\"https://beijinglug.club/wiki/doku.php?id=projects:xmpp\">经过测试的部分 XMPP 服务器清单</a> 。</p> \n <p>可以看到大多数的 XMPP 服务器对注册没有任何要求，只需要汝选择一个 Jabber ID 然后输入密码就 OK 啦， 当然这么做的后果之一就是忘记密码就不能找回了，所以创建一个强密码并记住它特别重要。</p> \n <p>除了在网页上注册以外，不少服务器也支持在客户端上注册，所以……</p> \n</div> \n<div class=\"section\" id=\"id4\"> \n <h2><a class=\"toc-backref\" href=\"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html#id13\">安装一个 XMPP 客户端</a></h2> \n <p>不同平台上可以推荐的客户端有很多：</p> \n <ul class=\"simple\"> \n  <li>比如跨平台的 Pidgin （顺便还可以跨协议，但是 Pidgin 支持 XMPP 是挺优秀的）。 Windows 可以从 <a class=\"reference external\" href=\"https://pidgin.im/download/\">https://pidgin.im/download/</a> 下载安装包，GNU/Linux 可以从包管理器安装，或者下载源代码编译</li> \n  <li>macOS 用户可以安装 Adium，可以从 <a class=\"reference external\" href=\"https://adium.im\">https://adium.im</a> 下载。</li> \n  <li>iOS 用户推荐 ChatSecure，可以从 App Store 下载安装。</li> \n  <li>Android 用户推荐 <a class=\"reference external\" href=\"https://f-droid.org/en/packages/com.xabber.androiddev/\">Xabber</a> 和 <a class=\"reference external\" href=\"https://f-droid.org/en/packages/eu.siacs.conversations/\">Conversations</a> 前者支持 XMPP 中常用的 OTR 端到端加密， 后者支持 MUC 和新的 OMEMO 和 openPGP 加密。</li> \n </ul> \n <p>每一个 XMPP 客户端的登录和注册方法都不尽相同，但都比较简单。这里就偷个懒不指导啦 😂</p> \n</div> \n<div class=\"section\" id=\"id5\"> \n <h2><a class=\"toc-backref\" href=\"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html#id14\">和好友聊天或进行群聊</a></h2> \n <p>添加汝好友或群聊的 Jabber ID 就 OK 啦~</p> \n <img alt=\"大概长这样\" class=\"responsive-img materialboxed\" src=\"https://blog.yoitsu.moe/images/XMPP/buddies.png\" /> \n</div> \n<div class=\"section\" id=\"id6\"> \n <h2><a class=\"toc-backref\" href=\"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html#id15\">加密聊天</a></h2> \n <blockquote>\n   主要说的是端到端加密，毕竟 8102 年了，传输加密已经是刚需了吧 😂 \n </blockquote> \n <p>目前 XMPP 中常用的端到端加密方式有三种 ，都是通过非对称加密实现的：</p> \n <ul class=\"simple\"> \n  <li><a class=\"reference external\" href=\"https://otr.cypherpunks.ca/\">OTR（Off-the-Record Messaging，不留记录即时通讯）</a> 是 XMPP 中最常用的端到端加密方式，被大多数客户端所支持。加密迅速而且前向安全。 缺点是更换客户端或重新登录时 OTR 指纹会发生变化， 可能会无法保证消息身份的一致性而需要重新验证。以及对文件的加密尚未标准化（不同客户端加密的文件 可能无法相互存取，因此习惯是发送文件的链接），另外称为下一代 OTR 的 <a class=\"reference external\" href=\"https://github.com/otrv4/otrv4\">OTRv4</a> 正在开发中。</li> \n </ul> \n <img alt=\"Pidgin 通过插件可以支持 OTR\" class=\"responsive-img materialboxed\" src=\"https://blog.yoitsu.moe/images/XMPP/pidgin_otr.png\" /> \n <p>Pidgin 通过插件可以支持 OTR，上面介绍的客户端中除了 Conversations 都支持 OTR。</p> \n <ul class=\"simple\"> \n  <li><a class=\"reference external\" href=\"https://conversations.im/omemo/\">OMEMO（OMEMO Multi-End Message and Object Encryption，OMEMO 多终端消息和对象加密）</a> 是 一种新型的端到端加密协议，可以跨设备同步加密的消息记录和文件，验证起来也比较简单（ <del>因为都盲目信任了？</del> ）。 不过除了 Conversations 以外好像都没支持好的样子……</li> \n  <li>openPGP 也能用于 XMPP 的端到端加密，不过毕竟是面向邮件的非对称加密，客户端不一定都支持 （Gajim、Psi+ 和 mcabber 支持）速度可能没那么快，还有可能把服务器娘累坏（雾）。</li> \n </ul> \n</div> \n<div class=\"section\" id=\"id7\"> \n <h2><a class=\"toc-backref\" href=\"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html#id16\">一些注意事项？</a></h2> \n <ul class=\"simple\"> \n  <li>因为大多数 XMPP 服务没有提供找回密码的功能，** 所以所以创建一个强密码并记住它！**</li> \n  <li>传输加密是必须的，端到端加密最好也用上。</li> \n  <li>端到端加密最好验证下双方的身份，除了传统的指纹验证以外 OTR 还可以通过共享秘密和问答验证。</li> \n  <li>只使用自由开源的客户端， <del>这个不解释。</del></li> \n </ul> \n</div> \n<div class=\"section\" id=\"id8\"> \n <h2><a class=\"toc-backref\" href=\"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html#id17\">自己搭建 XMPP 服务器</a></h2> \n <p>好啊好啊，这就是非中心化服务的优势之一呢~</p> \n <p>比较推荐的是 <a class=\"reference external\" href=\"https://prosody.im/\">Prosody</a> 和 <a class=\"reference external\" href=\"https://www.ejabberd.im/\">ejabberd</a> ， 前者轻量，配置简单。后者功能丰富，扩展性强。 <a class=\"reference external\" href=\"https://blog.yoitsu.moe/arch-linux/prosody_on_archlinux.html\">咱就用 Prosody 搭了一个</a></p> \n</div> \n<div class=\"section\" id=\"id10\"> \n <h2><a class=\"toc-backref\" href=\"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html#id18\">读点别的？</a></h2> \n <p><a class=\"reference external\" href=\"https://tonghuix.io/2015/03/xmpp-chat/\">https://tonghuix.io/2015/03/xmpp-chat/</a></p> \n <p>⇪网页标题：弃用QQ和微信！全面转向基于XMPP(Jabber)的即时聊天</p> \n <p>这篇文章简单的介绍了下 XMPP 的基本特点，也推荐了些不同平台的客户端。</p> \n <p><a class=\"reference external\" href=\"https://beijinglug.club/wiki/lib/exe/fetch.php?media=xmpp-guide.pdf\">https://beijinglug.club/wiki/lib/exe/fetch.php?media=xmpp-guide.pdf</a></p> \n <p>⇪网页标题：XMPP(Jabber) 聊天快速指南</p> \n <p>由北京 GNU/Linux 用户组（BLUG）成员编写的 XMPP 入门指南，图文并茂值得一读（？）</p> \n <p><a class=\"reference external\" href=\"https://hardenedlinux.github.io/cryptography/2018/02/01/pidgin_xmpp_otr_debian.html\">https://hardenedlinux.github.io/cryptography/2018/02/01/pidgin_xmpp_otr_debian.html</a></p> \n <p>⇪网页标题：Debian/Ubuntu 用户使用基于 XMPP 即时通信协议的 OTR 保护隐私的标准化部署流程</p> \n <p>介绍了 OTR 的原理， Debian 上使用 Pidgin 进行 OTR 聊天的流程，以及验证身份的一些技巧。</p> \n</div>","descriptionType":"html","publishedDate":"Thu, 27 Sep 2018 16:00:00 +0000","feedId":17634,"bgimg":"https://blog.yoitsu.moe/images/XMPP/buddies.png","linkMd5":"4913814fdbe4a98319e78100102bf115","destWidth":317,"destHeight":719,"sourceBytes":31782,"destBytes":12562,"author":"ホロ","articleImgCdnMap":{"https://blog.yoitsu.moe/images/XMPP/buddies.png":null,"https://blog.yoitsu.moe/images/XMPP/pidgin_otr.png":"https://cdn.jsdelivr.net/gh/myreaderx7/cdn60@2020_6/2020/11/17/06-12-19-285_13e4573bead90ebf.webp"},"publishedOrCreatedDate":1605593534756}],"record":{"createdTime":"2020-11-17 14:12:14","updatedTime":"2020-11-17 14:12:14","feedId":17634,"fetchDate":"Tue, 17 Nov 2020 06:12:14 +0000","fetchMs":890,"handleMs":147,"totalMs":42250,"newArticles":0,"totalArticles":114,"status":1,"type":0,"ip":"d35028d50cd902508c503a65512e6039","hostName":"us-037*","requestId":"91faef55f02d41aa81ee4af586082135_17634","contentType":"text/xml","totalBytes":28328,"bgimgsTotal":1,"bgimgsGithubTotal":0,"articlesImgsTotal":2,"articlesImgsGithubTotal":1,"successGithubMap":{"myreaderx7":1},"failGithubMap":{"myreaderx14":1}},"feed":{"createdTime":"2020-09-07 02:15:37","updatedTime":"2020-09-07 02:47:34","id":17634,"name":"约伊兹的萌狼乡手札","url":"https://blog.yoitsu.moe/feeds/all.atom.xml","subscriber":188,"website":null,"icon":"https://blog.yoitsu.moe/favicon.ico","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx65/cdn34@2020_3/2020/09/06/18-47-28-265_789644ead6734a91.ico","description":"","weekly":null,"link":null},"noPictureArticleList":[{"createdTime":"2020-11-17 14:12:20","updatedTime":"2020-11-17 14:12:20","id":null,"feedId":17634,"linkMd5":"4913814fdbe4a98319e78100102bf115"}],"tmpCommonImgCdnBytes":0,"tmpBodyImgCdnBytes":28328,"tmpBgImgCdnBytes":0,"extra4":{"start":1605593497873,"total":0,"statList":[{"spend":36736,"msg":"获取xml内容"},{"spend":147,"msg":"解释文章"},{"spend":1,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":2436,"msg":"正文链接上传到cdn"}]},"extra5":2,"extra6":2,"extra7ImgCdnFailResultVector":[{"code":1,"isDone":false,"source":"https://blog.yoitsu.moe/images/XMPP/buddies.png","sourceStatusCode":200,"destWidth":317,"destHeight":719,"sourceBytes":31782,"destBytes":12562,"targetWebpQuality":75,"feedId":17634,"totalSpendMs":850,"convertSpendMs":19,"createdTime":"2020-11-17 14:12:16","host":"europe-58*","referer":"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html","linkMd5ListStr":"4913814fdbe4a98319e78100102bf115,4913814fdbe4a98319e78100102bf115","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx14/cdn53/contents/2020/11/17/06-12-16-477_a1e5f964061273c2.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 68584859.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Tue, 17 Nov 2020 06:12:17 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"status":["403 Forbidden"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["BAA4:E7C1:65B479:755537:5FB369AA"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1605595118"],"x-ratelimit-used":["60"],"x-xss-protection":["1; mode=block"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx14/cdn53/contents/2020/11/17/06-12-16-477_a1e5f964061273c2.webp","historyStatusCode":[],"spendMs":266},"base64UserPassword":null,"token":"6b67d******************************91b08"},"githubUser":"myreaderx14","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"31 KB","destSize":"12.3 KB","compressRate":"39.5%"},{"code":1,"isDone":false,"source":"https://blog.yoitsu.moe/images/XMPP/buddies.png","sourceStatusCode":200,"destWidth":317,"destHeight":719,"sourceBytes":31782,"destBytes":12562,"targetWebpQuality":75,"feedId":17634,"totalSpendMs":458,"convertSpendMs":13,"createdTime":"2020-11-17 14:12:17","host":"europe-58*","referer":"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html","linkMd5ListStr":"4913814fdbe4a98319e78100102bf115,4913814fdbe4a98319e78100102bf115","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx14/cdn53/contents/2020/11/17/06-12-17-401_a1e5f964061273c2.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 68584859.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Tue, 17 Nov 2020 06:12:17 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"status":["403 Forbidden"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["BAA4:E7C1:65B492:755870:5FB369C1"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1605595118"],"x-ratelimit-used":["60"],"x-xss-protection":["1; mode=block"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx14/cdn53/contents/2020/11/17/06-12-17-401_a1e5f964061273c2.webp","historyStatusCode":[],"spendMs":244},"base64UserPassword":null,"token":"6b67d******************************91b08"},"githubUser":"myreaderx14","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"31 KB","destSize":"12.3 KB","compressRate":"39.5%"}],"extra10_invalidATagHrefValue":{"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html_#id11":"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html#id11","https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html_mailto:room@domain.tld":"mailto:room@domain.tld","https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html_#id12":"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html#id12","https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html_/arch-linux/prosody_on_archlinux.html":"https://blog.yoitsu.moe/arch-linux/prosody_on_archlinux.html","https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html_#id17":"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html#id17","https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html_#id18":"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html#id18","https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html_#id15":"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html#id15","https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html_#id16":"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html#id16","https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html_#id13":"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html#id13","https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html_#id14":"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html#id14"},"extra111_proxyServerAndStatMap":{"http://us-036.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://blog.yoitsu.moe/images/XMPP/pidgin_otr.png","sourceStatusCode":200,"destWidth":879,"destHeight":621,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx7/cdn60@2020_6/2020/11/17/06-12-19-285_13e4573bead90ebf.webp","sourceBytes":55377,"destBytes":28328,"targetWebpQuality":75,"feedId":17634,"totalSpendMs":2420,"convertSpendMs":41,"createdTime":"2020-11-17 14:12:17","host":"us-036*","referer":"https://blog.yoitsu.moe/tech_misc/using_xmpp_for_chats.html","linkMd5ListStr":"4913814fdbe4a98319e78100102bf115","githubUser":"myreaderx7","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"54.1 KB","destSize":"27.7 KB","compressRate":"51.2%"}],"successGithubMap":{"myreaderx7":1},"failGithubMap":{"myreaderx14":1}}