{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-10-13 14:40:55","updatedTime":"2020-10-13 14:40:55","title":"[C++/CX] PopupMenuを追加する","link":"http://blogs.wankuma.com/episteme/archive/2013/04/05/326006.aspx","description":"<p>ストアアプリの鬼門(?)、非同期処理とやらをちょっとばかり。<br><br>カウント値をタップすると[クリア」メニューをぺろっと出します。<br><img src=\"http://www1.c3-net.ne.jp/episteme/images/cppcx_4th/step1.png\"></p><p>ともあれCounterModelにclear()メソッドを追加して:</p><p><font face=\"Courier New\">//--- CounterModel.h<br>&nbsp; [Windows::UI::Xaml::Data::Bindable] <br>&nbsp; public ref class CounterModel sealed : public Common::BindableBase {<br>&nbsp; public:<br>&nbsp;&nbsp;&nbsp; ...<br>&nbsp;&nbsp;&nbsp; <font color=\"#ff0000\">void clear();</font><br>&nbsp;&nbsp;&nbsp; ...<br>&nbsp; };</font></p><p><font face=\"Courier New\">//--- CounterModel.cpp<br>...<br><font color=\"#ff0000\">&nbsp; void CounterModel::clear() { <br>&nbsp;&nbsp;&nbsp; value_ = 0; <br>&nbsp;&nbsp;&nbsp; OnPropertyChanged(L\"Count\"); <br>&nbsp;&nbsp;&nbsp; addLog(L\"ちゃら\"); <br>&nbsp; }</font></font></p><p>しかるのち TextBlock に Tapped イベントハンドラを打ち込みます。<br><img src=\"http://www1.c3-net.ne.jp/episteme/images/cppcx_4th/step2.png\"></p><p>イベントハンドラ ではタップされたコントロールの位置(=PopupMenu表示位置)を求めるヘルパ関数を用意。<br>MSDNのサンプルコードから拝借しました。</p><p><font color=\"#ff0000\" face=\"Courier New\">namespace {<br>&nbsp; Rect GetElementRect(FrameworkElement^ element) {<br>&nbsp;&nbsp;&nbsp; GeneralTransform^ buttonTransform = element-&gt;TransformToVisual(nullptr);<br>&nbsp;&nbsp;&nbsp; const Point pointOrig(0, 0);<br>&nbsp;&nbsp;&nbsp; const Point pointTransformed = buttonTransform-&gt;TransformPoint(pointOrig);<br>&nbsp;&nbsp;&nbsp; const Rect rect(pointTransformed.X, pointTransformed.Y, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; safe_cast&lt;float&gt;(element-&gt;ActualWidth), <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; safe_cast&lt;float&gt;(element-&gt;ActualHeight));<br>&nbsp;&nbsp;&nbsp; return rect;<br>&nbsp; } <br>}</font></p><p>C#/VBではこーゆーのをstaticメソッドにするんだろけども、<br>C++なら<strong>関係ないものは関係ないとこ</strong>にぽつんと置けるのが潔くてよろしいですな。</p><p>んでもってハンドラ本体。<br><font color=\"#ff0000\" face=\"Courier New\">using namespace Windows::UI::Popups;</font>&nbsp; を追加して:</p><p><font color=\"#ff0000\" face=\"Courier New\">void App1::TrialPage::txtCount_Tapped(Object^ sender, TappedRoutedEventArgs^ e) {<br>&nbsp; auto action = [this](IUICommand^ command){ count_.clear(); }; <font color=\"#008000\">// 押されたらクリア</font><br>&nbsp; auto menu = ref new PopupMenu();<br>&nbsp; menu-&gt;Commands-&gt;Append(ref new UICommand(L\"クリア\", <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ref new UICommandInvokedHandler(action)));<br>&nbsp; menu-&gt;ShowForSelectionAsync(GetElementRect(safe_cast&lt;FrameworkElement^&gt;(sender)));<br>&nbsp; <font color=\"#008000\">// ↑ココが非同期。完了を待たずに\"するっ\"と抜ける。(クリア処理は舞台裏)</font><br>}<br></font></p><img src =\"http://blogs.wankuma.com/episteme/aggbug/326006.aspx\" width = \"1\" height = \"1\" />","descriptionType":"text/html","publishedDate":"Fri, 05 Apr 2013 23:43:00 +0000","feedId":42717,"bgimg":"http://www1.c3-net.ne.jp/episteme/images/cppcx_4th/step1.png","linkMd5":"4e54cca36b7cb31c7b75253244e34d9f","author":"επιστημη","articleImgCdnMap":{"http://www1.c3-net.ne.jp/episteme/images/cppcx_4th/step1.png":null,"http://www1.c3-net.ne.jp/episteme/images/cppcx_4th/step2.png":null,"http://blogs.wankuma.com/episteme/aggbug/326006.aspx":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn2@2020_5/2020/10/13/06-42-58-035_ac2a1ae72c004fe2.webp"},"publishedOrCreatedDate":1602571255288}],"record":{"createdTime":"2020-10-13 14:40:55","updatedTime":"2020-10-13 14:40:55","feedId":42717,"fetchDate":"Tue, 13 Oct 2020 06:40:55 +0000","fetchMs":1047,"handleMs":13,"totalMs":245453,"newArticles":0,"totalArticles":15,"status":1,"type":0,"ip":"29781af090aa8578c47ebfd8e6b7ab34","hostName":"us-014*","requestId":"7e9c6ad7cfbb4a1f8ad97730464669e0_42717","contentType":"text/xml; charset=utf-8","totalBytes":72,"bgimgsTotal":1,"bgimgsGithubTotal":0,"articlesImgsTotal":3,"articlesImgsGithubTotal":1,"successGithubMap":{"myreaderx32":1},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 03:28:31","updatedTime":"2020-09-07 05:45:37","id":42717,"name":"東方算程譚","url":"http://blogs.wankuma.com/episteme/rss.aspx","subscriber":75,"website":null,"icon":"http://blogs.wankuma.com/favicon.ico","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx65/cdn7@2020_2/2020/09/06/21-45-35-292_b6c8dd6c90018ccc.ico","description":"Oriental Code Talk ── επιστημηが与太をこく、弾幕とは無縁のシロモノ。","weekly":null,"link":null},"noPictureArticleList":[{"createdTime":"2020-10-13 14:44:59","updatedTime":"2020-10-13 14:44:59","id":null,"feedId":42717,"linkMd5":"4e54cca36b7cb31c7b75253244e34d9f"}],"tmpCommonImgCdnBytes":0,"tmpBodyImgCdnBytes":72,"tmpBgImgCdnBytes":0,"extra4":{"start":1602571253727,"total":0,"statList":[{"spend":1548,"msg":"获取xml内容"},{"spend":13,"msg":"解释文章"},{"spend":120371,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":122264,"msg":"正文链接上传到cdn"}]},"extra5":3,"extra6":1,"extra7ImgCdnFailResultVector":[null,null,null,null,null,null,null,null],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-54.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://us-55.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://us-004.herokuapp.com/":{"failCount":2,"successCount":1,"resultList":[200,null,null]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"http://blogs.wankuma.com/episteme/aggbug/326006.aspx","sourceStatusCode":200,"destWidth":1,"destHeight":1,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn2@2020_5/2020/10/13/06-42-58-035_ac2a1ae72c004fe2.webp","sourceBytes":43,"destBytes":72,"targetWebpQuality":75,"feedId":42717,"totalSpendMs":1861,"convertSpendMs":2,"createdTime":"2020-10-13 14:42:56","host":"us-004*","referer":"http://blogs.wankuma.com/episteme/archive/2013/04/05/326006.aspx","linkMd5ListStr":"4e54cca36b7cb31c7b75253244e34d9f","githubUser":"myreaderx32","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"43 B","destSize":"72 B","compressRate":"167.4%"}],"successGithubMap":{"myreaderx32":1},"failGithubMap":{}}