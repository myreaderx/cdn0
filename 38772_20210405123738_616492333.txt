{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2021-04-05 20:37:35","updatedTime":"2021-04-05 20:37:35","title":"關於 DDD (Domain Driven Development) 微服務的結構設計議題","link":"http://www.kenming.idv.tw/?p=21884","description":"<p>＊＊ 本文同步發表於 <a href=\"https://www.facebook.com/groups/softthinking/permalink/1566957690176462/?__cft__[0]=AZWbapWKkc9P76w6Eithq9lefQaf6ndBeDq5zD-VKLc3C6dsMe3-Gom_trFfgTnwPNGt_9H0vPHuZ1DfEJelJXJlzIiD7KtjMX6yIPbE3Lu8zDzLC0wlU3dKw_Xl7UfmjzEh3XPW0pVV0xr8zktx7MrcBSiD5oGadrj1iASmGA-n435F0iJ6kMfaeQ4o65mG0E4&__tn__=%2CO%2CP-R\" rel=\"noopener\" target=\"_blank\">FB社群-軟體設計鮮思維</a> ＊＊</p>\n<p>最近在線上輔導了一位 技術職PM 結構設計的實現 (Realization)議題，他傳給我 DDD 的架構圖，覺得在「Domain Service」與「Domain Model」的責任界定上，觀念不是很清楚。</p>\n<p>嗯，其實這所謂的 DDD (Domain Driven Development) 架構圖根本就是典型 3-tier (Presentation-Application Logic-Data Source) 分層結構呈現爲圓形的剝洋蔥層次而已，越是內層 (Domain Model) 越代表爲系統的核心。<br />\n<a href=\"http://images.kenming.idv.tw/2021/01-06/onion-architecture.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://images.kenming.idv.tw/2021/01-06/onion-architecture.png\" alt=\"DDD Onion Architecture Diagram\" style=\"width:520px\" /></a></p>\n<p>工程師從這張圖往往會認爲「Domain Model」是最重要的核心觀念。是這樣沒錯，但對以「需求爲導向」的專案開發性質，它卻反而沒那麼重要！況且結構設計的基礎功夫要很紮實，封裝-介面-多型 諸多「虛」的設計觀念確實能充分了解並能整合活用，沒有花上 5-10 年以上功夫，是不容易應用在現實的系統開發上的。相對於此，「Domain Service」對現實的專案開發可是更切實際，且結構設計上的觀念也會比較容易入手。</p>\n<p><span id=\"more-21884\"></span></p>\n<p>界定好「Domain Service」這一層，就可以確實封裝 (encapsulate) 「資料存取」與「邏輯運算」這兩大塊，後續才得以透過重構 (refactoring) 的手段 (前提要撰寫單元測試)，讓責任的歸屬更加確實，這也是系統的「延展性」議題。簡而言之，「Domain Service」這一層，是決定系統在展示層 (presentation layer)與應用邏輯層 (application logic layer)未來是否能各自有機成長卻互不影響的主要關鍵。</p>\n<p>我們用一個很小的案例：「放入購物車」爲實作案例，第一課先讓學員專注在「PlaceShoppingCartService (簡化爲 PlaceCartService)」這個服務類別，以及爲它撰寫「PlaceShoppingCartSericeTest」所需的測試案例 (test case) 使用 C#.NET 的實作上。</p>\n<p>果不其然，過於沉浸於實作技術的工程師，往往會馬上想到實作的細節，卻會忽略了幾個結構設計上的原則：</p>\n<ul>\n<li>各類型類別的責任界定：如服務類別主要責任爲何 (方法、參數、回傳值)。</li>\n<li>命名的學問：服務/測試/資料傳遞 類別、方法、變數等命名議題。</li>\n<li>測試案例：該規劃哪些測試方法與準備測試數據。</li>\n<li>資料傳遞物件 (dto, data transfer object)：如何組織資料、是否會被多個 Service 類別共用等議題。</li>\n</ul>\n<p>這位學員的實作能力相當不錯，有些觀念一旦取得共識，他馬上就撰寫 C# 程式碼在 Github 上傳給我 Review 並在線上討論。不過其實在寫出程式碼前，在觀念溝通的過程中，如果先能用 UML 類別 (class)圖與物件合作的循序 (sequence) 圖表達，不需要工具，在筆記本塗鴉拍照上傳就可，這樣對觀念的表達很快就可以表現出來，而且因爲先過濾掉實作細節，反而比較能突顯討論的重點。可惜絕大部分的實作開發人員還不懂得如何使用設計圖表達設計思維，這應該也是必備的技能。</p>\n<p>一對一的線上輔導得以教學相長。從實作的細節過程中，更能了解諸多工程師的想法與問題並可以反饋到設計的思維上；同時我也從過程中學到一些雲端開發工具的使用，對未來開發輔導與教案的整理上很有幫助。</p>\n<p>藉由這個輔導的案例，除了練習的程式碼範例 (不涉及該學員的工作隱私)，後續我也會把上述所提及的幾個結構設計原則撰文討論與分享。</p>〈<a href=\"http://www.kenming.idv.tw/about_ddd_micro-service_structure-design/\">關於 DDD (Domain Driven Development) 微服務的結構設計議題</a>〉這篇文章最早發佈於《<a href=\"http://www.kenming.idv.tw\">Kenmingの鮮思維</a>》。<div class='yarpp-related-rss'>\n<p>相關文章：<ul>\n<li><a href=\"http://www.kenming.idv.tw/uml2_0_mda_model_driven_architecture_cdi/\" rel=\"bookmark\" title=\"{UML2.0} MDA(Model Driven Architecture) 簡單說明\">{UML2.0} MDA(Model Driven Architecture) 簡單說明 </a></li>\n<li><a href=\"http://www.kenming.idv.tw/asp-net-mvc_framework_learning_note/\" rel=\"bookmark\" title=\"ASP.NET MVC 框架學習心得註記\">ASP.NET MVC 框架學習心得註記 </a></li>\n<li><a href=\"http://www.kenming.idv.tw/er_el_a_pas_tier_vs_layer_enterprise_arc/\" rel=\"bookmark\" title=\"{軟體架構} Tier vs. Layer Enterprise Architecture\">{軟體架構} Tier vs. Layer Enterprise Architecture </a></li>\n<li><a href=\"http://www.kenming.idv.tw/ithome_a_cec_a_11_test_driven_developmen/\" rel=\"bookmark\" title=\"{iThome 書評—11} Test Driven Development By Examples\">{iThome 書評—11} Test Driven Development By Examples </a></li>\n<li><a href=\"http://www.kenming.idv.tw/sa_e_ac_e_eb_a_domain_knowledge_if/\" rel=\"bookmark\" title=\"SA 需不需要懂 &#8220;領域知識(Domain Knowledge)&#8221; ？\">SA 需不需要懂 &#8220;領域知識(Domain Knowledge)&#8221; ？ </a></li>\n<li><a href=\"http://www.kenming.idv.tw/software-technician_favorite_universal-dbmanager-object/\" rel=\"bookmark\" title=\"軟體技術人員最愛卻也是尾大不掉的萬用 Database Manager 物件\">軟體技術人員最愛卻也是尾大不掉的萬用 Database Manager 物件 </a></li>\n</ul></p>\n</div>\n","descriptionType":"html","publishedDate":"Fri, 19 Mar 2021 22:48:05 +0000","feedId":38772,"bgimg":"http://images.kenming.idv.tw/2021/01-06/onion-architecture.png","linkMd5":"cd4e613715df8daa300301b33f0bd6bb","destWidth":800,"destHeight":800,"sourceBytes":141943,"destBytes":56596,"author":"Wang Kenming","articleImgCdnMap":{"http://images.kenming.idv.tw/2021/01-06/onion-architecture.png":null},"publishedOrCreatedDate":1617626255324}],"record":{"createdTime":"2021-04-05 20:37:35","updatedTime":"2021-04-05 20:37:35","feedId":38772,"fetchDate":"Mon, 05 Apr 2021 12:37:35 +0000","fetchMs":33229,"handleMs":2932,"totalMs":39998,"newArticles":0,"totalArticles":8,"status":1,"type":0,"ip":"34b55bb048d0d72cef4ab614a04078fd","hostName":"us-036*","requestId":"6704163003d049ddb5c2f3a2223a5b8c_38772","contentType":"application/rss+xml; charset=UTF-8","totalBytes":0,"bgimgsTotal":1,"bgimgsGithubTotal":0,"articlesImgsTotal":1,"articlesImgsGithubTotal":0,"successGithubMap":{},"failGithubMap":{"myreaderx14":1}},"feed":{"createdTime":"2020-09-07 03:15:13","updatedTime":"2020-09-07 03:15:13","id":38772,"name":"Kenmingの鮮思維","url":"http://www.kenming.idv.tw/feed","subscriber":83,"website":null,"icon":"http://www.kenming.idv.tw/favicon.ico","icon_jsdelivr":null,"description":"不用牽掛過去，不必擔心未來，踏實於現在，就與過去和未來同在！","weekly":null,"link":"http://www.kenming.idv.tw"},"noPictureArticleList":[{"createdTime":"2021-04-05 20:37:38","updatedTime":"2021-04-05 20:37:38","id":null,"feedId":38772,"linkMd5":"cd4e613715df8daa300301b33f0bd6bb"}],"tmpCommonImgCdnBytes":0,"tmpBodyImgCdnBytes":0,"tmpBgImgCdnBytes":0,"extra4":{"start":1617626218530,"total":0,"statList":[{"spend":33863,"msg":"获取xml内容"},{"spend":2932,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":0,"msg":"正文链接上传到cdn"}]},"extra5":1,"extra6":1,"extra7ImgCdnFailResultVector":[{"code":1,"isDone":false,"source":"http://images.kenming.idv.tw/2021/01-06/onion-architecture.png","sourceStatusCode":200,"destWidth":800,"destHeight":800,"sourceBytes":141943,"destBytes":56596,"targetWebpQuality":75,"feedId":38772,"totalSpendMs":1667,"convertSpendMs":33,"createdTime":"2021-04-05 20:37:35","host":"europe-58*","referer":"http://www.kenming.idv.tw/?p=21884","linkMd5ListStr":"cd4e613715df8daa300301b33f0bd6bb,cd4e613715df8daa300301b33f0bd6bb","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx14/cdn38/contents/2021/04/05/12-37-36-899_bba08a817cd1706b.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 68584859.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Mon, 05 Apr 2021 12:37:37 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["B800:637A:4729A00:48DFDBC:606B0490"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1617626410"],"x-ratelimit-used":["60"],"x-xss-protection":["0"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx14/cdn38/contents/2021/04/05/12-37-36-899_bba08a817cd1706b.webp","historyStatusCode":[],"spendMs":212},"base64UserPassword":null,"token":"6b67d******************************91b08"},"githubUser":"myreaderx14","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"destSize":"55.3 KB","compressRate":"39.9%","sourceSize":"138.6 KB"},{"code":1,"isDone":false,"source":"http://images.kenming.idv.tw/2021/01-06/onion-architecture.png","sourceStatusCode":200,"destWidth":800,"destHeight":800,"sourceBytes":141943,"destBytes":56596,"targetWebpQuality":75,"feedId":38772,"totalSpendMs":1297,"convertSpendMs":28,"createdTime":"2021-04-05 20:37:37","host":"europe-58*","referer":"http://www.kenming.idv.tw/?p=21884","linkMd5ListStr":"cd4e613715df8daa300301b33f0bd6bb,cd4e613715df8daa300301b33f0bd6bb","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx14/cdn38/contents/2021/04/05/12-37-38-272_bba08a817cd1706b.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 68584859.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Mon, 05 Apr 2021 12:37:38 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["B800:637A:4729B4A:48DFF1B:606B0492"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1617626410"],"x-ratelimit-used":["60"],"x-xss-protection":["0"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx14/cdn38/contents/2021/04/05/12-37-38-272_bba08a817cd1706b.webp","historyStatusCode":[],"spendMs":211},"base64UserPassword":null,"token":"6b67d******************************91b08"},"githubUser":"myreaderx14","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"destSize":"55.3 KB","compressRate":"39.9%","sourceSize":"138.6 KB"}],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{},"extra12ImgCdnSuccessResultVector":[],"successGithubMap":{},"failGithubMap":{"myreaderx14":1}}