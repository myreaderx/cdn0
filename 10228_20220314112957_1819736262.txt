{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2022-03-14 19:29:30","updatedTime":"2022-03-14 19:29:30","title":"Asana’s Tech Stack: How we build a collaborative app for teams of all sizes","link":"https://blog.asana.com/?p=13330","description":"<div class=\"wpcollab-hello-emoji\">\n<p>I talk to a fair number of software engineers about working at Asana. They’ve usually heard a lot about how it’s a <a href=\"https://blog.asana.com/2021/08/5-years-best-place-to-work/\">great place to work</a>, and they want to know more about the tech stack and the challenges we work on.</p>\n\n\n\n<p>In the spirit of highlighting the technical challenges that have kept me excited since I started working here three years ago, I wanted to share an overview of our current architecture along with some of the problems we’re working on today.</p>\n\n\n\n<h2>About the product</h2>\n\n\n\n<p>At Asana, <a href=\"https://asana.com/company\">we want to make</a> teams of any size (1 to 100,000+) more effective by organizing their work in a single connected tool. This drives our product roadmap, along with our architecture and its challenges.</p>\n\n\n\n<p>At most companies, each team has their own work-tracking tool (think JIRA for Engineering, Zendesk for Customer Support, Salesforce for Sales). If people didn’t have access to another team’s tool, they’d have no idea what was being worked on, who was working on it, or why it mattered. Anyone working with multiple teams would have their work scattered across multiple tools with no guarantee each one was up-to-date.</p>\n\n\n\n<figure class=\"wp-block-image\"><img src=\"https://lh5.googleusercontent.com/7_pinVHS6m6g3dWZpm39XA7KkLPhMacIJz4Uh7544HngQlwak62GkJW9UHVTytn6lT3KZTe4zXtd9lBQxf8TbB7GNZ6_baAgoSnjWFa3iBoB_16zuoUrMebV_98Vr7uICLzYJZza\" alt=\"\" /></figure>\n\n\n\n<p>In contrast, Asana believes that every team in a company should be using the same tool to track (or sync) their goals, projects, and tasks. This shared source of truth gives everyone clarity about who’s working on what, by when, and why—without the headaches of switching between tools and information silos.</p>\n\n\n\n<p>This motivates some architectural requirements:</p>\n\n\n\n<ul><li>Feature-rich and flexible enough to support the plans and workflows of teams as different as HR, Engineering, and Sales</li><li>Performant, reliable, and synced across multiple devices so users stay focused on their meaningful work (not “<a href=\"https://asana.com/resources/why-work-about-work-is-bad\">work about work</a>”)</li><li>Easy for users to learn and set up their workflows</li><li>Integrated with a wide range of team-specific and company-specific tools</li><li>Secure &#38; scalable enough for organizations of 100,000 and beyond</li></ul>\n\n\n\n<p>Add all these factors together, and you have a software suite with challenges across the stack!</p>\n\n\n\n<h2>App architecture</h2>\n\n\n\n<h3>Asana’s Work Graph data model</h3>\n\n\n\n<p>One of Asana’s product differentiators is the flexibility and number of connections that users can create in the data model. Almost every object can be “<a href=\"https://asana.com/guide/team/advanced/connect-your-work#gl-tasks-multiple-projects\">multi-homed</a>” into other objects, creating a dense graph of objects and relationships.</p>\n\n\n\n<figure class=\"wp-block-image\"><img src=\"https://lh5.googleusercontent.com/f9-TxMnLgZVAOsnPAhEhdGhuDXEt6u04kwZTFm-pqEPuP5YksIGElkxeJC7d7W37sPkYhrgqz5y4pHY7wE66F9t1Up9NHtzHXdNIojGka9HkvPlA6JeqEWhEEsTX-HSqjCCSI8jy\" alt=\"\" /></figure>\n\n\n\n<p>This presents constant challenges around feature scaling, data integration, and product modeling.</p>\n\n\n\n<p>As an example, users might have read access on a particular task for many reasons. They could be the task’s assignee, they might be in the task’s collaborator list, or the task might be public, or they might be a member of one of the task’s projects, or they might be a member of a team associated with one of those projects. It’s important to have the right data permissions and controls in place, but standard approaches to SQL queries wouldn’t be able to run this logic performantly.</p>\n\n\n\n<p>To address these challenges, we’ve built a MySQL-backed persistence layer called OKVStore. It’s inspired by graph databases and object-oriented languages and enables engineers to declaratively define their properties &#38; access control rules in an object-like configuration file without worrying about the <a href=\"https://en.wikipedia.org/wiki/Object%E2%80%93relational_impedance_mismatch\">object-relational impedance mismatch</a> or LunaDb’s reactivity pipeline (more on that below).</p>\n\n\n\n<p>Of course, we still have many challenges in this space that keep us busy:</p>\n\n\n\n<ul><li>Supporting divergent use cases like <a href=\"https://asana.com/guide/examples/marketing/editorial-calendar\">content calendars</a>, <a href=\"https://asana.com/guide/examples/it/it-helpdesk-requests\">ticket backlogs</a>, and <a href=\"https://asana.com/guide/examples/eng/sprint-planning\">sprint-planning</a> in a single tool</li><li>Mapping the data model to team-specific productivity tools</li><li>Modeling team relationships in <a href=\"https://asana.com/resources/matrix-organization\">matrixed organizations</a></li><li>Data pipelines for replicating to Elasticsearch and ML datastores</li><li>Integrating data governance into our frameworks</li><li>Scaling to multiple clusters distributed across the globe</li></ul>\n\n\n\n<h3>Rich frontend clients</h3>\n\n\n\n<p>To support the wide variety of features users expect to get their work done, Asana’s codebase has grown to millions of lines of TypeScript/JavaScript code and thousands of React components.</p>\n\n\n\n<h3 class=\"has-text-align-center\"><img loading=\"lazy\" src=\"https://lh4.googleusercontent.com/G6kC-sO7ZB2wlgLIoWSB3pbcnMMwJcqtYRhZVQoIYs9UhxJAXY4ftZdFdVVrvAhYjvG_7W0SkgQk5mx4f66ucinvHogPum9AApcnhWGEKyOdnrtpU86wfvYsRJeQANtG9E0-LQD4\" width=\"625.0578512396694\" height=\"387\"></h3>\n\n\n\n<p>To keep the quality of the product and pace of development high, we’ve been working on several challenges:</p>\n\n\n\n<ul><li>Flexible spreadsheet, calendar, and timeline views for planning big projects</li><li>Richtext document editing for <a href=\"https://asana.com/guide/help/projects/project-overview#gl-brief\">kicking off projects</a> &#38; keeping notes</li><li><a href=\"https://www.youtube.com/watch?v=ylDed18OVdY\">Extracting</a> a library of accessible React components across dozens of teams</li><li><a href=\"https://blog.asana.com/2017/07/developer-environment-making-it-reliable-by-making-it-fast-to-reset/\">Integrating Bazel</a> for speedier incremental builds &#38; test runs</li><li><a href=\"https://blog.asana.com/2021/01/asana-engineering-ships-web-application-releases/\">Automating</a> releases and rollbacks based on error reporting</li><li>Bundle-splitting to speed up page loads</li></ul>\n\n\n\n<p>In addition to all this web code, we also have <a href=\"https://asana.com/downloadhttps://asana.com/download\">mobile apps</a> written natively in Swift &#38; Kotlin and an Electron-based <a href=\"https://asana.com/download\">desktop app</a>.</p>\n\n\n\n<h3>Realtime backend</h3>\n\n\n\n<p>Users expect that when they add a comment on a task in Asana, every other browser will immediately show that comment without needing to refresh the page. This could be straightforward to build for a single comment feed, but becomes a lot harder when users expect the same reactivity from every feature in the app (even for edits that fan out to thousands of connected clients).</p>\n\n\n\n<p>Asana built a custom service in Scala called LunaDb to power this app-wide reactive data-loading. Clients issue queries for graphs of related data and business logic calculations (similar to GraphQL), automatically subscribing to any updates to those query results. LunaDb then watches for changes in the underlying databases and pushes query updates down to all subscribed clients.</p>\n\n\n\n<figure class=\"wp-block-image\"><img src=\"https://lh5.googleusercontent.com/JSdDwKT1u8v3Vjes8uRQoKxAnXlyyVIABrE5xzYHFtXKiwPJ2iYts9kpn58aS2f8LvxyqmEA2seS54VBkUx-_XB6tTjpwFID391nHCLR9gOtTKMBgkM6IfoBKCi4v6k_SGqeTtYG\" alt=\"\" /></figure>\n\n\n\n<p>Writes are also routed through LunaDb, executing in our Node-based LunaServer backend application framework.</p>\n\n\n\n<p>Asana <a href=\"https://blog.asana.com/2015/10/asana-tech-talk-reactive-queries/\">first introduced</a> this technology in 2015 (around the time GraphQL became public) and it’s going through a renaissance to meet our newest challenges:</p>\n\n\n\n<ul><li>Refactoring LunaDb to <a href=\"https://blog.asana.com/2021/03/scaling-scala/\">support more backend languages</a> for product developers</li><li>Isolating stateful and stateless components for scalability and modularity</li><li>Instrumenting requests with distributed tracing to give developers insight into costs</li><li>Migrating to GraphQL’s query format</li><li>Bringing reactive data-loading to mobile clients</li></ul>\n\n\n\n<h2>…and we’re hiring!</h2>\n\n\n\n<p>Asana’s been around for 14 years and it feels like we’re just getting started. We have an ambitious vision full of new problems we’re excited to solve and a strong foundation of a well-loved product.</p>\n\n\n\n<p>There’s a lot of opportunity to bring new technical knowledge to Asana, solve these challenges, and learn from the smart &#38; kind engineers already on the team. (In addition to technical excellence, we also pride ourselves on our culture of design docs, close-knit teams, tech talks, and work-life balance)</p>\n\n\n\n<p>If any of this is exciting to you, we’re hiring for engineering roles across the stack. Check out our <a href=\"https://asana.com/jobs/engineering\">open roles</a>.</p>\n</div><p>The post <a rel=\"nofollow\" href=\"https://blog.asana.com/2022/02/asana-tech-stack/\">Asana’s Tech Stack: How we build a collaborative app for teams of all&#160;sizes</a> appeared first on <a rel=\"nofollow\" href=\"https://blog.asana.com\">The Asana Blog</a>.</p>\n","descriptionType":"html","publishedDate":"Tue, 01 Mar 2022 04:49:29 +0000","feedId":10228,"bgimg":"https://lh5.googleusercontent.com/7_pinVHS6m6g3dWZpm39XA7KkLPhMacIJz4Uh7544HngQlwak62GkJW9UHVTytn6lT3KZTe4zXtd9lBQxf8TbB7GNZ6_baAgoSnjWFa3iBoB_16zuoUrMebV_98Vr7uICLzYJZza","linkMd5":"95df54f99c13434b59237396ed30ae38","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx3/cdn22@2020_5/2022/03/14/11-29-55-333_f47ae3fee2412923.webp","destWidth":1438,"destHeight":764,"sourceBytes":3713763,"destBytes":3105670,"author":"Zach Millman","articleImgCdnMap":{"https://lh5.googleusercontent.com/7_pinVHS6m6g3dWZpm39XA7KkLPhMacIJz4Uh7544HngQlwak62GkJW9UHVTytn6lT3KZTe4zXtd9lBQxf8TbB7GNZ6_baAgoSnjWFa3iBoB_16zuoUrMebV_98Vr7uICLzYJZza":"https://cdn.jsdelivr.net/gh/myreaderx3/cdn22@2020_5/2022/03/14/11-29-55-333_f47ae3fee2412923.webp","https://lh5.googleusercontent.com/f9-TxMnLgZVAOsnPAhEhdGhuDXEt6u04kwZTFm-pqEPuP5YksIGElkxeJC7d7W37sPkYhrgqz5y4pHY7wE66F9t1Up9NHtzHXdNIojGka9HkvPlA6JeqEWhEEsTX-HSqjCCSI8jy":"https://cdn.jsdelivr.net/gh/myreaderx18/cdn37@2020_6/2022/03/14/11-29-56-711_27c3cc295b74cfef.webp","https://lh4.googleusercontent.com/G6kC-sO7ZB2wlgLIoWSB3pbcnMMwJcqtYRhZVQoIYs9UhxJAXY4ftZdFdVVrvAhYjvG_7W0SkgQk5mx4f66ucinvHogPum9AApcnhWGEKyOdnrtpU86wfvYsRJeQANtG9E0-LQD4":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn43@2020_6/2022/03/14/11-29-56-447_7e21a44f9f558cdf.webp","https://lh5.googleusercontent.com/JSdDwKT1u8v3Vjes8uRQoKxAnXlyyVIABrE5xzYHFtXKiwPJ2iYts9kpn58aS2f8LvxyqmEA2seS54VBkUx-_XB6tTjpwFID391nHCLR9gOtTKMBgkM6IfoBKCi4v6k_SGqeTtYG":"https://cdn.jsdelivr.net/gh/myreaderx2/cdn40@2020_4/2022/03/14/11-29-56-219_700efcff75cfe54d.webp"},"publishedOrCreatedDate":1647257370280}],"record":{"createdTime":"2022-03-14 19:29:30","updatedTime":"2022-03-14 19:29:30","feedId":10228,"fetchDate":"Mon, 14 Mar 2022 11:29:30 +0000","fetchMs":209,"handleMs":23,"totalMs":27354,"newArticles":0,"totalArticles":10,"status":1,"type":0,"ip":"245d88d7b2d8f26704713c23b090d029","hostName":"us-005*","requestId":"3e52cfe20040432fb173c9eaecd4c0ed_10228","contentType":"application/rss+xml; charset=UTF-8","totalBytes":3208744,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":4,"articlesImgsGithubTotal":4,"successGithubMap":{"myreaderx32":1,"myreaderx3":1,"myreaderx2":1,"myreaderx18":1},"failGithubMap":{}},"feed":{"createdTime":"2020-08-25 04:35:44","updatedTime":"2020-09-05 16:11:09","id":10228,"name":"The Asana Blog","url":"https://blog.asana.com/feed/","subscriber":302,"website":null,"icon":"https://blog.asana.com/favicon.ico","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx64/cdn62@2020_3/2020/09/05/08-11-02-977_5bfaf05fc7d596e2.ico","description":"The official blog for Asana news, tips, and updates","weekly":null,"link":null},"noPictureArticleList":[],"tmpCommonImgCdnBytes":3105670,"tmpBodyImgCdnBytes":103074,"tmpBgImgCdnBytes":0,"extra4":{"start":1647257370018,"total":0,"statList":[{"spend":239,"msg":"获取xml内容"},{"spend":23,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":1304,"msg":"正文链接上传到cdn"}]},"extra5":4,"extra6":4,"extra7ImgCdnFailResultVector":[],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://europe-23.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://europe-24.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-011.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://lh5.googleusercontent.com/7_pinVHS6m6g3dWZpm39XA7KkLPhMacIJz4Uh7544HngQlwak62GkJW9UHVTytn6lT3KZTe4zXtd9lBQxf8TbB7GNZ6_baAgoSnjWFa3iBoB_16zuoUrMebV_98Vr7uICLzYJZza","sourceStatusCode":200,"destWidth":1438,"destHeight":764,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx3/cdn22@2020_5/2022/03/14/11-29-55-333_f47ae3fee2412923.webp","sourceBytes":3713763,"destBytes":3105670,"targetWebpQuality":75,"feedId":10228,"totalSpendMs":25764,"convertSpendMs":24833,"createdTime":"2022-03-14 19:29:30","host":"us-54*","referer":"https://blog.asana.com/?p=13330","linkMd5ListStr":"95df54f99c13434b59237396ed30ae38,95df54f99c13434b59237396ed30ae38","githubUser":"myreaderx3","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"3.5 MB","destSize":"3 MB","compressRate":"83.6%"},{"code":1,"isDone":false,"source":"https://lh5.googleusercontent.com/JSdDwKT1u8v3Vjes8uRQoKxAnXlyyVIABrE5xzYHFtXKiwPJ2iYts9kpn58aS2f8LvxyqmEA2seS54VBkUx-_XB6tTjpwFID391nHCLR9gOtTKMBgkM6IfoBKCi4v6k_SGqeTtYG","sourceStatusCode":200,"destWidth":1600,"destHeight":666,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx2/cdn40@2020_4/2022/03/14/11-29-56-219_700efcff75cfe54d.webp","sourceBytes":97756,"destBytes":29528,"targetWebpQuality":75,"feedId":10228,"totalSpendMs":402,"convertSpendMs":30,"createdTime":"2022-03-14 19:29:56","host":"us-011*","referer":"https://blog.asana.com/?p=13330","linkMd5ListStr":"95df54f99c13434b59237396ed30ae38","githubUser":"myreaderx2","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"95.5 KB","destSize":"28.8 KB","compressRate":"30.2%"},{"code":1,"isDone":false,"source":"https://lh4.googleusercontent.com/G6kC-sO7ZB2wlgLIoWSB3pbcnMMwJcqtYRhZVQoIYs9UhxJAXY4ftZdFdVVrvAhYjvG_7W0SkgQk5mx4f66ucinvHogPum9AApcnhWGEKyOdnrtpU86wfvYsRJeQANtG9E0-LQD4","sourceStatusCode":200,"destWidth":978,"destHeight":605,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn43@2020_6/2022/03/14/11-29-56-447_7e21a44f9f558cdf.webp","sourceBytes":28403,"destBytes":14280,"targetWebpQuality":75,"feedId":10228,"totalSpendMs":786,"convertSpendMs":31,"createdTime":"2022-03-14 19:29:56","host":"europe-23*","referer":"https://blog.asana.com/?p=13330","linkMd5ListStr":"95df54f99c13434b59237396ed30ae38","githubUser":"myreaderx32","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"27.7 KB","destSize":"13.9 KB","compressRate":"50.3%"},{"code":1,"isDone":false,"source":"https://lh5.googleusercontent.com/f9-TxMnLgZVAOsnPAhEhdGhuDXEt6u04kwZTFm-pqEPuP5YksIGElkxeJC7d7W37sPkYhrgqz5y4pHY7wE66F9t1Up9NHtzHXdNIojGka9HkvPlA6JeqEWhEEsTX-HSqjCCSI8jy","sourceStatusCode":200,"destWidth":1600,"destHeight":1011,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx18/cdn37@2020_6/2022/03/14/11-29-56-711_27c3cc295b74cfef.webp","sourceBytes":1527973,"destBytes":59266,"targetWebpQuality":75,"feedId":10228,"totalSpendMs":1165,"convertSpendMs":83,"createdTime":"2022-03-14 19:29:56","host":"europe-24*","referer":"https://blog.asana.com/?p=13330","linkMd5ListStr":"95df54f99c13434b59237396ed30ae38","githubUser":"myreaderx18","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"1.5 MB","destSize":"57.9 KB","compressRate":"3.9%"}],"successGithubMap":{"myreaderx32":1,"myreaderx3":1,"myreaderx2":1,"myreaderx18":1},"failGithubMap":{}}