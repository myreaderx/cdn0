{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-10-19 01:51:30","updatedTime":"2020-10-19 01:51:30","title":"【权限维持】Microsoft Office","link":"https://rcoil.me/2019/05/【权限维持】Microsoft Office/","description":"<p>本文是针对<a href=\"https://github.com/RcoIl/Mind-Map/blob/master/Windows%E5%B8%B8%E8%A7%81%E6%8C%81%E4%B9%85%E6%8E%A7%E5%88%B6.png\" target=\"_blank\" rel=\"noopener\">Windows常见持久控制</a>的第一次说明。<br><a id=\"more\"></a></br></p> \n<h2 id=\"0x00-前言\"><a href=\"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#0x00-前言\" class=\"headerlink\" title=\"0x00 前言\"></a>0x00 前言</h2> \n<p>前段时间有过个需求，判断 <code>Office</code>是否开启宏，索性将 <a href=\"https://github.com/RcoIl/Mind-Map/blob/master/Windows%E5%B8%B8%E8%A7%81%E6%8C%81%E4%B9%85%E6%8E%A7%E5%88%B6.png\" target=\"_blank\" rel=\"noopener\">Windows常见持久控制</a> 中有关 <code>Office</code> 的记录也在后文写一下。</p> \n<ul> \n <li>判断是否安装了 <code>Microsoft Office</code></li> \n <li>判断是否开启了 <code>宏</code></li> \n <li>相关利用</li> \n</ul> \n<h2 id=\"0x01-环境说明\"><a href=\"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#0x01-环境说明\" class=\"headerlink\" title=\"0x01 环境说明\"></a>0x01 环境说明</h2> \n<figure class=\"highlight lsl\"> \n <table> \n  <tr> \n   <td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br /></br></br></br></br></pre></td> \n   <td class=\"code\"><pre><span class=\"line\">Microsoft Windows <span class=\"number\">7</span> Ultimate x64</span><br><span class=\"line\">- Office <span class=\"number\">2007</span>（实际环境）</span><br><span class=\"line\">- Office <span class=\"number\">2010</span>（测试环境）</span><br><span class=\"line\">- Office <span class=\"number\">2013</span>（测试环境）</span><br><span class=\"line\">- Office <span class=\"number\">2016</span>（测试环境）</span><br /></br></br></br></br></pre></td> \n  </tr> \n </table> \n</figure> \n<h2 id=\"0x02-相关判断\"><a href=\"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#0x02-相关判断\" class=\"headerlink\" title=\"0x02 相关判断\"></a>0x02 相关判断</h2> \n<ul> \n <li><p><code>VBAWarnings</code> 键值数值数据说明</p> \n  <figure class=\"highlight makefile\"> \n   <table> \n    <tr> \n     <td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br /></br></br></br></pre></td> \n     <td class=\"code\"><pre><span class=\"line\"><span class=\"section\">1:启用所有宏</span></span><br><span class=\"line\"><span class=\"section\">2:禁用所有宏并发出通知</span></span><br><span class=\"line\"><span class=\"section\">3:禁用无数字部署的所有宏</span></span><br><span class=\"line\"><span class=\"section\">4:禁用所有宏并且不通知</span></span><br /></br></br></br></pre></td> \n    </tr> \n   </table> \n  </figure></li> \n <li><p>代码</p> \n  <figure class=\"highlight csharp\"> \n   <table> \n    <tr> \n     <td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br /></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></pre></td> \n     <td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 通过注册表检测 Office 是否开启宏</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">OfficeVBAWarnings</span>(<span class=\"params\"><span class=\"keyword\">string</span> OfficeVersion</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>        {</span><br><span class=\"line\">            List&lt;<span class=\"keyword\">string</span>&gt; OfficeFeatures = <span class=\"keyword\">new</span> List&lt;<span class=\"keyword\">string</span>&gt;()</span><br><span class=\"line\">            {</span><br><span class=\"line\"> <span class=\"string\">\"Excel\"</span>, <span class=\"string\">\"Word\"</span>, <span class=\"string\">\"PowerPoint\"</span></span><br><span class=\"line\"> };</span><br><span class=\"line\"> <span class=\"keyword\">foreach</span> (<span class=\"keyword\">string</span> Features <span class=\"keyword\">in</span> OfficeFeatures)</span><br><span class=\"line\"> {</span><br><span class=\"line\"> <span class=\"keyword\">string</span> basekey = <span class=\"string\">@\"SOFTWARE\\Microsoft\\Office\\\"</span> + OfficeVersion + <span class=\"string\">@\"\\\"</span> + Features + <span class=\"string\">@\"\\Security\"</span>;</span><br><span class=\"line\"> RegistryKey registryKey = Registry.CurrentUser.OpenSubKey(basekey);</span><br><span class=\"line\"> <span class=\"keyword\">if</span> (registryKey != <span class=\"literal\">null</span>)</span><br><span class=\"line\"> {</span><br><span class=\"line\"> <span class=\"keyword\">string</span>[] ValueNames = registryKey.GetValueNames();</span><br><span class=\"line\"> <span class=\"keyword\">if</span> (registryKey.ValueCount == <span class=\"number\">0</span>)</span><br><span class=\"line\"> {</span><br><span class=\"line\"> Console.WriteLine(<span class=\"string\">\" [&gt;] {0} VBAWarnings: 2\"</span>, Features);</span><br><span class=\"line\"> }</span><br><span class=\"line\"> <span class=\"keyword\">else</span></span><br><span class=\"line\"> {</span><br><span class=\"line\"> <span class=\"keyword\">foreach</span> (<span class=\"keyword\">string</span> KeyName <span class=\"keyword\">in</span> ValueNames)</span><br><span class=\"line\"> {</span><br><span class=\"line\"> <span class=\"keyword\">object</span> VBAWarnings = registryKey.GetValue(<span class=\"string\">\"VBAWarnings\"</span>);</span><br><span class=\"line\"> Console.WriteLine(<span class=\"string\">\" [&gt;] {0} VBAWarnings: {1}\"</span>, Features, VBAWarnings);</span><br><span class=\"line\"> }</span><br><span class=\"line\"> }</span><br><span class=\"line\"> }</span><br><span class=\"line\"> }</span><br><span class=\"line\"> }</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// 通过注册表检测 Office 版本</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">OfficeIsInstall</span>(<span class=\"params\"><span class=\"keyword\">string</span> OfficeVersion</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span> {</span><br><span class=\"line\"> <span class=\"keyword\">string</span> basekey = <span class=\"string\">@\"SOFTWARE\\Microsoft\\Office\\\"</span> + OfficeVersion + <span class=\"string\">@\"\\Common\\InstallRoot\"</span>;</span><br><span class=\"line\"> RegistryKey registryKey = Registry.LocalMachine.OpenSubKey(basekey);</span><br><span class=\"line\"> <span class=\"keyword\">if</span> (registryKey != <span class=\"literal\">null</span>)</span><br><span class=\"line\"> {</span><br><span class=\"line\"> <span class=\"keyword\">if</span> (registryKey.GetValue(<span class=\"string\">\"Path\"</span>) != <span class=\"literal\">null</span>)</span><br><span class=\"line\"> {</span><br><span class=\"line\"> Console.WriteLine(<span class=\"string\">\" [&gt;] Microsoft Office Version: {0}\"</span>, OfficeVersion);</span><br><span class=\"line\"> OfficeVBAWarnings(OfficeVersion);</span><br><span class=\"line\"> }</span><br><span class=\"line\"> }</span><br><span class=\"line\"> }</span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">Main</span>(<span class=\"params\"><span class=\"keyword\">string</span>[] args</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span> {</span><br><span class=\"line\"> List&lt;<span class=\"keyword\">string</span>&gt; OfficeVersions = <span class=\"keyword\">new</span> List&lt;<span class=\"keyword\">string</span>&gt;()</span><br><span class=\"line\"> {</span><br><span class=\"line\"> <span class=\"string\">\"8.0\"</span>, <span class=\"string\">\"9.0\"</span>, <span class=\"string\">\"10.0\"</span>, <span class=\"string\">\"11.0\"</span>, <span class=\"string\">\"12.0\"</span>, <span class=\"string\">\"14.0\"</span>, <span class=\"string\">\"15.0\"</span>, <span class=\"string\">\"16.0\"</span></span><br><span class=\"line\"> };</span><br><span class=\"line\"> <span class=\"keyword\">foreach</span> (<span class=\"keyword\">string</span> OfficeVersion <span class=\"keyword\">in</span> OfficeVersions)</span><br><span class=\"line\"> {</span><br><span class=\"line\"> OfficeIsInstall(OfficeVersion);</span><br><span class=\"line\"> }</span><br><span class=\"line\"> }</span><br /></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></pre></td> \n    </tr> \n   </table> \n  </figure></li> \n</ul> \n<h2 id=\"0x03-Office-模板宏\"><a href=\"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#0x03-Office-模板宏\" class=\"headerlink\" title=\"0x03 Office 模板宏\"></a>0x03 Office 模板宏</h2> \n<p>每次 <code>Office</code> 程序启动时都会加载使用 <code>Office</code> 程序中的基本模板。</p> \n<p><em>相关位置</em></p> \n<figure class=\"highlight taggerscript\"> \n <table> \n  <tr> \n   <td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br /></br></br></br></pre></td> \n   <td class=\"code\"><pre><span class=\"line\">Word Normal.dotm位置：</span><br><span class=\"line\">C:<span class=\"symbol\">\\U</span>sers(username)<span class=\"symbol\">\\A</span>ppData<span class=\"symbol\">\\R</span>oaming<span class=\"symbol\">\\M</span>icrosoft<span class=\"symbol\">\\T</span>emplates<span class=\"symbol\">\\N</span>ormal.dotm</span><br><span class=\"line\"></span><br><span class=\"line\">Excel Personal.xlsb位置：C:<span class=\"symbol\">\\U</span>sers(username)<span class=\"symbol\">\\A</span>ppData<span class=\"symbol\">\\R</span>oaming<span class=\"symbol\">\\M</span>icrosoft<span class=\"symbol\">\\E</span>xcel<span class=\"symbol\">\\X</span>LSTART<span class=\"symbol\">\\P</span>ERSONAL.XLSB</span><br /></br></br></br></pre></td> \n  </tr> \n </table> \n</figure> \n<p><em>这一部分在倾旋的博客有提到</em></p> \n<p>新建宏名字 –&gt; <code>word</code> 为<em>AutoOpen</em>， <code>Excel</code> 为<em>Auto_Open</em></p> \n<p>使用 <code>GIF</code> 进行演示（Excel 同理）</p> \n<p><img src=\"https://rcoil.me/image/【权限维持】Microsoft Office/Blog_2019-05-27_22-32-49.gif\" alt=\"Blog_2019-05-27_22-32-49.png\" /></p> \n<p>本地使用相对应的 <code>Office</code> 版本生成的全局宏，替换目标机器对应的 <code>Office</code> 版本的全局宏，可行。</p> \n<h2 id=\"0x04-Office-加载项\"><a href=\"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#0x04-Office-加载项\" class=\"headerlink\" title=\"0x04 Office  加载项\"></a>0x04 Office 加载项</h2> \n<p><code>Office</code> 中支持不同类型的加载项，从本质上来讲，<code>Office</code> 套装有很多受信任的位置，当放置库文件时，在打开 <code>Office</code> 程序时，会自动加载库文件。在 <code>Office</code> 的信任中心选择禁用加载项，实际上不会禁用WLL，也不会阻止VBA代码执行。</p> \n<h3 id=\"1）Word-的-WLL-加载项\"><a href=\"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#1）Word-的-WLL-加载项\" class=\"headerlink\" title=\"1）Word 的 WLL 加载项\"></a>1）Word 的 WLL 加载项</h3> \n<p><code>Word</code> 的三个默认加载项位置如下所示：</p> \n<p><img src=\"https://rcoil.me/image/【权限维持】Microsoft Office/Blog_2019-05-27_22-32-49.png\" alt=\"Blog_2019-05-27_22-32-49.png\" /></p> \n<p>对用户位置中的 <code>Startup</code> 进一步调查发现，它是 Word 默认存放<code>全局模板</code>和<code>加载项</code>的文件夹，当启动Word时，程序会自动加载 <code>Startup</code> 文件夹中所有<code>*.dot、*.dotx或*.dotm</code>格式的Word文件，也可以托管拓展名为 <code>* .wll</code> 的文件。而<code>* .wll</code> 文件本质上是一个带有额外<code>特定于Office的扩展的DLL</code>。这意味着<code>* .wll</code> 文件起码可以实现基本的 <code>DLL 功能</code>，我们只需要将<code>*.dll</code> 重命名为 <code>*.wll</code>，放入此文件夹中，可获取当前<code>启动 word 的用户</code>的执行权限。</p> \n<p><em>示例</em>：</p> \n<figure class=\"highlight c\"> \n <table> \n  <tr> \n   <td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br /></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></pre></td> \n   <td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">Run</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>{</span><br><span class=\"line\">system(<span class=\"string\">\"calc\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">BOOL APIENTRY <span class=\"title\">DllMain</span><span class=\"params\">(HMODULE hModule,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">DWORD ul_reason_for_call,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">LPVOID lpReserved</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>{</span><br><span class=\"line\"><span class=\"keyword\">switch</span> (ul_reason_for_call)</span><br><span class=\"line\">{</span><br><span class=\"line\"><span class=\"keyword\">case</span> DLL_PROCESS_ATTACH:</span><br><span class=\"line\">Run();</span><br><span class=\"line\"><span class=\"comment\">// MessageBox(NULL, L\"Hello World，I'm RcoIl\", L\"demo\", MB_OK);</span></span><br><span class=\"line\"><span class=\"comment\">// WinExec(\"calc.exe\", SW_SHOWNORMAL);</span></span><br><span class=\"line\"><span class=\"keyword\">case</span> DLL_THREAD_ATTACH:</span><br><span class=\"line\"><span class=\"keyword\">case</span> DLL_THREAD_DETACH:</span><br><span class=\"line\"><span class=\"keyword\">case</span> DLL_PROCESS_DETACH:</span><br><span class=\"line\"><span class=\"keyword\">break</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">return</span> TRUE;</span><br><span class=\"line\">}</span><br /></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></pre></td> \n  </tr> \n </table> \n</figure> \n<p>在这步骤出现了无法加载 <code>wll</code> 问题，所以我直接提问 <a href=\"https://www.twitter.com/domchell\" target=\"_blank\" rel=\"noopener\">Dominic Chell.</a>，他给我的回答是：</p> \n<figure class=\"highlight arduino\"> \n <table> \n  <tr> \n   <td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br /></br></br></pre></td> \n   <td class=\"code\"><pre><span class=\"line\">我在测试的时候也遇到了这样的问题，我认为它是使用了 UI 来弹出东西的，所以建议使用一个简单的 MessageBox 进行测试。并且确保是从 <span class=\"built_in\">attach</span> 当中调用 Run()。</span><br><span class=\"line\"></span><br><span class=\"line\">在使用 MessageBox 时，确保没有使用任何有关系统的东西（避免缺失 DLL），并尝试所有的<span class=\"built_in\">switch</span> cases</span><br /></br></br></pre></td> \n  </tr> \n </table> \n</figure> \n<p>exp 思路就不说了。</p> \n<p>所以我最后使用了上面代码注释行。成功，结果如下。</p> \n<p><img src=\"https://rcoil.me/image/【权限维持】Microsoft Office/Blog_2019-05-27_22-32-50.gif\" alt=\"Blog_2019-05-27_22-32-50.gif\" /></p> \n<h3 id=\"2）Excel-的-XLL-加载项\"><a href=\"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#2）Excel-的-XLL-加载项\" class=\"headerlink\" title=\"2）Excel 的 XLL 加载项\"></a>2）Excel 的 XLL 加载项</h3> \n<figure class=\"highlight taggerscript\"> \n <table> \n  <tr> \n   <td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br /></br></pre></td> \n   <td class=\"code\"><pre><span class=\"line\">在HKEY_CURRENT_USER<span class=\"symbol\">\\S</span>oftware<span class=\"symbol\">\\M</span>icrosoft<span class=\"symbol\">\\O</span>ffice<span class=\"symbol\">\\1</span>2.0<span class=\"symbol\">\\E</span>xcel<span class=\"symbol\">\\O</span>ptions注册表项中添加一个键值</span><br><span class=\"line\">OPEN /R DemoAddin.xll （字符串值）</span><br /></br></pre></td> \n  </tr> \n </table> \n</figure> \n<p><code>Excel</code> 启动时，会自动检索 <code>C:\\Users(username)\\AppData\\Roaming\\Microsoft\\AddIns</code>目录，所以不需要写入绝对路径，默认自动加载。</p> \n<figure class=\"highlight plain\"> \n <table> \n  <tr> \n   <td class=\"gutter\"><pre><span class=\"line\">1</span><br /></pre></td> \n   <td class=\"code\"><pre><span class=\"line\">// DemoAddin.xll EXPORTS is xlAutoOpen</span><br /></pre></td> \n  </tr> \n </table> \n</figure> \n<h3 id=\"3）PowerPoint-的-VBA-加载项\"><a href=\"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#3）PowerPoint-的-VBA-加载项\" class=\"headerlink\" title=\"3）PowerPoint 的 VBA 加载项\"></a>3）PowerPoint 的 VBA 加载项</h3> \n<figure class=\"highlight taggerscript\"> \n <table> \n  <tr> \n   <td class=\"gutter\"><pre><span class=\"line\">1</span><br /></pre></td> \n   <td class=\"code\"><pre><span class=\"line\">HKEY_CURRENT_USER<span class=\"symbol\">\\S</span>oftware<span class=\"symbol\">\\M</span>icrosoft<span class=\"symbol\">\\O</span>ffice<span class=\"symbol\">\\1</span>2.0<span class=\"symbol\">\\P</span>owerPoint<span class=\"symbol\">\\A</span>ddIns<span class=\"symbol\">\\&lt;</span>AddInName&gt;</span><br /></pre></td> \n  </tr> \n </table> \n</figure> \n<p>文件格式为 <code>*.ppam</code> 或 <code>*.ppa</code>，也是与Excel 一样，放入<code>AddIns</code> 目录中。设置 <code>Autoload</code> 键值为 <strong>1</strong> ，更改PowerPoint 启动时自动加载加载项。</p> \n<p><img src=\"https://rcoil.me/image/【权限维持】Microsoft Office/Blog_2019-05-28_12-32-49.png\" alt=\"Blog_2019-05-28_12-32-49\" /></p> \n<p>关于<code>wll(DLL)</code> 、 <code>xll(dll)</code> 和 <code>ppam(VBA)</code> 的利用，可自行研究。</p> \n<h3 id=\"4）更多\"><a href=\"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#4）更多\" class=\"headerlink\" title=\"4）更多\"></a>4）更多</h3> \n<p>更多内容请阅读文章底部的参考文章。</p> \n<h2 id=\"0x05-参考\"><a href=\"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#0x05-参考\" class=\"headerlink\" title=\"0x05 参考\"></a>0x05 参考</h2> \n<p><a href=\"https://attack.mitre.org/techniques/T1137/\" target=\"_blank\" rel=\"noopener\">Office Application Startup</a><br><a href=\"https://enigma0x3.net/2014/01/23/maintaining-access-with-normal-dotm/comment-page-1/\" target=\"_blank\" rel=\"noopener\">MAINTAINING ACCESS WITH NORMAL.DOTM</a><br><a href=\"http://www.hexacorn.com/blog/2017/04/19/beyond-good-ol-run-key-part-62/\" target=\"_blank\" rel=\"noopener\"><a href=\"http://www.hexacorn.com/blog/2017/04/19/beyond-good-ol-run-key-part-62/\" target=\"_blank\" rel=\"noopener\">Beyond good ol’ Run key, Part 62</a></a><br><a href=\"https://labs.mwrinfosecurity.com/blog/add-in-opportunities-for-office-persistence/\" target=\"_blank\" rel=\"noopener\">Add-In Opportunities for Office Persistence</a><br><a href=\"https://www.mdsec.co.uk/2019/05/persistence-the-continued-or-prolonged-existence-of-something-part-1-microsoft-office/\" target=\"_blank\" rel=\"noopener\">Persistence: “the continued or prolonged existence of something”: Part 1 – Microsoft Office</a><br><a href=\"https://github.com/outflanknl/EvilClippy\" target=\"_blank\" rel=\"noopener\">EvilClippy</a></br></br></br></br></br></p>","descriptionType":"html","publishedDate":"Wed, 29 May 2019 10:52:59 +0000","feedId":25693,"bgimg":"https://rcoil.me/image/【权限维持】Microsoft Office/Blog_2019-05-27_22-32-49.gif","linkMd5":"7414101820bb696f75ec92aa49fdcf12","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx31/cdn75@2020_1/2020/10/18/17-51-55-280_0d8eaa5d12a5a293.webp","destWidth":1541,"destHeight":716,"sourceBytes":1372083,"destBytes":925174,"author":"","articleImgCdnMap":{"https://rcoil.me/image/【权限维持】Microsoft Office/Blog_2019-05-27_22-32-49.gif":"https://cdn.jsdelivr.net/gh/myreaderx31/cdn75@2020_1/2020/10/18/17-51-55-280_0d8eaa5d12a5a293.webp","https://rcoil.me/image/【权限维持】Microsoft Office/Blog_2019-05-27_22-32-49.png":"https://cdn.jsdelivr.net/gh/myreaderx30/cdn88@2020_2/2020/10/18/17-51-57-480_5f67ca32b6aa5fa8.webp","https://rcoil.me/image/【权限维持】Microsoft Office/Blog_2019-05-27_22-32-50.gif":"https://cdn.jsdelivr.net/gh/myreaderx18/cdn84@2020_1/2020/10/18/17-52-01-445_a9b1a86377b6b2b4.webp","https://rcoil.me/image/【权限维持】Microsoft Office/Blog_2019-05-28_12-32-49.png":"https://cdn.jsdelivr.net/gh/myreaderx15/cdn90@2020_1/2020/10/18/17-51-57-490_e0d467ecd664b835.webp"},"publishedOrCreatedDate":1603043490186}],"record":{"createdTime":"2020-10-19 01:51:30","updatedTime":"2020-10-19 01:51:30","feedId":25693,"fetchDate":"Sun, 18 Oct 2020 17:51:30 +0000","fetchMs":121,"handleMs":31,"totalMs":32554,"newArticles":0,"totalArticles":20,"status":1,"type":0,"ip":"6adc9ee180e15d93daf6364a5c318f90","hostName":"us-008*","requestId":"64eed9e9affd45f8b582ca6b0d7f574f_25693","contentType":"application/xml","totalBytes":1370204,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":4,"articlesImgsGithubTotal":4,"successGithubMap":{"myreaderx15":1,"myreaderx30":1,"myreaderx31":1,"myreaderx18":1},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 02:36:31","updatedTime":"2020-09-07 04:34:33","id":25693,"name":"RcoIl的窝","url":"http://rcoil.me/atom.xml","subscriber":128,"website":null,"icon":"https://rcoil.me/images/favicon.png?v=5.1.0","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx62/cdn62@2020_1/2020/09/06/20-34-28-421_ce361f5fcbe3a2e0.png","description":"","weekly":null,"link":null},"noPictureArticleList":[],"tmpCommonImgCdnBytes":925174,"tmpBodyImgCdnBytes":445030,"tmpBgImgCdnBytes":0,"extra4":{"start":1603043490026,"total":0,"statList":[{"spend":130,"msg":"获取xml内容"},{"spend":31,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":5516,"msg":"正文链接上传到cdn"}]},"extra5":4,"extra6":4,"extra7ImgCdnFailResultVector":[],"extra10_invalidATagHrefValue":{"https://rcoil.me/2019/05/【权限维持】Microsoft Office/_#0x02-相关判断":"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#0x02-相关判断","https://rcoil.me/2019/05/【权限维持】Microsoft Office/_#0x01-环境说明":"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#0x01-环境说明","https://rcoil.me/2019/05/【权限维持】Microsoft Office/_#0x00-前言":"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#0x00-前言","https://rcoil.me/2019/05/【权限维持】Microsoft Office/_#0x04-Office-加载项":"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#0x04-Office-加载项","https://rcoil.me/2019/05/【权限维持】Microsoft Office/_#2）Excel-的-XLL-加载项":"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#2）Excel-的-XLL-加载项","https://rcoil.me/2019/05/【权限维持】Microsoft Office/_#4）更多":"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#4）更多","https://rcoil.me/2019/05/【权限维持】Microsoft Office/_#0x05-参考":"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#0x05-参考","https://rcoil.me/2019/05/【权限维持】Microsoft Office/_#3）PowerPoint-的-VBA-加载项":"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#3）PowerPoint-的-VBA-加载项","https://rcoil.me/2019/05/【权限维持】Microsoft Office/_#0x03-Office-模板宏":"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#0x03-Office-模板宏","https://rcoil.me/2019/05/【权限维持】Microsoft Office/_#1）Word-的-WLL-加载项":"https://rcoil.me/2019/05/【权限维持】Microsoft Office/#1）Word-的-WLL-加载项"},"extra111_proxyServerAndStatMap":{"http://europe-56.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-006.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://europe-57.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://rcoil.me/image/【权限维持】Microsoft Office/Blog_2019-05-27_22-32-49.gif","sourceStatusCode":200,"destWidth":1541,"destHeight":716,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx31/cdn75@2020_1/2020/10/18/17-51-55-280_0d8eaa5d12a5a293.webp","sourceBytes":1372083,"destBytes":925174,"targetWebpQuality":75,"feedId":25693,"totalSpendMs":26748,"convertSpendMs":24812,"createdTime":"2020-10-19 01:51:30","host":"us-031*","referer":"https://rcoil.me/2019/05/【权限维持】Microsoft Office/","linkMd5ListStr":"7414101820bb696f75ec92aa49fdcf12,7414101820bb696f75ec92aa49fdcf12","githubUser":"myreaderx31","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"1.3 MB","destSize":"903.5 KB","compressRate":"67.4%"},{"code":1,"isDone":false,"source":"https://rcoil.me/image/【权限维持】Microsoft Office/Blog_2019-05-27_22-32-49.png","sourceStatusCode":200,"destWidth":828,"destHeight":335,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx30/cdn88@2020_2/2020/10/18/17-51-57-480_5f67ca32b6aa5fa8.webp","sourceBytes":30223,"destBytes":28378,"targetWebpQuality":75,"feedId":25693,"totalSpendMs":1311,"convertSpendMs":19,"createdTime":"2020-10-19 01:51:57","host":"europe-56*","referer":"https://rcoil.me/2019/05/【权限维持】Microsoft Office/","linkMd5ListStr":"7414101820bb696f75ec92aa49fdcf12","githubUser":"myreaderx30","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"29.5 KB","destSize":"27.7 KB","compressRate":"93.9%"},{"code":1,"isDone":false,"source":"https://rcoil.me/image/【权限维持】Microsoft Office/Blog_2019-05-28_12-32-49.png","sourceStatusCode":200,"destWidth":600,"destHeight":92,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx15/cdn90@2020_1/2020/10/18/17-51-57-490_e0d467ecd664b835.webp","sourceBytes":45417,"destBytes":9932,"targetWebpQuality":75,"feedId":25693,"totalSpendMs":1340,"convertSpendMs":6,"createdTime":"2020-10-19 01:51:57","host":"europe-57*","referer":"https://rcoil.me/2019/05/【权限维持】Microsoft Office/","linkMd5ListStr":"7414101820bb696f75ec92aa49fdcf12","githubUser":"myreaderx15","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"44.4 KB","destSize":"9.7 KB","compressRate":"21.9%"},{"code":1,"isDone":false,"source":"https://rcoil.me/image/【权限维持】Microsoft Office/Blog_2019-05-27_22-32-50.gif","sourceStatusCode":200,"destWidth":1120,"destHeight":706,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx18/cdn84@2020_1/2020/10/18/17-52-01-445_a9b1a86377b6b2b4.webp","sourceBytes":673276,"destBytes":406720,"targetWebpQuality":75,"feedId":25693,"totalSpendMs":5497,"convertSpendMs":4240,"createdTime":"2020-10-19 01:51:57","host":"us-006*","referer":"https://rcoil.me/2019/05/【权限维持】Microsoft Office/","linkMd5ListStr":"7414101820bb696f75ec92aa49fdcf12","githubUser":"myreaderx18","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"657.5 KB","destSize":"397.2 KB","compressRate":"60.4%"}],"successGithubMap":{"myreaderx15":1,"myreaderx30":1,"myreaderx31":1,"myreaderx18":1},"failGithubMap":{}}