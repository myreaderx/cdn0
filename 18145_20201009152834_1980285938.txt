{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-10-09 23:28:03","updatedTime":"2020-10-09 23:28:03","title":"Updates to Ghostwriter: UI and Operation Logs","link":"https://medium.com/p/d6b3bc3d3fbd","description":"<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/280/1*ThMF7k9yCBgYshA132MTaA.png\" /></figure><h3>Read First:</h3><p>If you’re new to Ghostwriter, start with this blog post to understand the project’s goals: <a href=\"https://posts.specterops.io/introducing-ghostwriter-part-1-61e7bd014aff\">https://posts.specterops.io/introducing-ghostwriter-part-1-61e7bd014aff</a></p><p>For those of you lacking the desire or the attention span to read another blog post, here’s the gist:</p><ul><li>Ghostwriter is a web-based red team report generation tool</li><li>Ghostwriter can keep track of clients, projects, findings, and infrastructure.</li><li>Ghostwriter automates routine assessment reporting tasks allowing operators to focus their time on analysis and custom content creation rather than formatting.</li></ul><h3>Intro</h3><p>For the past couple months, a few of us at SpecterOps have focused on updating Ghostwriter to improve usability, enhance reporting, and enable the project to serve a more central role in the red team engagement process. We’d like to highlight some of these changes and initiatives as we are eager to get them into your hands. We’re pretty excited about this and hope you will be too!</p><h3>Updated User Interface and Experience</h3><p>First, we are working towards a cleaner code base and a better user experience. Many of these changes are live right now on GitHub, but we have an official release planned for later this year that will contain many more enhancements and performance improvements. Ghostwriter now uses more AJAX requests to submit requests in the background and reduce page loads and refreshes. This alone is a big improvement to the overall user experience.</p><p>As you will see below, we have also added support for WebSockets, and we’re using them for some neat things! You can expect to see new real-time toast notifications and page updates. The most exciting use of WebSockets is certainly the new operation logging application.</p><h3>Operation Logging</h3><p>Any professional red teamer quickly understands the importance of tracking and keeping detailed logs of their actions during an engagement. If you ever have to deconflict red team activity with a client, accurately document a finding, or reconstruct an attack timeline, you’ll have detailed information about what command was executed at what time by whom. We refer to this as operation logging or “oplog” for short. At SpecterOps, we’ve historically aggregated any operator activity (action performed via a C2 tool, web browser, or operator terminal, etc) into a web-based internally hosted spreadsheet. Any actions against a client’s network are recorded here in a running list of timestamped activities. As a result, the engagement lead, team members, or other stakeholders can see a complete timeline and picture of the engagement.</p><p>Unfortunately, this completely manual approach of a shared oplog sheet is tedious to maintain and error prone. Furthermore, the vast majority of our red team activities are post-exploitation related and occur through C2 tooling (Mythic, Cobalt Strike, etc) that already have built-in logging. Since operators must enter these commands by hand into a log, it routinely shifts focus away from operating. In the best case, it reduces their efficiency, and in the worst case, results in inconsistent logging throughout the engagement. Additionally, during the reporting phase, any command, evidence, or timestamp that we want to include would still need to be manually copied over from the spreadsheet to Ghostwriter or the final report.</p><p>Operation Logging (Oplog) for Ghostwriter has a few goals:</p><ul><li>Reduce the manual logging overhead and automatically log each operator command, regardless of tool used via a standard API</li><li>Enable operators to go back and add context\\detail\\follow-up actions their entries within the oplog</li><li>Must allow addition of manual entries when they make sense (e.g., web browser interactions, non-instrumented tools, social engineering attempts, deconfliction requests, etc)</li><li>Enable reporting automation and analytics with oplog data</li><li>Easy import data from “offline” tools and export oplog data</li></ul><p>Operators now have a central log of all commands performed on an engagement in an easily importable/exportable format that can also be automatically included in report generation (not yet implemented). Operators can manually create an entry, or they can be automatically created using the exposed REST API. This allows C2 frameworks like CobaltStrike and Mythic to seamlessly integrate and allow the operator to keep their mind on the engagement and not on bookkeeping. We envision the Ghostwriter oplog page will be a staple in your red team engagement workflow and have a permanent spot on your coveted screen real estate.</p><h3>Oplog Features</h3><p>Complete documentation for Ghostwriter’s oplog feature can be found at<a href=\"https://ghostwriter.wiki/documentation/operation-logs\"> https://ghostwriter.wiki/documentation/operation-logs,</a> we’ll cover some of the basic features here. Out of personal pride and a matter of principle, we refuse to read the documentation of a new project unless we have already struggled with it for at least 45 minutes, and we don’t expect any less from you.</p><h4>Backend Operation Overview</h4><p>The oplog page uses websockets and async.io on the back end, so changes are immediately pushed to all those who are viewing the oplog. This allows for easy collaboration and immediate feedback. When an operator enters a command in a CobaltStrike beacon, the command, time, operator, user context, and hostname are all immediately logged and displayed on the oplog page. In the case of Mythic, whenever the command produces output, that output is also logged. Similar to a spreadsheet editor, the user can double click into any cell and modify the contents. Every modification is immediately sent over a persistent websocket connection and reflected for everyone using the page. This provides operators with immediate feedback when a command has finished or another operator added a comment.</p><h4>REST API</h4><p>Ghostwriter operational logging has a rudimentary REST API that allows external entities to create, update, and delete oplog entries. This allows us to integrate any C2 framework with relative ease. As we continue development, we plan on adding other commonly used tools such as proxychains, web browsers, and popular shells.</p><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/0*--JOwjTHHHV9m4Ee\" /></figure><h4>Real Time Operation Log Updates</h4><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/1*dUjiO_IDYorMkXWZJ1ZerQ.gif\" /></figure><p><em>An entry being auto-populated from the mythic sync utility</em></p><h4>Easy to import/export operation logs</h4><p>If you have a set of commands from another tool, they can be imported into Ghostwriter with (probably) minimal modifications. Ghostwriter can import/export CSV files for operation logging. There are times when our CobaltStrike teamservers are on a client VPN and we can’t access our internal infrastructure, including Ghostwriter. In this scenario, we have an aggressor script that will log each command to a properly formatted CSV file that can then be imported into Ghostwriter at the end of the engagement.</p><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/0*8i_HQgOmAZ8p8Dx5\" /></figure><p><em>Simply upload a CSV to import commands that were logged to a CSV file.</em></p><h4>Easy to copy entries</h4><p>If you ever had to manually enter commands to a log, you’ll know how much you will end up repeating yourself. To aid in that, Ghostwriter has a copy button at the very right of the row. If you do need to manually create a bunch of entries, say a web based form submit, then you wont need to hand copy/paste everything, saving you time.</p><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/0*bd3wOgzJAkgyLjsb\" /></figure><h4>See only the columns you want</h4><p>We know that not all the columns in the oplog table are helpful all the time. In order to save some screen space and present you with the most pertinent information, you can select the columns which you want to display and hide all the rest. Nobody wants to read the comments anyways.</p><figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/1024/0*wsbE0sOYr-HaoiHy\" /></figure><h4>The Future for Operation Logs in Ghostwriter</h4><ul><li>Many red teams, ours included, have sensitive data age-off policies. Data should be tagged with appropriate sensitivity levels and automatically aged-off (deleted) when appropriate.</li><li>Oplog extensions for more red team tools like bash (operator command line history), ssh, proxychains, etc.</li><li>Objective IDs — Users will be allowed to associate a command with a particular objective. This will make report generation easy as one can easily export all the commands executed in support of a particular objective.</li><li>Finding IDs — Users will be able to associate oplog entries with a specific report finding</li><li>MITRE ATT&#38;CK ID — Users will be able to associate TTPs with each oplog entry (this will be automatic for some tools that already track this data)</li><li>Evidence — Attach evidence directly to an oplog entry (e.g., screenshot)</li><li>Daily activity summary</li><li>Engagement timeline</li><li>Automatically map evidence from oplog entries to their associated findings</li><li>TTP Roll-up</li></ul><p>What do you think of the latest updates? What suggestions do you have for these new features? Reach out on the project’s GitHub page or on Twitter:</p><ul><li><a href=\"https://twitter.com/cmaddalena\">https://twitter.com/cmaddalena</a></li><li><a href=\"https://twitter.com/hotnops\">https://twitter.com/hotnops</a></li></ul><img src=\"https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=d6b3bc3d3fbd\" width=\"1\" height=\"1\" alt=\"\"><hr><p><a href=\"https://posts.specterops.io/updates-to-ghostwriter-ui-and-operation-logs-d6b3bc3d3fbd\">Updates to Ghostwriter: UI and Operation Logs</a> was originally published in <a href=\"https://posts.specterops.io\">Posts By SpecterOps Team Members</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>","descriptionType":"html","publishedDate":"Wed, 30 Sep 2020 17:03:36 +0000","feedId":18145,"bgimg":"https://cdn-images-1.medium.com/max/280/1*ThMF7k9yCBgYshA132MTaA.png","linkMd5":"63d1018626d2c55e5de139a36bc8e555","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx7/cdn10@2020_5/2020/10/09/15-28-03-780_76f6c3e7ba2f0905.webp","destWidth":280,"destHeight":280,"sourceBytes":27551,"destBytes":11962,"author":"hotnops","articleImgCdnMap":{"https://cdn-images-1.medium.com/max/280/1*ThMF7k9yCBgYshA132MTaA.png":"https://cdn.jsdelivr.net/gh/myreaderx7/cdn10@2020_5/2020/10/09/15-28-03-780_76f6c3e7ba2f0905.webp","https://cdn-images-1.medium.com/max/1024/0*--JOwjTHHHV9m4Ee":"https://cdn.jsdelivr.net/gh/myreaderx13/cdn29@2020_5/2020/10/09/15-28-07-224_817850128b323bf5.webp","https://cdn-images-1.medium.com/max/1024/1*dUjiO_IDYorMkXWZJ1ZerQ.gif":"https://cdn.jsdelivr.net/gh/myreaderx11/cdn34@2020_3/2020/10/09/15-28-10-588_6fd2e6a85b8ad68c.webp","https://cdn-images-1.medium.com/max/1024/0*8i_HQgOmAZ8p8Dx5":"https://cdn.jsdelivr.net/gh/myreaderx21/cdn26@2020_3/2020/10/09/15-28-05-879_4804ede695136614.webp","https://cdn-images-1.medium.com/max/1024/0*bd3wOgzJAkgyLjsb":"https://cdn.jsdelivr.net/gh/myreaderx12/cdn19@2020_4/2020/10/09/15-28-14-651_9792304942ec6832.webp","https://cdn-images-1.medium.com/max/1024/0*wsbE0sOYr-HaoiHy":"https://cdn.jsdelivr.net/gh/myreaderx22/cdn17@2020_2/2020/10/09/15-28-32-771_14968f6c1503424e.webp","https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=d6b3bc3d3fbd":"https://cdn.jsdelivr.net/gh/myreaderx18/cdn13@2020_3/2020/10/09/15-28-06-878_bf22808e245378c0.webp"},"publishedOrCreatedDate":1602257283513}],"record":{"createdTime":"2020-10-09 23:28:03","updatedTime":"2020-10-09 23:28:03","feedId":18145,"fetchDate":"Fri, 09 Oct 2020 15:28:03 +0000","fetchMs":173,"handleMs":19,"totalMs":31335,"newArticles":0,"totalArticles":10,"status":1,"type":0,"ip":"e4dc2764c56fbfb38f74c5dde2f33d08","hostName":"us-024*","requestId":"c5418aca8b8b4584907d6b3c52de2aa3_18145","contentType":"text/xml; charset=UTF-8","totalBytes":6748690,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":7,"articlesImgsGithubTotal":7,"successGithubMap":{"myreaderx7":1,"myreaderx21":1,"myreaderx11":1,"myreaderx22":1,"myreaderx12":1,"myreaderx13":1,"myreaderx18":1},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 02:16:48","updatedTime":"2020-09-07 02:49:39","id":18145,"name":"Posts By SpecterOps Team Members - Medium","url":"https://posts.specterops.io/feed","subscriber":183,"website":null,"icon":"https://cdn-images-1.medium.com/proxy/1*TGH72Nnw24QL3iV9IOm4VA.png","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx61/cdn92@2020_6/2020/09/06/18-49-35-883_7b1d3de1dd751a79.png","description":"Posts from SpecterOps team members on various topics relating information security - Medium","weekly":null,"link":null},"noPictureArticleList":[],"tmpCommonImgCdnBytes":11962,"tmpBodyImgCdnBytes":6736728,"tmpBgImgCdnBytes":0,"extra4":{"start":1602257283314,"total":0,"statList":[{"spend":180,"msg":"获取xml内容"},{"spend":19,"msg":"解释文章"},{"spend":1,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":28940,"msg":"正文链接上传到cdn"}]},"extra5":7,"extra6":7,"extra7ImgCdnFailResultVector":[],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://europe-56.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-020.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-021.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://europe-22.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-009.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://europe-60.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://cdn-images-1.medium.com/max/280/1*ThMF7k9yCBgYshA132MTaA.png","sourceStatusCode":200,"destWidth":280,"destHeight":280,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx7/cdn10@2020_5/2020/10/09/15-28-03-780_76f6c3e7ba2f0905.webp","sourceBytes":27551,"destBytes":11962,"targetWebpQuality":75,"feedId":18145,"totalSpendMs":2022,"convertSpendMs":11,"createdTime":"2020-10-09 23:28:03","host":"europe68*","referer":"https://medium.com/p/d6b3bc3d3fbd","linkMd5ListStr":"63d1018626d2c55e5de139a36bc8e555,63d1018626d2c55e5de139a36bc8e555","githubUser":"myreaderx7","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"26.9 KB","destSize":"11.7 KB","compressRate":"43.4%"},{"code":1,"isDone":false,"source":"https://cdn-images-1.medium.com/max/1024/0*8i_HQgOmAZ8p8Dx5","sourceStatusCode":200,"destWidth":1024,"destHeight":598,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx21/cdn26@2020_3/2020/10/09/15-28-05-879_4804ede695136614.webp","sourceBytes":102726,"destBytes":27656,"targetWebpQuality":75,"feedId":18145,"totalSpendMs":1409,"convertSpendMs":33,"createdTime":"2020-10-09 23:28:05","host":"us-009*","referer":"https://medium.com/p/d6b3bc3d3fbd","linkMd5ListStr":"63d1018626d2c55e5de139a36bc8e555","githubUser":"myreaderx21","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"100.3 KB","destSize":"27 KB","compressRate":"26.9%"},{"code":1,"isDone":false,"source":"https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=d6b3bc3d3fbd","sourceStatusCode":200,"destWidth":1,"destHeight":1,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx18/cdn13@2020_3/2020/10/09/15-28-06-878_bf22808e245378c0.webp","sourceBytes":43,"destBytes":72,"targetWebpQuality":75,"feedId":18145,"totalSpendMs":1911,"convertSpendMs":13,"createdTime":"2020-10-09 23:28:05","host":"europe-56*","referer":"https://medium.com/p/d6b3bc3d3fbd","linkMd5ListStr":"63d1018626d2c55e5de139a36bc8e555","githubUser":"myreaderx18","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"43 B","destSize":"72 B","compressRate":"167.4%"},{"code":1,"isDone":false,"source":"https://cdn-images-1.medium.com/max/1024/0*--JOwjTHHHV9m4Ee","sourceStatusCode":200,"destWidth":1024,"destHeight":337,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx13/cdn29@2020_5/2020/10/09/15-28-07-224_817850128b323bf5.webp","sourceBytes":46497,"destBytes":14476,"targetWebpQuality":75,"feedId":18145,"totalSpendMs":2484,"convertSpendMs":14,"createdTime":"2020-10-09 23:28:05","host":"europe-22*","referer":"https://medium.com/p/d6b3bc3d3fbd","linkMd5ListStr":"63d1018626d2c55e5de139a36bc8e555","githubUser":"myreaderx13","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"45.4 KB","destSize":"14.1 KB","compressRate":"31.1%"},{"code":1,"isDone":false,"source":"https://cdn-images-1.medium.com/max/1024/1*dUjiO_IDYorMkXWZJ1ZerQ.gif","sourceStatusCode":200,"destWidth":1600,"destHeight":217,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx11/cdn34@2020_3/2020/10/09/15-28-10-588_6fd2e6a85b8ad68c.webp","sourceBytes":694715,"destBytes":1204412,"targetWebpQuality":75,"feedId":18145,"totalSpendMs":6817,"convertSpendMs":4598,"createdTime":"2020-10-09 23:28:05","host":"europe-60*","referer":"https://medium.com/p/d6b3bc3d3fbd","linkMd5ListStr":"63d1018626d2c55e5de139a36bc8e555","githubUser":"myreaderx11","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"678.4 KB","destSize":"1.1 MB","compressRate":"173.4%"},{"code":1,"isDone":false,"source":"https://cdn-images-1.medium.com/max/1024/0*bd3wOgzJAkgyLjsb","sourceStatusCode":200,"destWidth":1412,"destHeight":578,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx12/cdn19@2020_4/2020/10/09/15-28-14-651_9792304942ec6832.webp","sourceBytes":1323827,"destBytes":1978884,"targetWebpQuality":75,"feedId":18145,"totalSpendMs":10576,"convertSpendMs":8650,"createdTime":"2020-10-09 23:28:05","host":"us-021*","referer":"https://medium.com/p/d6b3bc3d3fbd","linkMd5ListStr":"63d1018626d2c55e5de139a36bc8e555","githubUser":"myreaderx12","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"1.3 MB","destSize":"1.9 MB","compressRate":"149.5%"},{"code":1,"isDone":false,"source":"https://cdn-images-1.medium.com/max/1024/0*wsbE0sOYr-HaoiHy","sourceStatusCode":200,"destWidth":1600,"destHeight":786,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx22/cdn17@2020_2/2020/10/09/15-28-32-771_14968f6c1503424e.webp","sourceBytes":3001986,"destBytes":3511228,"targetWebpQuality":75,"feedId":18145,"totalSpendMs":28908,"convertSpendMs":26680,"createdTime":"2020-10-09 23:28:05","host":"us-020*","referer":"https://medium.com/p/d6b3bc3d3fbd","linkMd5ListStr":"63d1018626d2c55e5de139a36bc8e555","githubUser":"myreaderx22","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"2.9 MB","destSize":"3.3 MB","compressRate":"117%"}],"successGithubMap":{"myreaderx7":1,"myreaderx21":1,"myreaderx11":1,"myreaderx22":1,"myreaderx12":1,"myreaderx13":1,"myreaderx18":1},"failGithubMap":{}}