{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-12-03 10:54:36","updatedTime":"2020-12-03 10:54:36","title":"如何在12个小时，搞定http监控？","link":"http://weixin.sogou.com/weixin?type=2&query=%E6%9E%B6%E6%9E%84%E5%B8%88%E4%B9%8B%E8%B7%AF+%E5%A6%82%E4%BD%95%E5%9C%A812%E4%B8%AA%E5%B0%8F%E6%97%B6%EF%BC%8C%E6%90%9E%E5%AE%9Ahttp%E7%9B%91%E6%8E%A7%EF%BC%9F","description":"<div><div><div id=\"media\" class=\"rich_media_thumb_wrp\">\n\n            <img class=\"rich_media_thumb\" src=\"http://content.sov5.cn/mmbiz_jpg/YrezxckhYOxdNkNxWryMia0A8T0tLGpEahEoBMU4hhRIDWRlbZID20vp3mU12o3F0k9mtjfibibjN2UYibUTEWIBLQ?imageView2/1/w/600\">\n        </div>\n    \n\n    \n\n    <div class=\"rich_media_content\" id=\"js_content\">\n                    \n\n                    \n\n                    \n                    \n                    <section style=\"line-height: 1.75em;\" data-mpa-powered-by=\"yiban.io\"><span style=\"letter-spacing: 1px;font-size: 15px;\">系统监控，是做系统必须解决的一个问题。创业型公司，微服务以前，如何用半天的时间，搞定一个<strong>可扩展，通用</strong>的<span style=\"color: rgb(255, 76, 0);\">http监控框架</span>，是今天要聊的话题。</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><strong style=\"font-size: 15px;letter-spacing: 1px;\">有哪些常见http监控需求？</strong><br></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">常见的http监控需求有两类：</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（1）html页面监控；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（2）返回json数据的http接口；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><strong>常见的http监控怎么玩？</strong></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">可以通过access日志，观测参数来实施告警：</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（1）http非200状态码；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（2）http请求响应时间；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><strong>常见的http非200状态码，以及响应时间监控有什么弊端？</strong></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">大部分公司，都有自己的404页面。</span></section><section style=\"line-height: 1.75em;\"><span style=\"color: rgb(0, 128, 255);\"><em><span style=\"color: rgb(0, 128, 255);letter-spacing: 1px;font-size: 15px;\">画外音：当然，不排除有些公司把tomcat异常信息透传到页面的。</span></em></span></section><section style=\"line-height: 1.75em;\"><img style=\"width: 312px; height: 159px; max-width: 600px\" data-ratio=\"0.5095238095238095\" data-type=\"jpeg\" data-w=\"840\" data-s=\"300,640\" data-copyright=\"0\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxdNkNxWryMia0A8T0tLGpEaxUojX688NuRL5ibjqXzmlYlG89iaMosK0qrRhztS7uUzv6quGa0COawQ/640?wx_fmt=jpeg\"></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">这个页面的http状态码是200，且返回速度极快，根本不能代表html页面的真实运行情况，很难起到真正的监控作用。</span></section><section style=\"line-height: 1.75em;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 15px;\"><em>画外音：不是说http状态码监控没用，相反，http状态码的监控是很有必要的，http状态码404说明系统一定有问题，但http状态码200不能说明系统没有问题。</em></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><strong>http状态码不能说明问题，那什么才能代表http没有问题呢？</strong></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">每个http都有自己的业务特性，<strong>必须符合业务特性的页面，才是正常的</strong>。</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><strong><span style=\"letter-spacing: 1px;font-size: 15px;\">特性一：需要返回特定的页面内容。</span></strong></section><section style=\"line-height: 1.75em;\"><img style=\"width: 305px; height: 188px; max-width: 600px\" data-ratio=\"0.6163682864450127\" data-type=\"png\" data-w=\"391\" data-s=\"300,640\" data-copyright=\"0\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxdNkNxWryMia0A8T0tLGpEaSNVjJE1QcZMicPT3GTWlftXib9ibaBvz2VAmsn42NVHmibicpBzuZl3ibPEQ/640?wx_fmt=png\"></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">例如，访问</span><span style=\"text-decoration: underline;letter-spacing: 1px;font-size: 12px;\">http://daojia.com/</span><span style=\"letter-spacing: 1px;font-size: 15px;\">，一定要返回一个<span style=\"color: rgb(255, 76, 0);\">含“家政”字眼</span>的html页面，才是正确的。</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><strong><span style=\"letter-spacing: 1px;font-size: 15px;\">特性二：需要返回特定的接口内容。</span></strong><span style=\"letter-spacing: 1px;font-size: 15px;\"></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">例如，RESTful的获取用户信息接口，假设传入uid=123，会传回：</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 12px;\">{“RET”:”SUCCESS”, “name”:”shenjian”, “uid”:”123”}</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">即，</span><span style=\"text-decoration: underline;letter-spacing: 1px;font-size: 12px;\">http://daojia.com/userinfo/get/?uid=123</span><span style=\"letter-spacing: 1px;font-size: 15px;\">，一定要返回一个<span style=\"color: rgb(255, 76, 0);\">含“shenjian”的字符串</span>，才是正确的。</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">于是乎，得到了可扩展通用<strong>http监控框架的思路</strong>：不仅仅要监控http状态码，更重要的是，要<span style=\"color: rgb(255, 76, 0);\">监控http返回内容的业务特性</span>。</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><strong>可扩展通用http监控框架的细节如何？</strong></span></section><section style=\"line-height: 1.75em;\"><img style=\"max-width: 600px\" data-ratio=\"0.4727272727272727\" data-type=\"jpeg\" data-w=\"495\" data-s=\"300,640\" data-copyright=\"0\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxdNkNxWryMia0A8T0tLGpEanjhkmpmcAkiab35kVfg916HlJosr4fGbR8meqcC6DrTSmHAlIRhFfHw/640?wx_fmt=jpeg\"></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">整个http监控平台的架构如上，分为<span style=\"color: rgb(255, 76, 0);\">监控平台模块，信息管理模块，基础服务模块</span>。</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><strong>一、监控平台模块</strong></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（1）http监控中心：实施监控的主程序；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（2）http监控配置：可扩展的监控项信息管理；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">监控项核心信息包含：</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（1）被监控的html页面/RESTful接口属于哪个集群；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（2）被监控的URL；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（3）被监控的URL需要传入的数据，包含</span><span style=\"letter-spacing: 1px;font-size: 12px;\">GET/POST/COOKIE</span><span style=\"letter-spacing: 1px;font-size: 15px;\">等数据；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（4）被监控的http返回的数据中必须包含什么业务特性字符串；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">例如，到家官网html为例，监控项核心信息为：</span></section><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>[http.monitor.item]</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>cluster.name : daojia_main</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>url : </em><em>http://daojia.com/</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>result : 家政</em></span></p><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">即，访问</span><span style=\"text-decoration: underline;letter-spacing: 1px;font-size: 12px;\">http://daojia.com/</span><span style=\"letter-spacing: 1px;font-size: 15px;\">，返回结果必须包含“家政”。</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"> </span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">以获取用户信息RESTful接口为例，监控项核心信息为：</span></section><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>[http.monitor.item]</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>cluster.name : daojia_user</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>url : </em><em>http://daojia.com/userinfo/get/</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>get.data : uid=123</em></span></p><p style=\"white-space: normal;line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>post.data : NULL</em></span></p><p style=\"white-space: normal;line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>cookie.data : NULL</em></span></p><p style=\"line-height: normal;\"><span style=\"letter-spacing: 1px;font-size: 12px;\"><em style=\"color: rgb(0, 82, 255);\">result : shenjian</em></span></p><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">即，访问</span><span style=\"text-decoration: underline;letter-spacing: 1px;font-size: 12px;\">http://daojia.com/userinfo/get/?uid=123</span><span style=\"letter-spacing: 1px;font-size: 15px;\">，返回结果必须包含“shenjian”。</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">框架初期，可以以配置的形式管理监控项，但如果要做成<strong>平台</strong>，需要有一个<strong>监控项管理后台</strong>，来新增/修改/管理监控项。</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">监控中心，会遍历所有监控项，并发对各个http监控项实施监控。</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><strong>二、信息管理模块</strong></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">信息管理模块又分为：集群信息管理模块，员工信息管理模块，告警策略管理模块。</span></section><section style=\"line-height: 1.75em;\"><br></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">集群信息管理模块，主要提供这个接口：</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 12px;\">Info Service::getClusterInfo(String clusterName)</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">即，<strong>通过集群名，获取集群信息</strong>。</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">集群信息有很多，和监控相关的主要有这么几个信息：</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（1）集群ip列表，每个web-server都应该被监控到；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（2）集群负责人，如果监控异常，要将告警发给谁；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">用户信息管理模块，主要提供这个接口：</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 12px;\">Info Service::getYuanGongInfo(String name)</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">即，<strong>通过员工名，获取员工信息</strong>。</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">员工信息有很多，和监控相关的主要有这么几个信息：</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（1）员工手机号，邮箱，微信号，钉钉号等通讯信息；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（2）如果要实现多级告警策略，还需要获取员工部门及leader的相关信息；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">告警策略管理模块，主要提供这个接口：</span></section><p style=\"line-height: normal;\"><span style=\"letter-spacing: 1px;font-size: 12px;\">Bool Service::trySendAlarm(</span></p><p style=\"line-height: normal;\"><span style=\"letter-spacing: 1px;font-size: 12px;\">         String clusterName,</span></p><p style=\"line-height: normal;\"><span style=\"letter-spacing: 1px;font-size: 12px;\">         String yuangongName,</span></p><p style=\"line-height: normal;\"><span style=\"letter-spacing: 1px;font-size: 12px;\">         String ip,</span></p><p style=\"line-height: normal;\"><span style=\"letter-spacing: 1px;font-size: 12px;\">         String url,</span></p><p style=\"line-height: normal;\"><span style=\"letter-spacing: 1px;font-size: 12px;\">         …</span></p><p style=\"line-height: normal;\"><span style=\"letter-spacing: 1px;font-size: 12px;\">)</span></p><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">即，<strong>一旦发现接口有异常，尝试发送告警</strong>。</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">这个尝试发送告警，并不意味着一定会发送短信或者邮件，因为需要实现一系列人性化的告警策略：</span></section><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li style=\"letter-spacing: 1px;font-size: 15px;\"><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">集群收敛策略，可以通过clusterName去重</span></section></li><li style=\"letter-spacing: 1px;font-size: 15px;\"><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">接口收敛策略，可以通过url去重</span></section></li><li style=\"letter-spacing: 1px;font-size: 15px;\"><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">定时定频策略，可以通过yuangongName去重</span></section></li><li style=\"letter-spacing: 1px;font-size: 15px;\"><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">白天黑夜策略，可以通过告警发送时间实施</span></section></li><li style=\"letter-spacing: 1px;font-size: 15px;\"><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">…</span></section></li></ul><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><strong>三、基础服务模块</strong></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">进行完告警策略过滤后，如果真实需要发送告警，调用基础服务模块发出。</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">发送邮件，发送短信这些基础服务模块，相信每个公司都有，这里就不展开叙述了。</span></section><section style=\"line-height: 1.75em;\"><br></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><strong>进一步的，可扩展通用http监控框架细节如何？</strong></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">早期，如果系统没有平台化和服务化，可以通过配置文件，搞定上面的各个可扩展模块：</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（1）http监控项信息：通过配置文件搞；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（2）集群信息：通过配置文件搞；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（3）员工信息：通过配置文件搞；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（4）告警策略信息：不搞告警策略了，异常就发短信；</span></section><section style=\"line-height: 1.75em;\"><img style=\"max-width: 600px\" data-ratio=\"0.43891402714932126\" data-type=\"png\" data-w=\"442\" data-s=\"300,640\" data-copyright=\"0\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxdNkNxWryMia0A8T0tLGpEarq1Xibqw9CNMiaApLYqAHSBicwEbibAR06Qg7mJWad2fXa9iaciaFic4siaofw/640?wx_fmt=png\"></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">于是乎，http监控框架变成了这个样子，模块都用配置文件代替了：</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">http监控项配置，monitor-item.config</span></section><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>[http.monitor.item]</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>cluster.name : daojia_main</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>url : </em><em>http://daojia.com/</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>result : 家政</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em><br></em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>[http.monitor.item]</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>cluster.name : daojia_user</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>url : </em><em>http://daojia.com/userinfo/get/</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>get.data : uid=123</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>post.data : NULL</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>cookie.data : NULL</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>result : shenjian</em></span></p><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">集群信息配置，cluster-info.config：</span></section><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>[daojia_main]</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>ip.list : ip1, ip2, ip3</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>port : 80</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>owner.list: shenjian, zhangsan, lisi</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em><br></em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>[daojia_user]</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>ip.list : ip11, ip22, ip33</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>port : 8080</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>owner.list: shenjian</em></span></p><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">员工信息配置，owner-info.config</span></section><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>[shenjian]</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>email : </em><em>XX@XX.com</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>phone :15912345678</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em><br></em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>[zhangsan]</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>email : </em><em>YY@YY.com</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>phone :18611220099</em></span></p><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><strong>五、http监控框架伪代码</strong></span></section><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>// 解析配置文件，取出监控项、集群、员工等信息</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>Array[monitor-item] A1=Parse(monitor-item.config);</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>Array[cluster-info] A2= Parse(cluster-info.config);</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>Array[owner-info] A3=Parse(owner-info.config);</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em><br></em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>// 遍历所有监控项</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>for(each item in A1){</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em> // 取出监控项的集群名，URL，http数据，结果等信息</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em> clusterName= item.clusterName;</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em> url= item.url;</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em> getData= item.getData;</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em> postData= item.postData;</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em> cookieData= item.cookieData;</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em> result= item.result</em></span></p><p style=\"line-height: normal;\"><br></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);font-style: italic;letter-spacing: 1px;font-size: 12px;\"> // 由集群名，获取集群信息<br></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em> clusterInfo= A2[clusterName];</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em> // 由集群信息，获取集群ip列表，集群负责人列表</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em> List<string>ips = clusterInfo.ip;</string></em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em> List<string>owners = clusterinfo.owner;</string></em></span></p><p style=\"line-height: normal;\"><br></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em> // 集群内的每一个ip实例web-server，都需要监控</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em> for(each ip in ips){</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>  // 根据ip，url，http数据构造请求</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>  httpClient client = new httpClient(ip, url, getData, postData, cookieData);</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>  // 获取http请求执行结果</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>  httpResponse resp = client.execute();</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>  // 如果返回为200，并且包含监控项里的业务特性结果</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>  if(resp.code==200&amp;&amp; resp.contain(result)){</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>    //正常，继续监控</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>    continue;</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>  }</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em><br></em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>  // 否则，对所有集群负责人发送告警</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>  for(each owner in owners){</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>   // 取出负责人邮箱和手机号</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>   email =A3[owner].email;</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>   phone =A3[owner].phone;</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>   // 发送邮件与短信告警</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>   sendEmail(email, ip,url, owner);</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>   snedSM(phone, ip, url,owner);</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>  }</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em> }</em></span></p><p style=\"line-height: normal;\"><span style=\"color: rgb(0, 82, 255);letter-spacing: 1px;font-size: 12px;\"><em>}</em></span></p><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">如此一来，一个小型的，可扩展的，满足创业型公司需求的http监控框架，就搞定了。</span></section><section style=\"line-height: 1.75em;\"><em><span style=\"color: rgb(0, 128, 255);letter-spacing: 1px;font-size: 15px;\">画外音：先不用纠结是用服务，还是cron，还是多线程这些细节，也不用纠结一行能不能parse完整个配置文件，用过xml的都懂，上面的配置文件只是demo示例而已。</span></em></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">这个框架的扩展性非常好，能很好的通过配置文件扩展。</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">monitor-item.config，监控项扩展性：</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（1）新增html页面监控，或者json的RESTful接口监控，只需要在配置中增加一个item；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（2）配置支持url，get，post，cookie等参数拼装任意http监控请求；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（3）配置支持不同业务逻辑返回不同的result的业务特性检查；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">cluster-info.config，集群信息扩展性：</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（1）新增集群，只需在配置中增加一个item；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（2）集群加了一个实例，只需增加一个ip；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（3）集群加了一个负责人，只需增加一个owner；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">owner-info.config，负责人信息扩展性：</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（1）新增负责人，只需要在配置中增加一个item；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">（2）换了手机号/邮箱，只需修改相应配置；</span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><br></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\"><strong>最后一个问题，为什么要拆分成3个配置文件，而不是只用一个？</strong></span></section><section style=\"line-height: 1.75em;\"><span style=\"letter-spacing: 1px;font-size: 15px;\">呵呵，设计解耦，我们都需要多多修炼。</span><span style=\"font-size: 15px;letter-spacing: 1px;\"></span></section><section style=\"font-family: -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif normal center rgb><span style=\"letter-spacing: 1px;font-size: 15px;\"><strong><img data-ratio=\"1\" data-type=\"jpeg\" data-w=\"250\" data-s=\"300,640\" width=\"auto\" style=\"box-sizing: border-box; visibility: visible !important; width: 130px !important; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_jpg/Ir1gRyhAx7udO2WibD2tcDg4rqPvjo7jhbqZ6SFJZIxBo6N8ZZDptOCp8rYrRlXh8LiaAatFLtJdaWukz7qMvbDQ/640?wx_fmt=jpeg\"></strong></span></section><section style=\"font-family: -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif normal rgb center><span style=\"letter-spacing: 1px;font-size: 12px;\"><strong><strong>架构师之路</strong>-分享技术思路</strong></span></section><p style=\"font-family: -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif normal rgb><br></p><p style=\"font-family: -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif normal rgb><span style=\"font-size: 15px;letter-spacing: 1px;\"><strong>思路比结论更重要，希望大家有收获。</strong></span></p><p style=\"font-family: -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif normal rgb><br></p><section style=\"font-family: -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif normal rgb><strong style=\"font-size: 15px;letter-spacing: 1px;\">调研</strong></section><section style=\"font-family: -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif normal rgb><span style=\"font-size: 15px;letter-spacing: 1px;\">贵司的http，是怎么监控的？谢</span><span style=\"font-size: 15px;letter-spacing: 1px;color: rgb(255, 76, 0);\">转</span><span style=\"font-size: 15px;letter-spacing: 1px;\">。</span></section>\n                </div>\n\n    \n        <br>\n        <div id=\"js_toobar3\" class=\"rich_media_tool\">\n            <a target=\"_blank\" href=\"https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==%5Cx26amp;mid=2651965808%5Cx26amp;idx=1%5Cx26amp;sn=2c1a395bb0e923cd00b3eb02281e48a8%5Cx26amp;chksm=bd2d7cac8a5af5ba3ae8c4038c86a7ef02912612fd3eb53dc4e738ab0168f53bb14ae0f4b56f%5Cx26amp;token=949516902%5Cx26amp;lang=zh_CN#rd\" id=\"js_view_source\" class=\"media_tool_meta meta_primary\">阅读原文</a>\n        </div>\n    \n    <br>\n\n    \n        <a target=\"_blank\" href=\"http://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651965857&amp;idx=1&amp;sn=c068cc2978f6c0fdf75b066439d97d0b&amp;chksm=bd2d7c7d8a5af56b3783ee5210f1cbd7f514b8995efd12b5db2743a344c2f6cc3343ce3631e0&amp;scene=0#rd\" style=\"color: blue\" class=\"media_tool_meta meta_primary\">原文</a>\n        <br>\n    \n\n    \n\n    <img alt=\"\" width=\"1px\" height=\"1px\" class=\"\" style=\"width:1px;height:1px;display:none\" src=\"http://www.jintiankansha.me/rss_static/13611/AI7rPl1xeT\"></div></div>","descriptionType":"html","publishedDate":"Fri, 27 Nov 2020 01:02:00 +0000","feedId":2240,"bgimg":"http://content.sov5.cn/mmbiz_jpg/YrezxckhYOxdNkNxWryMia0A8T0tLGpEahEoBMU4hhRIDWRlbZID20vp3mU12o3F0k9mtjfibibjN2UYibUTEWIBLQ?imageView2/1/w/600","linkMd5":"13473de3d4427739d178dc298a98be55","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn11@2020_5/2020/12/03/02-55-38-681_f293f3313fb74208.webp","destWidth":339,"destHeight":191,"sourceBytes":4360,"destBytes":3502,"author":"","articleImgCdnMap":{"http://content.sov5.cn/mmbiz_jpg/YrezxckhYOxdNkNxWryMia0A8T0tLGpEahEoBMU4hhRIDWRlbZID20vp3mU12o3F0k9mtjfibibjN2UYibUTEWIBLQ?imageView2/1/w/600":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn11@2020_5/2020/12/03/02-55-38-681_f293f3313fb74208.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxdNkNxWryMia0A8T0tLGpEaxUojX688NuRL5ibjqXzmlYlG89iaMosK0qrRhztS7uUzv6quGa0COawQ/640?wx_fmt=jpeg":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn53@2020_3/2020/12/03/02-55-47-600_7a73edb4c7487377.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxdNkNxWryMia0A8T0tLGpEaSNVjJE1QcZMicPT3GTWlftXib9ibaBvz2VAmsn42NVHmibicpBzuZl3ibPEQ/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx13/cdn71@2020_2/2020/12/03/02-55-46-648_9c9b0ef94e7a1f5a.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxdNkNxWryMia0A8T0tLGpEanjhkmpmcAkiab35kVfg916HlJosr4fGbR8meqcC6DrTSmHAlIRhFfHw/640?wx_fmt=jpeg":"https://cdn.jsdelivr.net/gh/myreaderx8/cdn56@2020_2/2020/12/03/02-55-44-808_dc73c8d413269999.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxdNkNxWryMia0A8T0tLGpEarq1Xibqw9CNMiaApLYqAHSBicwEbibAR06Qg7mJWad2fXa9iaciaFic4siaofw/640?wx_fmt=png":null,"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_jpg/Ir1gRyhAx7udO2WibD2tcDg4rqPvjo7jhbqZ6SFJZIxBo6N8ZZDptOCp8rYrRlXh8LiaAatFLtJdaWukz7qMvbDQ/640?wx_fmt=jpeg":"https://cdn.jsdelivr.net/gh/myreaderx5oss/cdn67@2020_3/2020/12/03/02-55-43-651_43c39f7a470dd737.webp","http://www.jintiankansha.me/rss_static/13611/AI7rPl1xeT":null},"publishedOrCreatedDate":1606964076380}],"record":{"createdTime":"2020-12-03 10:54:36","updatedTime":"2020-12-03 10:54:36","feedId":2240,"fetchDate":"Thu, 03 Dec 2020 02:54:36 +0000","fetchMs":993,"handleMs":17,"totalMs":77854,"newArticles":0,"totalArticles":5,"status":1,"type":0,"ip":"9c0221c5bce09ea62c98da5ffdae1b8a","hostName":"europe62*","requestId":"a7f9abe586af4ec68500f1cb29cb2df7_2240","contentType":"application/rss+xml","totalBytes":68972,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":7,"articlesImgsGithubTotal":5,"successGithubMap":{"myreaderx8":1,"myreaderx32":2,"myreaderx13":1,"myreaderx5oss":1},"failGithubMap":{"myreaderx23":1}},"feed":{"createdTime":"2020-08-24 21:31:38","updatedTime":"2020-09-01 10:02:14","id":2240,"name":"架构师之路","url":"http://feedmaker.kindle4rss.com/feeds/gh_10a6b96351a9.weixin.xml","subscriber":null,"website":null,"icon":"http://www.sogou.com/images/logo/new/favicon.ico?v=4","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx63/cdn89@2020_4/2020/09/01/02-02-15-297_d24121c9beed1de6.ico","description":"架构师之路，坚持撰写接地气的架构文章","weekly":null,"link":null},"noPictureArticleList":[{"createdTime":"2020-12-03 10:55:53","updatedTime":"2020-12-03 10:55:53","id":null,"feedId":2240,"linkMd5":"13473de3d4427739d178dc298a98be55"}],"tmpCommonImgCdnBytes":3502,"tmpBodyImgCdnBytes":65470,"tmpBgImgCdnBytes":0,"extra4":{"start":1606964075187,"total":0,"statList":[{"spend":1176,"msg":"获取xml内容"},{"spend":17,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":13387,"msg":"正文链接上传到cdn"}]},"extra5":7,"extra6":7,"extra7ImgCdnFailResultVector":[null,{"code":1,"isDone":false,"source":"http://www.jintiankansha.me/rss_static/13611/AI7rPl1xeT","sourceStatusCode":405,"sourceBytes":0,"destBytes":0,"feedId":2240,"totalSpendMs":425,"convertSpendMs":0,"createdTime":"2020-12-03 10:55:39","host":"us-007*","referer":"http://weixin.sogou.com/weixin?type=2&query=%E6%9E%B6%E6%9E%84%E5%B8%88%E4%B9%8B%E8%B7%AF+%E5%A6%82%E4%BD%95%E5%9C%A812%E4%B8%AA%E5%B0%8F%E6%97%B6%EF%BC%8C%E6%90%9E%E5%AE%9Ahttp%E7%9B%91%E6%8E%A7%EF%BC%9F","linkMd5ListStr":"13473de3d4427739d178dc298a98be55","extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[405],"sourceSize":"0","destSize":"0"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_jpg/Ir1gRyhAx7udO2WibD2tcDg4rqPvjo7jhbqZ6SFJZIxBo6N8ZZDptOCp8rYrRlXh8LiaAatFLtJdaWukz7qMvbDQ/640?wx_fmt=jpeg","sourceStatusCode":403,"sourceBytes":0,"destBytes":0,"feedId":2240,"totalSpendMs":802,"convertSpendMs":0,"createdTime":"2020-12-03 10:55:39","host":"us-034*","referer":"http://weixin.sogou.com/weixin?type=2&query=%E6%9E%B6%E6%9E%84%E5%B8%88%E4%B9%8B%E8%B7%AF+%E5%A6%82%E4%BD%95%E5%9C%A812%E4%B8%AA%E5%B0%8F%E6%97%B6%EF%BC%8C%E6%90%9E%E5%AE%9Ahttp%E7%9B%91%E6%8E%A7%EF%BC%9F","linkMd5ListStr":"13473de3d4427739d178dc298a98be55","extra22GetBytesInfo":"2、Referer字段 ： http://weixin.sogou.com/weixin?type=2&query=%E6%9E%B6%E6%9E%84%E5%B8%88%E4%B9%8B%E8%B7%AF+%E5%A6%82%E4%BD%95%E5%9C%A812%E4%B8%AA%E5%B0%8F%E6%97%B6%EF%BC%8C%E6%90%9E%E5%AE%9Ahttp%E7%9B%91%E6%8E%A7%EF%BC%9F","extra23historyStatusCode":[403,403],"sourceSize":"0","destSize":"0"},{"code":1,"isDone":false,"source":"http://www.jintiankansha.me/rss_static/13611/AI7rPl1xeT","sourceStatusCode":405,"sourceBytes":0,"destBytes":0,"feedId":2240,"totalSpendMs":449,"convertSpendMs":0,"createdTime":"2020-12-03 10:55:40","host":"us-53*","referer":"http://weixin.sogou.com/weixin?type=2&query=%E6%9E%B6%E6%9E%84%E5%B8%88%E4%B9%8B%E8%B7%AF+%E5%A6%82%E4%BD%95%E5%9C%A812%E4%B8%AA%E5%B0%8F%E6%97%B6%EF%BC%8C%E6%90%9E%E5%AE%9Ahttp%E7%9B%91%E6%8E%A7%EF%BC%9F","linkMd5ListStr":"13473de3d4427739d178dc298a98be55","extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[405],"sourceSize":"0","destSize":"0"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxdNkNxWryMia0A8T0tLGpEarq1Xibqw9CNMiaApLYqAHSBicwEbibAR06Qg7mJWad2fXa9iaciaFic4siaofw/640?wx_fmt=png","sourceStatusCode":200,"destWidth":442,"destHeight":194,"sourceBytes":30494,"destBytes":11838,"targetWebpQuality":75,"feedId":2240,"totalSpendMs":4561,"convertSpendMs":7,"createdTime":"2020-12-03 10:55:39","host":"europe-56*","referer":"http://weixin.sogou.com/weixin?type=2&query=%E6%9E%B6%E6%9E%84%E5%B8%88%E4%B9%8B%E8%B7%AF+%E5%A6%82%E4%BD%95%E5%9C%A812%E4%B8%AA%E5%B0%8F%E6%97%B6%EF%BC%8C%E6%90%9E%E5%AE%9Ahttp%E7%9B%91%E6%8E%A7%EF%BC%9F","linkMd5ListStr":"13473de3d4427739d178dc298a98be55","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx23/cdn65/contents/2020/12/03/02-55-43-985_aec4e8390600e68b.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 69189253.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Thu, 03 Dec 2020 02:55:44 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"status":["403 Forbidden"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["A4B4:23E5:671659:76ADC5:5FC853A7"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1606967305"],"x-ratelimit-used":["60"],"x-xss-protection":["1; mode=block"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx23/cdn65/contents/2020/12/03/02-55-43-985_aec4e8390600e68b.webp","historyStatusCode":[],"spendMs":250},"base64UserPassword":null,"token":"df0b9******************************93a6e"},"githubUser":"myreaderx23","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"29.8 KB","destSize":"11.6 KB","compressRate":"38.8%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxdNkNxWryMia0A8T0tLGpEarq1Xibqw9CNMiaApLYqAHSBicwEbibAR06Qg7mJWad2fXa9iaciaFic4siaofw/640?wx_fmt=png","sourceStatusCode":200,"destWidth":442,"destHeight":194,"sourceBytes":30494,"destBytes":11838,"targetWebpQuality":75,"feedId":2240,"totalSpendMs":8794,"convertSpendMs":7,"createdTime":"2020-12-03 10:55:44","host":"europe-56*","referer":"http://weixin.sogou.com/weixin?type=2&query=%E6%9E%B6%E6%9E%84%E5%B8%88%E4%B9%8B%E8%B7%AF+%E5%A6%82%E4%BD%95%E5%9C%A812%E4%B8%AA%E5%B0%8F%E6%97%B6%EF%BC%8C%E6%90%9E%E5%AE%9Ahttp%E7%9B%91%E6%8E%A7%EF%BC%9F","linkMd5ListStr":"13473de3d4427739d178dc298a98be55","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx23/cdn65/contents/2020/12/03/02-55-52-783_aec4e8390600e68b.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 69189253.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Thu, 03 Dec 2020 02:55:53 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"status":["403 Forbidden"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["A4B4:23E5:671CA1:76B87E:5FC853B5"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1606967305"],"x-ratelimit-used":["60"],"x-xss-protection":["1; mode=block"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx23/cdn65/contents/2020/12/03/02-55-52-783_aec4e8390600e68b.webp","historyStatusCode":[],"spendMs":254},"base64UserPassword":null,"token":"df0b9******************************93a6e"},"githubUser":"myreaderx23","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"29.8 KB","destSize":"11.6 KB","compressRate":"38.8%"}],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://europe-56.herokuapp.com/":{"failCount":0,"successCount":2,"resultList":[200,200]},"http://us-018.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-53.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[405]},"http://us-007.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[405]},"http://us-019.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-034.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[403]},"http://us-035.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://europe66.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"http://content.sov5.cn/mmbiz_jpg/YrezxckhYOxdNkNxWryMia0A8T0tLGpEahEoBMU4hhRIDWRlbZID20vp3mU12o3F0k9mtjfibibjN2UYibUTEWIBLQ?imageView2/1/w/600","sourceStatusCode":200,"destWidth":339,"destHeight":191,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn11@2020_5/2020/12/03/02-55-38-681_f293f3313fb74208.webp","sourceBytes":4360,"destBytes":3502,"targetWebpQuality":75,"feedId":2240,"totalSpendMs":2963,"convertSpendMs":33,"createdTime":"2020-12-03 10:55:36","host":"us-54*","referer":"http://weixin.sogou.com/weixin?type=2&query=%E6%9E%B6%E6%9E%84%E5%B8%88%E4%B9%8B%E8%B7%AF+%E5%A6%82%E4%BD%95%E5%9C%A812%E4%B8%AA%E5%B0%8F%E6%97%B6%EF%BC%8C%E6%90%9E%E5%AE%9Ahttp%E7%9B%91%E6%8E%A7%EF%BC%9F","linkMd5ListStr":"13473de3d4427739d178dc298a98be55,13473de3d4427739d178dc298a98be55","githubUser":"myreaderx32","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"4.3 KB","destSize":"3.4 KB","compressRate":"80.3%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_jpg/Ir1gRyhAx7udO2WibD2tcDg4rqPvjo7jhbqZ6SFJZIxBo6N8ZZDptOCp8rYrRlXh8LiaAatFLtJdaWukz7qMvbDQ/640?wx_fmt=jpeg","sourceStatusCode":200,"destWidth":250,"destHeight":250,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx5oss/cdn67@2020_3/2020/12/03/02-55-43-651_43c39f7a470dd737.webp","sourceBytes":19963,"destBytes":12830,"targetWebpQuality":75,"feedId":2240,"totalSpendMs":4042,"convertSpendMs":8,"createdTime":"2020-12-03 10:55:40","host":"europe66*","referer":"http://weixin.sogou.com/weixin?type=2&query=%E6%9E%B6%E6%9E%84%E5%B8%88%E4%B9%8B%E8%B7%AF+%E5%A6%82%E4%BD%95%E5%9C%A812%E4%B8%AA%E5%B0%8F%E6%97%B6%EF%BC%8C%E6%90%9E%E5%AE%9Ahttp%E7%9B%91%E6%8E%A7%EF%BC%9F","linkMd5ListStr":"13473de3d4427739d178dc298a98be55","githubUser":"myreaderx5oss","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"19.5 KB","destSize":"12.5 KB","compressRate":"64.3%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxdNkNxWryMia0A8T0tLGpEanjhkmpmcAkiab35kVfg916HlJosr4fGbR8meqcC6DrTSmHAlIRhFfHw/640?wx_fmt=jpeg","sourceStatusCode":200,"destWidth":495,"destHeight":234,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx8/cdn56@2020_2/2020/12/03/02-55-44-808_dc73c8d413269999.webp","sourceBytes":27536,"destBytes":20752,"targetWebpQuality":75,"feedId":2240,"totalSpendMs":3874,"convertSpendMs":7,"createdTime":"2020-12-03 10:55:41","host":"us-019*","referer":"http://weixin.sogou.com/weixin?type=2&query=%E6%9E%B6%E6%9E%84%E5%B8%88%E4%B9%8B%E8%B7%AF+%E5%A6%82%E4%BD%95%E5%9C%A812%E4%B8%AA%E5%B0%8F%E6%97%B6%EF%BC%8C%E6%90%9E%E5%AE%9Ahttp%E7%9B%91%E6%8E%A7%EF%BC%9F","linkMd5ListStr":"13473de3d4427739d178dc298a98be55","githubUser":"myreaderx8","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"26.9 KB","destSize":"20.3 KB","compressRate":"75.4%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxdNkNxWryMia0A8T0tLGpEaSNVjJE1QcZMicPT3GTWlftXib9ibaBvz2VAmsn42NVHmibicpBzuZl3ibPEQ/640?wx_fmt=png","sourceStatusCode":200,"destWidth":391,"destHeight":241,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx13/cdn71@2020_2/2020/12/03/02-55-46-648_9c9b0ef94e7a1f5a.webp","sourceBytes":29662,"destBytes":11964,"targetWebpQuality":75,"feedId":2240,"totalSpendMs":7715,"convertSpendMs":9,"createdTime":"2020-12-03 10:55:39","host":"us-035*","referer":"http://weixin.sogou.com/weixin?type=2&query=%E6%9E%B6%E6%9E%84%E5%B8%88%E4%B9%8B%E8%B7%AF+%E5%A6%82%E4%BD%95%E5%9C%A812%E4%B8%AA%E5%B0%8F%E6%97%B6%EF%BC%8C%E6%90%9E%E5%AE%9Ahttp%E7%9B%91%E6%8E%A7%EF%BC%9F","linkMd5ListStr":"13473de3d4427739d178dc298a98be55","githubUser":"myreaderx13","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"29 KB","destSize":"11.7 KB","compressRate":"40.3%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxdNkNxWryMia0A8T0tLGpEaxUojX688NuRL5ibjqXzmlYlG89iaMosK0qrRhztS7uUzv6quGa0COawQ/640?wx_fmt=jpeg","sourceStatusCode":200,"destWidth":840,"destHeight":428,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx32/cdn53@2020_3/2020/12/03/02-55-47-600_7a73edb4c7487377.webp","sourceBytes":22944,"destBytes":19924,"targetWebpQuality":75,"feedId":2240,"totalSpendMs":8751,"convertSpendMs":27,"createdTime":"2020-12-03 10:55:39","host":"us-018*","referer":"http://weixin.sogou.com/weixin?type=2&query=%E6%9E%B6%E6%9E%84%E5%B8%88%E4%B9%8B%E8%B7%AF+%E5%A6%82%E4%BD%95%E5%9C%A812%E4%B8%AA%E5%B0%8F%E6%97%B6%EF%BC%8C%E6%90%9E%E5%AE%9Ahttp%E7%9B%91%E6%8E%A7%EF%BC%9F","linkMd5ListStr":"13473de3d4427739d178dc298a98be55","githubUser":"myreaderx32","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"22.4 KB","destSize":"19.5 KB","compressRate":"86.8%"}],"successGithubMap":{"myreaderx8":1,"myreaderx32":2,"myreaderx13":1,"myreaderx5oss":1},"failGithubMap":{"myreaderx23":1}}