{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2021-09-28 21:05:00","updatedTime":"2021-09-28 21:05:00","title":"How to Visualize NGINX Plus with Prometheus and Grafana","link":"https://www.nginx.com/?p=67976","description":"<p>As we discussed in <a href=\"https://www.nginx.com/blog/how-to-improve-visibility-in-kubernetes/\">How to Improve Visibility in Kubernetes</a>, one of the top challenges for app development and delivery teams is getting insight into app performance, security, and availability. These insights help teams troubleshoot problems quickly and proactively prepare for traffic spikes. </p> \n<p>Traffic management tools&nbsp;– such as load balancers, reverse proxies, API gateways, and Ingress controllers&nbsp;– generate a wealth of information about your app and infrastructure health. You can track these valuable metrics in real time on the <a href=\"https://www.nginx.com/products/nginx/live-activity-monitoring/\">NGINX&nbsp;Plus dashboard</a>, and NGINX&nbsp;Plus can also feed metrics to third‑party monitoring tools to give you extra insight from visualizations of performance over time. Two of the most popular tools work together to give you these time‑series graphs: </p> \n<ul> \n <li><a target=\"_blank\" href=\"https://prometheus.io/\" rel=\"noopener noreferrer\">Prometheus</a>&nbsp;– An open source project of the Cloud Native Computing Foundation (CNCF) for monitoring and alerting</li> \n <li><a target=\"_blank\" href=\"https://grafana.com/\" rel=\"noopener noreferrer\">Grafana</a>&nbsp;– An open source visualization and analytics tool that generates graphs and other visualizations from time‑series databases such as Prometheus</li> \n</ul> \n<p>The <span style=\"white-space: nowrap;\"><a href=\"https://www.nginx.com/products/nginx/modules/prometheus-njs/\">Prometheus-njs</a></span> module makes it easy to feed NGINX&nbsp;Plus metrics to Prometheus and Grafana. It uses the <a target=\"_blank\" href=\"https://nginx.org/en/docs/njs/\" rel=\"noopener noreferrer\">NGINX JavaScript module</a> (NJS) and the <span style=\"white-space: nowrap;\"><a target=\"_blank\" href=\"https://nginx.org/en/docs/http/ngx_http_api_module.html\" rel=\"noopener noreferrer\">NGINX Plus API</a></span> to export metrics from NGINX&nbsp;Plus to the Prometheus server. </p> \n<p>In this video demo, we cover the complete steps for setting up NGINX&nbsp;Plus, Prometheus, and Grafana, and building Grafana graphs.</p> \n<p><iframe width=\"770\" height=\"443\" src=\"https://www.youtube.com/embed/0Qs6r8l1GAA\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen=\"\"></iframe></p> \n<p>To help you set up your own implementation, we summarize the steps in the following sections, mapped to timepoints in the video:</p> \n<ul> \n <li><a href=\"https://www.nginx.com/?p=67976#Prerequisites\">Prerequisites</a></li> \n <li><a href=\"https://www.nginx.com/?p=67976#NGINX-Plus\">Set Up the NGINX&nbsp;Plus Server (1:20)</a></li> \n <li><a href=\"https://www.nginx.com/?p=67976#Prometheus\">Set Up the Prometheus Server (5:30)</a></li> \n <li><a href=\"https://www.nginx.com/?p=67976#Grafana\">Set Up the Grafana Server (9:15)</a></li> \n <li><a href=\"https://www.nginx.com/?p=67976#graphs\">Create NGINX&nbsp;Plus Graphs in Grafana (11:15)</a></li> \n</ul> \n<p><strong>Notes:</strong></p> \n<ul> \n <li>These instructions rely on the <span style=\"white-space: nowrap;\">NGINX Plus API</span>, and so do not work for NGINX Open Source.</li> \n <li>To use Prometheus and Grafana with NGINX Ingress Controller, see our <a target=\"_blank\" href=\"https://docs.nginx.com/nginx-ingress-controller/logging-and-monitoring/prometheus/\" rel=\"noopener noreferrer\">documentation</a>.</li> \n</ul> \n<h2>Prerequisites</h2> \n<p>Before beginning the demo, we satisfied the following prerequisites.</p> \n<ol> \n <li><a target=\"_blank\" href=\"https://docs.nginx.com/nginx/admin-guide/installing-nginx/installing-nginx-plus/\" rel=\"noopener noreferrer\">Install NGINX&nbsp;Plus</a> on the NGINX&nbsp;Plus server. For the purposes of the demo, we’re doing a clean initial installation. If you’re using an existing NGINX&nbsp;Plus server, you might need to modify the changes made to configuration files during the demo.</li> \n <li><a target=\"_blank\" href=\"https://docs.nginx.com/nginx/admin-guide/dynamic-modules/nginscript/\" rel=\"noopener noreferrer\">Install the NGINX JavaScript (njs) module</a> on the NGINX&nbsp;Plus server.</li> \n <li><a target=\"_blank\" href=\"https://docs.docker.com/engine/install/\" rel=\"noopener noreferrer\">Install the latest version of Docker</a> on the Prometheus server. In the demo, we follow common practice and run Prometheus on a second server, separate from NGINX&nbsp;Plus.</li> \n <li>Install the latest version of Docker on the Grafana server (in the demo, a third server).</li> \n</ol> \n<h2 id=\"NGINX-Plus\">Set Up the NGINX Plus Server (1:20)</h2> \n<ol> \n <li> <p>Install the <span style=\"white-space: nowrap;\">Prometheus-njs</span> module. We’re using Ubuntu&nbsp;20.04 in the demo, and this is the appropriate command. For other operating systems, see the <a target=\"_blank\" href=\"https://docs.nginx.com/nginx/admin-guide/dynamic-modules/prometheus-njs/\" rel=\"noopener noreferrer\">documentation</a>.</p> <pre><code class=\"terminal\">$ <strong>sudo apt-get install nginx-plus-module-prometheus</strong></code></pre> </li> \n <li> <p>Using your preferred text editor, open <strong>/etc/nginx/nginx.conf</strong> and add the following <a target=\"_blank\" href=\"https://nginx.org/en/docs/ngx_core_module.html#load_module\" rel=\"noopener noreferrer\"><code>load_module</code></a> directive in the top‑level context, outside the <code>http</code> block.</p> <pre><code class=\"config\">load_module modules/ngx_http_js_module.so;\n# existing top-level directives\n\nhttp {\n    #...\n}</code></pre> </li> \n <li> <p>(Optional) Increase the size of the buffer for storing response bodies from subrequests (the default size <span style=\"white-space: nowrap;\">is 4 KB</span> <span style=\"white-space: nowrap;\">or 8 KB</span>, depending on the platform). This prevents <span style=\"white-space: nowrap;\"><code>too</code> <code>big</code> <code>subrequest</code> <code>response</code></span> errors , which appear in the <a target=\"_blank\" href=\"https://docs.nginx.com/nginx/admin-guide/monitoring/logging/\" rel=\"noopener noreferrer\">NGINX error log</a>. Add the following <a target=\"_blank\" href=\"https://nginx.org/en/docs/http/ngx_http_core_module.html#subrequest_output_buffer_size\" rel=\"noopener noreferrer\"><code>subrequest_output_buffer_size</code></a> directive in the <code>http</code> block.</p> <pre><code class=\"config\">http {\n    #...\n    subrequest_output_buffer_size 32k;\n}</code></pre> </li> \n <p><a name=\"nginx-t\"></a></p> \n <li> <p>Save <strong>nginx.conf</strong> and run this command to verify that the NGINX configuration is syntactically correct.</p> <pre><code class=\"terminal\">$ <strong>sudo nginx -t</strong>\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful</code></pre> </li> \n <li> <p>Change directory to <strong>conf.d</strong> and list the files.</p> <pre><code class=\"terminal\">$ <strong>cd conf.d</strong>\n$ <strong>ls</strong>\ndefault.conf</code></pre> </li> \n <li> <p>The <strong>default.conf</strong> file defines a virtual server that listens on port&nbsp;80. The virtual server for Prometheus needs to listen on that port, so remove <strong>default.conf</strong> to free it up.</p> <pre><code class=\"terminal\">$ <strong>sudo rm default.conf</strong></code></pre> </li> \n <li> <p>Using your preferred text editor, create a new file called <strong>prometheus.conf</strong>, with the following contents.</p> <pre><code class=\"config\">js_import /usr/share/nginx-plus-module prometheus/prometheus.js;\n\nserver {\n    location = /metrics {\n        js_content prometheus.metrics;\n    }\n \n    location /api {\n        api;\n    } \n}</code></pre> <p>The <a target=\"_blank\" href=\"https://nginx.org/en/docs/http/ngx_http_js_module.html#js_import\" rel=\"noopener noreferrer\"><code>js_import</code></a> directive specifies the location of the NGINX JavaScript code that converts the metrics generated by the <span style=\"white-space: nowrap;\">NGINX Plus API</span> into the format required by Prometheus. (You do not also need to add a <code>load_module</code> directive for <span style=\"white-space: nowrap;\">Prometheus-njs</span>.)</p> <p>The first <a target=\"_blank\" href=\"https://nginx.org/en/docs/http/ngx_http_core_module.html#location\" rel=\"noopener noreferrer\"><code>location</code></a> block provides access to the Prometheus-formatted metrics. The second <code>location</code> block enables the <span style=\"white-space: nowrap;\">NGINX Plus API</span>, which generates the raw metrics and exposes them to Prometheus.</p> <p><strong>Note:</strong> In production environments, we strongly recommend restricting access to the <span style=\"white-space: nowrap;\">NGINX Plus API</span> as described in our <a target=\"_blank\" href=\"https://docs.nginx.com/nginx/admin-guide/load-balancer/dynamic-configuration-api/#enabling-dynamic-configuration\" rel=\"noopener noreferrer\">documentation</a>.</p> <p>For more information about the <span style=\"white-space: nowrap;\">Prometheus-njs</span> module, see our <a target=\"_blank\" href=\"https://docs.nginx.com/nginx/admin-guide/dynamic-modules/prometheus-njs/\" rel=\"noopener noreferrer\">documentation</a>.</p> </li> \n <li> <p>Save <strong>prometheus.conf</strong>, check for correct syntax as in <a href=\"https://www.nginx.com/?p=67976#nginx-t\">Step&nbsp;4</a>, and run this command to start NGINX&nbsp;Plus.</p> <pre><code class=\"terminal\">$ <strong>sudo nginx</strong></code></pre> </li> \n</ol> \n<h2 id=\"Prometheus\">Set Up the Prometheus Server (5:30)</h2> \n<ol> \n <li> <p>Create a new YAML‑formatted Prometheus config file called <strong>prometheus.yml</strong> in the <strong>/etc/prometheus</strong> directory, with these contents (based on a <a target=\"_blank\" href=\"https://prometheus.io/docs/introduction/first_steps/#configuring-prometheus\" rel=\"noopener noreferrer\">default config file</a> from the Prometheus website). As shown, the one change to make is to add the IP address and port of the NGINX&nbsp;Plus server in the targets field.</p> <pre><code class=\"config\">global:\n  scrape_interval: 15s \n  \n  external_labels:\n    monitor: 'codelab-monitor'\n \nscrape_configs:  \n  - job_name: 'prometheus'\n    \n    scrape_interval: 5s\n \n    static_configs:\n      - targets: ['<em>NGINX_Plus_IP_address</em>:80']</code></pre> <p>For details about Prometheus configuration, including more options you can include in the configuration file, see the <a target=\"_blank\" href=\"https://prometheus.io/docs/prometheus/latest/configuration/configuration/\" rel=\"noopener noreferrer\">Prometheus documentation</a>.</p> </li> \n <li> <p>Save <strong>prometheus.yml</strong>, then run the following command. It pulls Prometheus from Docker Hub and exposes it on port&nbsp;9090.</p> <pre><code class=\"terminal\">$ <strong>sudo docker run --network=\"host\" -d -p 9090:9090 -v ~/prometheus.yml:/etc/prometheus/prometheus.yml prom/prometheus</strong></code></pre> </li> \n <li> <p>In a browser, navigate to the IP address and port of the new Prometheus server. A page like the following confirms that the server is working.</p> <p><a href=\"https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_homepage.png\"><img src=\"https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_homepage.png\" alt=\"\" width=\"2214\" height=\"787\" class=\"aligncenter size-full wp-image-67988\" style=\"border:2px solid #666666; padding:2px; margin:2px;\" srcset=\"https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_homepage.png 2214w, https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_homepage-300x107.png 300w, https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_homepage-1024x364.png 1024w, https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_homepage-768x273.png 768w, https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_homepage-1536x546.png 1536w, https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_homepage-2048x728.png 2048w, https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_homepage-150x53.png 150w, https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_homepage-640x227.png 640w, https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_homepage-320x114.png 320w\" sizes=\"(max-width: 2214px) 100vw, 2214px\" /></a> </p></li> \n <li> <p>Verify that Prometheus is accessing the feed of NGINX&nbsp;Plus metrics. Click the globe icon to the left of the <span style=\"background-color:#1654f3; color:white; font-weight:bold;\"> Execute </span> button in the upper right corner of the window. A list of metrics like the following appears.</p> <p><a href=\"https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_Metrics-Explorer.png\"><img src=\"https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_Metrics-Explorer.png\" alt=\"\" width=\"2014\" height=\"1610\" class=\"aligncenter size-full wp-image-67987\" srcset=\"https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_Metrics-Explorer.png 2014w, https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_Metrics-Explorer-300x240.png 300w, https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_Metrics-Explorer-1024x819.png 1024w, https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_Metrics-Explorer-768x614.png 768w, https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_Metrics-Explorer-1536x1228.png 1536w, https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_Metrics-Explorer-150x120.png 150w, https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_Metrics-Explorer-640x512.png 640w, https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_Metrics-Explorer-320x256.png 320w\" sizes=\"(max-width: 2014px) 100vw, 2014px\" /></a> </p></li> \n</ol> \n<h2 id=\"Grafana\">Set Up the Grafana Server (9:15)</h2> \n<ol> \n <li> <p>Run this command to pull Grafana from Docker Hub and expose it on port&nbsp;3000:</p> <pre><code class=\"terminal\">[terminal]$ <strong>sudo docker run -d -p 3000:3000 grafana/grafana</strong></code></pre> <p>For other installation methods, see the <a target=\"_blank\" href=\"https://grafana.com/docs/grafana/latest/installation/\" rel=\"noopener noreferrer\">Grafana documentation</a>.</p> </li> \n <li> <p>In a browser, navigate to the IP address and port of the new Grafana server. The Grafana login page confirms that the server is working.</p> <p><a href=\"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_login-page.png\"><img src=\"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_login-page.png\" alt=\"\" width=\"1380\" height=\"1741\" class=\"aligncenter size-full wp-image-67986\" srcset=\"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_login-page.png 1380w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_login-page-238x300.png 238w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_login-page-812x1024.png 812w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_login-page-768x969.png 768w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_login-page-1218x1536.png 1218w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_login-page-119x150.png 119w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_login-page-507x640.png 507w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_login-page-266x336.png 266w\" sizes=\"(max-width: 1380px) 100vw, 1380px\" /></a> </p></li> \n <li> <p>Log in by entering <strong>admin</strong> in both the <span style=\"white-space: nowrap; font-weight:bold;\">Email or username</span> and <strong>Password</strong> fields. We strongly recommend that you set a new secure password as prompted, but we skip that step in the demo for the sake of time.</p> </li> \n <p><a name=\"Grafana-homepage\"></a></p> \n <li> <p>On the Grafana homepage which appears, register Prometheus as a <em>data source</em> by following the instructions in the <a target=\"_blank\" href=\"https://prometheus.io/docs/visualization/grafana/#creating-a-prometheus-data-source\" rel=\"noopener noreferrer\">Grafana documentation</a>. The video shows the the steps in the Grafana GUI.</p> <p><strong>Note:</strong> In Step&nbsp;5 of the Grafana instructions, instead of the URL example shown (<strong>http://localhost:9090</strong>) enter the IP address of your Prometheus server (and port&nbsp;9090).</p> <p><a href=\"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_homepage.png\"><img src=\"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_homepage.png\" alt=\"\" width=\"2727\" height=\"1363\" class=\"aligncenter size-full wp-image-67985\" srcset=\"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_homepage.png 2727w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_homepage-300x150.png 300w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_homepage-1024x512.png 1024w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_homepage-768x384.png 768w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_homepage-1536x768.png 1536w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_homepage-2048x1024.png 2048w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_homepage-150x75.png 150w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_homepage-640x320.png 640w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_homepage-320x160.png 320w\" sizes=\"(max-width: 2727px) 100vw, 2727px\" /></a></p> <p>After you click the <span style=\"background-color:#4087ff; color:white; font-weight:bold;\"> Save &amp; test </span> button in Step&nbsp;7 of the Grafana instructions, the green box with a checkmark and the <span style=\"white-space: nowrap; font-weight:bold;\">Data source is working</span> message indicate that Grafana has successfully connected to the Prometheus server.</p> <p><a href=\"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_Data-source-is-working.png\"><img src=\"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_Data-source-is-working.png\" alt=\"\" width=\"1315\" height=\"749\" class=\"aligncenter size-full wp-image-67984\" srcset=\"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_Data-source-is-working.png 1315w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_Data-source-is-working-300x171.png 300w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_Data-source-is-working-1024x583.png 1024w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_Data-source-is-working-768x437.png 768w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_Data-source-is-working-150x85.png 150w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_Data-source-is-working-640x365.png 640w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_Data-source-is-working-320x182.png 320w\" sizes=\"(max-width: 1315px) 100vw, 1315px\" /></a> </p></li> \n</ol> \n<h2 id=\"graphs\">Create NGINX Plus Graphs in Grafana (11:15)</h2> \n<p>While Prometheus is useful for looking at just one metric, Grafana makes it easy to look at a collection of metrics on a single graph. </p> \n<p>To build a Grafana graph:</p> \n<ol> \n <li> <p>Click the plus sign (<strong>+</strong>) in the navigation bar at the left side of the page (see the screenshot in <a href=\"https://www.nginx.com/?p=67976#Grafana-homepage\">Step&nbsp;4</a> of the previous section). Select <strong>Dashboard</strong> on the <strong>Create</strong> drop‑down menu.</p> </li> \n <li> <p>Click the <span style=\"white-space: nowrap; font-weight:bold;\">Add an empty panel</span> box.</p> </li> \n <li> <p>On the <span style=\"white-space: nowrap; font-weight:bold;\">New dashboard/Edit Panel</span> page that appears, verify that Prometheus appears in the <span style=\"white-space: nowrap; font-weight:bold;\">Data source</span> field of the <strong>Query</strong> tab in the bottom half of the page. If not, select <strong>Prometheus</strong> from the drop‑down menu.</p> </li> \n <li> <p>Enter <code>nginx</code> in the <span style=\"background-color:#181b1a; color:#95d8ff; font-weight:bold;\"> Metrics browser &gt; </span> field. A list of NGINX&nbsp;Plus metrics appears.</p> <p><a href=\"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_metrics-list.png\"><img src=\"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_metrics-list.png\" alt=\"\" width=\"2582\" height=\"1754\" class=\"aligncenter size-full wp-image-67983\" srcset=\"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_metrics-list.png 2582w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_metrics-list-300x204.png 300w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_metrics-list-1024x696.png 1024w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_metrics-list-768x522.png 768w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_metrics-list-1536x1043.png 1536w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_metrics-list-2048x1391.png 2048w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_metrics-list-150x102.png 150w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_metrics-list-640x435.png 640w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_metrics-list-320x217.png 320w\" sizes=\"(max-width: 2582px) 100vw, 2582px\" /></a></p> <p>Here are brief descriptions to give you an idea of what information they provide.</p> \n  <ul> \n   <li><code>nginxplus_connections_accepted</code>&nbsp;– Accepted client connections</li> \n   <li><code>nginxplus_connections_active</code>&nbsp;– Active client connections</li> \n   <li><code>nginxplus_connections_dropped</code>&nbsp;– Dropped client connections dropped</li> \n   <li><code>nginxplus_connections_idle</code>&nbsp;– Idle client connections</li> \n   <li><code>nginxplus_http_requests_current</code>&nbsp;– Current HTTP requests</li> \n   <li><code>nginxplus_http_requests_total</code>&nbsp;– Total HTTP requests</li> \n   <li><code>nginxplus_nginx_meta</code>&nbsp;– NGINX meta information</li> \n   <li><code>nginxplus_processes_respawned</code>&nbsp;– Total number of abnormally terminated and re‑spawned child processes</li> \n   <li><code>nginxplus_ssl_handshakes</code>&nbsp;– Successful SSL handshakes</li> \n   <li><code>nginxplus_ssl_handshakes_failed</code>&nbsp;– Failed SSL handshakes</li> \n   <li><code>nginxplus_ssl_session_reuses</code>&nbsp;– Session reuses during SSL handshake</li> \n   <li><code>nginxplus_workers_mem_private</code>&nbsp;– Private memory used by NGINX workers, does not include shared libraries</li> \n   <li><code>nginxplus_workers_mem_rss</code>&nbsp;– Memory utilized by NGINX worker processes</li> \n  </ul> </li>  \n <li> <p>Select a metric from the list (in the demo we select <code>nginxplus_connections_active</code>). To select another metric, click the <span style=\"background-color:#181b1a; color:white; font-weight:bold;\"> + Query </span> button and select another metric in the new <span style=\"background-color:#181b1a; color:#95d8ff; font-weight:bold;\"> Metrics browser &gt; </span> field (in the demo, we select <code>nginxplus_connections_idle</code>).</p> </li> \n <li> <p>Click the \"refresh\" (two arrows forming a circle) icon above the graph in the upper half of the page, and results start to appear on the graph.</p> <p><a href=\"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_graph-nginxplus-connections-accepted.png\"><img src=\"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_graph-nginxplus-connections-accepted.png\" alt=\"\" width=\"2477\" height=\"1754\" class=\"aligncenter size-full wp-image-67982\" srcset=\"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_graph-nginxplus-connections-accepted.png 2477w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_graph-nginxplus-connections-accepted-300x212.png 300w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_graph-nginxplus-connections-accepted-1024x725.png 1024w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_graph-nginxplus-connections-accepted-768x544.png 768w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_graph-nginxplus-connections-accepted-1536x1088.png 1536w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_graph-nginxplus-connections-accepted-2048x1450.png 2048w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_graph-nginxplus-connections-accepted-150x106.png 150w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_graph-nginxplus-connections-accepted-640x453.png 640w, https://www.nginx.com/wp-content/uploads/2021/09/Grafana_graph-nginxplus-connections-accepted-320x227.png 320w\" sizes=\"(max-width: 2477px) 100vw, 2477px\" /></a></p> </li> \n</ol> \n<h2>Bonus: Unified Insights and Analytics for All Your NGINX&nbsp;Plus Deployments</h2> \n<p>You may be asking “What if I’ve got a large NGINX deployment, including many NGINX&nbsp;Plus instances?” or “How can I update the configuration of my instances based on the insights and analytics from Prometheus and Grafana?” <a href=\"https://www.nginx.com/products/nginx-controller/\">NGINX&nbsp;Controller</a>, our control‑ and management‑plane solution for NGINX deployments, helps you address those questions and many more. </p> \n<p>While Prometheus and Grafana are excellent solutions for monitoring, alerting, and visualization, they do not provide a way to update configurations and policies. Taking action based on these insights still requires logging into individual NGINX&nbsp;Plus instances to make changes, which can be time consuming and error prone&nbsp;– especially for large and complex NGINX&nbsp;Plus deployments.</p> \n<p><a href=\"https://www.nginx.com/wp-content/uploads/2021/04/NGINX-Controller-App-Centric-UI_2021-04@2x.png\"><img src=\"https://www.nginx.com/wp-content/uploads/2021/04/NGINX-Controller-App-Centric-UI_2021-04@2x.png\" alt=\"\" width=\"2048\" height=\"1228\" class=\"aligncenter size-full wp-image-66365\" srcset=\"https://www.nginx.com/wp-content/uploads/2021/04/NGINX-Controller-App-Centric-UI_2021-04@2x.png 2048w, https://www.nginx.com/wp-content/uploads/2021/04/NGINX-Controller-App-Centric-UI_2021-04@2x-300x180.png 300w, https://www.nginx.com/wp-content/uploads/2021/04/NGINX-Controller-App-Centric-UI_2021-04@2x-1024x614.png 1024w, https://www.nginx.com/wp-content/uploads/2021/04/NGINX-Controller-App-Centric-UI_2021-04@2x-768x461.png 768w, https://www.nginx.com/wp-content/uploads/2021/04/NGINX-Controller-App-Centric-UI_2021-04@2x-1536x921.png 1536w, https://www.nginx.com/wp-content/uploads/2021/04/NGINX-Controller-App-Centric-UI_2021-04@2x-150x90.png 150w, https://www.nginx.com/wp-content/uploads/2021/04/NGINX-Controller-App-Centric-UI_2021-04@2x-640x384.png 640w, https://www.nginx.com/wp-content/uploads/2021/04/NGINX-Controller-App-Centric-UI_2021-04@2x-395x237.png 395w, https://www.nginx.com/wp-content/uploads/2021/04/NGINX-Controller-App-Centric-UI_2021-04@2x-320x192.png 320w\" sizes=\"(max-width: 2048px) 100vw, 2048px\" /></a></p> \n<p>NGINX&nbsp;Controller offers deep insight and analytics on the&nbsp;200+ NGINX&nbsp;Plus metrics, including requests per second, CPU usage,&nbsp;<code>4<em>xx</em></code> and&nbsp;<code>5<em>xx</em></code> errors, health check failures, and much more&nbsp;– all presented in an app‑centric, intuitive, and unified platform. You can then deep dive into the data, export it in reports, and make necessary configuration and policy changes leveraging automated, role‑specific workflows that were designed by NGINX experts to abstract away complexity. </p> \n<p>With NGINX&nbsp;Controller, you can keep your finger on the pulse or you app deployments and take control of NGINX&nbsp;Plus instances and configuration objects (for example, Environments, Gateways, and Apps) at scale. And you don’t have to sacrifice use of your favorite monitoring and alerting solutions; Controller’s API‑first design makes integrating with third‑party solutions very simple and straightforward. </p> \n<p><iframe width=\"770\" height=\"443\" src=\"https://www.youtube.com/embed/k-nsAKImnFY\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen=\"\"></iframe></p> \n<h2>Get Started with NGINX Plus and NGINX&nbsp;Controller</h2> \n<p>If you haven’t tried NGINX&nbsp;Plus, we encourage you to try it out&nbsp;– as a load balancer, reverse proxy, and API gateway, or as a fully supported web server with enhanced monitoring and management APIs. Get started today with a <span style=\"white-space: nowrap;\"><a href=\"https://www.nginx.com/free-trial-request\">free 30-day trial</a></span> today or <a href=\"https://www.nginx.com/contact-sales/\">contact us to discuss your use cases</a>.</p> \n<p>And if you’re thinking NGINX&nbsp;Controller might be the way to visualize and monitor your NGINX&nbsp;Plus fleet, check out the <span style=\"white-space: nowrap;\"><a href=\"https://www.nginx.com/free-trial-request-nginx-controller\">free 30-day trial</a></span> that includes both the Application Delivery and API Management modules with Controller App Security.</p> \n<p>The post <a rel=\"nofollow\" href=\"https://www.nginx.com/blog/how-to-visualize-nginx-plus-with-prometheus-and-grafana/\">How to Visualize NGINX Plus with Prometheus and Grafana</a> appeared first on <a rel=\"nofollow\" href=\"https://www.nginx.com\">NGINX</a>.</p>","descriptionType":"html","publishedDate":"Fri, 24 Sep 2021 04:15:22 +0000","feedId":10473,"bgimg":"https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_homepage.png","linkMd5":"4fe49f9bbbccd84c05cf4c899f295d27","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx6/cdn3@2020_6/2021/09/28/13-05-06-871_4da268516ed71b48.webp","destWidth":2214,"destHeight":787,"sourceBytes":112795,"destBytes":50454,"author":"Monica Thorne of F5","articleImgCdnMap":{"https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_homepage.png":"https://cdn.jsdelivr.net/gh/myreaderx6/cdn3@2020_6/2021/09/28/13-05-06-871_4da268516ed71b48.webp","https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_Metrics-Explorer.png":"https://cdn.jsdelivr.net/gh/myreaderx23/cdn11@2020_1/2021/09/28/13-05-08-687_d492f09f188262ca.webp","https://www.nginx.com/wp-content/uploads/2021/09/Grafana_login-page.png":"https://cdn.jsdelivr.net/gh/myreaderx3/cdn20@2020_5/2021/09/28/13-05-12-050_1a57810fc19cea23.webp","https://www.nginx.com/wp-content/uploads/2021/09/Grafana_homepage.png":"https://cdn.jsdelivr.net/gh/myreaderx4/cdn18@2020_6/2021/09/28/13-05-09-765_41bffdf5b66d31ee.webp","https://www.nginx.com/wp-content/uploads/2021/09/Grafana_Data-source-is-working.png":"https://cdn.jsdelivr.net/gh/myreaderx19/cdn14@2020_5/2021/09/28/13-05-24-920_0658fa6ecb38e134.webp","https://www.nginx.com/wp-content/uploads/2021/09/Grafana_metrics-list.png":"https://cdn.jsdelivr.net/gh/myreaderx14/cdn7@2020_2/2021/09/28/13-05-09-185_764943a89d4bf1ba.webp","https://www.nginx.com/wp-content/uploads/2021/09/Grafana_graph-nginxplus-connections-accepted.png":"https://cdn.jsdelivr.net/gh/myreaderx31/cdn15@2020_2/2021/09/28/13-05-18-824_17e3a6c8886425cd.webp","https://www.nginx.com/wp-content/uploads/2021/04/NGINX-Controller-App-Centric-UI_2021-04@2x.png":"https://cdn.jsdelivr.net/gh/myreaderx33/cdn10@2020_4/2021/09/28/13-05-08-796_4dabb409ed1330a5.webp"},"publishedOrCreatedDate":1632834300088}],"record":{"createdTime":"2021-09-28 21:05:00","updatedTime":"2021-09-28 21:05:00","feedId":10473,"fetchDate":"Tue, 28 Sep 2021 13:05:00 +0000","fetchMs":764,"handleMs":3838,"totalMs":29969,"newArticles":0,"totalArticles":10,"status":1,"type":0,"ip":"79b59b7ab14b8d981e3d8a220e20848a","hostName":"us-025*","requestId":"26382f3c30db49b493dfbef28e2f8040_10473","contentType":"application/rss+xml; charset=UTF-8","totalBytes":646084,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":8,"articlesImgsGithubTotal":8,"successGithubMap":{"myreaderx14":1,"myreaderx6":1,"myreaderx4":1,"myreaderx33":1,"myreaderx3":1,"myreaderx23":1,"myreaderx31":1,"myreaderx19":1},"failGithubMap":{}},"feed":{"createdTime":"2020-08-25 04:35:56","updatedTime":"2020-08-25 04:35:56","id":10473,"name":"NGINX","url":"https://www.nginx.com/feed/","subscriber":294,"website":null,"icon":"https://www.nginx.com/favicon.ico","icon_jsdelivr":null,"description":"The High Performance Reverse Proxy, Load Balancer, Edge Cache, Origin Server","weekly":null,"link":"https://www.nginx.com"},"noPictureArticleList":[],"tmpCommonImgCdnBytes":50454,"tmpBodyImgCdnBytes":595630,"tmpBgImgCdnBytes":0,"extra4":{"start":1632834295387,"total":0,"statList":[{"spend":940,"msg":"获取xml内容"},{"spend":3838,"msg":"解释文章"},{"spend":7,"msg":"上传封面图到cdn"},{"spend":14,"msg":"修正封面图上传失败重新上传"},{"spend":17023,"msg":"正文链接上传到cdn"}]},"extra5":8,"extra6":8,"extra7ImgCdnFailResultVector":[],"extra10_invalidATagHrefValue":{"https://www.nginx.com/?p=67976_#Prometheus":"https://www.nginx.com/?p=67976#Prometheus","https://www.nginx.com/?p=67976_#nginx-t":"https://www.nginx.com/?p=67976#nginx-t","https://www.nginx.com/?p=67976_#Grafana-homepage":"https://www.nginx.com/?p=67976#Grafana-homepage","https://www.nginx.com/?p=67976_#NGINX-Plus":"https://www.nginx.com/?p=67976#NGINX-Plus","https://www.nginx.com/?p=67976_#Grafana":"https://www.nginx.com/?p=67976#Grafana","https://www.nginx.com/?p=67976_#graphs":"https://www.nginx.com/?p=67976#graphs","https://www.nginx.com/?p=67976_#Prerequisites":"https://www.nginx.com/?p=67976#Prerequisites"},"extra111_proxyServerAndStatMap":{"http://us-025.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-028.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-022.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-023.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-024.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-026.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-027.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_homepage.png","sourceStatusCode":200,"destWidth":2214,"destHeight":787,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx6/cdn3@2020_6/2021/09/28/13-05-06-871_4da268516ed71b48.webp","sourceBytes":112795,"destBytes":50454,"targetWebpQuality":75,"feedId":10473,"totalSpendMs":1997,"convertSpendMs":536,"createdTime":"2021-09-28 21:05:05","host":"europe-59*","referer":"https://www.nginx.com/?p=67976","linkMd5ListStr":"4fe49f9bbbccd84c05cf4c899f295d27,4fe49f9bbbccd84c05cf4c899f295d27","githubUser":"myreaderx6","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"110.2 KB","destSize":"49.3 KB","compressRate":"44.7%"},{"code":1,"isDone":false,"source":"https://www.nginx.com/wp-content/uploads/2021/09/Prometheus_Metrics-Explorer.png","sourceStatusCode":200,"destWidth":2014,"destHeight":1610,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx23/cdn11@2020_1/2021/09/28/13-05-08-687_d492f09f188262ca.webp","sourceBytes":238566,"destBytes":116792,"targetWebpQuality":75,"feedId":10473,"totalSpendMs":641,"convertSpendMs":110,"createdTime":"2021-09-28 21:05:08","host":"us-022*","referer":"https://www.nginx.com/?p=67976","linkMd5ListStr":"4fe49f9bbbccd84c05cf4c899f295d27","githubUser":"myreaderx23","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"233 KB","destSize":"114.1 KB","compressRate":"49%"},{"code":1,"isDone":false,"source":"https://www.nginx.com/wp-content/uploads/2021/04/NGINX-Controller-App-Centric-UI_2021-04@2x.png","sourceStatusCode":200,"destWidth":2048,"destHeight":1228,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx33/cdn10@2020_4/2021/09/28/13-05-08-796_4dabb409ed1330a5.webp","sourceBytes":428685,"destBytes":126176,"targetWebpQuality":75,"feedId":10473,"totalSpendMs":785,"convertSpendMs":204,"createdTime":"2021-09-28 21:05:08","host":"us-025*","referer":"https://www.nginx.com/?p=67976","linkMd5ListStr":"4fe49f9bbbccd84c05cf4c899f295d27","githubUser":"myreaderx33","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"418.6 KB","destSize":"123.2 KB","compressRate":"29.4%"},{"code":1,"isDone":false,"source":"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_metrics-list.png","sourceStatusCode":200,"destWidth":2582,"destHeight":1754,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx14/cdn7@2020_2/2021/09/28/13-05-09-185_764943a89d4bf1ba.webp","sourceBytes":443792,"destBytes":103094,"targetWebpQuality":75,"feedId":10473,"totalSpendMs":1087,"convertSpendMs":485,"createdTime":"2021-09-28 21:05:08","host":"us-023*","referer":"https://www.nginx.com/?p=67976","linkMd5ListStr":"4fe49f9bbbccd84c05cf4c899f295d27","githubUser":"myreaderx14","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"433.4 KB","destSize":"100.7 KB","compressRate":"23.2%"},{"code":1,"isDone":false,"source":"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_homepage.png","sourceStatusCode":200,"destWidth":2727,"destHeight":1363,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx4/cdn18@2020_6/2021/09/28/13-05-09-765_41bffdf5b66d31ee.webp","sourceBytes":411050,"destBytes":95094,"targetWebpQuality":75,"feedId":10473,"totalSpendMs":1758,"convertSpendMs":265,"createdTime":"2021-09-28 21:05:08","host":"us-027*","referer":"https://www.nginx.com/?p=67976","linkMd5ListStr":"4fe49f9bbbccd84c05cf4c899f295d27","githubUser":"myreaderx4","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"401.4 KB","destSize":"92.9 KB","compressRate":"23.1%"},{"code":1,"isDone":false,"source":"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_login-page.png","sourceStatusCode":200,"destWidth":1380,"destHeight":1741,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx3/cdn20@2020_5/2021/09/28/13-05-12-050_1a57810fc19cea23.webp","sourceBytes":755324,"destBytes":46548,"targetWebpQuality":75,"feedId":10473,"totalSpendMs":1522,"convertSpendMs":101,"createdTime":"2021-09-28 21:05:11","host":"us-028*","referer":"https://www.nginx.com/?p=67976","linkMd5ListStr":"4fe49f9bbbccd84c05cf4c899f295d27","githubUser":"myreaderx3","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"737.6 KB","destSize":"45.5 KB","compressRate":"6.2%"},{"code":1,"isDone":false,"source":"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_graph-nginxplus-connections-accepted.png","sourceStatusCode":200,"destWidth":2477,"destHeight":1754,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx31/cdn15@2020_2/2021/09/28/13-05-18-824_17e3a6c8886425cd.webp","sourceBytes":227985,"destBytes":86080,"targetWebpQuality":75,"feedId":10473,"totalSpendMs":790,"convertSpendMs":191,"createdTime":"2021-09-28 21:05:18","host":"us-024*","referer":"https://www.nginx.com/?p=67976","linkMd5ListStr":"4fe49f9bbbccd84c05cf4c899f295d27","githubUser":"myreaderx31","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"222.6 KB","destSize":"84.1 KB","compressRate":"37.8%"},{"code":1,"isDone":false,"source":"https://www.nginx.com/wp-content/uploads/2021/09/Grafana_Data-source-is-working.png","sourceStatusCode":200,"destWidth":1315,"destHeight":749,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx19/cdn14@2020_5/2021/09/28/13-05-24-920_0658fa6ecb38e134.webp","sourceBytes":66497,"destBytes":21846,"targetWebpQuality":75,"feedId":10473,"totalSpendMs":745,"convertSpendMs":42,"createdTime":"2021-09-28 21:05:24","host":"us-026*","referer":"https://www.nginx.com/?p=67976","linkMd5ListStr":"4fe49f9bbbccd84c05cf4c899f295d27","githubUser":"myreaderx19","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"64.9 KB","destSize":"21.3 KB","compressRate":"32.9%"}],"successGithubMap":{"myreaderx14":1,"myreaderx6":1,"myreaderx4":1,"myreaderx33":1,"myreaderx3":1,"myreaderx23":1,"myreaderx31":1,"myreaderx19":1},"failGithubMap":{}}