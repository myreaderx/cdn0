{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2021-07-25 18:59:17","updatedTime":"2021-07-25 18:59:17","title":"MySQL灵魂十连问","link":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+MySQL%E7%81%B5%E9%AD%82%E5%8D%81%E8%BF%9E%E9%97%AE","description":"<div><div><div id=\"media\" class=\"rich_media_thumb_wrp\">\n\n            <img class=\"rich_media_thumb\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_jpg/eZzl4LXykQxuKzgT3PibHib0BekmINBzLWA1d4xb0BUCry6FMVE1Q6KEqQk2Y7gULibI2K1qoMVJnXwvPEBkPibqfQ/0?wx_fmt=jpeg?imageView2/1/w/600\">\n        </div>\n    \n\n    \n\n    <div class=\"rich_media_content\" id=\"js_content\">\n                    \n\n                    \n                    \n                    \n                    <p style=\"text-align: left;\"><strong style=\"color: rgb(171, 25, 66);text-align: justify;\"><span style=\"font-size: 15px;text-align: left;\">1. SQL 语句执行流程</span></strong></p><section data-tool=\"mdnice编辑器\" data-website=\"https://www.mdnice.com\" style=\"white-space: normal;text-align: left;\"><p><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>MySQL 大体上可分为 Server 层和存储引擎层两部分。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p></section><h5 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>Server 层</span></strong></h5><p><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"white-space: normal;text-align: left;\"><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>连接器</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：TCP 握手后服务器来验证登陆用户身份，A用户创建连接后，管理员对A用户权限修改了也不会影响到已经创建的链接权限，必须重新登陆；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>查询缓存</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：查询后的结果存储位置，MySQL 8.0 版本以后已经取消，因为查询缓存失效太频繁，得不偿失；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>分析器</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：根据语法规则，判断你输入的这个 SQL 语句是否满足 MySQL 语法；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>优化器</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：多种执行策略可实现目标，系统自动选择最优进行执行；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>执行器</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：判断是否有权限，将最终任务提交到存储引擎。</span></section></li></ul><h5 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></h5><h5 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>存储引擎层</span></strong></h5><p><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>负责数据的存储和提取。其架构模式是插件式的，支持InnoDB、MyISAM、Memory等多个存储引擎。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>现在最常用的存储引擎是 InnoDB，它从 MySQL 5.5.5 版本开始成为了默认存储引擎（经常用的也是这个）。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.4267241379310345\" data-type=\"png\" data-w=\"1624\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscHYVe250B5pbSfZrbqeiatdwHkfBFbiaXibg8HicQqZD1ibaejYZnyg0jxEQ/640?wx_fmt=png\"></figure><h5 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>SQL执行顺序：</span></h5><p><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.29390018484288355\" data-type=\"png\" data-w=\"541\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscvL02EdeR3b0PK0icwria3VTqC15hyics1iaicuuz2KKUlVCZm4tDbRX1JtA/640?wx_fmt=png\"></figure><h3 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></h3><h3 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><strong style=\"color: rgb(171, 25, 66);text-align: justify;\"><span style=\"font-size: 15px;text-align: left;\">2. BinLog、RedoLog、UndoLog</span></strong></h3><h5 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></h5><h5 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><strong style=\"color: rgb(171, 25, 66);text-align: justify;\"><span style=\"font-size: 15px;text-align: left;\">2.1 BinLog</span></strong></h5><p><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>BinLog 是记录所有数据库表结构变更（例如 create、alter table）以及表数据修改（insert、update、delete）的二进制日志，主从数据库同步用到的都是 BinLog 文件。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>BinLog 日志文件有三种模式：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>STATEMENT 模式</span></strong></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"white-space: normal;text-align: left;\"><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>内容：binlog 只会记录可能引起数据变更的 SQL 语句；</span></p></li><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>优势：该模式下因为没有记录实际的数据，所以日志量和 IO 都消耗很低，性能是最优的；</span></p></li><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>劣势：但有些操作并不是确定的，比如 uuid() 函数会随机产生唯一标识，当依赖 binlog 回放时，该操作生成的数据与原数据必然是不同的，此时可能造成无法预料的后果。</span></p></li></ul><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>ROW 模式</span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></strong></p><ul class=\"list-paddingleft-2\" style=\"white-space: normal;text-align: left;\"><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>内容：在该模式下，binlog 会记录每次操作的源数据与修改后的目标数据，StreamSets 就要求该模式；</span></p></li><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>优势：可以绝对精准的还原，从而保证了数据的安全与可靠，并且复制和数据恢复过程可以是并发进行的；</span></p></li><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>劣势：缺点在于 binlog 体积会非常大。同时，对于修改记录多、字段长度大的操作来说，记录时性能消耗会很严重。阅读的时候也需要特殊指令来进行读取数据。</span></p></li></ul><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>MIXED 模式</span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></strong></p><ul class=\"list-paddingleft-2\" style=\"white-space: normal;text-align: left;\"><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>内容：是对上述 STATEMENT 跟 ROW  两种模式的混合使用；</span></p></li><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>细节：对于绝大部分操作，都使用 STATEMENT 来进行 binlog 的记录，只有以下操作使用 ROW 来实现：表的存储引擎为 NDB，使用了uuid() 等不确定函数，使用了 insert delay 语句，使用了临时表。</span></p></li></ul><p style=\"white-space: normal;text-align: left;\"><br></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><img data-ratio=\"0.41243523316062175\" data-type=\"png\" data-w=\"965\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscM2Fp9cfschice1hHVoTicZwJAfggMichIjt1rJnhqXSpWviaAR5BeiaaKTg/640?wx_fmt=png\"></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>主从同步流程：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ol class=\"list-paddingleft-2\" style=\"white-space: normal;text-align: left;\"><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>主节点必须启用二进制日志，记录任何修改了数据库数据的事件；</span></p></li><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>从节点开启一个线程（I/O Thread）把自己扮演成 MySQL 的客户端，通过 MySQL 协议，请求主节点的二进制日志文件中的事件 ；</span></p></li><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>主节点启动一个线程（dump Thread），检查自己二进制日志中的事件，跟对方请求的位置对比。如果不带请求位置参数，则主节点就会从第一个日志文件中的第一个事件一个一个发送给从节点；</span></p></li><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>从节点接收到主节点发送过来的数据把它放置到中继日志（Relay log）文件中。并记录该次请求到主节点的具体哪一个二进制日志文件内部的哪一个位置（主节点中的二进制文件会有多个）；</span></p></li><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>从节点启动另外一个线程（SQL Thread ），把 Relay log 中的事件读取出来，并在本地再执行一次。</span></p></li></ol><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>MySQL 默认的复制方式是异步的，并且复制的时候是有并行复制能力的。</span><span style=\"font-size: 15px;text-align: justify;\">主库把日志发送给从库后不管了。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\"><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\">这样会产生一个问题：假设主库挂了，从库处理失败了，这时候从库升为主库后，日志就丢失了。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\"><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\">由此产生两个概念：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\"><br></span></p><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>全同步复制</span></strong></section><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>主库写入 binlog 后强制同步日志到从库。所有的从库都执行完成后才返回给客户端，但是很显然这个方式的话性能会受到严重影响。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>半同步复制</span></strong></section><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>半同步复制的逻辑是这样，从库写入日志成功后返回 ACK 确认给主库，主库收到至少一个从库的确认就认为写操作完成。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>还可以延伸到由于主从配置不一样、主库大事务、从库压力过大、网络震荡等造成主备延迟。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>如何避免这个问题？</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>主备切换的时候用可靠性优先原则还是可用性优先原则？</span></p></li><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>如何判断主库Crash了？</span></p></li><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>互为主备情况下如何避免主备循环复制？</span></p></li><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>被删库跑路了如何正确恢复？</span></p></li></ul><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>感觉越来越扯到 DBA 的活儿上去了。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><img class=\"__bg_gif\" data-ratio=\"1\" data-type=\"gif\" data-w=\"200\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_gif/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscibMIov2IbEqK78yrVZjpMS5GW2NoqXOs5CB0ibVxDT0nzQ3DVUa2QAaA/640?wx_fmt=gif\"></p><h5 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></h5><h5 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><strong style=\"color: rgb(171, 25, 66);text-align: justify;\"><span style=\"font-size: 15px;text-align: left;\">2.2 RedoLog</span></strong></h5><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>可以先通过下面 Demo 理解：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>饭点记账可以把账单写在账本上也可以写在粉板上。有人赊账或者还账的话，一般有两种做法：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ol class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>直接把账本翻出来，把这次赊的账加上去或者扣除掉；</span></p></li><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>先在粉板上记下这次的账，等打烊以后再把账本翻出来核算。</span></p></li></ol><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>生意忙时选后者，因为前者太麻烦了。得在密密麻麻的记录中找到这个人的赊账总额信息，找到之后再拿出算盘计算，最后再将结果写回到账本上。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>同样，在 MySQL 中如果每一次的更新操作都需要写进磁盘，然后磁盘也要找到对应的那条记录然后再更新。</span><span style=\"font-size: 15px;text-align: justify;\">整个过程 IO 成本、查找成本都很高。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\"><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\">而粉板和账本配合的整个过程就是 MySQL 用到的是 Write-Ahead Logging 技术，它的关键点就是先写日志，再写磁盘。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\"><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\">此时账本 = BinLog，粉板 = RedoLog。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\"><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>记录更新时，InnoDB 引擎就会先把记录写到 RedoLog（粉板）里面，并更新内存。同时，InnoDB 引擎会在空闲时将这个操作记录更新到磁盘里面。</span></p></li><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify> 如果更新太多 RedoLog 处理不了的时候，需先将 RedoLog 部分数据写到磁盘，然后擦除 RedoLog 部分数据。RedoLog 类似转盘。</span></p></li></ul><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>RedoLog 有 write pos 跟 checkpoint</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>write pos ：是当前记录的位置，一边写一边后移，写到第3号文件末尾后就回到0号文件开头；</span></p></li><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>check point：是当前要擦除的位置，也是往后推移并且循环的，擦除记录前要把记录更新到数据文件。</span></p></li></ul><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>write pos 和 check point 之间的是粉板上还空着的部分，可以用来记录新的操作。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>如果 write pos 追上checkpoint 表示粉板满了，这时候不能再执行新的更新。得停下来先擦掉一些记录，把 checkpoint 推进一下。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>有了 <span style=\"font-size: 15px;\">RedoLog</span>，InnoDB 就可以保证即使数据库发生异常重启，之前提交的记录都不会丢失，这个能力称为 crash-safe。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><img data-ratio=\"1.010204081632653\" data-type=\"png\" data-w=\"392\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscgO7ico0mApLjNfetKfiaSRovhW0hzcciav2OEibI4vOBAHEQUwG0K1Dtmw/640?wx_fmt=png\"></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>RedoLog 两阶段提交：为了让binlog跟redolog两份日志之间的逻辑一致。提交流程大致为：</span><span style=\"font-size: 15px;text-align: justify;color: rgb(154, 154, 154);\">1 prepare阶段 -&gt;  2 写binlog  -&gt; 3 commit</span></p><p><br></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>当在 2 之前崩溃时，重启恢复后发现没有 commit，回滚。备份恢复：没有 binlog，一致；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>当在 3 之前崩溃时，重启恢复发现虽没有 commit，但满足 prepare 和 binlog 完整，所以重启后会自动 commit。备份：有 binlog 一致。</span></section></li></ul><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><span style=\"font-size: 15px;\">BinLog </span>与 <span style=\"font-size: 15px;\">RedoLog </span>区别：</span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></strong></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>RedoLog  是 InnoDB 引擎特有的。BinLog 是 MySQL 的 Server 层实现的，所有引擎都可以使用；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>RedoLog  是物理日志，记录的是在某个数据页上做了什么修改。BinLog 是逻辑日志，记录的是这个语句的原始逻辑。比如给 ID=2 这一行的c字段加 1；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>RedoLog  是循环写的，空间固定会用完。BinLog 是可以追加写入的。追加写是指 BinLog 文件写到一定大小后会切换到下一个，并不会覆盖以前的日志。</span></section></li></ul><section style=\"white-space: normal;text-align: left;\"><br></section><h5 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><strong style=\"color: rgb(171, 25, 66);text-align: justify;\"><span style=\"font-size: 15px;text-align: left;\">2.3 UndoLog</span></strong></h5><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>UndoLog 一般是逻辑日志，主要分为两种：</span></p><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></section><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>insert undo log</span></strong></section><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>代表事务在 insert 新记录时产生的 undo log，只在事务回滚时需要，并且在事务提交后可以被立即丢弃。</span></p><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></section><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>update undo log</span></strong></section><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></section><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>事务在进行 update 或 delete 时产生的 undo log。不仅在事务回滚时需要，在快照读时也需要。</span></p><p style=\"white-space: normal;text-align: left;\"><br></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>所以不能随便删除，只有在快速读或事务回滚不涉及该日志时，对应的日志才会被 purge 线程统一清除。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><h3 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><strong style=\"color: rgb(171, 25, 66);text-align: justify;\"><span style=\"font-size: 15px;text-align: left;\">3. MySQL中的索引</span></strong></h3><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>索引的常见模型有哈希表、有序数组和搜索树。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"white-space: normal;text-align: left;\"><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>哈希表：一种以 KV 存储数据的结构，只适合等值查询，不适合范围查询；</span></p></li><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>有序数组：只适用于静态存储引擎，涉及到插入的时候比较麻烦。可以参考 Java 中的 ArrayList；</span></p></li><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>搜索树：按照数据结构中的二叉树来存储数据，不过此时是 N 叉树（B+ 树）。广泛应用在存储引擎层中。</span></p></li></ul><p style=\"white-space: normal;text-align: left;\"><br></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><img data-ratio=\"0.33382789317507416\" data-type=\"png\" data-w=\"1348\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscSfuwG8dyJpNooFwiahEInRIJtRzLZribXCd7Kd2hR4DFib5bXkrt1mX1w/640?wx_fmt=png\"></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>B+ 树比 B 树优势在于：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"white-space: normal;text-align: left;\"><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>B+ 树非叶子节点存储的只是索引，可以存储的更多。B+ 树比B树更加矮胖，IO 次数更少；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>B+ 树叶子节点前后管理，更加方便范围查询。同时结果都在叶子节点，查询效率稳定；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>B+ 树中更有利于对数据扫描，可以避免 B 树的回溯扫描。</span></section></li></ul><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>索引的优点：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>唯一索引可以保证每一行数据的唯一性；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>提高查询速度；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>加速表与表的连接；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>显著的减少查询中分组和排序的时间；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>通过使用索引，可以在查询的过程中，使用优化隐藏器，提高系统的性能。</span></p></li></ul><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>索引的缺点：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>创建跟维护都需要耗时；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>创建索引时，需要对表加锁，在锁表的同时，可能会影响到其他的数据操作； </span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>索引需要磁盘的空间进行存储，磁盘占用也很快；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>当对表中的数据进行 CRUD 的时，也会触发索引的维护，而维护索引需要时间，可能会降低数据操作性能。</span></p></li></ul><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>索引设计的原则<strong>不应该</strong>：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>索引不是越多越好。索引太多，维护索引需要时间跟空间；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>频繁更新的数据，不宜建索引；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>数据量小的表没必要建立索引。</span></p></li></ul><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>应该：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ol class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>重复率小的列建议生成索引。因为重复数据少，索引树查询更有效率，等价基数越大越好；</span></p></li><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>数据具有唯一性，建议生成唯一性索引。在数据库的层面，保证数据正确性；</span></p></li><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>频繁group by、order by的列建议生成索引。可以大幅提高分组和排序效率；</span></p></li><li style=\"white-space: normal;text-align: left;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>经常用于查询条件的字段建议生成索引。通过索引查询，速度更快。</span></p></li></ol><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>索引失效的场景</span></strong></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>模糊搜索</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：左模糊或全模糊都会导致索引失效，比如 '%a' 和 '%a%'。但是右模糊是可以利用索引的，比如 'a%' ；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><strong>隐式类型转换</strong>：比如 select * from t where name = xxx , name 是字符串类型，但是没有加引号，所以是由 MySQL 隐式转换的，所以会让索引失效 3。当语句中带有 or 的时候：比如 select * from t where name=‘sw’ or age=14；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>不符合联合索引的最左前缀匹配</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：(A,B,C) 的联合索引，where 条件只处理了 C 或 B 或只有 B,C。</span></p></li></ul><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>关于索引的知识点</span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>主键索引</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：主键索引的叶子节点存的是整行数据信息。在 InnoDB 里，主键索引也被称为聚簇索引（clustered index）。主键自增是无法保证完全自增的哦，遇到唯一键冲突、事务回滚等都可能导致不连续；</span></p></li><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>唯一索引</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：以唯一列生成的索引，该列不允许有重复值，但允许有空值（NULL）；</span></p></li><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>普通索引跟唯一索引查询性能</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：InnoDB 的数据是按数据页为单位来读写的，默认每页 16KB，因此这两种索引查询数据性能差别微乎其微；</span></p></li><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>change buffer</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：普通索引用在更新过程的加速，更新的字段如果在缓存中，如果是普通索引则直接更新即可。如果是唯一索引需要将所有数据读入内存来确保不违背唯一性，所以尽量用普通索引；</span></p></li><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>非主键索引</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：非主键索引的叶子节点内容是主键的值。在 InnoDB 里，非主键索引也被称为二级索引（secondary index）；</span></p></li><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>回表</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：先通过数据库索引扫描出数据所在的行，再通过行主键id取出索引中未提供的数据，即基于非主键索引的查询需要多扫描一棵索引树；</span></p></li><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>覆盖索引</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：如果一个索引包含（或者说覆盖）所有需要查询的字段的值，我们就称之为覆盖索引；</span></p></li><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>联合索引</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：相对单列索引，组合索引是用多个列组合构建的索引，一次性最多联合 16 个；</span></p></li><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>最左前缀原则</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：对多个字段同时建立的组合索引（有顺序，ABC、ACB 是完全不同的两种联合索引）以联合索引（a,b,c）为例，建立这样的索引相当于建立了索引 a、ab、abc 三个索引。另外组合索引实际还是一个索引，并非真的创建了多个索引，只是产生的效果等价于产生多个索引；</span></p></li><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>索引下推</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：MySQL 5.6 引入了索引下推优化。可以在索引遍历过程中，对索引中包含的字段先做判断，过滤掉不符合条件的记录，减少回表次数；</span></p></li><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>索引维护</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：B+ 树为了维护索引有序性涉及到页分裂跟页合并。增删数据时需考虑页空间利用率。</span></p></li><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>自增主键</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：一般会建立与业务无关的自增主键，不会触发叶子节点分裂；</span></p></li><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>延迟关联</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：通过使用覆盖索引查询返回需要的主键，再根据主键关联原表获得需要的数据；</span></p></li><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>InnoDB 存储</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：* .frm 文件是一份定义文件，也就是定义数据库表是一张怎么样的表。*.ibd 文件则是该表的索引，数据存储文件，既该表的所有索引树，所有行记录数据都存储在该文件中；</span></p></li><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>MyISAM 存储</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：* .frm文件是一份定义文件，也就是定义数据库表是一张怎么样的表。* .MYD 文件是 MyISAM 存储引擎表的所有行数据的文件。* .MYI 文件存放的是 MyISAM 存储引擎表的索引相关数据的文件。MyISAM 引擎下，表数据和表索引数据是分开存储的；</span></p></li><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>MyISAM 查询</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：在 MyISAM 下，主键索引和辅助键索引都属于非聚簇索引。查询不管是走主键索引，还是非主键索引，在叶子结点得到的都是目的数据的地址，还需要通过该地址，才能在数据文件中找到目的数据。</span><span style=\"font-size: 15px;text-align: justify;\">PS：InnoDB </span><span style=\"font-size: 15px;text-align: justify;\">支持聚簇索引，MyISAM </span><span style=\"font-size: 15px;text-align: justify;\">不支持聚簇索引。</span></p></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></h3><h3 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><strong style=\"color: rgb(171, 25, 66);text-align: justify;\"><span style=\"font-size: 15px;text-align: left;\">4. SQL 事务隔离级别</span></strong></h3><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>ACID 四个特性</span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>原子性（Atomicity）</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：把多个操作放到一个事务中，保证这些操作要么都成功，要么都不成功；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>一致性（Consistency）</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：理解成一串对数据进行操作的程序执行下来，不会对数据产生不好的影响，比如凭空产生或消失；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>隔离性（Isolation，又称独立性）</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：隔离性的意思就是多个事务之间互相不干扰，即使是并发事务的情况下，他们只是两个并发执行没有交集，互不影响的东西；当然实现中，也不一定需要这么完整隔离性，即不一定需要这么的互不干扰，有时候还是允许有部分干扰的。所以 MySQL 可以支持 4 种事务隔离性；</span></section></li><li style=\"white-space: normal;text-align: left;\"><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>持久性（Durability）</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：当某个操作操作完毕了，那么结果就是这样了，并且这个操作会持久化到日志记录中。</span></section></li></ul><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>ACID 中 C 与 CAP 定理中 C 的区别</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 14px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify rgb>ACID 的 C 着重强调单数据库事务操作时，要保证数据的完整和正确性，数据不会凭空消失跟增加。CAP 理论中的 C 指的是对一个数据多个备份的读写一致性。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>事务操作可能会出现的数据问题</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>脏读（dirty read）</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：B 事务更改数据还未提交，A 事务已经看到并且用了。B 事务如果回滚，则 A 事务做错了 ；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>不可重复读（non-repeatable read）</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：不可重复读的重点是修改。同样的条件, 你读取过的数据，再次读取出来发现值不一样了。只需要锁住满足条件的记录 ；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>幻读（phantom read）</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：事务 A 先修改了某个表的所有纪录的状态字段为已处理，未提交；事务 B 也在此时新增了一条未处理的记录，并提交了；事务 A 随后查询记录，却发现有一条记录是未处理的造成幻读现象。幻读仅专指新插入的行。幻读会造成语义上的问题跟数据一致性问题；</span></p></li></ul><p><br></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>在可重复读 RR 隔离级别下，普通查询是快照读，是不会看到别的事务插入的数据的。因此，幻读在当前读下才会出现。要用间隙锁解决此问题。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>在说隔离级别之前，你首先要知道，你隔离得越严实，效率就会越低。因此很多时候，我们都要在二者之间寻找一个平衡点。SQL标准的事务隔离级别由低到高如下：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><img data-ratio=\"0.2463768115942029\" data-type=\"png\" data-w=\"966\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscgibd299HzibqpMOzBzuu53emIf8YzmicWjtB5StmmOm0NQyibYvehBEkHw/640?wx_fmt=png\"></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>上图从上到下的模式会导致系统的并行性能依次降低，安全性依次提高。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>读未提交</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：别人改数据的事务尚未提交，我在自己的事务中也能读到；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>读已提交（Oracle 默认）</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：别人改数据的事务已经提交，我在我的事务中才能读到；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>可重复读（MySQL 默认）</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：别人改数据的事务已经提交，我在我的事务中也不去读，以此保证重复读一致性；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>串行</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：我的事务尚未提交，别人就别想改数据。</span></p></li></ul><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>标准跟实现</span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>上面都是关于事务的标准，但是每一种数据库都有不同的实现，比如 MySQL InnDB 默认为 RR 级别，但是不会出现幻读。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>因为当事务A更新了所有记录的某个字段，此时事务A会获得对这个表的表锁，因为事务 A 还没有提交，所以事务 A 获得的锁没有释放。</span><span style=\"font-size: 15px;text-align: justify;\">此时事务 B </span><span style=\"font-size: 15px;text-align: justify;\">在该表插入新记录，会因为无法获得该表的锁，则导致插入操作被阻塞。</span><span style=\"font-size: 15px;text-align: justify;\">只有事务 </span><span style=\"font-size: 15px;text-align: justify;\">A 提交了事务后，释</span><span style=\"font-size: 15px;text-align: justify;\">放了锁，事务 B 才能进行接下去的操作。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>所以，可以说   MySQL 的 RR 级别的隔离是已经实现解决了脏读、不可重复读和幻读的。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><h3 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><strong style=\"color: rgb(171, 25, 66);text-align: justify;\"><span style=\"font-size: 15px;text-align: left;\">5. MySQL 中的锁</span></strong></h3><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>无论是 Java 的并发编程还是数据库的并发操作都会涉及到锁，研发人员引入了悲观锁跟乐观锁这样一种锁的设计思想。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>悲观锁</span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></strong></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>优点</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：适合在写多读少的并发环境中使用。虽然无法维持非常高的性能，但是在乐观锁无法提更好的性能前提下，可以做到数据的安全性；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>缺点</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：加锁会增加系统开销，虽然能保证数据的安全，但数据处理吞吐量低，不适合在读书写少的场合下使用。</span></p></li></ul><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>乐观锁</span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>优点</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：在读多写少的并发场景下，可以避免数据库加锁的开销，提高 DAO 层的响应性能，很多情况下 ORM 工具都有带有乐观锁的实现，所以这些方法不一定需要我们人为的去实现；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>缺点</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：在写多读少的并发场景下，即在写操作竞争激烈的情况下，会导致 CAS 多次重试，冲突频率过高，导致开销比悲观锁更高；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>实现</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：数据库层面的乐观锁其实跟 CAS 思想类似， 通数据版本号或者时间戳也可以实现。</span></p></li></ul><p style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>数据库并发场景主要有三种</span></strong></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>读-读</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：不存在任何问题，也不需要并发控制；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>读-写</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：有隔离性问题，可能遇到脏读、幻读、不可重复读；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>写-写</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：可能存更新丢失问题，比如第一类更新丢失，第二类更新丢失。</span></p></li></ul><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>两类更新丢失问题</span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>第一类更新丢失</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：事务A的事务回滚覆盖了事务 B 已提交的结果；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>第二类更新丢失</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：事务A的提交覆盖了事务 B 已提交的结果。</span></p></li></ul><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>为了合理贯彻落实锁的思想，MySQL 中引入了杂七杂八的各种锁：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.5758547008547008\" data-type=\"png\" data-w=\"936\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjsctpicK2QbzhGg3pLVsOag114l2sSmB649SgQD00AMWiaSf5eq76spIibOg/640?wx_fmt=png\"></figure><h5 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><span style=\"text-align: justify;color: rgb(136, 136, 136);font-size: 12px;\">锁分类</span></h5><p><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>MySQL支持三种层级的锁定，分别为：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>表级锁定</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：</span><span style=\"font-size: 15px;text-align: justify;\">MySQL 中锁定粒度最大的一种锁，最常使用的 MYISAM 与 INNODB 都支持表级锁定；</span></p></li><li><p><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>页级锁定</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：是 MySQ L中锁定粒度介于行级锁和表级锁中间的一种锁，表级锁速度快但冲突多，行级冲突少但速度慢。所以取了折衷的页级，一次锁定相邻的一组记录；</span></p></li><li><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>行级锁定</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：<span style=\"font-size: 15px;\">MySQL </span>中锁定粒度最细的一种锁，表示只针对当前操作的行进行加锁。行级锁能大大减少数据库操作的冲突。其加锁粒度最小，但加锁的开销也最大行级锁不一定比表级锁要好：锁的粒度越细，代价越高，相比表级锁在表的头部直接加锁，行级锁还要扫描找到对应的行对其上锁，这样的代价其实是比较高的，所以表锁和行锁各有所长。</span></section></li></ul><section style=\"white-space: normal;text-align: left;\"><br></section><h5 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>MyISAM 中的锁</span></strong></h5><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>虽然 MySQL 支持表、页、行三级锁定，但 MyISAM 存储引擎只支持表锁。所以MyISAM 的加锁相对比较开销低，但数据操作的并发性能相对就不高。但如果写操作都是尾插入，那还是可以支持一定程度的读写并发。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\"><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\">从 MyISAM 所支持的锁中也可以看出：MyISAM 是一个支持读读并发，但不支持通用读写并发，写写并发的数据库引擎，所以它更适合用于读多写少的应用场合，一般工程中也用的较少。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\"><br></span></p><h5 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>InnoDB 中的锁</span></strong></h5><p><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>该模式下支持的锁实在是太多了，具体如下：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>共享锁和排他锁 (Shared and Exclusive Locks)</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>意向锁（Intention Locks） </span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>记录锁（Record Locks） </span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>间隙锁（Gap Locks） </span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>临键锁 （Next-Key Locks） </span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>插入意向锁（Insert Intention Locks） </span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>主键自增锁 (AUTO-INC Locks) </span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>空间索引断言锁（Predicate Locks for Spatial Indexes）</span></p></li></ul><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>举个栗子，比如行锁里的共享锁跟排它锁 lock in share modle 共享读锁：</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>为了确保自己查到的数据没有被其他的事务正在修改，也就是说确保查到的数据是最新的数据，并且不允许其他人来修改数据。</span></p><p style=\"white-space: normal;text-align: left;\"><br></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>但是自己不一定能够修改数据，因为有可能其他的事务也对这些数据使用了 in share mode 的方式上了 S 锁。如果不及时的 commit 或者 rollback 也可能会造成大量的事务等待。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>for update 排它写锁</span></strong></p><p style=\"white-space: normal;text-align: left;\"><br></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>为了让自己查到的数据确保是最新数据，并且查到后的数据只允许自己来修改的时候，需要用到 for update。相当于一个 update 语句。</span></p><p style=\"white-space: normal;text-align: left;\"><br></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>在业务繁忙的情况下，如果事务没有及时的 commit 或者 rollback 可能会造成其他事务长时间的等待，从而影响数据库的并发使用效率。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify rgb><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>Gap Lock 间隙锁</span></strong></p><p style=\"white-space: normal;text-align: left;\"><br></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>行锁只能锁住行，如果在记录之间的间隙插入数据就无法解决了。因此 MySQL 引入了间隙锁（Gap Lock）。间隙锁是左右开区间。间隙锁之间不会冲突。</span></p><p style=\"white-space: normal;text-align: left;\"><br></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>间隙锁和行锁合称 NextKeyLock，每个 NextKeyLock 是前开后闭区间。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify rgb><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>间隙锁加锁原则</span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><ol class=\"list-paddingleft-2\" style=\"list-style-type: decimal;\"><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>加锁的基本单位是 NextKeyLock，是前开后闭区间；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>查找过程中访问到的对象才会加锁；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>索引上的等值查询，给唯一索引加锁的时候，NextKeyLock 退化为行锁；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>索引上的等值查询，向右遍历时且最后一个值不满足等值条件的时候，NextKeyLock 退化为间隙锁；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>唯一索引上的范围查询会访问到不满足条件的第一个值为止。</span></p></li></ol><h3 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></h3><h3 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><br></h3><h3 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><strong style=\"color: rgb(171, 25, 66);text-align: justify;\"><span style=\"font-size: 15px;text-align: left;\">6. MVCC</span></strong></h3><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>MVCC </span><span style=\"font-size: 15px;text-align: justify;\">全称 Multi-Version Concurrency Control，即多版本并发控制。MVCC是一种并发控制的理念，维持一个数据的多个版本，使得读写操作没有冲突。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\"><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>MVCC 在 MySQL InnoDB 中实现目的主要是为了提高数据库并发性能，用更好的方式去处理读写冲突。</span><span style=\"font-size: 15px;text-align: justify;\">做到即使有读写冲突时</span><span style=\"font-size: 15px;text-align: justify;\">，也能做到不加锁，非阻塞并发读。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\"><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>MySQL InnoDB 下的当前读和快照读</span></strong></p><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></section><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>当前读</span></strong></section><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></section><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>像 select lock in share mode（共享锁）、select for update 、update、insert、delete（排他锁）这些操作都是一种当前读。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>就是它读取的是记录的最新版本，读取时还要保证其他并发事务不能修改当前记录，会对读取的记录进行加锁。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>当前读可以认为是悲观锁的具体功能实现。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>快照读</span></strong></section><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></strong></section><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>不加锁的 select 就是快照读，即不加锁的非阻塞读。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>快照读的前提是隔离级别不是串行级别，串行级别下的快照读会退化成当前读。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>之所以出现快照读的情况，是基于提高并发性能的考虑，快照读的实现是基于多版本并发控制，即 MVCC。</span><span style=\"font-size: 15px;text-align: justify;\">可以认为 MVCC 是行锁的一个变种</span><span style=\"font-size: 15px;text-align: justify;\">。</span><span style=\"font-size: 15px;text-align: justify;\">但它在很多情况下，避免了加锁操作，降低了开销</span><span style=\"font-size: 15px;text-align: justify;\">。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>既然是基于多版本，即快照读可能读到的并不一定是数据的最新版本，而有可能是之前的历史版本。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>快照读就是 MVCC 思想在 MySQL 的具体非阻塞读功能实现。MVCC 的目的就是为了实现读写冲突不加锁，提高并发读写性能。而这个读指的就是快照读。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>快照读就是 MySQL 为我们实现 MVCC 理想模型的其中一个具体非阻塞读功能。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>因为大佬不满意只让数据库采用悲观锁这样性能不佳的形式去解决读写冲突问题，因此提出了 MVCC，所以我们可以形成两个组合：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>MVCC + 悲观锁：MVCC解决读写冲突，悲观锁解决写写冲突；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>MVCC + 乐观锁：MVCC解决读写冲突，乐观锁解决写写冲突。</span></p></li></ul><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><h5 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>MVCC 的实现原理</span></strong></h5><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>MVCC 实现原理主要是依赖记录中的 四个隐式字段、undo日志 、Consistent Read View 来实现的。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>四个隐式字段</span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ol data-tool=\"mdnice编辑器\" class=\"list-paddingleft-2\" style=\"white-space: normal;text-align: left;\"><li style=\"white-space: normal;text-align: left;font-size: 15px;\"><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>DB_TRX_ID</span></span></strong><span style=\"font-size: 15px;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：</span><span style=\"text-align: justify;\">6 byte，最近修改（修改/插入）事务 ID。记录创建这条记录/最后一次修改该记录的事务ID；</span></span></section></li><li style=\"white-space: normal;text-align: left;font-size: 15px;\"><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>DB_ROLL_PTR</span></span></strong><span style=\"font-size: 15px;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：</span><span style=\"text-align: justify;\">7 byte，回滚指针。指向这条记录的上一个版本（存储于 rollback segment 里）；</span></span></section></li><li style=\"white-space: normal;text-align: left;font-size: 15px;\"><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>DB_ROW_ID</span></span></strong><span style=\"font-size: 15px;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：</span><span style=\"text-align: justify;\">6 byte，隐含的自增ID（隐藏主键）。如果数据表没有主键，InnoDB 会自动以 DB_ROW_ID 产生一个聚簇索引；</span></span></section></li><li style=\"white-space: normal;text-align: left;font-size: 15px;\"><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>FLAG</span></span></strong><span style=\"font-size: 15px;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：</span><span style=\"font-size: 15px;text-align: justify;\">一个删除 flag 隐藏字段, 既记录被更新或删除并不代表真的删除，而是删除 flag 变了。</span></span></section></li></ol><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>事务对一条记录的修改，会导致该记录的 undo log 成为一条记录版本线性表（链表）， undo log 的链首就是最新的旧记录，链尾就是最早的旧记录。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>undo 日志</span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>此知识点上文已经说过了，对 MVCC 有帮助的实质是 update undo log。undo log 实际上就是存在 rollback segment 中旧记录链。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>一致读视图 Consistent Read View：Read View 是事务进行快照读操作的时候生产的读视图（Read View）。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>在该事务执行的快照读的那一刻，会生成数据库系统当前的一个快照，记录并维护系统当前活跃事务的 ID。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>InnoDB 里面每个事务有一个唯一的事务 ID，叫作 transaction id。它是在事务开始的时候向InnoDB的事务系统申请的，是按申请顺序严格递增的。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>拿着这个 ID 跟记录中 ID 对比进行选择性展示，这里说下大致的思路。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>你可以简单的理解为 MVCC 为每一行增加了两个隐藏字段，两个字段分别保存了这个行的当前事务 ID 跟行的删除事务 ID。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>insert</span></strong></section><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></section><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\">InnoDB 为新插入的每一行保存当前系统版本号作为版本号。</span></section><section style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\"><br></span></section><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>select</span></strong></section><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>InnoDB 只会查找版本早于当前事务版本的数据行，也就是行的系统版本号 &lt;= 事务的系统版本号。这样可以确保事务读取的行，要么是在事务开始前已经存在的，要么是事务自身插入或者修改过的。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>行的删除版本要么未定义，要么大于当前事务版本号，这可以确保事务读取到的行在事务开始之前未被删除。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>只有同时满足<span style=\"font-size: 15px;\">上述条件</span>的记录，才能返回作为查询结果。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>delete</span></strong></section><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></strong></section><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>InnoDB 会为删除的每一行保存当前系统的版本号（事务的 ID）作为删除标识。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>update</span></strong></section><section style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></strong></section><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>InnoDB 执行 update，实际上是新插入了一行记录，并保存其创建时间为当前事务的ID。同时保存当前事务 ID 到要 update 的行的删除时间。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>上面只是一个浅显的讲解 MVCC 选择标准流程，源码层面应该是根据低水位跟高水位来截取的。具体实现可自行搜索。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>重点</span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>事务中快照读的结果是非常依赖该事务首次出现快照读的地方，即某个事务中首次出现快照读的地方非常关键，它有决定该事务后续快照读结果的能力。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>在 RC 隔离级别下，是每个快照读都会生成并获取最新的 Read View；而在 RR 隔离级别下，则是同一个事务中的第一个快照读才会创建 Read View，之后的快照读获取的都是同一个 Read View。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><h3 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><strong style=\"color: rgb(171, 25, 66);text-align: justify;\"><span style=\"font-size: 15px;text-align: left;\">7. 缓冲池（buffer pool）</span></strong></h3><p><strong style=\"color: rgb(171, 25, 66);text-align: justify;\"><span style=\"font-size: 15px;text-align: left;\"><br></span></strong></p><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;max-width: 100%;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \" pingfang sc cambria cochin georgia times new roman serif left normal rgb flex column center border-box break-word><img data-ratio=\"0.8301886792452831\" data-type=\"png\" data-w=\"795\" style=\"text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscwkxt1Y5ib3BSgkZNLK9bRkS9vrWMJvGibJkM2MhPuqG15fWzzDt92zibw/640?wx_fmt=png\"></figure><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>应用系统分层架构，为了加速数据访问会把最常访问的数据，放在缓存（cache）里，避免每次都去访问数据库。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>操作系统会有缓冲池（buffer pool）机制，避免每次访问磁盘，以加速数据的访问。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>MySQL 作为一个存储系统，同样具有缓冲池（buffer pool）机制，以避免每次查询数据都进行磁盘 IO。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>主要作用</span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>存在的意义是加速查询；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>缓冲池（buffer pool）是一种常见的降低磁盘访问的机制；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>缓冲池通常以页（page 16K）为单位缓存数据；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>缓冲池的常见管理算法是 LRU，memcache、OS、InnoDB 都使用了这种算法；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>InnoDB 对普通 LRU 进行了优化：将缓冲池分为老生代和新生代。入缓冲池的页优先进入老生代，该页被访问才进入新生代，以解决预读失效的问题页被访问。且在老生代停留时间超过配置阈值的，才进入新生代。以解决批量数据访问，大量热数据淘汰的问题。</span></p></li></ul><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>预读失效</span></strong></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>由于预读（Read-Ahead）提前把页放入了缓冲池，但最终 MySQL 并没有从页中读取数据，称为预读失效。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><img data-ratio=\"0.38961038961038963\" data-type=\"png\" data-w=\"385\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscH7qKU8no7yicMLJWPSXnLhlsyPDRMJpx4udB5329PPFhicsRx2gLWNng/640?wx_fmt=png\"></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>缓冲池污染</span></strong></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>当某一个 SQL 语句，要批量扫描大量数据时可能导致把缓冲池的所有页都替换出去，进而导致大量热数据被换出，MySQL性能急剧下降，这种情况叫缓冲池污染。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>解决办法：加入老生代停留时间窗口策略后，短时间内被大量加载的页，并不会立刻插入新生代头部，而是优先淘汰那些，短期内仅仅访问了一次的页。</span></p><p style=\"text-align: left;\"><br></p><h3 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><strong style=\"color: rgb(171, 25, 66);text-align: justify;\"><span style=\"font-size: 15px;text-align: left;\">8. table 瘦身</span></strong></h3><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>空洞</span></strong></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>MySQL 执行 delete 命令其实只是把记录的位置或者数据页标记为了可复用，但磁盘文件的大小是不会变的。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>通过 delete 命令是不能回收表空间的。这些可以复用而没有被使用的空间，看起来就像是空洞。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>插入时候引发分裂同样会产生空洞。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>重建表思路</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ol class=\"list-paddingleft-2\" style=\"list-style-type: decimal;\"><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>新建一个跟 A 表结构相同的表B；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>按照主键 ID 将 A 数据一行行读取同步到表 B；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>用表 B 替换表 A 实现效果上的瘦身。</span></p></li></ol><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>重建表指令</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><strong style=\"font-size: 15px;white-space: normal;\">慎用 </strong>alter table A engine=InnoDB ，牛逼的 DBA 都用下面的开源工具。</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>推荐 GitHub：gh-ost。</span></p></li></ul><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><h3 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><strong style=\"color: rgb(171, 25, 66);text-align: justify;\"><span style=\"font-size: 15px;text-align: left;\">9. SQL Joins、统计、 随机查询</span></strong></h3><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>7 种 join</span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: center;\"><img data-ratio=\"0.6955056179775281\" data-type=\"jpeg\" data-w=\"890\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_jpg/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscBH6nUzNykh2yuJfMELtlfeGgesc6GYwsmeNFkV67uXWHp7n3q7EImg/640?wx_fmt=jpeg\"></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>统计</span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ol class=\"list-paddingleft-2\" style=\"list-style-type: decimal;\"><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>MyISAM 模式下把一个表的总行数存在了磁盘上，直接拿来用即可；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>InnoDB 引擎由于 MVCC 的原因，需要把数据读出来然后累计求和 ；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>性能由坏到好：count(字段) &lt; count(主键id) &lt; count(1) ≈ count(*)。尽量用count(*)即可。</span></p></li></ol><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>随机查询</span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></strong></p><section class=\"code-snippet__fix code-snippet__js\"><ul class=\"code-snippet__line-index code-snippet__js\"><li></ul><pre class=\"code-snippet__js\" data-lang=\"cs\"><code><span class=\"code-snippet_outer\">mysql&gt; <span class=\"code-snippet__function\"><span class=\"code-snippet__keyword\">select</span> word <span class=\"code-snippet__keyword\">from</span> words order <span class=\"code-snippet__keyword\">by</span> <span class=\"code-snippet__title\">rand</span>(<span class=\"code-snippet__params\"></span>) limit 3</span>;</span></code></pre></section><pre data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></pre><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>直接使用 order by rand()。</span><span style=\"font-size: 15px;text-align: justify;\">explain</span><span style=\"font-size: 15px;text-align: justify;\"> 这个语句发现需要 Using temporary 和 Using filesort，查询的执行代价往往是比较大的。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>在设计的时要避开这种写法。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><section class=\"code-snippet__fix code-snippet__js\"><ul class=\"code-snippet__line-index code-snippet__js\"><li><li><li><li><li><li><li></ul><pre class=\"code-snippet__js\" data-lang=\"css\"><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__selector-tag\">mysql</span>&gt; <span class=\"code-snippet__selector-tag\">select</span> <span class=\"code-snippet__selector-tag\">count</span>(*) <span class=\"code-snippet__selector-tag\">into</span> @<span class=\"code-snippet__keyword\">C</span> from t;</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__selector-tag\">set</span> @<span class=\"code-snippet__keyword\">Y1</span> = floor(@C * rand());</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__selector-tag\">set</span> @<span class=\"code-snippet__keyword\">Y2</span> = floor(@C * rand());</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__selector-tag\">set</span> @<span class=\"code-snippet__keyword\">Y3</span> = floor(@C * rand());</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__selector-tag\">select</span> * <span class=\"code-snippet__selector-tag\">from</span> <span class=\"code-snippet__selector-tag\">t</span> <span class=\"code-snippet__selector-tag\">limit</span> @<span class=\"code-snippet__keyword\">Y1</span>,<span class=\"code-snippet__keyword\">1</span>; </span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__selector-tag\">select</span> * <span class=\"code-snippet__selector-tag\">from</span> <span class=\"code-snippet__selector-tag\">t</span> <span class=\"code-snippet__selector-tag\">limit</span> @<span class=\"code-snippet__keyword\">Y2</span>,<span class=\"code-snippet__keyword\">1</span>;</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__selector-tag\">select</span> * <span class=\"code-snippet__selector-tag\">from</span> <span class=\"code-snippet__selector-tag\">t</span> <span class=\"code-snippet__selector-tag\">limit</span> @<span class=\"code-snippet__keyword\">Y3</span>,<span class=\"code-snippet__keyword\">1</span>;</span></code></pre></section><pre data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></pre><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>这样可以避免临时表跟排序的产生，最终查询行数 = C + (Y1+1) + (Y2+1) + (Y3+1)</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>exist 和 in 对比：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>in 查询时首先查询子查询的表，然后将内表和外表做一个笛卡尔积，然后按照条件进行筛选；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>子查询使用 exists 会先进行主查询。将查询到的每行数据循环带入子查询校验是否存在，过滤出整体的返回数据；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>两表大小相当，in 和 exists 差别不大。内表大的时候，用 exists 效率较高；内表小的时候，用 in 效率较高；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>查询用 not in 那么内外表都进行全表扫描，没有用到索引；而 not exists 的子查询依然能用到表上的索引。not exists 比 not in 要快。</span></p></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></h3><h3 data-tool=\"mdnice编辑器\" style=\"text-align: left;\"><strong style=\"color: rgb(171, 25, 66);text-align: justify;\"><span style=\"font-size: 15px;text-align: left;\">10. MySQL 优化</span></strong></h3><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>SQL 优化主要分 4 个方向：SQL 语句跟索引、表结构、系统配置、硬件。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>总优化思路就是<strong>最大化利用索引、尽可能避免全表扫描、减少无效数据的查询</strong>：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>减少数据访问</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：设置合理的字段类型，启用压缩，通过索引访问等减少磁盘 IO；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>返回更少的数据</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：只返回需要的字段和数据分页处理，减少磁盘 IO 及网络 IO；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><strong>减少交互次数</strong>：批量 DML 操作，函数存储等减少数据连接次数；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><strong>减少服务器 CPU 开销</strong>：尽量减少数据库排序操作以及全表查询，减少 CPU 内存占用 ；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><strong>分表分区</strong>：使用表分区，可以增加并行操作，更大限度利用 CPU 资源。</span></p></li></ul><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>SQL 语句优化举例：</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>合理建立覆盖索引：可以有效减少回表；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>union、or、in都能命中索引，建议使用 in；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>负向条件 !=、&lt;&gt;、not in、not exists、not like 等不会使用索引，建议用 in；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>在列上进行运算或使用函数会使索引失效，从导致行全表扫描 ；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>小心隐式类型转换，原字符串用整型会触发CAST函数导致索引失效。原int用字符串则会走索引；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>不建议使用 % 前缀模糊查询；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>多表关联查询时，小表在前大表在后。在 MySQL 中，执行 from 后的表关联查询是从左往右执行的（Oracle <strong>相反</strong>）。第一张表会涉及到全表扫描；</span></p></li><li><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>调整 where 字句中的连接顺序。MySQL 采用从左往右，自上而下的顺序解析</span><span style=\"font-size: 15px;text-align: justify;\">where 子句。</span><span style=\"font-size: 15px;text-align: justify;\">根据这个原理，应将过滤数据多的条件往前放，最快速度缩小结果集。</span></p></li></ul><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\"><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>SQL 调优大致思路</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ol class=\"list-paddingleft-2\" style=\"list-style-type: decimal;\"><li style=\"font-size: 15px;\"><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>先用慢查询日志定位具体需要优化的 SQL； </span></p></li><li><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>使用 </span><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>explain</span><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify> 执行计划查看索引使用情况；</span></p></li><li style=\"font-size: 15px;\"><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>重点关注：一般情况下根据这 4 列就能找到索引问题。</span><span style=\"text-align: justify;\">key 查看有没有使用索引，key_len 查看索引使用是否充分，type 查看索引类型，Extra 查看附加信息。包括排序、临时表、where 条件为 false 等；</span></span></p></li><li style=\"font-size: 15px;\"><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>根据上一步找出的索引问题优化 SQL；</span></p></li><li style=\"font-size: 15px;\"><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>再回到第 2 步。</span></p></li></ol><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: center;\"><img data-ratio=\"1.1130434782608696\" data-type=\"png\" data-w=\"920\" style=\"white-space: normal; text-align: left; max-width: 600px\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscXslQAiaAsl3icFLPfJiaRfcCC4VXlOVv5gAhuvEbS7AbzjG6KjTUx5Fhw/640?wx_fmt=png\"></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>表结构优化</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ol class=\"list-paddingleft-2\" style=\"list-style-type: decimal;\"><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>尽量使用 TINYINT、SMALLINT、MEDIUM_INT 作为整数类型而非 INT，如果非负则加上 UNSIGNED；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>VARCHAR 的长度只分配真正需要的空间；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>尽量使用 TIMESTAMP 而非 DATETIME；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>单表不要有太多字段，建议在 20 以内；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>避免使用 NULL 字段，很难查询优化且占用额外索引空间。字符串默认为''。</span></p></li></ol><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>读写分离</span></strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>只在主服务器上写，只在从服务器上读。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>对应到数据库集群一般都是一主一从、一主多从。业务服务器把需要写的操作都写到主数据库中，读的操作都去从库查询。</span><span style=\"font-size: 15px;text-align: justify;\">主库会同步数据到从库保证数据的一致性。</span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;text-align: justify;\"><br></span></p><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>一般读写分离的实现方式有两种，代码封装与数据库中间件。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>分库分表</span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>分库分表分为垂直和水平两个方式，一般是先垂直后水平。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ol class=\"list-paddingleft-2\" style=\"list-style-type: decimal;\"><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>垂直分库</span></strong><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：将应用分为若干模块，比如订单模块、用户模块、商品模块、支付模块等等。其实就是微服务的理念；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>垂直分表</span></strong><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：一般将不常用字段跟数据较大的字段做拆分；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>水平分表</span></strong><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：根据场景选择什么字段作分表字段，比如淘宝日订单 1000 万，用 userId 作分表字段。数据查询支持到最近 6 个月的订单，超过 6 个月的做归档处理，那么 6 个月的数据量就是 18 亿，分 1024 张表，每个表存 200W 数据，hash(userId )% 100 找到对应表格；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>ID 生成器</span></strong><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>：分布式 ID 需要跨库全局唯一方便查询存储-检索数据，确保唯一性跟数字递增性。</span></p></li></ol><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><br></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>目前主要流行的分库分表工具 就是 MyCat 和 sharding-sphere。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><strong><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>TiDB</span></strong></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>开源分布式数据库，结合了传统的 RDBMS 和 NoSQL 的最佳特性。TiDB 兼容 MySQL，支持无限的水平扩展，具备强一致性和高可用性。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>TiDB 的目标是为 OLTP（Online Transactional Processing） 和 OLAP（Online Analytical Processing）场景提供一站式的解决方案。</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>TiDB 具备如下<strong>核心特点</strong></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ol class=\"list-paddingleft-2\" style=\"list-style-type: decimal;\"><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>支持 MySQL 协议（开发接入成本低）；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>100% 支持事务（数据一致性实现简单、可靠）；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>无限水平拓展（不必考虑分库分表）不停服务；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>TiDB 支持和 MySQL 的互备；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>遵循 JDBC 原则，学习成本低、强关系型、强一致性，不用担心主从配置，不用考虑分库分表，还可以无缝动态扩展。</span></p></li></ol><p style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>适合</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ol class=\"list-paddingleft-2\" style=\"list-style-type: decimal;\"><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>原业务的 MySQL 的业务遇到单机容量或者性能瓶颈时，可以考虑使用 TiDB 无缝替换 MySQL；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>大数据量下，MySQL 复杂查询很慢；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>大数据量下，数据增长很快，接近单机处理的极限，不想分库分表或者使用数据库中间件等对业务侵入性较大、对业务有约束的 Sharding 方案；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>大数据量下，有高并发实时写入、实时查询、实时统计分析的需求。</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>有分布式事务、多数据中心的数据 100% 强一致性、auto-failover 的高可用的需求。</span></p></li></ol><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>不适合</span></p><p data-tool=\"mdnice编辑器\" style=\"white-space: normal;text-align: left;\"><span style=\"font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify><br></span></p><ol class=\"list-paddingleft-2\" style=\"list-style-type: decimal;\"><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>单机 MySQL 能满足的场景也用不到 TiDB；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>数据条数少于 5000w 的场景下通常用不到 TiDB，TiDB 是为大规模的数据场景设计的；</span></p></li><li style=\"font-size: 15px;\"><p style=\"white-space: normal;text-align: left;\"><span style=\"font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, \" helvetica neue sc sans gb yahei ui arial sans-serif justify>如果你的应用数据量小（所有数据千万级别行以下），且没有高可用、强一致性或者多数据中心复制等要求，那么就不适合使用 TiDB。</span></p></li></ol><p style=\"white-space: normal;\"><span style=\"font-size: 15px;\"></span></p><p style=\"white-space: normal;text-align: center;\"><br></p><p style=\"white-space: normal;text-align: center;\"><span style=\"font-size: 15px;color: rgb(136, 136, 136);\">- EOF -</span></p><section donone=\"shifuMouseDownCard('shifu_c_030')\" label=\"Copyright Reserved by PLAYHUDONG.\" style=\"margin-top: 1em;margin-bottom: 1em;white-space: normal;text-align: start;max-width: 100%;caret-color: rgb(0, 0, 0);color: rgb(0, 0, 0);border-width: 0px;border-style: initial;border-color: initial;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><section style=\"margin-left: 1em;max-width: 100%;line-height: 1.4;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"padding: 3px 8px;max-width: 100%;border-radius: 4px;color: rgb(255, 255, 255);background-color: rgb(255, 105, 31);font-family: inherit;text-align: inherit;text-decoration: inherit;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">推荐阅读</span>  <span style=\"margin-left: 4px;padding: 3px 8px;max-width: 100%;border-radius: 1.2em;color: rgb(255, 255, 255);line-height: 1.2;background-color: rgb(204, 204, 204);font-family: inherit;text-align: inherit;text-decoration: inherit;border-color: rgb(249, 110, 87);font-size: 12px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">点击标题可跳转</span></section><section style=\"margin-top: -11px;padding: 22px 16px 16px;max-width: 100%;border-width: 1px;border-style: solid;border-color: rgb(255, 105, 31);color: rgb(51, 51, 51);font-size: 1em;font-family: inherit;text-align: inherit;text-decoration: inherit;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><p style=\"max-width: 100%;min-height: 1em;line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"text-decoration: underline;font-size: 13px;\">1、<a target=\"_blank\" href=\"http://mp.weixin.qq.com/s?__biz=MjM5NzMyMjAwMA==&amp;mid=2651496381&amp;idx=1&amp;sn=ff43c8b525210b67a87892b5f799f59d&amp;chksm=bd25f3c28a527ad4650a28774f3bdbfd26e931243461a339ed2b67d172457068a6d9d2abe45a&amp;scene=21#wechat_redirect\" data-itemshowtype=\"11\" tab=\"innerlink\" data-linktype=\"2\">35 张图带你 MySQL 调优</a></span></p><p style=\"max-width: 100%;min-height: 1em;line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"text-decoration: underline;font-size: 13px;\">2、<a target=\"_blank\" href=\"http://mp.weixin.qq.com/s?__biz=MjM5NzMyMjAwMA==&amp;mid=2651495976&amp;idx=2&amp;sn=c2f18cab0069840902df30fab279a80d&amp;chksm=bd25f2578a527b418b576e7cb5849091de8e753bd6c2f2b2193d46f525bae931f9d7330bd83d&amp;scene=21#wechat_redirect\" data-itemshowtype=\"0\" tab=\"innerlink\" data-linktype=\"2\">MySQL 中的反斜杠 \\\\，真是太坑了！！</a></span></p><p style=\"max-width: 100%;min-height: 1em;line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"text-decoration: underline;font-size: 13px;\">3、<a target=\"_blank\" href=\"http://mp.weixin.qq.com/s?__biz=MjM5NzMyMjAwMA==&amp;mid=2651494789&amp;idx=1&amp;sn=93d7139f9af298c74a6c7a39c5558832&amp;chksm=bd25f5fa8a527cecbbec34ff716deabcb829e9573f88a3ed87d739a575cfb9bb3f1e908c869c&amp;scene=21#wechat_redirect\" data-itemshowtype=\"0\" tab=\"innerlink\" data-linktype=\"2\">MySQL性能篇：索引、锁、事务、分库分表如何撑起亿级数据</a></span></p></section></section><p style=\"white-space: normal;caret-color: rgb(0, 0, 0);color: rgb(0, 0, 0);text-align: start;max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><br></p><p style=\"white-space: normal;text-align: center;\"><span style=\"max-width: 100%;font-size: 14px;color: rgb(255, 169, 0);box-sizing: border-box !important;overflow-wrap: break-word !important;\">看完本文有收获？请转发分享给更多人</span><br></p><p style=\"white-space: normal;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><strong style=\"max-width: 100%;color: rgb(255, 169, 0);box-sizing: border-box !important;overflow-wrap: break-word !important;\">关注「ImportNew」，提升Java技能</strong></p><p style=\"white-space: normal;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><img data-ratio=\"0.9166666666666666\" data-s=\"300,640\" data-type=\"jpeg\" data-w=\"600\" style=\"box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 600px !important; max-width: 600px\" width=\"auto\" src=\"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/2A8tXicCG8ylbWIGfdoDED35IRRySQZTXUkJ1eop9MHApzFibKnOo0diboXpl0rmS5mH78YJhsWQv0dhv718A6kUA/640?wx_fmt=jpeg\"></p><p style=\"white-space: normal;text-align: right;\"><span style=\"max-width: 100%;font-family: -apple-system-font, system-ui, \" helvetica neue sc sans gb yahei ui arial sans-serif center break-word border-box>点赞和在看就是最大的支持❤️</span></p><p><br></p><p><br></p>\n                </div>\n\n    \n    <br>\n\n    \n        <a target=\"_blank\" href=\"http://mp.weixin.qq.com/s?__biz=MjM5NzMyMjAwMA==&amp;mid=2651497617&amp;idx=1&amp;sn=b93ace61f2aa5dadd8b514edb0255511&amp;chksm=bd25c8ee8a5241f8c110266d68c49853dfdd3f7de48730803d4acca6ec83ffa297c8972f922b&amp;scene=0#rd\" style=\"color: blue\" class=\"media_tool_meta meta_primary\">原文</a>\n        <br>\n    \n\n    \n\n    <img alt=\"\" width=\"1px\" height=\"1px\" class=\"\" style=\"width:1px;height:1px;display:none\" src=\"http://www.jintiankansha.me/rss_static/11757/XplMqHvvWU\"></div></div>","descriptionType":"html","publishedDate":"Sat, 24 Jul 2021 03:30:00 +0000","feedId":2521,"bgimg":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_jpg/eZzl4LXykQxuKzgT3PibHib0BekmINBzLWA1d4xb0BUCry6FMVE1Q6KEqQk2Y7gULibI2K1qoMVJnXwvPEBkPibqfQ/0?wx_fmt=jpeg?imageView2/1/w/600","linkMd5":"f3a8a96fb2bf35cdeb7f5a534d3a6931","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx3/cdn43@2020_3/2021/07/25/10-59-44-290_f7f324d77fee5319.webp","destWidth":751,"destHeight":319,"sourceBytes":30236,"destBytes":21658,"author":"","articleImgCdnMap":{"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_jpg/eZzl4LXykQxuKzgT3PibHib0BekmINBzLWA1d4xb0BUCry6FMVE1Q6KEqQk2Y7gULibI2K1qoMVJnXwvPEBkPibqfQ/0?wx_fmt=jpeg?imageView2/1/w/600":"https://cdn.jsdelivr.net/gh/myreaderx3/cdn43@2020_3/2021/07/25/10-59-44-290_f7f324d77fee5319.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscHYVe250B5pbSfZrbqeiatdwHkfBFbiaXibg8HicQqZD1ibaejYZnyg0jxEQ/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx27/cdn99@2020_2/2021/07/25/10-59-51-311_679e4143191f7d08.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscvL02EdeR3b0PK0icwria3VTqC15hyics1iaicuuz2KKUlVCZm4tDbRX1JtA/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx18/cdn19@2020_3/2021/07/25/10-59-47-100_6f852527e4894ffb.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscM2Fp9cfschice1hHVoTicZwJAfggMichIjt1rJnhqXSpWviaAR5BeiaaKTg/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx4/cdn28@2020_4/2021/07/25/11-00-12-970_2190f4e46c597a8a.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_gif/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscibMIov2IbEqK78yrVZjpMS5GW2NoqXOs5CB0ibVxDT0nzQ3DVUa2QAaA/640?wx_fmt=gif":null,"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscgO7ico0mApLjNfetKfiaSRovhW0hzcciav2OEibI4vOBAHEQUwG0K1Dtmw/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx21/cdn15@2020_1/2021/07/25/11-01-10-136_835faf88688f4fb5.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscSfuwG8dyJpNooFwiahEInRIJtRzLZribXCd7Kd2hR4DFib5bXkrt1mX1w/640?wx_fmt=png":null,"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscgibd299HzibqpMOzBzuu53emIf8YzmicWjtB5StmmOm0NQyibYvehBEkHw/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx29/cdn89@2020_2/2021/07/25/11-00-13-213_df45dc608b6427d0.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjsctpicK2QbzhGg3pLVsOag114l2sSmB649SgQD00AMWiaSf5eq76spIibOg/640?wx_fmt=png":null,"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscwkxt1Y5ib3BSgkZNLK9bRkS9vrWMJvGibJkM2MhPuqG15fWzzDt92zibw/640?wx_fmt=png":null,"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscH7qKU8no7yicMLJWPSXnLhlsyPDRMJpx4udB5329PPFhicsRx2gLWNng/640?wx_fmt=png":"https://cdn.jsdelivr.net/gh/myreaderx1/cdn8@2020_5/2021/07/25/11-00-00-538_b41988dc0844569b.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_jpg/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscBH6nUzNykh2yuJfMELtlfeGgesc6GYwsmeNFkV67uXWHp7n3q7EImg/640?wx_fmt=jpeg":"https://cdn.jsdelivr.net/gh/myreaderx16/cdn23@2020_3/2021/07/25/11-00-47-648_dcf97759a990cafa.webp","http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscXslQAiaAsl3icFLPfJiaRfcCC4VXlOVv5gAhuvEbS7AbzjG6KjTUx5Fhw/640?wx_fmt=png":null,"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/2A8tXicCG8ylbWIGfdoDED35IRRySQZTXUkJ1eop9MHApzFibKnOo0diboXpl0rmS5mH78YJhsWQv0dhv718A6kUA/640?wx_fmt=jpeg":null,"http://www.jintiankansha.me/rss_static/11757/XplMqHvvWU":null},"publishedOrCreatedDate":1627210757531}],"record":{"createdTime":"2021-07-25 18:59:17","updatedTime":"2021-07-25 18:59:17","feedId":2521,"fetchDate":"Sun, 25 Jul 2021 10:59:17 +0000","fetchMs":505,"handleMs":78,"totalMs":151596,"newArticles":0,"totalArticles":5,"status":1,"type":0,"ip":"f306b40366a93aa712f78b685bea0f01","hostName":"us-025*","requestId":"6a744dc0787e44668bbfb11b52cd6e5f_2521","contentType":"application/rss+xml","totalBytes":173980,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":15,"articlesImgsGithubTotal":8,"successGithubMap":{"myreaderx16":1,"myreaderx27":1,"myreaderx4":1,"myreaderx21":1,"myreaderx3":1,"myreaderx1":1,"myreaderx29":1,"myreaderx18":1},"failGithubMap":{"myreaderx31":1}},"feed":{"createdTime":"2020-08-24 21:31:41","updatedTime":"2020-09-01 10:09:47","id":2521,"name":"ImportNew","url":"http://feedmaker.kindle4rss.com/feeds/importnew.weixin.xml","subscriber":null,"website":null,"icon":"http://www.sogou.com/images/logo/new/favicon.ico?v=4","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx63/cdn9@2020_3/2020/09/01/02-08-31-388_d24121c9beed1de6.ico","description":"伯乐在线旗下账号，专注Java技术分享，包括Java基础技术、进阶技能、架构设计和Java技术领域动态等。","weekly":null,"link":null},"noPictureArticleList":[{"createdTime":"2021-07-25 19:01:48","updatedTime":"2021-07-25 19:01:48","id":null,"feedId":2521,"linkMd5":"f3a8a96fb2bf35cdeb7f5a534d3a6931"}],"tmpCommonImgCdnBytes":21658,"tmpBodyImgCdnBytes":152322,"tmpBgImgCdnBytes":0,"extra4":{"start":1627210756765,"total":0,"statList":[{"spend":690,"msg":"获取xml内容"},{"spend":78,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":123637,"msg":"正文链接上传到cdn"}]},"extra5":15,"extra6":10,"extra7ImgCdnFailResultVector":[{"code":1,"isDone":false,"source":"http://www.jintiankansha.me/rss_static/11757/XplMqHvvWU","sourceStatusCode":0,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":718,"convertSpendMs":0,"createdTime":"2021-07-25 18:59:44","host":"europe70*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+MySQL%E7%81%B5%E9%AD%82%E5%8D%81%E8%BF%9E%E9%97%AE","linkMd5ListStr":"f3a8a96fb2bf35cdeb7f5a534d3a6931","extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[0],"sourceSize":"0","destSize":"0"},{"code":1,"isDone":false,"source":"http://www.jintiankansha.me/rss_static/11757/XplMqHvvWU","sourceStatusCode":405,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":697,"convertSpendMs":0,"createdTime":"2021-07-25 18:59:45","host":"europe-57*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+MySQL%E7%81%B5%E9%AD%82%E5%8D%81%E8%BF%9E%E9%97%AE","linkMd5ListStr":"f3a8a96fb2bf35cdeb7f5a534d3a6931","extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[405],"sourceSize":"0","destSize":"0"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscgO7ico0mApLjNfetKfiaSRovhW0hzcciav2OEibI4vOBAHEQUwG0K1Dtmw/640?wx_fmt=png","sourceStatusCode":403,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":1839,"convertSpendMs":0,"createdTime":"2021-07-25 18:59:44","host":"us-51*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+MySQL%E7%81%B5%E9%AD%82%E5%8D%81%E8%BF%9E%E9%97%AE","linkMd5ListStr":"f3a8a96fb2bf35cdeb7f5a534d3a6931","extra22GetBytesInfo":"2、Referer字段 ： http://weixin.sogou.com/weixin?type=2&query=ImportNew+MySQL%E7%81%B5%E9%AD%82%E5%8D%81%E8%BF%9E%E9%97%AE","extra23historyStatusCode":[403,403],"sourceSize":"0","destSize":"0"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/2A8tXicCG8ylbWIGfdoDED35IRRySQZTXUkJ1eop9MHApzFibKnOo0diboXpl0rmS5mH78YJhsWQv0dhv718A6kUA/640?wx_fmt=jpeg","sourceStatusCode":200,"destWidth":600,"destHeight":550,"sourceBytes":37143,"destBytes":31608,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":5152,"convertSpendMs":12,"createdTime":"2021-07-25 18:59:44","host":"us-012*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+MySQL%E7%81%B5%E9%AD%82%E5%8D%81%E8%BF%9E%E9%97%AE","linkMd5ListStr":"f3a8a96fb2bf35cdeb7f5a534d3a6931","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx31/cdn4/contents/2021/07/25/10-59-49-863_f93d0239d4369c75.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 69855631.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Resource, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Sun, 25 Jul 2021 10:59:49 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["D938:3E12:28CAAA4:4F93488:60FD4425"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1627214035"],"x-ratelimit-resource":["core"],"x-ratelimit-used":["60"],"x-xss-protection":["0"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx31/cdn4/contents/2021/07/25/10-59-49-863_f93d0239d4369c75.webp","historyStatusCode":[],"spendMs":36},"base64UserPassword":null,"token":"da243******************************d9e47"},"githubUser":"myreaderx31","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"36.3 KB","destSize":"30.9 KB","compressRate":"85.1%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/2A8tXicCG8ylbWIGfdoDED35IRRySQZTXUkJ1eop9MHApzFibKnOo0diboXpl0rmS5mH78YJhsWQv0dhv718A6kUA/640?wx_fmt=jpeg","sourceStatusCode":200,"destWidth":600,"destHeight":550,"sourceBytes":37143,"destBytes":31608,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":13157,"convertSpendMs":24,"createdTime":"2021-07-25 18:59:49","host":"us-012*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+MySQL%E7%81%B5%E9%AD%82%E5%8D%81%E8%BF%9E%E9%97%AE","linkMd5ListStr":"f3a8a96fb2bf35cdeb7f5a534d3a6931","rawMap":{"githubUrl":"https://api.github.com/repos/myreaderx31/cdn4/contents/2021/07/25/11-00-02-967_f93d0239d4369c75.webp","resp":{"code":403,"msg":"Forbidden","body":"{\n  \"message\": \"API rate limit exceeded for user ID 69855631.\",\n  \"documentation_url\": \"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"\n}\n","headerMap":{"access-control-allow-origin":["*"],"access-control-expose-headers":["ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Resource, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset"],"content-security-policy":["default-src 'none'"],"content-type":["application/json; charset=utf-8"],"date":["Sun, 25 Jul 2021 11:00:03 GMT"],"referrer-policy":["origin-when-cross-origin, strict-origin-when-cross-origin"],"server":["GitHub.com"],"strict-transport-security":["max-age=31536000; includeSubdomains; preload"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding, Accept, X-Requested-With"],"x-accepted-oauth-scopes":["repo"],"x-content-type-options":["nosniff"],"x-frame-options":["deny"],"x-github-media-type":["github.v3; format=json"],"x-github-request-id":["D938:3E12:28CAFBB:4F93E00:60FD4432"],"x-oauth-scopes":["admin:enterprise, admin:gpg_key, admin:org, admin:org_hook, admin:public_key, admin:repo_hook, delete:packages, delete_repo, gist, notifications, repo, user, workflow, write:discussion, write:packages"],"x-ratelimit-limit":["60"],"x-ratelimit-remaining":["0"],"x-ratelimit-reset":["1627214035"],"x-ratelimit-resource":["core"],"x-ratelimit-used":["60"],"x-xss-protection":["0"]},"exceptionMsg":"Unexpected code 403,url is : https://api.github.com/repos/myreaderx31/cdn4/contents/2021/07/25/11-00-02-967_f93d0239d4369c75.webp","historyStatusCode":[],"spendMs":91},"base64UserPassword":null,"token":"da243******************************d9e47"},"githubUser":"myreaderx31","githubHttpCode":403,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"36.3 KB","destSize":"30.9 KB","compressRate":"85.1%"},null,null,null,null,{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscgO7ico0mApLjNfetKfiaSRovhW0hzcciav2OEibI4vOBAHEQUwG0K1Dtmw/640?wx_fmt=png","sourceStatusCode":403,"sourceBytes":0,"destBytes":0,"feedId":2521,"totalSpendMs":1839,"convertSpendMs":0,"createdTime":"2021-07-25 18:59:44","host":"us-51*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+MySQL%E7%81%B5%E9%AD%82%E5%8D%81%E8%BF%9E%E9%97%AE","linkMd5ListStr":"f3a8a96fb2bf35cdeb7f5a534d3a6931","extra22GetBytesInfo":"2、Referer字段 ： http://weixin.sogou.com/weixin?type=2&query=ImportNew+MySQL%E7%81%B5%E9%AD%82%E5%8D%81%E8%BF%9E%E9%97%AE","extra23historyStatusCode":[403,403],"sourceSize":"0","destSize":"0"},null,null,null,null,null,null,null],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-013.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[403]},"http://us-037.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://europe63.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://us-035.herokuapp.com/":{"failCount":0,"successCount":2,"resultList":[200,200]},"http://us-024.herokuapp.com/":{"failCount":1,"successCount":1,"resultList":[200,null]},"http://europe70.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[0]},"http://europe-25.herokuapp.com/":{"failCount":2,"successCount":1,"resultList":[200,null,null]},"http://europe69.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://us-036.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://us-004.herokuapp.com/":{"failCount":1,"successCount":1,"resultList":[200,null]},"http://us-019.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://europe-57.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[405]},"http://us-51.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[403]},"http://us-016.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]},"http://us-023.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-029.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-012.herokuapp.com/":{"failCount":1,"successCount":2,"resultList":[200,200,null]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_jpg/eZzl4LXykQxuKzgT3PibHib0BekmINBzLWA1d4xb0BUCry6FMVE1Q6KEqQk2Y7gULibI2K1qoMVJnXwvPEBkPibqfQ/0?wx_fmt=jpeg?imageView2/1/w/600","sourceStatusCode":200,"destWidth":751,"destHeight":319,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx3/cdn43@2020_3/2021/07/25/10-59-44-290_f7f324d77fee5319.webp","sourceBytes":30236,"destBytes":21658,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":27035,"convertSpendMs":9,"createdTime":"2021-07-25 18:59:17","host":"europe-25*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+MySQL%E7%81%B5%E9%AD%82%E5%8D%81%E8%BF%9E%E9%97%AE","linkMd5ListStr":"f3a8a96fb2bf35cdeb7f5a534d3a6931,f3a8a96fb2bf35cdeb7f5a534d3a6931","githubUser":"myreaderx3","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"29.5 KB","destSize":"21.2 KB","compressRate":"71.6%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscvL02EdeR3b0PK0icwria3VTqC15hyics1iaicuuz2KKUlVCZm4tDbRX1JtA/640?wx_fmt=png","sourceStatusCode":200,"destWidth":541,"destHeight":159,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx18/cdn19@2020_3/2021/07/25/10-59-47-100_6f852527e4894ffb.webp","sourceBytes":5844,"destBytes":9368,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":2664,"convertSpendMs":4,"createdTime":"2021-07-25 18:59:44","host":"us-029*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+MySQL%E7%81%B5%E9%AD%82%E5%8D%81%E8%BF%9E%E9%97%AE","linkMd5ListStr":"f3a8a96fb2bf35cdeb7f5a534d3a6931","githubUser":"myreaderx18","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"5.7 KB","destSize":"9.1 KB","compressRate":"160.3%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscHYVe250B5pbSfZrbqeiatdwHkfBFbiaXibg8HicQqZD1ibaejYZnyg0jxEQ/640?wx_fmt=png","sourceStatusCode":200,"destWidth":1080,"destHeight":461,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx27/cdn99@2020_2/2021/07/25/10-59-51-311_679e4143191f7d08.webp","sourceBytes":78745,"destBytes":25670,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":6802,"convertSpendMs":22,"createdTime":"2021-07-25 18:59:44","host":"us-024*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+MySQL%E7%81%B5%E9%AD%82%E5%8D%81%E8%BF%9E%E9%97%AE","linkMd5ListStr":"f3a8a96fb2bf35cdeb7f5a534d3a6931","githubUser":"myreaderx27","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"76.9 KB","destSize":"25.1 KB","compressRate":"32.6%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscH7qKU8no7yicMLJWPSXnLhlsyPDRMJpx4udB5329PPFhicsRx2gLWNng/640?wx_fmt=png","sourceStatusCode":200,"destWidth":385,"destHeight":150,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx1/cdn8@2020_5/2021/07/25/11-00-00-538_b41988dc0844569b.webp","sourceBytes":25642,"destBytes":5404,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":16146,"convertSpendMs":5,"createdTime":"2021-07-25 18:59:44","host":"europe-25*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+MySQL%E7%81%B5%E9%AD%82%E5%8D%81%E8%BF%9E%E9%97%AE","linkMd5ListStr":"f3a8a96fb2bf35cdeb7f5a534d3a6931","githubUser":"myreaderx1","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"25 KB","destSize":"5.3 KB","compressRate":"21.1%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscM2Fp9cfschice1hHVoTicZwJAfggMichIjt1rJnhqXSpWviaAR5BeiaaKTg/640?wx_fmt=png","sourceStatusCode":200,"destWidth":965,"destHeight":398,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx4/cdn28@2020_4/2021/07/25/11-00-12-970_2190f4e46c597a8a.webp","sourceBytes":101985,"destBytes":26254,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":28472,"convertSpendMs":21,"createdTime":"2021-07-25 18:59:44","host":"us-004*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+MySQL%E7%81%B5%E9%AD%82%E5%8D%81%E8%BF%9E%E9%97%AE","linkMd5ListStr":"f3a8a96fb2bf35cdeb7f5a534d3a6931","githubUser":"myreaderx4","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"99.6 KB","destSize":"25.6 KB","compressRate":"25.7%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscgibd299HzibqpMOzBzuu53emIf8YzmicWjtB5StmmOm0NQyibYvehBEkHw/640?wx_fmt=png","sourceStatusCode":200,"destWidth":966,"destHeight":238,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx29/cdn89@2020_2/2021/07/25/11-00-13-213_df45dc608b6427d0.webp","sourceBytes":7531,"destBytes":10930,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":28752,"convertSpendMs":7,"createdTime":"2021-07-25 18:59:44","host":"us-035*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+MySQL%E7%81%B5%E9%AD%82%E5%8D%81%E8%BF%9E%E9%97%AE","linkMd5ListStr":"f3a8a96fb2bf35cdeb7f5a534d3a6931","githubUser":"myreaderx29","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"7.4 KB","destSize":"10.7 KB","compressRate":"145.1%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_jpg/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscBH6nUzNykh2yuJfMELtlfeGgesc6GYwsmeNFkV67uXWHp7n3q7EImg/640?wx_fmt=jpeg","sourceStatusCode":200,"destWidth":890,"destHeight":619,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx16/cdn23@2020_3/2021/07/25/11-00-47-648_dcf97759a990cafa.webp","sourceBytes":78880,"destBytes":64214,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":3039,"convertSpendMs":22,"createdTime":"2021-07-25 19:00:44","host":"us-035*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+MySQL%E7%81%B5%E9%AD%82%E5%8D%81%E8%BF%9E%E9%97%AE","linkMd5ListStr":"f3a8a96fb2bf35cdeb7f5a534d3a6931","githubUser":"myreaderx16","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"77 KB","destSize":"62.7 KB","compressRate":"81.4%"},{"code":1,"isDone":false,"source":"http://img2.jintiankansha.me/get?src=http://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUQrRBUyxETV2RgzXuPqjscgO7ico0mApLjNfetKfiaSRovhW0hzcciav2OEibI4vOBAHEQUwG0K1Dtmw/640?wx_fmt=png","sourceStatusCode":200,"destWidth":392,"destHeight":396,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx21/cdn15@2020_1/2021/07/25/11-01-10-136_835faf88688f4fb5.webp","sourceBytes":66488,"destBytes":10482,"targetWebpQuality":75,"feedId":2521,"totalSpendMs":23716,"convertSpendMs":9,"createdTime":"2021-07-25 19:00:46","host":"us-023*","referer":"http://weixin.sogou.com/weixin?type=2&query=ImportNew+MySQL%E7%81%B5%E9%AD%82%E5%8D%81%E8%BF%9E%E9%97%AE","linkMd5ListStr":"f3a8a96fb2bf35cdeb7f5a534d3a6931","githubUser":"myreaderx21","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"64.9 KB","destSize":"10.2 KB","compressRate":"15.8%"}],"successGithubMap":{"myreaderx16":1,"myreaderx27":1,"myreaderx4":1,"myreaderx21":1,"myreaderx3":1,"myreaderx1":1,"myreaderx29":1,"myreaderx18":1},"failGithubMap":{"myreaderx31":1}}