{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2021-05-12 04:59:58","updatedTime":"2021-05-12 04:59:58","title":"The Query Builder Blog Series: Part 6 - Selecting and Deselecting Fields","link":"http://feedproxy.google.com/~r/GoogleAdsDeveloperBlog/~3/Qs5ntvFfQJY/the-query-builder-blog-series-part-6.html","description":"This <a href=\"https://ads-developers.googleblog.com/search/label/query_builder_blog_series\">blog series</a> follows the journey of building the new and improved <a href=\"https://developers.google.com/google-ads/api/fields/latest/overview_query_builder\">Interactive Google Ads Query Builder</a> tool. <a href=\"https://ads-developers.googleblog.com/2021/05/the-query-builder-blog-series-part-5.html\">Part 5</a> of this series described how we determine whether or not a field is selectable. In Part 6, we will discuss how we add fields to a Google Ads Query Language (GAQL) string using the <code>SelectionService</code>.<br /><br /><h3 style=\"text-align: left;\">GAQL String State</h3>In order to track which fields have been selected, we need to keep track of the GAQL string’s state, which we can do in an instance variable called <code>selectedFields</code> that has the following interface definition:<br /><br /><br /> <pre class=\"prettyprint lang-javas\">interface SelectedFields {<br />  select: string[];<br />  where: Array&lt;{field: string, context: string}&gt;;<br />  orderBy: Array&lt;{field: string, context?: string}&gt;;<br />  limit?: string;<br />  params?: string;<br />}</pre> <br /><br /><br />The <a href=\"https://developers.google.com/google-ads/api/docs/query/structure#select\"><code>select</code></a> field holds an array of field names. The <a href=\"https://developers.google.com/google-ads/api/docs/query/structure#where\"><code>where</code></a> field holds an array of objects, each of which contains a <code>field</code> name and <code>context</code> string. By context, we mean the filtering condition to apply to the field (or operator and operand). For example, if we added the filtering condition, <code>ad_group.id = 1234567890</code> to the WHERE clause, the field would be <code>ad_group.id</code>, and the context would be<code> = 1234567890.</code> Similarly, the <a href=\"https://developers.google.com/google-ads/api/docs/query/structure#order_by\"><code>orderBy</code></a> field holds an array of <code>field</code> names and optional <code>context</code> strings. Here, <code>context</code> is the optional ASC or DESC direction (default ASC). The <code>limit</code> field is the optional string representation of the integer <a href=\"https://developers.google.com/google-ads/api/docs/query/structure#limit\">LIMIT</a>. Finally, the optional <code>params</code> field represents the optional string value of the <a href=\"https://developers.google.com/google-ads/api/docs/query/structure#parameters\">PARAMETERS</a> clause. We don’t need an array here because there is currently only a single option for this clause.<br /><h3 style=\"text-align: left;\">Selecting Fields</h3>Now that we have a data structure in place to track the state of a user’s query, we can implement a method to select a field in any clause.<br /><br /><br /> <pre class=\"prettyprint lang-javas\">selectField(field: string, clause: string, context?: string): void {<br />    ...<br />}</pre> <br />If the <code>clause</code> is SELECT, we’ll add the provided field to the <code>select</code> array in <code>selectedFields</code>. When users add a field in the SELECT clause, no context is provided.<br /><br /><br />If the <code>clause</code> is WHERE, all three parameters are required because a filtering condition containing an operator and operand must be provided as a <code>context</code> string. When users click the checkbox to add a field in the WHERE clause, we’ll open a dialog prompting them to specify the operator, and then an operand once the operator has been set. Depending on the <code>data_type</code> of the field being selected, we’ll pre-populate the list of available operators a user can select, and depending on the operator selected, we’ll show the user a different component to input the operand. Once a user adds the filtering criteria, we’ll join the operator and operand into a single string to create the <code>context</code> string.<br /><br /><br /><img src=\"https://lh3.googleusercontent.com/aaHFHhbTK3g2LVNgKRv8RqW-UrMSVoLsY_9bp_oA_Cv2-TjbtxOADMSP9vODVcNRjsKLQBGNIMLigS1DxrG_CWrdW7yCrDbPqhGyOiPEsp94V3sFmb_btdb45nZ69cP1D3vRvmgP-Q\" style=\"width:100%\"/><br /><br /><br />If the <code>clause</code> is ORDER BY, <code>context</code> is optional. When a user selects a field in the ORDER BY clause, we’ll call <code>selectField</code> without any context and add the field to the <code>orderBy</code> array of <code>selectedFields</code> without any context. We’ll also present users with radio buttons under the field name to specify an order of ASC or DESC. Upon clicking one of the options, we’ll update the respective field’s entry in the <code>orderBy</code> array to add the order <code>context</code>.<br /><br /><img src=\"https://lh3.googleusercontent.com/7QxdIeXQ3MnpmH6r8ZO4lv0f22jqrteL16nTWKfl5lCHY8d2W1doWXdC2S9RYMgDYOlnDtnON00zHeYQNHfuzC06pIOLMNMTP_Ls2252RMmbeKHgbxNn5SRMvokfJpyPFpMdRJOt2Q\"  style=\"width:100%\"/><br /><br /><br />If the <code>clause</code> is LIMIT or PARAMETERS, we’ll update the <code>limit</code> and <code>params</code> entries of <code>selectedFields</code>, respectively, with the provided string as the <code>field</code> parameter. The limit must be a positive integer, the validation for which is performed in the related UI component. The only parameter currently available is <code>include_drafts</code>, and the default value is false. Therefore, we’ll present users with a checkbox in the UI component for PARAMETERS with a single option ‘include_drafts=true’. If the user clicks the checkbox, we’ll pass the string <code>include_drafts=true</code> to <code>selectField</code> as the <code>field</code>.<br /><h3 style=\"text-align: left;\">SELECT Presence</h3>While the logic of selecting fields is straight-forward, there are two rules regarding selectability that we intentionally skipped in <a href=\"https://ads-developers.googleblog.com/2021/05/the-query-builder-blog-series-part-5.html\">part 5</a>. Certain fields must be present in the SELECT clause before they can be inserted into the WHERE or ORDER BY clauses.<br /><br /><br /><br /><i>Rule #1: with the exception of “core date segments” (<a href=\"https://developers.google.com/google-ads/api/fields/latest/segments#segments.date\">segments.date</a>, <a href=\"https://developers.google.com/google-ads/api/fields/latest/segments#segments.week\">segments.week</a>, <a href=\"https://developers.google.com/google-ads/api/fields/latest/segments#segments.month\">segments.month</a>, <a href=\"https://developers.google.com/google-ads/api/fields/latest/segments#segments.quarter\">segments.quarter</a>, <a href=\"https://developers.google.com/google-ads/api/fields/latest/segments#segments.year\">segments.year</a>), all <a href=\"https://developers.google.com/google-ads/api/fields/latest/segments\">segments</a> and <a href=\"https://developers.google.com/google-ads/api/docs/reporting/segmentation#segmenting_by_a_segment_resource\">segmenting resources</a> must be present in the SELECT clause before they can be inserted into the WHERE clause.</i><br /><br /><br /><br /><i>Rule #2: all <a href=\"https://developers.google.com/google-ads/api/fields/latest/segments\">segments</a>, <a href=\"https://developers.google.com/google-ads/api/docs/reporting/segmentation#segmenting_by_a_segment_resource\">segmenting resources</a>, <a href=\"https://developers.google.com/google-ads/api/docs/reporting/criteria-metrics\">metrics</a>, and <a href=\"https://developers.google.com/google-ads/api/docs/query/overview#querying_for_attributes_of_a_related_resource\">attributed resource</a> fields must be present in the SELECT clause before they can be inserted into the ORDER BY clause. In other words, only fields on the resource in the FROM clause can be placed in the ORDER BY clause without first being inserted into the SELECT clause.</i><br /><br /><br />In these cases, we’ll present a dialog that enables the user to add the field to the SELECT clause as well as the desired clause in a single step.<br /><br /><br /><img src=\"https://lh4.googleusercontent.com/3fhLcNOHdUnLNxXWGw1VoRh2hxP5UrbWgc2kkTny1wEjz_-oulawT4fRtOPyepWcqz1GxmvYf5_sK_bK5k6yCXaUqUU2KMuhn-yiMuhTHWP6AQP5mf1saNnag61n6RtmJ5BPmotjgA\" style=\"width:100%\"/><br /><br /><br /><h3 style=\"text-align: left;\">Deselecting Fields</h3>In order to deselect fields, we’ll implement a method in the <code>SelectionService</code> called <code>deselectField</code>.<br /><br /><br /> <pre class=\"prettyprint lang-javas\">deselectField(field: string, clause: string): void {<br />    …<br />}</pre> <br /><br /><br /><br />Deselecting a field is similar to selecting a field. As a safeguard, we’ll first check if the field is selected. Then, if the <code>clause</code> is SELECT, WHERE, or ORDER BY, we’ll remove the deselected field from the respective array entry of <code>selectedFields</code>. In the event the field that is required to be present in SELECT before being added to WHERE or ORDER BY according to the rules described above and is removed from SELECT, we’ll automatically remove the field from SELECT in a single operation. If the clause is LIMIT or PARAMETERS, we’ll update the respective entry of <code>selectedFields</code> to <code>undefined</code>.<br /><h3 style=\"text-align: left;\">Updating the Output</h3>With the <code>selectedFields</code> variable, <code>selectField</code> method, and <code>deselectField</code> method in place, we can now track the state of the query string. In order to keep track of changes throughout the application, we’ll create an <a href=\"https://angular.io/guide/observables\">Observable</a> in the <code>SelectionService</code> and call <code>next</code> on it each time <code>selectField</code> or <code>deselectField</code> is called. Then, we can subscribe to the observable in any component that needs to be aware of the GAQL query state.<br /><h3 style=\"text-align: left;\">Conclusion</h3>We have now updated the <code>SelectionService</code> to select fields and deselect fields. In this post, we’ve covered:<br /><ul style=\"text-align: left;\"><li>GAQL query and clause structure.</li><li>Additional detail regarding selectability.</li><li>Using <a href=\"https://angular.io/guide/observables\">Observables</a> in Angular.</li></ul><div>Hopefully this has deepened your understanding of constructing GAQL queries with the Google Ads API. If you have any questions or need additional help, contact us via the <a href=\"https://groups.google.com/forum/#!forum/adwords-api\">forum</a> or at googleadsapi-support@google.com.</div><span class=\"byline-author\"><img height=\"40\" src=\"https://lh3.googleusercontent.com/a-/AOh14GiOcLXyMYphwRh10nyuK_-RpxNBRiDcaag6Z73p=s600-p-rwa\" style=\"border: none; vertical-align: middle;\" width=\"40\" /> - Devin Chasanoff, on behalf of the Google Ads API Team</span><img src=\"http://feeds.feedburner.com/~r/GoogleAdsDeveloperBlog/~4/Qs5ntvFfQJY\" height=\"1\" width=\"1\" alt=\"\"/>","descriptionType":"html","publishedDate":"Tue, 11 May 2021 14:36:00 +0000","feedId":44300,"bgimg":"https://lh3.googleusercontent.com/aaHFHhbTK3g2LVNgKRv8RqW-UrMSVoLsY_9bp_oA_Cv2-TjbtxOADMSP9vODVcNRjsKLQBGNIMLigS1DxrG_CWrdW7yCrDbPqhGyOiPEsp94V3sFmb_btdb45nZ69cP1D3vRvmgP-Q","linkMd5":"af1458e23e99f947c1ae71ee0837c5e3","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx27/cdn78@2020_5/2021/05/11/21-00-26-451_9ede346bff3eebc4.webp","destWidth":1600,"destHeight":969,"sourceBytes":3247019,"destBytes":2003276,"author":"Google Ads Developer Advisor","articleImgCdnMap":{"https://lh3.googleusercontent.com/aaHFHhbTK3g2LVNgKRv8RqW-UrMSVoLsY_9bp_oA_Cv2-TjbtxOADMSP9vODVcNRjsKLQBGNIMLigS1DxrG_CWrdW7yCrDbPqhGyOiPEsp94V3sFmb_btdb45nZ69cP1D3vRvmgP-Q":"https://cdn.jsdelivr.net/gh/myreaderx27/cdn78@2020_5/2021/05/11/21-00-26-451_9ede346bff3eebc4.webp","https://lh3.googleusercontent.com/7QxdIeXQ3MnpmH6r8ZO4lv0f22jqrteL16nTWKfl5lCHY8d2W1doWXdC2S9RYMgDYOlnDtnON00zHeYQNHfuzC06pIOLMNMTP_Ls2252RMmbeKHgbxNn5SRMvokfJpyPFpMdRJOt2Q":"https://cdn.jsdelivr.net/gh/myreaderx19/cdn3@2020_4/2021/05/11/21-00-27-857_fd7b7e0b762b8c89.webp","https://lh4.googleusercontent.com/3fhLcNOHdUnLNxXWGw1VoRh2hxP5UrbWgc2kkTny1wEjz_-oulawT4fRtOPyepWcqz1GxmvYf5_sK_bK5k6yCXaUqUU2KMuhn-yiMuhTHWP6AQP5mf1saNnag61n6RtmJ5BPmotjgA":"https://cdn.jsdelivr.net/gh/myreaderx2/cdn5@2020_4/2021/05/11/21-00-47-700_9144bffd5e7f46bb.webp","https://lh3.googleusercontent.com/a-/AOh14GiOcLXyMYphwRh10nyuK_-RpxNBRiDcaag6Z73p=s600-p-rwa":"https://cdn.jsdelivr.net/gh/myreaderx7/cdn13@2020_5/2021/05/11/21-00-27-755_fcb7cf77c39a8ad2.webp","http://feeds.feedburner.com/~r/GoogleAdsDeveloperBlog/~4/Qs5ntvFfQJY":"https://cdn.jsdelivr.net/gh/myreaderx15/cdn12@2020_5/2021/05/11/21-00-27-647_e925a79f57d44370.webp"},"publishedOrCreatedDate":1620766798298}],"record":{"createdTime":"2021-05-12 04:59:58","updatedTime":"2021-05-12 04:59:58","feedId":44300,"fetchDate":"Tue, 11 May 2021 20:59:58 +0000","fetchMs":16,"handleMs":8,"totalMs":50286,"newArticles":0,"totalArticles":25,"status":1,"type":0,"ip":"79b59b7ab14b8d981e3d8a220e20848a","hostName":"us-010*","requestId":"039d64d639bb4c2c915a9a9b0d2eb2a4_44300","contentType":"text/xml; charset=UTF-8","totalBytes":4180262,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":5,"articlesImgsGithubTotal":5,"successGithubMap":{"myreaderx15":1,"myreaderx7":1,"myreaderx27":1,"myreaderx2":1,"myreaderx19":1},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 03:34:12","updatedTime":"2020-09-07 05:52:03","id":44300,"name":"Google Ads Developer Blog","url":"http://feeds.feedburner.com/GoogleAdsDeveloperBlog","subscriber":72,"website":null,"icon":"http://ads-developers.googleblog.com/favicon.ico","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx61/cdn98@2020_5/2020/09/06/21-52-01-177_8141aad60c080180.ico","description":"The official blog for information about the Google Ads, Google Ad Manager, Google Mobile Ads SDKs for AdMob and IMA SDKs, and other Google Advertising Platform developer tools.","weekly":null,"link":null},"noPictureArticleList":[],"tmpCommonImgCdnBytes":2003276,"tmpBodyImgCdnBytes":2176986,"tmpBgImgCdnBytes":0,"extra4":{"start":1620766798272,"total":0,"statList":[{"spend":18,"msg":"获取xml内容"},{"spend":8,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":20939,"msg":"正文链接上传到cdn"}]},"extra5":5,"extra6":5,"extra7ImgCdnFailResultVector":[],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-037.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-036.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://europe21.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://europe70.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://lh3.googleusercontent.com/aaHFHhbTK3g2LVNgKRv8RqW-UrMSVoLsY_9bp_oA_Cv2-TjbtxOADMSP9vODVcNRjsKLQBGNIMLigS1DxrG_CWrdW7yCrDbPqhGyOiPEsp94V3sFmb_btdb45nZ69cP1D3vRvmgP-Q","sourceStatusCode":200,"destWidth":1600,"destHeight":969,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx27/cdn78@2020_5/2021/05/11/21-00-26-451_9ede346bff3eebc4.webp","sourceBytes":3247019,"destBytes":2003276,"targetWebpQuality":75,"feedId":44300,"totalSpendMs":29178,"convertSpendMs":17211,"createdTime":"2021-05-12 04:59:58","host":"europe70*","referer":"http://feedproxy.google.com/~r/GoogleAdsDeveloperBlog/~3/Qs5ntvFfQJY/the-query-builder-blog-series-part-6.html","linkMd5ListStr":"af1458e23e99f947c1ae71ee0837c5e3,af1458e23e99f947c1ae71ee0837c5e3","githubUser":"myreaderx27","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"3.1 MB","destSize":"1.9 MB","compressRate":"61.7%"},{"code":1,"isDone":false,"source":"http://feeds.feedburner.com/~r/GoogleAdsDeveloperBlog/~4/Qs5ntvFfQJY","sourceStatusCode":200,"destWidth":1,"destHeight":1,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx15/cdn12@2020_5/2021/05/11/21-00-27-647_e925a79f57d44370.webp","sourceBytes":43,"destBytes":72,"targetWebpQuality":75,"feedId":44300,"totalSpendMs":282,"convertSpendMs":2,"createdTime":"2021-05-12 05:00:27","host":"us-036*","referer":"http://feedproxy.google.com/~r/GoogleAdsDeveloperBlog/~3/Qs5ntvFfQJY/the-query-builder-blog-series-part-6.html","linkMd5ListStr":"af1458e23e99f947c1ae71ee0837c5e3","githubUser":"myreaderx15","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"43 B","destSize":"72 B","compressRate":"167.4%"},{"code":1,"isDone":false,"source":"https://lh3.googleusercontent.com/a-/AOh14GiOcLXyMYphwRh10nyuK_-RpxNBRiDcaag6Z73p=s600-p-rwa","sourceStatusCode":200,"destWidth":600,"destHeight":600,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx7/cdn13@2020_5/2021/05/11/21-00-27-755_fcb7cf77c39a8ad2.webp","sourceBytes":178720,"destBytes":178720,"feedId":44300,"totalSpendMs":424,"convertSpendMs":0,"createdTime":"2021-05-12 05:00:27","host":"us-037*","referer":"http://feedproxy.google.com/~r/GoogleAdsDeveloperBlog/~3/Qs5ntvFfQJY/the-query-builder-blog-series-part-6.html","linkMd5ListStr":"af1458e23e99f947c1ae71ee0837c5e3","githubUser":"myreaderx7","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"174.5 KB","destSize":"174.5 KB","compressRate":"100%"},{"code":1,"isDone":false,"source":"https://lh3.googleusercontent.com/7QxdIeXQ3MnpmH6r8ZO4lv0f22jqrteL16nTWKfl5lCHY8d2W1doWXdC2S9RYMgDYOlnDtnON00zHeYQNHfuzC06pIOLMNMTP_Ls2252RMmbeKHgbxNn5SRMvokfJpyPFpMdRJOt2Q","sourceStatusCode":200,"destWidth":1452,"destHeight":142,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx19/cdn3@2020_4/2021/05/11/21-00-27-857_fd7b7e0b762b8c89.webp","sourceBytes":13877,"destBytes":5706,"targetWebpQuality":75,"feedId":44300,"totalSpendMs":545,"convertSpendMs":8,"createdTime":"2021-05-12 05:00:27","host":"europe70*","referer":"http://feedproxy.google.com/~r/GoogleAdsDeveloperBlog/~3/Qs5ntvFfQJY/the-query-builder-blog-series-part-6.html","linkMd5ListStr":"af1458e23e99f947c1ae71ee0837c5e3","githubUser":"myreaderx19","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"13.6 KB","destSize":"5.6 KB","compressRate":"41.1%"},{"code":1,"isDone":false,"source":"https://lh4.googleusercontent.com/3fhLcNOHdUnLNxXWGw1VoRh2hxP5UrbWgc2kkTny1wEjz_-oulawT4fRtOPyepWcqz1GxmvYf5_sK_bK5k6yCXaUqUU2KMuhn-yiMuhTHWP6AQP5mf1saNnag61n6RtmJ5BPmotjgA","sourceStatusCode":200,"destWidth":1600,"destHeight":1284,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx2/cdn5@2020_4/2021/05/11/21-00-47-700_9144bffd5e7f46bb.webp","sourceBytes":2868793,"destBytes":1992488,"targetWebpQuality":75,"feedId":44300,"totalSpendMs":20795,"convertSpendMs":11312,"createdTime":"2021-05-12 05:00:27","host":"europe21*","referer":"http://feedproxy.google.com/~r/GoogleAdsDeveloperBlog/~3/Qs5ntvFfQJY/the-query-builder-blog-series-part-6.html","linkMd5ListStr":"af1458e23e99f947c1ae71ee0837c5e3","githubUser":"myreaderx2","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"2.7 MB","destSize":"1.9 MB","compressRate":"69.5%"}],"successGithubMap":{"myreaderx15":1,"myreaderx7":1,"myreaderx27":1,"myreaderx2":1,"myreaderx19":1},"failGithubMap":{}}