{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-10-19 02:27:33","updatedTime":"2020-10-19 02:27:33","title":"C++/CX: データとコントロールの紐付け","link":"http://blogs.wankuma.com/episteme/archive/2013/03/31/323988.aspx","description":"<p>さてとーちょっくらいぢくるよ。</p><p>前回のコード、ここいらへん↓の居心地がよくない。</p><p><font size=\"2\" face=\"Courier New\">void App1::TrialPage::btnInc_Click(Platform::Object^ sender, Windows::UI::Xaml::RoutedEventArgs^ e)<br>{<br>&nbsp; ++count_;<br>&nbsp; <font color=\"#ff0000\">txtCount-&gt;Text = count_.ToString();</font><br></font><font size=\"2\" face=\"Courier New\">}</font></p><p>ロジック内に画面の面倒を見る処理が<strong>混入</strong>してます。できることならカウンタ値を+/-するだけで画面上の値が<strong>勝手にぴょこぴょこ</strong>更新されるとステキ。それやってみましょ。<br>データ・バインディングといわれるやつですな。<strong>データ束縛</strong>と訳されてたりするけども、\"束縛\"ちゅーとほのかに<strong>淫靡な香り</strong>が漂います。なんかこー<strong>ぎりぎり</strong>と縛り上げていたぶるみたいで...\"紐付け\"の方がまだマシな気が。</p><p>TrialPage.xaml状にあるTextBlockのText属性を書き換えます:<br><img src=\"http://www1.c3-net.ne.jp/episteme/images/cppcx_2nd/step1.png\"></p><p>\"{Binding Count}\" が「紐付け元にあるCountプロパティの値を置け」ちう意味ですな。<br>んで、Countプロパティを提供する\"紐付け元\"をこさえます。</p><p><font face=\"Courier New\">// --- CounterModel.h<br>#pragma once</font></p><p><font face=\"Courier New\">#include \"Common/BindableBase.h\"</font></p><p><font face=\"Courier New\">namespace App1 { <font color=\"#008000\">// この名前空間はプロジェクト名に合わせる</font></font></p><p><font face=\"Courier New\">&nbsp; <font color=\"#ff0000\">[Windows::UI::Xaml::Data::Bindable]</font> <br>&nbsp; public ref class CounterModel sealed <font color=\"#ff0000\">: public Common::BindableBase</font> {<br>&nbsp; public:<br>&nbsp;&nbsp;&nbsp; CounterModel();<br>&nbsp;&nbsp;&nbsp; property int Count { int get(); }<br>&nbsp;&nbsp;&nbsp; void increment();<br>&nbsp;&nbsp;&nbsp; void decrement();<br>&nbsp; private:<br>&nbsp;&nbsp;&nbsp; int value_;<br>&nbsp; };<br>}</font></p><p>ここでのキモはふたつ:<br>- [Windows::UI::Xaml::Data::Bindable] てなアトリビュートを付けること。このクラスは<strong>紐付け可能</strong>であることを示します。<br>- Common::BindableBase から導出すること。BindableBaseが紐付けに必要な<strong>モロモロ</strong>を提供してくれるのな。</p><p>CounterModel の実装はこんなカンジ。</p><p><font face=\"Courier New\">// --- CounterModel.cpp<br>#include \"pch.h\"<br>#include \"CounterModel.h\"</font></p><p><font face=\"Courier New\">namespace App1 { <font color=\"#008000\">// この名前空間はプロジェクト名に合わせる</font></font></p><p><font face=\"Courier New\">&nbsp; CounterModel::CounterModel() : value_(0) {}<br>&nbsp; int CounterModel::Count::get() { return value_; }<br>&nbsp; void CounterModel::increment() { ++value_; <font color=\"#ff0000\">OnPropertyChanged(L\"Count\");</font> }<br>&nbsp; void CounterModel::decrement() { --value_; <font color=\"#ff0000\">OnPropertyChanged(L\"Count\");</font> }</font></p><p><font face=\"Courier New\">}</font></p><p>OnPropertyChanged(L\"Count\") が\"Countプロパティが<strong>変更されたよー</strong>\"と紐付け先に通知してくれます。通知を受けたXAMLさんはそいじゃってんでCountプロパティを読み取って<strong>絵ヅラを描き換える</strong>ってスンポーです。</p><p>TrialPage.xaml.h をちょっとだけいぢり、int count_ を CounterModel^ count_ に取り替えます。<br><img src=\"http://www1.c3-net.ne.jp/episteme/images/cppcx_2nd/step2.png\"></p><p>実装側(TrialPage.xaml.cpp)は...</p><p><font size=\"2\" face=\"Courier New\">TrialPage::TrialPage()<br>{<br>&nbsp; InitializeComponent();<br>&nbsp; <font color=\"#ff0000\">count_ = ref new CounterModel();<br>&nbsp; DataContext = count_;<br></font>}</font></p><p><font size=\"2\" face=\"Courier New\">void App1::TrialPage::btnInc_Click(Platform::Object^ sender, Windows::UI::Xaml::RoutedEventArgs^ e)<br>{<br>&nbsp; <font color=\"#ff0000\">count_-&gt;increment();</font><br>}</font></p><p><font size=\"2\" face=\"Courier New\">void App1::TrialPage::btnDec_Click(Platform::Object^ sender, Windows::UI::Xaml::RoutedEventArgs^ e)<br>{<br>&nbsp; <font color=\"#ff0000\">count_-&gt;decrement();</font><br>}</font></p><p>コンストラクタでDataCountextをセットすることで紐付け先(XAMLさん)に紐付け元(CounterModel)を教えてあげてます。これで完成。動くハズよ。</p><p>&nbsp;</p><img src =\"http://blogs.wankuma.com/episteme/aggbug/323988.aspx\" width = \"1\" height = \"1\" />","descriptionType":"text/html","publishedDate":"Sun, 31 Mar 2013 11:48:00 +0000","feedId":42717,"bgimg":"http://www1.c3-net.ne.jp/episteme/images/cppcx_2nd/step1.png","linkMd5":"6d86e124dc63d808f1bd8f9c9e9acac9","author":"επιστημη","articleImgCdnMap":{"http://www1.c3-net.ne.jp/episteme/images/cppcx_2nd/step1.png":null,"http://www1.c3-net.ne.jp/episteme/images/cppcx_2nd/step2.png":null,"http://blogs.wankuma.com/episteme/aggbug/323988.aspx":"https://cdn.jsdelivr.net/gh/myreaderx7/cdn6@2020_5/2020/10/18/18-29-34-524_cfc67c1ab9c5af78.webp"},"publishedOrCreatedDate":1603045653093}],"record":{"createdTime":"2020-10-19 02:27:33","updatedTime":"2020-10-19 02:27:33","feedId":42717,"fetchDate":"Sun, 18 Oct 2020 18:27:33 +0000","fetchMs":1407,"handleMs":10,"totalMs":245244,"newArticles":0,"totalArticles":15,"status":1,"type":0,"ip":"2fbc598270685d2ad3e3de972b0b4ef6","hostName":"us-024*","requestId":"6b76196c0e1b466db794ab851395691b_42717","contentType":"text/xml; charset=utf-8","totalBytes":72,"bgimgsTotal":1,"bgimgsGithubTotal":0,"articlesImgsTotal":3,"articlesImgsGithubTotal":1,"successGithubMap":{"myreaderx7":1},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 03:28:31","updatedTime":"2020-09-07 05:45:37","id":42717,"name":"東方算程譚","url":"http://blogs.wankuma.com/episteme/rss.aspx","subscriber":75,"website":null,"icon":"http://blogs.wankuma.com/favicon.ico","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx65/cdn7@2020_2/2020/09/06/21-45-35-292_b6c8dd6c90018ccc.ico","description":"Oriental Code Talk ── επιστημηが与太をこく、弾幕とは無縁のシロモノ。","weekly":null,"link":null},"noPictureArticleList":[{"createdTime":"2020-10-19 02:31:36","updatedTime":"2020-10-19 02:31:36","id":null,"feedId":42717,"linkMd5":"6d86e124dc63d808f1bd8f9c9e9acac9"}],"tmpCommonImgCdnBytes":0,"tmpBodyImgCdnBytes":72,"tmpBgImgCdnBytes":0,"extra4":{"start":1603045651127,"total":0,"statList":[{"spend":1956,"msg":"获取xml内容"},{"spend":10,"msg":"解释文章"},{"spend":121616,"msg":"正文链接上传到cdn"},{"spend":122937,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"}]},"extra5":3,"extra6":1,"extra7ImgCdnFailResultVector":[null,null,null,null,null,null,null,null],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"http://blogs.wankuma.com/episteme/aggbug/323988.aspx","sourceStatusCode":200,"destWidth":1,"destHeight":1,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx7/cdn6@2020_5/2020/10/18/18-29-34-524_cfc67c1ab9c5af78.webp","sourceBytes":43,"destBytes":72,"targetWebpQuality":75,"feedId":42717,"totalSpendMs":1977,"convertSpendMs":2,"createdTime":"2020-10-19 02:29:33","host":"us-033*","referer":"http://blogs.wankuma.com/episteme/archive/2013/03/31/323988.aspx","linkMd5ListStr":"6d86e124dc63d808f1bd8f9c9e9acac9","githubUser":"myreaderx7","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"43 B","destSize":"72 B","compressRate":"167.4%"}],"successGithubMap":{"myreaderx7":1},"failGithubMap":{}}