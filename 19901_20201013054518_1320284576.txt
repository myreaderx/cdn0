{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-10-13 13:41:13","updatedTime":"2020-10-13 13:41:13","title":"CMDR-DOS: Commodore DOS on FAT32","link":"https://www.pagetable.com/?p=1421","description":"<p>All disk drives connected to the Serial Bus of a Commodore 64 speak the <a href=\"https://www.pagetable.com/?p=1038\">Commodore DOS</a> protocol, from the popular 1541 5.25″ drive to the modern <a href=\"https://sd2iec.de\">sd2iec</a> SD card interfaces. <strong>CMDR-DOS</strong> is a new and open source implementation of the Commodore DOS protocol, using SD cards with the FAT32 filesystem and supporting advances features like partitions, subdirectories and timestamps –&nbsp;and running on a 65c02!</p> \n<h2 id=\"commander-x16\">Commander X16</h2> \n<p>It is the built-in DOS of the <a href=\"https://www.commanderx16.com\">Commander X16</a>, and runs on the main CPU, so the KERNAL API (<code>talk</code>, <code>tksa</code>, <code>untlk</code>, <code>listn</code>, <code>secnd</code>, <code>unlsn</code>, <code>acptr</code>, <code>ciout</code>) calls directly into the DOS implementation. This allows <code>LOAD</code> speeds of about 140 KB/sec on an 8 MHz system.</p> \n<p>Demo:</p> \n<p><img src=\"https://www.pagetable.com/docs/cmdr-dos.gif\" alt=\"\" /></p> \n<p>Transcript:</p> \n<pre style=\"overflow:scroll; height:200px;\"><code>DOS\"$=P\":REM THERE ARE TWO PARTITIONS ON THIS SD-CARD\n\n255 \"CMDR-DOS SD CARD\"  MBR  \n1    \"PART1\"            FAT32  \n2    \"PART2\"            FAT32\n\nREADY.  \nDOS\"N1:SYSTEM,1616,FAT32\":REM FORMAT PARTITION 1\n\nREADY.  \nDOS\"N2:DATA,1617,FAT32\":REM FORMAT PARTITION 2\n\nREADY.  \nDOS\"$=P\":REM THE NEW NAMES OF THE TWO PARTITIONS\n\n255 \"CMDR-DOS SD CARD\"  MBR  \n1    \"SYSTEM\"           FAT32  \n2    \"DATA\"             FAT32\n\nREADY.  \nDOS\"CP1\":REM SWITCH TO PARTITION 1\n\nREADY.  \nDOS\"$\":REM SHOW DIRECTORY\n\n0 \"SYSTEM          \" FAT32  \n99 MB FREE.\n\nREADY.  \nOPEN1,8,2,\"HELLO,P,W\":PRINT#1,\"HELLO WORLD!\":CLOSE1:REM CREATE FILE\n\nREADY.  \nDOS\"$\"\n\n0 \"SYSTEM          \" FAT32  \n1    \"HELLO\"            PRG  \n99 MB FREE.\n\nREADY.  \nDOS\"C:WORLD=HELLO\":REM DUPLICATE FILE\n\nREADY.  \nDOS\"$\"\n\n0 \"SYSTEM          \" FAT32  \n1    \"HELLO\"            PRG  \n1    \"WORLD\"            PRG  \n99 MB FREE.\n\nREADY.  \nDOS\"C:HELLO WORLD=HELLO,WORLD\":REM CONCATENATE FILES\n\nREADY.  \nDOS\"$\"\n\n0 \"SYSTEM          \" FAT32  \n1    \"HELLO\"            PRG  \n1    \"WORLD\"            PRG  \n1    \"HELLO WORLD\"      PRG  \n99 MB FREE.\n\nREADY.  \nDOS\"MD:SECRET\":REM CREATE SUBDIRECTORY\n\nREADY.  \nDOS\"$\"\n\n0 \"SYSTEM          \" FAT32  \n1    \"HELLO\"            PRG  \n1    \"WORLD\"            PRG  \n1    \"HELLO WORLD\"      PRG  \n0    \"SECRET\"           DIR  \n99 MB FREE.\n\nREADY.  \nDOS\"$//SECRET/:\":REM SHOW SUBDIR CONTENTS\n\n0 \"SYSTEM          \" FAT32  \n0    \".\"                DIR  \n0    \"..\"               DIR  \n99 MB FREE.\n\nREADY.  \nDOS\"CD:SECRET\":REM CHANGE TO SUBDIR\n\nREADY.  \nDOS\"$\"\n\n0 \"SYSTEM          \" FAT32  \n0    \".\"                DIR  \n0    \"..\"               DIR  \n99 MB FREE.\n\nREADY.  \nDOS\"C:SECRET HELLO=//:HELLO\":REM COPY FILE FROM ROOT TO HERE\n\nREADY.  \nDOS\"CD:_\":REM CHANGE BACK UP\n\nREADY.  \nDOS\"CP2\":REM CHANGE TO PARTITION 2\n\nREADY.  \nDOS\"$\n\n0 \"DATA            \" FAT32  \n98 MB FREE.\n\nREADY.  \nDOS\"C:DATA FILE=1//SECRET/:SECRET HELLO\":REM COPY FILE FROM PARTITION 1\n\nREADY.  \nDOS\"$\n\n0 \"DATA            \" FAT32  \n1    \"DATA FILE\"        PRG  \n98 MB FREE.\n\nREADY.  \nDOS\"$1:\":REM SHOW DIRECTORY OF PARTITION 1\n\n1 \"SYSTEM          \" FAT32  \n1    \"HELLO\"            PRG  \n1    \"WORLD\"            PRG  \n1    \"HELLO WORLD\"      PRG  \n0    \"SECRET\"           DIR  \n99 MB FREE.\n\nREADY.  \nDOS\"S1:H*\":REM DELETE ALL FILES THERE STARTING WITH H\n\nREADY.  \nDOS:REM THIS WILL SAY THAT \"02\" FILES WERE DELETED  \n01, FILES SCRATCHED,02,00\n\nREADY.  \nDOS\"CP1\":REM CHANGE BACK TO PARTITION 1\n\nREADY.  \nDOS\"$\n\n0 \"SYSTEM          \" FAT32  \n1    \"WORLD\"            PRG  \n0    \"SECRET\"           DIR  \n99 MB FREE.\n\nREADY.  \nDOS\"S:*\":REM DELETE ALL REMAINING FILES\n\nREADY.  \nDOS:REM THIS WILL SAY THAT \"01\" FILE WAS DELETED  \n01, FILES SCRATCHED,01,00\n\nREADY.  \nDOS\"$\":REM THE DIRECTORY IS STILL THERE\n\n0 \"SYSTEM          \" FAT32  \n0    \"SECRET\"           DIR  \n99 MB FREE.\n\nREADY.  \nDOS\"RD:SECRET\":REM DELETE IT\n\nREADY.  \nDOS:REM \"00\" FILES DELETED, BECAUSE DIR WAS NOT EMPTY  \n01, FILES SCRATCHED,00,00\n\nREADY.  \nDOS\"S//SECRET/:*\":REM DELETE ALL FILES INSIDE\n\nREADY.  \nDOS:REM \"01\" FILE DELETED  \n01, FILES SCRATCHED,01,00\n\nREADY.  \nDOS\"RD:SECRET\":REM NOW TRY DELING THE DIR AGAIN\n\nREADY.  \nDOS:REM \"01\" FILES DELETED, IT WORKED THIS TIME  \n01, FILES SCRATCHED,01,00\n\nREADY.  \nDOS\"$\n\n0 \"SYSTEM          \" FAT32  \n99 MB FREE.\n\nREADY.  \nREM THAT'S IT. :)\n\nREADY.\n</code></pre> \n<h2 id=\"source\">Source</h2> \n<p>The implementation is part of the Commander X16 ROM and available here:</p> \n<p><a href=\"https://github.com/commanderx16/x16-rom/tree/master/dos\">https://github.com/commanderx16/x16-rom/tree/master/dos</a></p> \n<h2 id=\"future\">Future</h2> \n<p>The codebase is very versatile and could be reused for other kinds of projects:</p> \n<h3 id=\"other-new-retro-machines\">Other New Retro Machines</h3> \n<p>CMDR-DOS could be easily ported to other Commodore-like 65c02+ systems like the <a href=\"https://mega65.org\">MEGA65</a> and the <a href=\"https://www.c256foenix.com\">C256 Foenix</a>, providing a DOS interface to FAT32 on those platforms.</p> \n<h3 id=\"sd2iec-like-device\">sd2iec-like Device</h3> \n<p>Functionality-wise, the CMDR-DOS codebase is also very similar to what sd2iec does –&nbsp;minus the Commodore Serial part. It could be ported a device like the <a href=\"https://www.forum64.de/index.php?thread/102472-1581replica-gotek1581-1581-pc-drive-adapter/\">1581replica</a>, with an SD card attached instead of a disk drive, and one would have a 65c02-based sdi2ec-like device.</p>","descriptionType":"html","publishedDate":"Sat, 22 Aug 2020 08:17:36 +0000","feedId":19901,"bgimg":"https://www.pagetable.com/docs/cmdr-dos.gif","linkMd5":"0a221d13758ed67ed4b53242e504680c","author":"Michael Steil","articleImgCdnMap":{"https://www.pagetable.com/docs/cmdr-dos.gif":null},"publishedOrCreatedDate":1602567673769}],"record":{"createdTime":"2020-10-13 13:41:13","updatedTime":"2020-10-13 13:41:13","feedId":19901,"fetchDate":"Tue, 13 Oct 2020 05:41:13 +0000","fetchMs":507,"handleMs":54,"totalMs":247518,"newArticles":0,"totalArticles":100,"status":1,"type":0,"ip":"8f41f8a56dca4331062af167bd7997ff","hostName":"europe70*","requestId":"667cc5695fe944fe83338542a58e4198_19901","contentType":"application/rss+xml; charset=UTF-8","totalBytes":0,"bgimgsTotal":1,"bgimgsGithubTotal":0,"articlesImgsTotal":1,"articlesImgsGithubTotal":0,"successGithubMap":{},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 02:21:03","updatedTime":"2020-09-07 02:57:00","id":19901,"name":"pagetable.com","url":"http://www.pagetable.com/?feed=rss2","subscriber":166,"website":null,"icon":"https://www.pagetable.com/favicon.ico","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx61/cdn84@2020_5/2020/09/06/18-56-54-748_49cdf9342311a66c.jpg","description":"Some Assembly Required","weekly":null,"link":null},"noPictureArticleList":[{"createdTime":"2020-10-13 13:45:18","updatedTime":"2020-10-13 13:45:18","id":null,"feedId":19901,"linkMd5":"0a221d13758ed67ed4b53242e504680c"}],"tmpCommonImgCdnBytes":0,"tmpBodyImgCdnBytes":0,"tmpBgImgCdnBytes":0,"extra4":{"start":1602567671033,"total":0,"statList":[{"spend":2682,"msg":"获取xml内容"},{"spend":54,"msg":"解释文章"},{"spend":122816,"msg":"正文链接上传到cdn"},{"spend":122826,"msg":"上传封面图到cdn"},{"spend":1,"msg":"修正封面图上传失败重新上传"}]},"extra5":1,"extra6":0,"extra7ImgCdnFailResultVector":[null,null,null,null,null,null],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{},"extra12ImgCdnSuccessResultVector":[],"successGithubMap":{},"failGithubMap":{}}