{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-09-07 13:17:52","updatedTime":"2020-09-07 13:17:52","title":"更新浏览器缓存","link":"http://www.aoao.org.cn/?p=179","description":"<p>开始之前可以先看下这个 <a href=\"http://www.stevesouders.com/blog/2012/05/22/self-updating-scripts/\">Self-updating scripts</a>，看完了接着。</p>\n<p>动态构建iframe 的好处在于，想清啥就清啥，清的不一定是固定的资源，总会有需要清滴的。IE还有可以让要清的js不用运行，webkit的好像没找到适合的方式。</p>\n<pre class=\"code\"><code>function clearCache(js) {\n\tif(!(typeof(js) == 'object' && js.length>0 )){\t\t\n\t\treturn false;\n\t}<xmp>\tvar isIE = (navigator.userAgent.match(/MSIE/)!=null);\n\tvar mimetype = isIE ? 'type=\"text/cache\"' : '';\n\tvar jsClips = '<script '+ mimetype +' src=\"' + js.join('\"><\\/script><script '+ mimetype +' src=\"') + '\"><\\/script>';\n\tvar jsReload = '<script>if(window.name == \"\"){window.name = \"kill\";location.reload(true);}<\\/script>';\n\tvar html = '<html><body>'\n\t\t\t+ jsClips \n\t\t\t+ jsReload\n\t\t\t+ '</body></html>';\n\tvar ifr = document.createElement('iframe');\n\tifr.style.display =\"none\";\n\tif(isIE){\n\t\tifr.src = 'about:blank';\n\t\tdocument.body.appendChild(ifr);\n\t\tvar ifrdoc = ifr.contentWindow.document;\n\t\tifrdoc.open();\n\t\tifrdoc.write(html);\n\t\tifrdoc.close();\n\t}else{\n\t\tifr.src = \"data:text/html;charset=gbk,\"+ encodeURIComponent(html);\n\t\tdocument.body.appendChild(ifr);\n\t}</xmp>}</code></pre>\n<p>虽然脚本是可以被更新，但是什么时候更新才是最大一个问题。</p>\n<p>每次都去检查一下是否要更新，是个办法，但觉得有点浪费，以前我是用类如这种方式来创建一个4小时内的时间戳，对应请求的地址过期时间是10年 来减少消耗。</p>\n<pre class=\"code\"><code>parseInt((new Date()).getTime()/(1000*60*60*4)).toString(36)</code></pre>\n<p>当然如果可以单独给配指定的过期时间会更简单。</p>\n<p>现在呢？我觉得可以增加用 <code>localStorage</code>（低版本 IE 用 <code>userData</code> 顶）减少更多的消耗。</p>\n<p>不过说实话，怎样更新 一直没想好怎样做更适合</p>\n<p>除了用于更新第三方的，那是否可以应用到自身业务呢。在淘宝，某些通用的东东会被加上各种各样的时间戳，想统一时间戳最好的办法就是不用时间戳。 如果不带时间戳 定期在onload 之后再去检查更新我觉得是可接受的。</p>\n<p>想看下文吗 看这里 <a href=\"http://www.cnblogs.com/_franky/archive/2012/07/05/2577141.html\">浏览器静态资源的版本控制新思路.强制更新指定资源缓存.的探讨</a></p>\n","descriptionType":"html","publishedDate":"Sat, 16 Jun 2012 09:16:14 +0000","feedId":20980,"bgimg":"","linkMd5":"9585d6d4edbb5dd14ad70909318cfb83","bgimgJsdelivr":"","metaImg":"","author":"aoao","publishedOrCreatedDate":1599455872525}],"record":{"createdTime":"2020-09-07 13:17:52","updatedTime":"2020-09-07 13:17:52","feedId":20980,"fetchDate":"Mon, 07 Sep 2020 05:17:52 +0000","fetchMs":80,"handleMs":183971,"totalMs":184058,"newArticles":0,"totalArticles":20,"status":1,"type":0,"ip":"d01126ad4678a8e169f9117eff8589f2","hostName":"us-015*","requestId":"69f5bea93d364d9fa0fee0c81d908af2_20980","contentType":"application/rss+xml; charset=UTF-8","totalBytes":0,"bgimgsTotal":0,"bgimgsGithubTotal":0,"articlesImgsTotal":0,"articlesImgsGithubTotal":0,"successGithubMap":{},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 02:23:51","updatedTime":"2020-09-07 04:15:08","id":20980,"name":"样式之美","url":"http://feeds.feedburner.com/aoao","subscriber":158,"website":null,"icon":"http://www.aoao.org.cn/favicon.ico","icon_jsdelivr":null,"description":"没落的角落","weekly":null,"link":"http://www.aoao.org.cn"},"noPictureArticleList":[],"tmpCommonImgCdnBytes":0,"tmpBodyImgCdnBytes":0,"tmpBgImgCdnBytes":0,"extra4":{"start":1599455688471,"total":0,"statList":[{"spend":86,"msg":"获取xml内容"},{"spend":183971,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"正文链接上传到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"}]},"extra5":0,"extra6":0,"extra7ImgCdnFailResultVector":[],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{},"extra12ImgCdnSuccessResultVector":[],"successGithubMap":{},"failGithubMap":{}}