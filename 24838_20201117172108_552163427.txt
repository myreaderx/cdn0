{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-11-18 01:18:53","updatedTime":"2020-11-18 01:18:53","title":"基于 Docker 在 Win10 平台搭建 Ruby on Rails 6.0 框架开发环境","link":"https://ruby-china.org/topics/40586","description":"<p>原文转载自「刘悦的技术博客」<a href=\"https://v3u.cn/a_id_170\" rel=\"nofollow\" target=\"_blank\" title=\"\">https://v3u.cn/a_id_170</a></p>\n\n<p>2020 年，“非著名 Web 框架”--Ruby on Rails 已经 15 岁了。在今年，Rails 6.0 趋于完善，除了拿掉讨厌的 Jquery，Webpacker 也成为默认前端打包方案，Sprockets 开始软着陆，未来很可能会和 Jquery 一样被彻底废弃，这就是历史的进程。</p>\n\n<p>由于历史原因，本身就由 Ruby 撰写的 HomeBrew 在 Mac os 系统上大行其道，所以大部分 Rails 程序员的主力电脑都是 Mac book pro，而使用 Windows 系统的用户就没那么好运了，比如 Rails 6.0 开始启用 Webpacker，这就需要用户安装 yarn，由此带来一系列的连锁反应，还有令人绝望的 Win10 系统下的 CoffeeScript 问题，这也是 Rails 包括 Jekyll 时常令人诟病因素之一：搭个环境都这么费劲，我为啥不用 Django、Laravel 亦或者是 Springboot 呢？为什么非得受这份罪呢？因为.......热爱，本次我们使用 Docker 来简化 Rails 环境的搭建，让它能够在各个操作系统下做到无缝开发。</p>\n\n<p>当然了，第一步还是安装 Docker，没有安装的朋友请参照：<a href=\"https://v3u.cn/a_id_149\" rel=\"nofollow\" target=\"_blank\" title=\"\">win10 系统下把玩折腾 DockerToolBox 以及更换国内镜像源 (各种神坑)</a>。</p>\n\n<p>然后在电脑内建立一个 rails 项目的目录</p>\n <pre class=\"highlight plaintext\"><code>mkdir myr  \ncd myr\n</code></pre> \n<p>第三步，拉取基础镜像，该镜像内置了 ruby2.5.1 和 node11 为我们安装 Rails6.0 打好基础</p>\n <pre class=\"highlight plaintext\"><code>docker pull starefossen/ruby-node\n</code></pre> \n<p>拉取镜像成功后，启动容器并且进入命令行，记住用挂载命令把当前目录共享到 Docker 容器内部，不会设置共享文件夹的同学可以参照这篇文章：<a href=\"https://v3u.cn/a_id_166\" rel=\"nofollow\" target=\"_blank\" title=\"\">上穷碧落下凡尘:Win10 系统下基于 Docker 配置 Elasticsearch7 配合 Python3 进行全文检索交互</a></p>\n <pre class=\"highlight plaintext\"><code>docker run --rm -v /myr:/usr/src -w /usr/src -ti starefossen/ruby-node /bin/bash\n</code></pre> \n<p>由于在容器内部已经安装好 ruby2.5.1，所以 gem 也随之安装好，那么我们可以在容易内部安装 Rails</p>\n <pre class=\"highlight plaintext\"><code>gem install -v 6.0.2 rails\n</code></pre> \n<p>这里用-v 参数可控制版本号。</p>\n\n<p>在容器内安装 Rails6.0 成功之后，直接在容器内建立项目</p>\n <pre class=\"highlight plaintext\"><code>rails new .\n</code></pre> \n<p>项目建立好以后，你会发现在 windows 目录会同步出现 Rails 项目文件</p>\n\n<p><img src=\"https://v3u.cn/v3u/Public/js/editor/attached/20200804220844_35733.png\" title=\"\" alt=\"\"></p>\n\n<p>此时，在容器命令行内输入 exit 退出容器，此时容器就会停止并且删除，这个容器也完成了它的历史任务，它的存在就是帮我们创建好一个 Rails 项目，并且通过共享文件的形式在宿主机同步。</p>\n\n<p>下一步，为了能在宿主机运行我们的 Rails 服务，需要一个 Dockerfile 文件来定制我们自己的镜像</p>\n <pre class=\"highlight plaintext\"><code>FROM starefossen/ruby-node  \n\n# 设置项目目录  \nWORKDIR /usr/src/app  \n\n# 设置配置文件  \nCOPY Gemfile* ./  \nRUN bundle install  \n\n# 拷贝文件  \nCOPY . ./  \n\n# 暴露端口  \nEXPOSE 3000  \n\n# 启动服务命令  \nCMD [\"bundle\", \"exec\", \"rails\", \"server\", \"-b\", \"0.0.0.0\"]\n</code></pre> \n<p>写好 Dockerfile 之后，我们就可以打造一个全新的镜像，这个镜像用来运行我们已经建立好的 Rails 项目。</p>\n <pre class=\"highlight plaintext\"><code>docker build -t myr .\n</code></pre> \n<p>打包成功后，输入命令查看镜像</p>\n <pre class=\"highlight plaintext\"><code>docker images\n</code></pre> \n<p><img src=\"https://v3u.cn/v3u/Public/js/editor/attached/20200804220845_23254.png\" title=\"\" alt=\"\"></p>\n\n<p>此时，启动容器</p>\n <pre class=\"highlight plaintext\"><code>docker run -p 3000:3000 -v /myr:/usr/src/app/ myr\n</code></pre> \n<p>访问一下 <a href=\"http://localhost:3000\" rel=\"nofollow\" target=\"_blank\">http://localhost:3000</a></p>\n\n<p><img src=\"https://v3u.cn/v3u/Public/js/editor/attached/20200804220839_99469.png\" title=\"\" alt=\"\"></p>\n\n<p>熟悉的 “世界人民大团结” 欢迎页面已经映入眼帘，就是这么的简单，有人说了，Python 才是如今的 “当红炸子鸡”，现在学习 Rails 会不会是 “四九年入国军”？我想说的是，时至今年，全球依然有超过一亿的网站和后台服务由 Rails 驱动，其中不乏国际知名企业，如：Airbnb、Basecamp、Github 等，尽管 Php 和 Python 的使用范围比 Ruby 更广，但其最受欢迎的两个框架 Laravel 和 Django 分别比 Rails 的代码贡献者要少很多。更多的开源代码贡献者意味着 Gem 的质量非常之好，俗话说，Gem 为 Rails 倾尽了所有，而 Rails 经常被人们盛赞，也是因为支持它的社区正在努力创建非常多可重用的库。</p>\n\n<p>我们可以看看在 github 上的开源代码贡献者的数量对比：</p>\n\n<p>GitHub contributors to Ruby frameworks:  </p>\n\n<p>Rails: 4260<br>\nPadrino: 228<br>\nHanami: 146<br>\nSinatra: 387  </p>\n\n<p>GitHub contributors to Django (Python) and Laravel (PHP):  </p>\n\n<p>Django: 2,007<br>\nLaravel: 740</p>\n\n<p>差距可见一斑，归根结底，一款框架的开发和使用还是得以 “人” 为本。一如既往，专注 web，专注产品的 Rails6.0 在新的时代里一定会继往开来、再创辉煌。</p>\n\n<p>原文转载自「刘悦的技术博客」<a href=\"https://v3u.cn/a_id_170\" rel=\"nofollow\" target=\"_blank\" title=\"\">https://v3u.cn/a_id_170</a></p>","descriptionType":"text/html","publishedDate":"Tue, 17 Nov 2020 14:34:55 +0000","feedId":24838,"bgimg":"https://v3u.cn/v3u/Public/js/editor/attached/20200804220844_35733.png","linkMd5":"4b0cbe362b42b40d9a8822783028d380","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx18/cdn21@2020_1/2020/11/17/17-20-00-145_84d93d69584c42fd.webp","destWidth":1466,"destHeight":858,"sourceBytes":199061,"destBytes":32536,"author":"zcxey2911","articleImgCdnMap":{"https://v3u.cn/v3u/Public/js/editor/attached/20200804220844_35733.png":"https://cdn.jsdelivr.net/gh/myreaderx18/cdn21@2020_1/2020/11/17/17-20-00-145_84d93d69584c42fd.webp","https://v3u.cn/v3u/Public/js/editor/attached/20200804220845_23254.png":"https://cdn.jsdelivr.net/gh/myreaderx/cdn35@2020_6/2020/11/17/17-21-07-794_06eb4d2ee714bde6.webp","https://v3u.cn/v3u/Public/js/editor/attached/20200804220839_99469.png":"https://cdn.jsdelivr.net/gh/myreaderx15/cdn31@2020_3/2020/11/17/17-20-09-226_f9bd4846986ca4bc.webp"},"publishedOrCreatedDate":1605633533351}],"record":{"createdTime":"2020-11-18 01:18:53","updatedTime":"2020-11-18 01:18:53","feedId":24838,"fetchDate":"Tue, 17 Nov 2020 17:18:53 +0000","fetchMs":2399,"handleMs":15,"totalMs":137820,"newArticles":0,"totalArticles":20,"status":1,"type":0,"ip":"724f8e6abe96545fd3a077cef72be75c","hostName":"us-037*","requestId":"96617573a20b4aba9f992ec2b70109a2_24838","contentType":"application/xml; charset=utf-8","totalBytes":193206,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":3,"articlesImgsGithubTotal":3,"successGithubMap":{"myreaderx15":1,"myreaderx18":1,"myreaderx":1},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 02:34:15","updatedTime":"2020-09-07 04:30:54","id":24838,"name":"Ruby China社区","url":"http://ruby-china.org/topics/feed","subscriber":132,"website":null,"icon":"https://l.ruby-china.com/photo/2018/bd93b12d-98d0-47a4-9f7a-128b8a3271f7.png!large","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx64/cdn61@2020_6/2020/09/06/20-30-53-702_e409ca4dc8e134c0.png","description":"Ruby China社区最新发帖.","weekly":null,"link":null},"noPictureArticleList":[],"tmpCommonImgCdnBytes":32536,"tmpBodyImgCdnBytes":160670,"tmpBgImgCdnBytes":0,"extra4":{"start":1605633530936,"total":0,"statList":[{"spend":2400,"msg":"获取xml内容"},{"spend":15,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":67174,"msg":"正文链接上传到cdn"}]},"extra5":3,"extra6":3,"extra7ImgCdnFailResultVector":[null,null],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-53.herokuapp.com/":{"failCount":0,"successCount":2,"resultList":[200,200]},"http://us-030.herokuapp.com/":{"failCount":1,"successCount":0,"resultList":[null]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://v3u.cn/v3u/Public/js/editor/attached/20200804220844_35733.png","sourceStatusCode":200,"destWidth":1466,"destHeight":858,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx18/cdn21@2020_1/2020/11/17/17-20-00-145_84d93d69584c42fd.webp","sourceBytes":199061,"destBytes":32536,"targetWebpQuality":75,"feedId":24838,"totalSpendMs":7594,"convertSpendMs":50,"createdTime":"2020-11-18 01:19:53","host":"europe68*","referer":"https://ruby-china.org/topics/40586","linkMd5ListStr":"4b0cbe362b42b40d9a8822783028d380,4b0cbe362b42b40d9a8822783028d380","githubUser":"myreaderx18","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"194.4 KB","destSize":"31.8 KB","compressRate":"16.3%"},{"code":1,"isDone":false,"source":"https://v3u.cn/v3u/Public/js/editor/attached/20200804220839_99469.png","sourceStatusCode":200,"destWidth":1810,"destHeight":1090,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx15/cdn31@2020_3/2020/11/17/17-20-09-226_f9bd4846986ca4bc.webp","sourceBytes":586227,"destBytes":122284,"targetWebpQuality":75,"feedId":24838,"totalSpendMs":8766,"convertSpendMs":185,"createdTime":"2020-11-18 01:20:01","host":"us-53*","referer":"https://ruby-china.org/topics/40586","linkMd5ListStr":"4b0cbe362b42b40d9a8822783028d380","githubUser":"myreaderx15","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"572.5 KB","destSize":"119.4 KB","compressRate":"20.9%"},{"code":1,"isDone":false,"source":"https://v3u.cn/v3u/Public/js/editor/attached/20200804220845_23254.png","sourceStatusCode":200,"destWidth":1364,"destHeight":252,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx/cdn35@2020_6/2020/11/17/17-21-07-794_06eb4d2ee714bde6.webp","sourceBytes":72555,"destBytes":38386,"targetWebpQuality":75,"feedId":24838,"totalSpendMs":4456,"convertSpendMs":22,"createdTime":"2020-11-18 01:21:04","host":"us-53*","referer":"https://ruby-china.org/topics/40586","linkMd5ListStr":"4b0cbe362b42b40d9a8822783028d380","githubUser":"myreaderx","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"70.9 KB","destSize":"37.5 KB","compressRate":"52.9%"}],"successGithubMap":{"myreaderx15":1,"myreaderx18":1,"myreaderx":1},"failGithubMap":{}}