{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-12-03 11:10:05","updatedTime":"2020-12-03 11:10:05","title":"macOS的15个安全技巧（二）","link":"https://www.4hou.com/posts/p79m","description":"<p style=\"text-align: center;\"><img src=\"https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946559175777.png\" title=\"1591946215110361.png\" alt=\"01.png\"/></p><p><a href=\"https://www.4hou.com/posts/o7Ak\" target=\"_blank\" title=\"https://www.4hou.com/posts/o7Ak\">（接上文）</a></p><p><span style=\"font-size: 20px;\"><strong>隐藏桌面上的所有文件</strong></span></p><p style=\"text-align: left;\"><strong>技巧</strong></p><pre class=\"brush:html;toolbar:false\">chflags&#160;hidden&#160;~/Desktop/*</pre><p style=\"text-align: left;\">和</p><pre class=\"brush:html;toolbar:false\">chflags&#160;nohidden&#160;~/Desktop/*</pre><p style=\"text-align: left;\"><strong>介绍</strong></p><p style=\"text-align: left;\">另一个与记录和报告有关的技巧是：如果你需要获取桌面的屏幕截图或屏幕记录，那么除了移动或删除所有杂乱的桌面之外，还有一个替代方法，即使用chflags实用程序临时隐藏所有桌面文件。</p><p style=\"text-align: left;\">请注意，尽管这与使用Finder使用Keychord Command-Shift-Period显示/隐藏不可见文件的另一个技巧无关，但是，如果你已使用该Keychord在Finder中启用了不可见文件，则还需要再次调用&#160;Finder keychord并将设置切换为“关闭”，此技巧才能起作用。</p><p style=\"text-align: left;\">截屏或录制后，请不要忘记使用nohidden标志来取消隐藏。</p><p><span style=\"font-size: 20px;\"><strong>编码/解码URL字符串</strong></span></p><p style=\"text-align: left;\"><strong>技巧</strong></p><pre class=\"brush:html;toolbar:false\">alias&#160;urldecode=&#39;python3&#160;-c&#160;&#34;import&#160;sys,&#160;urllib.parse&#160;as&#160;ul;&#160;print(ul.unquote_plus(sys.argv[1]))&#34;&#39;</pre><p style=\"text-align: left;\">和</p><pre class=\"brush:html;toolbar:false\">alias&#160;urlencode=&#39;python3&#160;-c&#160;&#34;import&#160;sys,&#160;urllib.parse&#160;as&#160;ul;&#160;print(ul.quote_plus(sys.argv[1]))&#34;&#39;</pre><p style=\"text-align: left;\"><strong>介绍</strong></p><p style=\"text-align: left;\">百分比编码的URL字符串非常常见，因此我发现在我的shell .rc脚本中定义一个别名来处理它们非常有用，特别是用于解码。尽管这个技巧使用的是Python 3，但是还有许多其他方法可以使用不同的工具来实现这一点:Python 2、Perl、Ruby、纯Bash和Zsh等等，精确度各不相同。我个人更喜欢Python 3，因为根据我的经验，它是最可靠的。</p><p style=\"text-align: center;\"><img src=\"https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946559496906.jpeg\" title=\"1591946232981315.jpeg\" alt=\"30.jpg\"/></p><p><span style=\"font-size: 20px;\"><strong>创建一个随机命名的文件或目录</strong></span></p><p style=\"text-align: left;\"><strong>技巧</strong></p><pre class=\"brush:html;toolbar:false\">mktemp&#160;-d&#160;/tmp/XXXXXXXXXXXX</pre><p style=\"text-align: left;\"><strong>介绍</strong></p><p style=\"text-align: left;\">使用带有或不带-d开关的mktemp实用程序分别创建一个随机命名的文件或目录，不需要指定/private/tmp目录，你可以同样使用$TMPDIR目录或任何其他你希望的目录：如果没有路径前缀，该工具将在当前工作目录中创建随机命名的文件或目录。</p><p style=\"text-align: left;\">在防御性编程中，随机命名的临时文件非常有用，可以确保攻击者无法预测你可能需要定位应用程序或程序资源的临时文件的路径。类似地，攻击者使用它们将恶意文件放入临时目录和其他具有随机名称的位置，以帮助他们规避简单的基于路径的探测启发式和YARA规则，这些规则试图通过指定特定位置来减轻资源的负担。</p><p style=\"text-align: left;\">在上面的示例中，我使用12 Xs生成一个很难猜测的随机名称。但是，防御者和攻击者可以通过明智地使用正则表达式搜索模式在一定程度上让这个技巧变得无用。</p><p style=\"text-align: center;\"><img src=\"https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946560266930.jpeg\" title=\"1591946241854024.jpeg\" alt=\"32.jpg\"/></p><p style=\"text-align: left;\">顺便说一下，macOS上使用了许多不同的临时目录。虽然/tmp是/private/tmp的别名，但/private/var/tmp和$TMPDIR都是完全不同的位置，如以下图像中每个列表所证明的。我们从ls -al而不是$ TMPDIR的目录列表中显示计数，仅仅是因为那里的文件太多，所以无法方便地将其放入屏幕截图中。</p><p style=\"text-align: center;\"><img src=\"https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946561362088.jpeg\" title=\"1591946250174063.jpeg\" alt=\"33.jpg\"/></p><p><span style=\"font-size: 20px;\"><strong>使用Swift作为脚本语言</strong></span></p><p style=\"text-align: left;\"><strong>技巧</strong></p><pre class=\"brush:html;toolbar:false\">#!/usr/bin/swift</pre><p style=\"text-align: left;\">或</p><pre class=\"brush:html;toolbar:false\">#!/usr/bin/env&#160;swift</pre><p style=\"text-align: left;\"><strong>介绍</strong></p><p style=\"text-align: left;\">使用Swift作为脚本语言的优势在于，它允许你从文本文件运行代码，这些文本文件可以本地调用Apple Cocoa api。通过访问Foundation、AppKit和其他框架中的代码，你可以构建与本机二进制文件一样强大的可移植脚本，这对于攻击者或防御者来说都是理想的。</p><p style=\"text-align: left;\">以这种方式使用Swift取决于目标计算机上Xcode命令行工具的存在，因此这将你的目标主要限制在开发人员中，相当大的一群人通常不愿安装安全控件，而如果你正在考虑的话，可以选择一个不错的目标群体有关供应链攻击和横向移动的信息或者安装依赖作为post-exploitation的一部分。通过将脚本转换为自己计算机上的Swift二进制文件，然后将二进制文件导入到目标设备，可以完全避免依赖关系。为此，只需从脚本中删除shebang并使用swiftc编译器即可快速创建本机Mach-O二进制文件：</p><p style=\"text-align: left;\">swiftc&#160;my_script.swift&#160;-o&#160;my_script</p><p style=\"text-align: left;\">使用Swift作为脚本语言显然需要了解Swift本身，你可以在<a href=\"https://rderik.com/blog/using-swift-for-scripting/\" target=\"_self\">Derik Ramirez</a>的网站上找到很好的介绍。</p><p style=\"text-align: center;\"><img src=\"https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946561424039.png\" title=\"1591946336412681.png\" alt=\"微信截图_20200612151844.png\"/></p><p style=\"text-align: left;\">现在，请注意使用#!/usr/bin/env形式的此脚本或任何其他脚本shebang的注意事项。开发人员通常会推荐这种做法，因为这样可以确保即使shell程序不在标准路径中，也不会存在多种版本（例如Python 2，Python 2.7，Python 3等），shell都可以找到该可执行文件。但是，从安全角度来看，这会引入潜在的漏洞。由于env将使用指定名称（例如，Swift）首先出现在用户$ PATH中的任何可执行文件，因此恶意进程可能会在用户路径的顶部删除一个cuckoo二进制文件，并执行该文件，而不是真正的Swift二进制文件。出于这个原因，如果需要考虑安全性，我建议始终使用Swift(和其他)二进制文件的绝对路径。</p><p><span style=\"font-size: 20px;\"><strong>在截屏时移动或调整所选区域的大小</strong></span></p><p style=\"text-align: left;\"><strong>技巧</strong></p><p style=\"text-align: left;\">用Command-Shift-4选择区域时按住空格键。</p><p style=\"text-align: left;\"><strong>介绍</strong></p><p style=\"text-align: left;\">这是我几个月前才学会的一个奇妙的技巧，尽管我多年来每天都使用screencapture keychordCommand-Shift-4。虽然该办法可以让你快速选择一个自定义区域，但如果你的起始位置不对，则操作结果会出现偏差。</p><p style=\"text-align: left;\">使用此技巧，你无需取消Esc并重试。按住鼠标/触控板以避免拍摄，然后只需按住空格键并移动光标即可将所选区域重新定位到所需位置。重新定位后释放空格键，并根据需要通过常规拖动继续进行调整，释放鼠标/触控板进行拍摄。</p><p style=\"text-align: center;\"><img src=\"https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946562113322.gif\" title=\"1591946345178751.gif\" alt=\"38.gif\"/></p><p style=\"text-align: left;\">在macOS Catalina 10.15中，还有额外的Command-Shift-5&#160;keychord，它提供了来自HUD风格界面的各种选项，包括指定不同的默认保存位置。</p><p><span style=\"font-size: 20px;\"><strong>将Cocoa时间戳转换为人类可读的日期</strong></span></p><p style=\"text-align: left;\"><strong>技巧</strong></p><pre class=\"brush:html;toolbar:false\">date&#160;-r&#160;$((&#160;+&#160;978307200))</pre><p style=\"text-align: left;\"><strong>介</strong><strong>绍</strong></p><p style=\"text-align: left;\">这是我在前面介绍macOS事件响应时提到过的一个技巧，但是值得在这里重复一遍。从1970年1月1日星期一00:00:00开始的Unix时间戳已在macOS和其他操作系统中广泛使用，可以在命令行上使用日期实用程序将它们转换为人类可读的形式。</p><p style=\"text-align: left;\">Cocoa时间戳大家可能就不太熟悉了，它采用类似的形式，但通常有一个表示第二个追加部分的小数，如587381138.016775。不过，最重要的区别是，Cocoa的时间戳开始时间要比Unix&#160;晚31年，即2001年1月1日。因此，要使用日期实用程序转换Cocoa时间戳，我们需要添加31年的差异，即978307200秒。出于大多数非取证的目的，可以忽略小数点后一秒的分数。</p><p style=\"text-align: center;\"><img src=\"https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946562622380.jpeg\" title=\"1591946357153967.jpeg\" alt=\"40.jpg\"/></p>","descriptionType":"text/html","publishedDate":"Thu, 03 Dec 2020 02:45:00 +0000","feedId":6942,"bgimg":"https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946559175777.png","linkMd5":"6dc8aaa8371f6f6fe2fdccf37a7fbae5","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx19/cdn64@2020_4/2020/12/03/03-10-08-683_ec9effd3de993fb3.webp","destWidth":958,"destHeight":393,"sourceBytes":185403,"destBytes":16606,"author":"lucywang","articleImgCdnMap":{"https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946559175777.png":"https://cdn.jsdelivr.net/gh/myreaderx19/cdn64@2020_4/2020/12/03/03-10-08-683_ec9effd3de993fb3.webp","https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946559496906.jpeg":"https://cdn.jsdelivr.net/gh/myreaderx15/cdn88@2020_4/2020/12/03/03-10-13-470_3de55317ce95e1bb.webp","https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946560266930.jpeg":"https://cdn.jsdelivr.net/gh/myreaderx16/cdn71@2020_3/2020/12/03/03-10-13-145_60c48b5fa3fdadcf.webp","https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946561362088.jpeg":"https://cdn.jsdelivr.net/gh/myreaderx30/cdn75@2020_4/2020/12/03/03-10-13-235_be6dab017e063f7f.webp","https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946561424039.png":"https://cdn.jsdelivr.net/gh/myreaderx4/cdn83@2020_5/2020/12/03/03-10-13-491_09ab946b87c7caaf.webp","https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946562113322.gif":"https://cdn.jsdelivr.net/gh/myreaderx31/cdn78@2020_6/2020/12/03/03-10-32-127_eaf94f1350f83b2a.webp","https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946562622380.jpeg":"https://cdn.jsdelivr.net/gh/myreaderx12/cdn67@2020_4/2020/12/03/03-10-12-165_7540e8720f1ac3e6.webp"},"publishedOrCreatedDate":1606965005547}],"record":{"createdTime":"2020-12-03 11:10:05","updatedTime":"2020-12-03 11:10:05","feedId":6942,"fetchDate":"Thu, 03 Dec 2020 03:10:05 +0000","fetchMs":3676,"handleMs":30,"totalMs":32540,"newArticles":0,"totalArticles":20,"status":1,"type":0,"ip":"c79a5f941582c1930444d374ae5e4ab9","hostName":"europe66*","requestId":"b03d8b7439ce47c2b77b6a09124b83bc_6942","contentType":"text/xml; charset=UTF-8","totalBytes":965548,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":7,"articlesImgsGithubTotal":7,"successGithubMap":{"myreaderx15":1,"myreaderx16":1,"myreaderx4":1,"myreaderx12":1,"myreaderx30":1,"myreaderx31":1,"myreaderx19":1},"failGithubMap":{}},"feed":{"createdTime":"2020-08-25 04:33:21","updatedTime":"2020-09-05 15:32:54","id":6942,"name":"嘶吼 RoarTalk – 回归最本质的信息安全,互联网安全新媒体,4hou.com","url":"http://www.4hou.com/feed","subscriber":null,"website":null,"icon":"https://www.4hou.com/favicon.ico","icon_jsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx61/cdn65@2020_4/2020/09/05/07-30-55-487_3d63d92d260693c0.jpg","description":"嘶吼是一家新兴的互联网安全新媒体，为您带来不一样的互联网安全新视界。嘶吼的出现将为信息安全领域带来更有力量的声音，我们的每一声嘶吼，都如雷贯耳；每一个步伐，都掷地有声！","weekly":null,"link":null},"noPictureArticleList":[],"tmpCommonImgCdnBytes":16606,"tmpBodyImgCdnBytes":948942,"tmpBgImgCdnBytes":0,"extra4":{"start":1606965000878,"total":0,"statList":[{"spend":4640,"msg":"获取xml内容"},{"spend":30,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":23829,"msg":"正文链接上传到cdn"}]},"extra5":7,"extra6":7,"extra7ImgCdnFailResultVector":[],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{"http://us-038.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-037.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://europe-23.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-010.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-014.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]},"http://us-026.herokuapp.com/":{"failCount":0,"successCount":1,"resultList":[200]}},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946559175777.png","sourceStatusCode":200,"destWidth":958,"destHeight":393,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx19/cdn64@2020_4/2020/12/03/03-10-08-683_ec9effd3de993fb3.webp","sourceBytes":185403,"destBytes":16606,"targetWebpQuality":75,"feedId":6942,"totalSpendMs":3876,"convertSpendMs":33,"createdTime":"2020-12-03 11:10:05","host":"us-022*","referer":"https://www.4hou.com/posts/p79m","linkMd5ListStr":"6dc8aaa8371f6f6fe2fdccf37a7fbae5,6dc8aaa8371f6f6fe2fdccf37a7fbae5","githubUser":"myreaderx19","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"181.1 KB","destSize":"16.2 KB","compressRate":"9%"},{"code":1,"isDone":false,"source":"https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946562622380.jpeg","sourceStatusCode":200,"destWidth":1258,"destHeight":268,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx12/cdn67@2020_4/2020/12/03/03-10-12-165_7540e8720f1ac3e6.webp","sourceBytes":32602,"destBytes":21522,"targetWebpQuality":75,"feedId":6942,"totalSpendMs":3315,"convertSpendMs":18,"createdTime":"2020-12-03 11:10:09","host":"us-010*","referer":"https://www.4hou.com/posts/p79m","linkMd5ListStr":"6dc8aaa8371f6f6fe2fdccf37a7fbae5","githubUser":"myreaderx12","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"31.8 KB","destSize":"21 KB","compressRate":"66%"},{"code":1,"isDone":false,"source":"https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946561362088.jpeg","sourceStatusCode":200,"destWidth":1135,"destHeight":681,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx30/cdn75@2020_4/2020/12/03/03-10-13-235_be6dab017e063f7f.webp","sourceBytes":107066,"destBytes":97326,"targetWebpQuality":75,"feedId":6942,"totalSpendMs":4569,"convertSpendMs":169,"createdTime":"2020-12-03 11:10:09","host":"us-037*","referer":"https://www.4hou.com/posts/p79m","linkMd5ListStr":"6dc8aaa8371f6f6fe2fdccf37a7fbae5","githubUser":"myreaderx30","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"104.6 KB","destSize":"95 KB","compressRate":"90.9%"},{"code":1,"isDone":false,"source":"https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946560266930.jpeg","sourceStatusCode":200,"destWidth":1189,"destHeight":514,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx16/cdn71@2020_3/2020/12/03/03-10-13-145_60c48b5fa3fdadcf.webp","sourceBytes":79105,"destBytes":62442,"targetWebpQuality":75,"feedId":6942,"totalSpendMs":4720,"convertSpendMs":28,"createdTime":"2020-12-03 11:10:09","host":"europe-23*","referer":"https://www.4hou.com/posts/p79m","linkMd5ListStr":"6dc8aaa8371f6f6fe2fdccf37a7fbae5","githubUser":"myreaderx16","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"77.3 KB","destSize":"61 KB","compressRate":"78.9%"},{"code":1,"isDone":false,"source":"https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946561424039.png","sourceStatusCode":200,"destWidth":682,"destHeight":274,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx4/cdn83@2020_5/2020/12/03/03-10-13-491_09ab946b87c7caaf.webp","sourceBytes":54958,"destBytes":13426,"targetWebpQuality":75,"feedId":6942,"totalSpendMs":4603,"convertSpendMs":9,"createdTime":"2020-12-03 11:10:09","host":"us-026*","referer":"https://www.4hou.com/posts/p79m","linkMd5ListStr":"6dc8aaa8371f6f6fe2fdccf37a7fbae5","githubUser":"myreaderx4","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"53.7 KB","destSize":"13.1 KB","compressRate":"24.4%"},{"code":1,"isDone":false,"source":"https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946559496906.jpeg","sourceStatusCode":200,"destWidth":882,"destHeight":242,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx15/cdn88@2020_4/2020/12/03/03-10-13-470_3de55317ce95e1bb.webp","sourceBytes":39095,"destBytes":35214,"targetWebpQuality":75,"feedId":6942,"totalSpendMs":4615,"convertSpendMs":13,"createdTime":"2020-12-03 11:10:09","host":"us-014*","referer":"https://www.4hou.com/posts/p79m","linkMd5ListStr":"6dc8aaa8371f6f6fe2fdccf37a7fbae5","githubUser":"myreaderx15","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"38.2 KB","destSize":"34.4 KB","compressRate":"90.1%"},{"code":1,"isDone":false,"source":"https://img.4hou.com/uploads/ueditor/php/upload/image/20200612/1591946562113322.gif","sourceStatusCode":200,"destWidth":1280,"destHeight":720,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx31/cdn78@2020_6/2020/12/03/03-10-32-127_eaf94f1350f83b2a.webp","sourceBytes":1185247,"destBytes":719012,"targetWebpQuality":75,"feedId":6942,"totalSpendMs":23650,"convertSpendMs":18485,"createdTime":"2020-12-03 11:10:09","host":"us-038*","referer":"https://www.4hou.com/posts/p79m","linkMd5ListStr":"6dc8aaa8371f6f6fe2fdccf37a7fbae5","githubUser":"myreaderx31","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"1.1 MB","destSize":"702.2 KB","compressRate":"60.7%"}],"successGithubMap":{"myreaderx15":1,"myreaderx16":1,"myreaderx4":1,"myreaderx12":1,"myreaderx30":1,"myreaderx31":1,"myreaderx19":1},"failGithubMap":{}}