{"code":1,"isDone":false,"toInsertArticleList":[{"createdTime":"2020-10-19 13:07:06","updatedTime":"2020-10-19 13:07:06","title":"\n        NVIDIA PRIME 配置笔记\n      ","link":"https://blog.lilydjwg.me/posts/214768","description":"\n        <p style=\"text-indent: 2em; font-style: italic;\">本文来自<a href=\"https://blog.lilydjwg.me/\">依云's Blog</a>，转载请注明。</p><p>\n\t这是由 NVIDIA 官方提供的新的双显卡配置方案（<a href=\"http://download.nvidia.com/XFree86/Linux-x86_64/435.21/README/primerenderoffload.html\">官方文档</a>），需要最新的驱动及 Xorg 支持。其中 nvidia 驱动已经位于 Arch Linux 官方仓库中（版本号 435.21）。<strike>相关 Xorg 补丁还在 git 上，并没有新版本放出，所以需要自行编译包含补丁的版本。<a href=\"https://gitlab.freedesktop.org/aplattner/arch-xorg-server\">这里</a>有现成的 PKGBUILD。我打包好的版本也<a href=\"https://build.archlinuxcn.org/~lilydjwg/\">提供下载</a>。</strike></p>\n<p>\n\t<strong>2019年11月25日更新</strong>：xorg-server 1.20.6 已经进入 Arch Linux 官方仓库，包含需要的补丁了。</p>\n<p>\n\t<strong>2020年02月14日更新</strong>：现在也可以通过安装 nvidia-prime 直接配置好，就不用搞下边那些配置了。记得安装 nvidia（或者 nvidia-dkms 等）驱动包哦～</p>\n<p>\n\t我的硬件是 ThinkPad T470p，Intel Corporation HD Graphics 630 核显和 GeForce 940MX 独显。核显的特点是：省电、支持视频编解码加速。独显的特点是：Minecraft 能开光影，FPS 也要高一点。用来跑火狐的话可以正确渲染 <a href=\"http://www.fishgl.com/\">FishGL</a>。</p>\n<p>\n\t配置方法如下。</p>\n<p>\n\t首先把 bbswitch 啥的都卸载了吧。虽然注意点不卸载也没事，但是毕竟装着没意义还容易出问题。然后看看 /etc/modprobe.d 下有没有黑名单 nvidia 的驱动，给它取消了。我有一个 <code>options nvidia_drm modeset=1</code> 的配置，不知道有没有影响。</p>\n<p>\n\tXorg 这边要加一段配置。就保存在 /etc/X11/xorg.conf.d/nvidia.conf 好了。</p>\n<pre class=\"brush: plain;\" title=\"nvidia.conf\">\nSection &#34;ServerLayout&#34;\n  Identifier &#34;layout&#34;\n  Screen 0 &#34;iGPU&#34;\n  Option &#34;AllowNVIDIAGPUScreens&#34;\nEndSection\n\nSection &#34;Device&#34;\n  Identifier &#34;iGPU&#34;\n  Driver &#34;modesetting&#34;\n  BusID &#34;PCI:0:2:0&#34;\nEndSection\n\nSection &#34;Screen&#34;\n  Identifier &#34;iGPU&#34;\n  Device &#34;iGPU&#34;\nEndSection\n\nSection &#34;Device&#34;\n  Identifier &#34;dGPU&#34;\n  Driver &#34;nvidia&#34;\nEndSection\n</pre>\n<p>\n\t那个 <code>BusID</code> 的值要自己看着 <code>lspci | grep VGA</code> 来改。</p>\n<p>\n\t如果你之前是用N卡跑 Xorg 的，需要把 <code>xrandr --setprovideroutputsource modesetting NVIDIA-0</code> 之类的设置去掉。</p>\n<p>\n\t然后重启系统就可以了。请做好通过 tty 或者 ssh 修复配置的准备。</p>\n<p>\n\t默认情况下，Xorg 及其上的程序运行于i卡。使用 <code>__NV_PRIME_RENDER_OFFLOAD=1 __GLX_VENDOR_LIBRARY_NAME=nvidia</code> 环境变量来指定使用N卡。为了方便起见，做一个别名好了：</p>\n<pre class=\"brush: bash;\">\nalias nvrun=&#34;__NV_PRIME_RENDER_OFFLOAD=1 __GLX_VENDOR_LIBRARY_NAME=nvidia&#34;\n</pre>\n<p>\n\t然后就可以 <code>nvrun minecraft-launcher</code> 啦～</p>\n<p style=\"text-align: center;\">\n\t<a href=\"https://store.lilydjwg.me/img/blog/nvidia-prime/mc-bsl-shader.png\"><img alt=\"Minecraft BSL 光影效果\" src=\"https://store.lilydjwg.me/img/blog/nvidia-prime/mc-bsl-shader.png\" /></a></p>\n<p>\n\t对了，要注意一下的是，这两个环境变量对视频硬解也是有效的。比如我如果给 mpv 使用这两个环境变量的话，mpv 就会黑屏（我的N卡不支持硬解&#8230;&#8230;</p>\n\n      ","descriptionType":"text/html","publishedDate":"Tue, 03 Sep 2019 08:18:30 +0000","feedId":31814,"bgimg":"https://store.lilydjwg.me/img/blog/nvidia-prime/mc-bsl-shader.png","linkMd5":"397f7b54fc794c18f6b50790b2fb961a","bgimgJsdelivr":"https://cdn.jsdelivr.net/gh/myreaderx22/cdn40@2020_6/2020/10/19/05-07-08-383_6f4b4a1a8f9de0ed.webp","destWidth":1024,"destHeight":563,"sourceBytes":742134,"destBytes":50968,"author":"依云","articleImgCdnMap":{"https://store.lilydjwg.me/img/blog/nvidia-prime/mc-bsl-shader.png":"https://cdn.jsdelivr.net/gh/myreaderx22/cdn40@2020_6/2020/10/19/05-07-08-383_6f4b4a1a8f9de0ed.webp"},"publishedOrCreatedDate":1603084026448}],"record":{"createdTime":"2020-10-19 13:07:06","updatedTime":"2020-10-19 13:07:06","feedId":31814,"fetchDate":"Mon, 19 Oct 2020 05:07:06 +0000","fetchMs":142,"handleMs":180372,"totalMs":183720,"newArticles":0,"totalArticles":12,"status":1,"type":0,"ip":"71aab6be87ca2a527ee0da8dd54c34d1","hostName":"europe21*","requestId":"bf0daf242a194b1599843008dc0f206b_31814","contentType":"application/rss+xml; charset=utf-8","totalBytes":50968,"bgimgsTotal":1,"bgimgsGithubTotal":1,"articlesImgsTotal":1,"articlesImgsGithubTotal":1,"successGithubMap":{"myreaderx22":1},"failGithubMap":{}},"feed":{"createdTime":"2020-09-07 02:53:45","updatedTime":"2020-09-07 02:53:45","id":31814,"name":"\n      依云's Blog\n    ","url":"http://blog.lilydjwg.me/posts.rss","subscriber":101,"website":null,"icon":"https://blog.lilydjwg.me/favicon.ico","icon_jsdelivr":null,"description":"\n      \n    ","weekly":null,"link":"https://blog.lilydjwg.me"},"noPictureArticleList":[],"tmpCommonImgCdnBytes":50968,"tmpBodyImgCdnBytes":0,"tmpBgImgCdnBytes":0,"extra4":{"start":1603083845919,"total":0,"statList":[{"spend":157,"msg":"获取xml内容"},{"spend":180372,"msg":"解释文章"},{"spend":0,"msg":"上传封面图到cdn"},{"spend":0,"msg":"修正封面图上传失败重新上传"},{"spend":0,"msg":"正文链接上传到cdn"}]},"extra5":1,"extra6":1,"extra7ImgCdnFailResultVector":[],"extra10_invalidATagHrefValue":{},"extra111_proxyServerAndStatMap":{},"extra12ImgCdnSuccessResultVector":[{"code":1,"isDone":false,"source":"https://store.lilydjwg.me/img/blog/nvidia-prime/mc-bsl-shader.png","sourceStatusCode":200,"destWidth":1024,"destHeight":563,"fixedGithubDest":"https://cdn.jsdelivr.net/gh/myreaderx22/cdn40@2020_6/2020/10/19/05-07-08-383_6f4b4a1a8f9de0ed.webp","sourceBytes":742134,"destBytes":50968,"targetWebpQuality":75,"feedId":31814,"totalSpendMs":3162,"convertSpendMs":56,"createdTime":"2020-10-19 13:07:06","host":"europe61*","referer":"https://blog.lilydjwg.me/posts/214768","linkMd5ListStr":"397f7b54fc794c18f6b50790b2fb961a,397f7b54fc794c18f6b50790b2fb961a","githubUser":"myreaderx22","githubHttpCode":201,"extra22GetBytesInfo":"1、没有Referer字段","extra23historyStatusCode":[200],"sourceSize":"724.7 KB","destSize":"49.8 KB","compressRate":"6.9%"}],"successGithubMap":{"myreaderx22":1},"failGithubMap":{}}